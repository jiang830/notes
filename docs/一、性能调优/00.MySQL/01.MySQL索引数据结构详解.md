---
title: MySQL索引数据结构详解
date: 2022-08-31 01:56:40
permalink: /pages/1c9782/
categories: 
  - MySQL
author: 
  name: 江
---
## 索引数据结构

索引是帮助MySQL高效获取数据的排好序的数据结构

### 二叉树

极端情况下会变成一条直线

### 红黑树

相比于二叉树，数据平衡了，但是在数据比较多的情况下，树的高度会比较高，查询数据困难

### Hash表

- 对索引的key进行一次hash计算就可以定位出数据存储的位置

- 很多时候Hash索引要比B+ 树索引更高效

- 仅能满足 “=”，“IN”，不支持范围查询

- hash冲突问题

  ![image-20230630211334131](https://img.jssjqd.cn/202306302113889.png)

### B-Tree

- 叶节点具有相同的深度，叶节点的指针为空
- 所有索引元素不重复
- 节点中的数据索引从左到右递增排列

![](https://img.jssjqd.cn/20221025015342.png)

### B+Tree(B-Tree变种)

- 非叶子节点不存储data，只存储索引(冗余)，可以放更多的索引
- 叶子节点包含所有索引字段
- 叶子节点用指针连接，提高区间访问的性能

![](https://img.jssjqd.cn/20221025015420.png)

*B+Tree对比B-Tree的优点：*

- B+Tree 解决的两大问题是（每个节点存储更多关键字；路数更多）
- 扫库、扫表能力更强（如果我们要对表进行全表扫描，只需要遍历叶子节点就可以了，不需要遍历整棵 B+Tree 拿到所有的数据）
- B+Tree 的磁盘读写能力相对于 B Tree 来说更强，同数据量下磁盘I/0次数更少（根节点和枝节点不保存数据区，所以一个节点可以保存更多的关键字，一次磁盘加载的关键字更多）
- 范围查询和排序能力更强（因为叶子节点上有下一个数据区的指针，数据形成了链表）
- 效率更加稳定（B+Tree 永远是在叶子节点拿到数据，所以 IO 次数是稳定的）

## 存储引擎

### MyISAM

MyISAM索引文件和数据文件是分离的(非聚簇索引)

![image-20230701004320293](https://img.jssjqd.cn/202307010043485.png)

### InnoDB

InnoDB索引实现(聚簇索引)

1. **表数据文件本身就是按B+Tree组织的一个索引结构文件**

2. **聚集索引-叶节点包含了完整的数据记录**

3. **为什么建议InnoDB表必须建主键？**

   聚簇索引默认是主键，如果表中没有定义主键，InnoDB 会选择一个唯一的非空索引（确切说会选择一个唯一非空的列作为主键）代替。如果没有这样的索引，InnoDB 会隐式定义一个主键来作为聚簇索引。

4. **并且推荐使用整型的自增主键？**

   数据插入数据库时会根据主键对数据进行排序，查询数据时也需要对主键进行对比，整型主键在插入排序和查询对比时都比使用普通字符串作为主键的效率更高，而主键自增可以有效的避免数据页分裂，整形主键能减少主键占用的空间。

5. **为什么非主键索引结构叶子节点存储的是主键值？**

   数据一致性和节省存储空间

![image-20230701004415970](https://img.jssjqd.cn/202307010044300.png)

![image-20230701004426711](https://img.jssjqd.cn/202307010044396.png)

## 索引最左前缀原理

### 联合索引的底层存储结构

![image-20230701030747964](https://img.jssjqd.cn/202307010307955.png)

## 千万级数据表如何用B+树索引快速查找

## 聚集索引&聚簇索引&稀疏索引是什么

## 为什么DBA推荐用自增主键做索引

## 联合索引底层数据结构是怎么样的

## MySQL最左前缀优化原则

