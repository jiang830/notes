(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{356:function(t,s,a){"use strict";a.r(s);var n=a(4),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[s("strong",[t._v("前置启动程序")])]),t._v(" "),s("p",[t._v("事先启动一个web应用程序，用jps查看其进程id，接着用各种jdk自带命令优化应用")]),t._v(" "),s("h3",{attrs:{id:"jmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jmap"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Jmap")])]),t._v(" "),s("p",[t._v("此命令可以用来查看内存信息，实例个数以及占用内存大小")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232740.png",alt:""}})]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("jmap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("histo "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14660")]),t._v("  #查看历史生成的实例\njmap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("histo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("live "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14660")]),t._v("  #查看当前存活的实例，执行过程中可能会触发一次full gc\n")])])]),s("p",[t._v("打开log.txt，文件内容如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232749.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("num：序号")]),t._v(" "),s("li",[t._v("instances：实例数量")]),t._v(" "),s("li",[t._v("bytes：占用空间大小")]),t._v(" "),s("li",[t._v("class name：类名称，[C is a char[]，[S is a short[]，[I is a int[]，[B is a byte[]，[[I is a int[][]")])]),t._v(" "),s("h4",{attrs:{id:"堆信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#堆信息"}},[t._v("#")]),t._v(" 堆信息")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232806.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"堆内存dump"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#堆内存dump"}},[t._v("#")]),t._v(" 堆内存dump")]),t._v(" "),s("div",{staticClass:"language-\\ extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("jmap -dump:format=b,file=eureka.hprof 14660              \n")])])]),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232814.png",alt:""}})]),t._v(" "),s("p",[t._v("也可以设置内存溢出自动导出dump文件(内存很大的时候，可能会导不出来)")]),t._v(" "),s("ol",[s("li",[t._v("-XX:+HeapDumpOnOutOfMemoryError")]),t._v(" "),s("li",[t._v("-XX:HeapDumpPath=./  （路径）")])]),t._v(" "),s("p",[t._v("示例代码：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OOMTest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// JVM设置    ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// -Xms10M -Xmx10M -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=D:\\jvm.dump ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" j "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UUID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("randomUUID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("j"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UUID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("randomUUID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n")])])]),s("p",[s("strong",[t._v("可以用jvisualvm命令工具导入该dump文件分析")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232826.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"jstack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jstack"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Jstack")])]),t._v(" "),s("p",[t._v("用jstack加进程id查找死锁，见如下示例")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeadLockTest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" lock1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" lock2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thread1 begin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thread1 end"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thread2 begin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thread2 end"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"main thread end"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232833.png",alt:""}})]),t._v(" "),s("p",[t._v('"Thread-1" 线程名')]),t._v(" "),s("p",[t._v("prio=5 优先级=5")]),t._v(" "),s("p",[t._v("tid=0x000000001fa9e000 线程id")]),t._v(" "),s("p",[t._v("nid=0x2d64 线程对应的本地线程标识nid")]),t._v(" "),s("p",[t._v("java.lang.Thread.State: BLOCKED 线程状态")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232839.png",alt:""}})]),t._v(" "),s("p",[t._v("还可以用jvisualvm自动检测死锁")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232845.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("远程连接jvisualvm")])]),t._v(" "),s("p",[s("strong",[t._v("启动普通的jar程序JMX端口配置：")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("java -Dcom.sun.management.jmxremote.port=8888 -Djava.rmi.server.hostname=192.168.65.60 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -jar microservice-eureka-server.jar   \n")])])]),s("p",[t._v("PS：")]),t._v(" "),s("p",[t._v("-Dcom.sun.management.jmxremote.port 为远程机器的JMX端口")]),t._v(" "),s("p",[t._v("-Djava.rmi.server.hostname 为远程机器IP")]),t._v(" "),s("p",[s("strong",[t._v("tomcat的JMX配置：在catalina.sh文件里的最后一个JAVA_OPTS的赋值语句下一行增加如下配置行")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.port=8888 -Djava.rmi.server.hostname=192.168.50.60 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false"    \n')])])]),s("p",[t._v("连接时确认下端口是否通畅，可以临时关闭下防火墙")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("systemctl stop firewalld   #临时关闭防火墙              \n")])])]),s("h4",{attrs:{id:"jstack找出占用cpu最高的线程堆栈信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jstack找出占用cpu最高的线程堆栈信息"}},[t._v("#")]),t._v(" "),s("strong",[t._v("jstack找出占用cpu最高的线程堆栈信息")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tuling"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jvm")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 运行此代码，cpu会飙高\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Math")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" initData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("666")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//一个方法对应一块栈帧内存区域")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Math")]),t._v(" math "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Math")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            math"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("1，使用命令top -p  ，显示你的java进程的内存情况，pid是你的java进程号，比如19663")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232854.png",alt:""}})]),t._v(" "),s("p",[t._v("2，按H，获取每个线程的内存情况")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232901.png",alt:""}})]),t._v(" "),s("p",[t._v("3，找到内存和cpu占用最高的线程tid，比如19664")]),t._v(" "),s("p",[t._v("4，转为十六进制得到 0x4cd0，此为线程id的十六进制表示")]),t._v(" "),s("p",[t._v("5，执行 jstack 19663|grep -A 10 4cd0，得到线程堆栈信息中 4cd0 这个线程所在行的后面10行，从堆栈中可以发现导致cpu飙高的调用方法")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232910.png",alt:""}})]),t._v(" "),s("p",[t._v("6，查看对应的堆栈信息找出可能存在问题的代码")]),t._v(" "),s("h3",{attrs:{id:"jinfo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jinfo"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Jinfo")])]),t._v(" "),s("p",[t._v("查看正在运行的Java应用程序的扩展参数")]),t._v(" "),s("h4",{attrs:{id:"查看jvm的参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看jvm的参数"}},[t._v("#")]),t._v(" 查看jvm的参数 "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232919.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"查看java系统参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看java系统参数"}},[t._v("#")]),t._v(" 查看java系统参数")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232931.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"jstat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jstat"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Jstat")])]),t._v(" "),s("p",[t._v("jstat命令可以查看堆内存各部分的使用量，以及加载类的数量。命令的格式如下：")]),t._v(" "),s("p",[t._v("jstat [-命令选项] [vmid] [间隔时间(毫秒)] [查询次数]")]),t._v(" "),s("p",[t._v("注意：使用的jdk版本是jdk8")]),t._v(" "),s("h4",{attrs:{id:"垃圾回收统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收统计"}},[t._v("#")]),t._v(" 垃圾回收统计")]),t._v(" "),s("p",[s("strong",[t._v("jstat -gc pid 最常用")]),t._v("，可以评估程序内存使用及GC压力整体情况")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232939.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("S0C：第一个幸存区的大小，单位KB")]),t._v(" "),s("li",[t._v("S1C：第二个幸存区的大小")]),t._v(" "),s("li",[t._v("S0U：第一个幸存区的使用大小")]),t._v(" "),s("li",[t._v("S1U：第二个幸存区的使用大小")]),t._v(" "),s("li",[t._v("EC：伊甸园区的大小")]),t._v(" "),s("li",[t._v("EU：伊甸园区的使用大小")]),t._v(" "),s("li",[t._v("OC：老年代大小")]),t._v(" "),s("li",[t._v("OU：老年代使用大小")]),t._v(" "),s("li",[t._v("MC：方法区大小(元空间)")]),t._v(" "),s("li",[t._v("MU：方法区使用大小")]),t._v(" "),s("li",[t._v("CCSC:压缩类空间大小")]),t._v(" "),s("li",[t._v("CCSU:压缩类空间使用大小")]),t._v(" "),s("li",[t._v("YGC：年轻代垃圾回收次数")]),t._v(" "),s("li",[t._v("YGCT：年轻代垃圾回收消耗时间，单位s")]),t._v(" "),s("li",[t._v("FGC：老年代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGCT：老年代垃圾回收消耗时间，单位s")]),t._v(" "),s("li",[t._v("GCT：垃圾回收消耗总时间，单位s")])]),t._v(" "),s("h4",{attrs:{id:"堆内存统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#堆内存统计"}},[t._v("#")]),t._v(" 堆内存统计")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232946.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("NGCMN：新生代最小容量")]),t._v(" "),s("li",[t._v("NGCMX：新生代最大容量")]),t._v(" "),s("li",[t._v("NGC：当前新生代容量")]),t._v(" "),s("li",[t._v("S0C：第一个幸存区大小")]),t._v(" "),s("li",[t._v("S1C：第二个幸存区的大小")]),t._v(" "),s("li",[t._v("EC：伊甸园区的大小")]),t._v(" "),s("li",[t._v("OGCMN：老年代最小容量")]),t._v(" "),s("li",[t._v("OGCMX：老年代最大容量")]),t._v(" "),s("li",[t._v("OGC：当前老年代大小")]),t._v(" "),s("li",[t._v("OC:当前老年代大小")]),t._v(" "),s("li",[t._v("MCMN:最小元数据容量")]),t._v(" "),s("li",[t._v("MCMX：最大元数据容量")]),t._v(" "),s("li",[t._v("MC：当前元数据空间大小")]),t._v(" "),s("li",[t._v("CCSMN：最小压缩类空间大小")]),t._v(" "),s("li",[t._v("CCSMX：最大压缩类空间大小")]),t._v(" "),s("li",[t._v("CCSC：当前压缩类空间大小")]),t._v(" "),s("li",[t._v("YGC：年轻代gc次数")]),t._v(" "),s("li",[t._v("FGC：老年代GC次数")])]),t._v(" "),s("h4",{attrs:{id:"新生代垃圾回收统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新生代垃圾回收统计"}},[t._v("#")]),t._v(" 新生代垃圾回收统计")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010232953.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("S0C：第一个幸存区的大小")]),t._v(" "),s("li",[t._v("S1C：第二个幸存区的大小")]),t._v(" "),s("li",[t._v("S0U：第一个幸存区的使用大小")]),t._v(" "),s("li",[t._v("S1U：第二个幸存区的使用大小")]),t._v(" "),s("li",[t._v("TT:对象在新生代存活的次数")]),t._v(" "),s("li",[t._v("MTT:对象在新生代存活的最大次数")]),t._v(" "),s("li",[t._v("DSS:期望的幸存区大小")]),t._v(" "),s("li",[t._v("EC：伊甸园区的大小")]),t._v(" "),s("li",[t._v("EU：伊甸园区的使用大小")]),t._v(" "),s("li",[t._v("YGC：年轻代垃圾回收次数")]),t._v(" "),s("li",[t._v("YGCT：年轻代垃圾回收消耗时间")])]),t._v(" "),s("h4",{attrs:{id:"新生代内存统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新生代内存统计"}},[t._v("#")]),t._v(" 新生代内存统计")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233007.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("NGCMN：新生代最小容量")]),t._v(" "),s("li",[t._v("NGCMX：新生代最大容量")]),t._v(" "),s("li",[t._v("NGC：当前新生代容量")]),t._v(" "),s("li",[t._v("S0CMX：最大幸存1区大小")]),t._v(" "),s("li",[t._v("S0C：当前幸存1区大小")]),t._v(" "),s("li",[t._v("S1CMX：最大幸存2区大小")]),t._v(" "),s("li",[t._v("S1C：当前幸存2区大小")]),t._v(" "),s("li",[t._v("ECMX：最大伊甸园区大小")]),t._v(" "),s("li",[t._v("EC：当前伊甸园区大小")]),t._v(" "),s("li",[t._v("YGC：年轻代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGC：老年代回收次数")])]),t._v(" "),s("h4",{attrs:{id:"老年代垃圾回收统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#老年代垃圾回收统计"}},[t._v("#")]),t._v(" 老年代垃圾回收统计")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233018.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("MC：方法区大小")]),t._v(" "),s("li",[t._v("MU：方法区使用大小")]),t._v(" "),s("li",[t._v("CCSC:压缩类空间大小")]),t._v(" "),s("li",[t._v("CCSU:压缩类空间使用大小")]),t._v(" "),s("li",[t._v("OC：老年代大小")]),t._v(" "),s("li",[t._v("OU：老年代使用大小")]),t._v(" "),s("li",[t._v("YGC：年轻代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGC：老年代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGCT：老年代垃圾回收消耗时间")]),t._v(" "),s("li",[t._v("GCT：垃圾回收消耗总时间")])]),t._v(" "),s("h4",{attrs:{id:"老年代内存统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#老年代内存统计"}},[t._v("#")]),t._v(" 老年代内存统计")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233025.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("OGCMN：老年代最小容量")]),t._v(" "),s("li",[t._v("OGCMX：老年代最大容量")]),t._v(" "),s("li",[t._v("OGC：当前老年代大小")]),t._v(" "),s("li",[t._v("OC：老年代大小")]),t._v(" "),s("li",[t._v("YGC：年轻代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGC：老年代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGCT：老年代垃圾回收消耗时间")]),t._v(" "),s("li",[t._v("GCT：垃圾回收消耗总时间")])]),t._v(" "),s("h4",{attrs:{id:"元数据空间统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#元数据空间统计"}},[t._v("#")]),t._v(" 元数据空间统计")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233036.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("MCMN:最小元数据容量")]),t._v(" "),s("li",[t._v("MCMX：最大元数据容量")]),t._v(" "),s("li",[t._v("MC：当前元数据空间大小")]),t._v(" "),s("li",[t._v("CCSMN：最小压缩类空间大小")]),t._v(" "),s("li",[t._v("CCSMX：最大压缩类空间大小")]),t._v(" "),s("li",[t._v("CCSC：当前压缩类空间大小")]),t._v(" "),s("li",[t._v("YGC：年轻代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGC：老年代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGCT：老年代垃圾回收消耗时间")]),t._v(" "),s("li",[t._v("GCT：垃圾回收消耗总时间")])]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233050.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("S0：幸存1区当前使用比例")]),t._v(" "),s("li",[t._v("S1：幸存2区当前使用比例")]),t._v(" "),s("li",[t._v("E：伊甸园区使用比例")]),t._v(" "),s("li",[t._v("O：老年代使用比例")]),t._v(" "),s("li",[t._v("M：元数据区使用比例")]),t._v(" "),s("li",[t._v("CCS：压缩使用比例")]),t._v(" "),s("li",[t._v("YGC：年轻代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGC：老年代垃圾回收次数")]),t._v(" "),s("li",[t._v("FGCT：老年代垃圾回收消耗时间")]),t._v(" "),s("li",[t._v("GCT：垃圾回收消耗总时间")])]),t._v(" "),s("h3",{attrs:{id:"jvm运行情况预估"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm运行情况预估"}},[t._v("#")]),t._v(" "),s("strong",[t._v("JVM运行情况预估")])]),t._v(" "),s("p",[t._v("用 jstat gc -pid 命令可以计算出如下一些关键数据，有了这些数据就可以采用之前介绍过的优化思路，先给自己的系统设置一些初始性的JVM参数，比如堆内存大小，年轻代大小，Eden和Survivor的比例，老年代的大小，大对象的阈值，大龄对象进入老年代的阈值等。")]),t._v(" "),s("h4",{attrs:{id:"年轻代对象增长的速率"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#年轻代对象增长的速率"}},[t._v("#")]),t._v(" "),s("strong",[t._v("年轻代对象增长的速率")])]),t._v(" "),s("p",[t._v("可以执行命令 jstat -gc pid 1000 10 (每隔1秒执行1次命令，共执行10次)，通过观察EU(eden区的使用)来估算每秒eden大概新增多少对象，如果系统负载不高，可以把频率1秒换成1分钟，甚至10分钟来观察整体情况。注意，一般系统可能有高峰期和日常期，所以需要在不同的时间分别估算不同情况下对象增长速率。")]),t._v(" "),s("h4",{attrs:{id:"young-gc的触发频率和每次耗时"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#young-gc的触发频率和每次耗时"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Young GC的触发频率和每次耗时")])]),t._v(" "),s("p",[t._v("知道年轻代对象增长速率我们就能推根据eden区的大小推算出Young GC大概多久触发一次，Young GC的平均耗时可以通过 YGCT/YGC 公式算出，根据结果我们大概就能知道"),s("strong",[t._v("系统大概多久会因为Young GC的执行而卡顿多久。")])]),t._v(" "),s("h4",{attrs:{id:"每次young-gc后有多少对象存活和进入老年代"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#每次young-gc后有多少对象存活和进入老年代"}},[t._v("#")]),t._v(" "),s("strong",[t._v("每次Young GC后有多少对象存活和进入老年代")])]),t._v(" "),s("p",[t._v("这个因为之前已经大概知道Young GC的频率，假设是每5分钟一次，那么可以执行命令 jstat -gc pid 300000 10 ，观察每次结果eden，survivor和老年代使用的变化情况，在每次gc后eden区使用一般会大幅减少，survivor和老年代都有可能增长，这些增长的对象就是每次Young GC后存活的对象，同时还可以看出每次Young GC后进去老年代大概多少对象，从而可以推算出"),s("strong",[t._v("老年代对象增长速率。")])]),t._v(" "),s("h4",{attrs:{id:"full-gc的触发频率和每次耗时"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#full-gc的触发频率和每次耗时"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Full GC的触发频率和每次耗时")])]),t._v(" "),s("p",[t._v("知道了老年代对象的增长速率就可以推算出Full GC的触发频率了，Full GC的每次耗时可以用公式 FGCT/FGC 计算得出。")]),t._v(" "),s("p",[s("strong",[t._v("优化思路")]),t._v("其实简单来说就是尽量让每次Young GC后的存活对象小于Survivor区域的50%，都留存在年轻代里。尽量别让对象进入老年代。尽量减少Full GC的频率，避免频繁Full GC对JVM性能的影响。")]),t._v(" "),s("h3",{attrs:{id:"系统频繁full-gc导致系统卡顿是怎么回事"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统频繁full-gc导致系统卡顿是怎么回事"}},[t._v("#")]),t._v(" "),s("strong",[t._v("系统频繁Full GC导致系统卡顿是怎么回事")])]),t._v(" "),s("ul",[s("li",[t._v("机器配置：2核4G")]),t._v(" "),s("li",[t._v("JVM内存大小：2G")]),t._v(" "),s("li",[t._v("系统运行时间：7天")]),t._v(" "),s("li",[t._v("期间发生的Full GC次数和耗时：500多次，200多秒")]),t._v(" "),s("li",[t._v("期间发生的Young GC次数和耗时：1万多次，500多秒")])]),t._v(" "),s("p",[t._v("大致算下来每天会发生70多次Full GC，平均每小时3次，每次Full GC在400毫秒左右；")]),t._v(" "),s("p",[t._v("每天会发生1000多次Young GC，每分钟会发生1次，每次Young GC在50毫秒左右。")]),t._v(" "),s("p",[t._v("JVM参数设置如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("-Xms1536M -Xmx1536M -Xmn512M -Xss256K -XX:SurvivorRatio=6  -XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M \n-XX:+UseParNewGC  -XX:+UseConcMarkSweepGC  -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly\n")])])]),s("p",[t._v("​")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233102.png",alt:""}})]),t._v(" "),s("p",[t._v("大家可以结合"),s("strong",[t._v("对象挪动到老年代那些规则")]),t._v("推理下我们这个程序可能存在的一些问题")]),t._v(" "),s("p",[t._v("经过分析感觉可能会由于对象动态年龄判断机制导致full gc较为频繁")]),t._v(" "),s("p",[t._v("为了给大家看效果，我模拟了一个示例程序(见课程对应工程代码：jvm-full-gc)，打印了jstat的结果如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("jstat -gc 13456 2000 10000              \n")])])]),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233108.png",alt:""}})]),t._v(" "),s("p",[t._v("对于对象动态年龄判断机制导致的full gc较为频繁可以先试着优化下JVM参数，把年轻代适当调大点：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("  -Xms1536M -Xmx1536M -Xmn1024M -Xss256K -XX:SurvivorRatio=6  -XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M \n-XX:+UseParNewGC  -XX:+UseConcMarkSweepGC  -XX:CMSInitiatingOccupancyFraction=92 -XX:+UseCMSInitiatingOccupancyOnly \n")])])]),s("p",[t._v("​")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233114.png",alt:""}})]),t._v(" "),s("p",[t._v("优化完发现没什么变化，"),s("strong",[t._v("full gc的次数比minor gc的次数还多了")])]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233122.png",alt:""}})]),t._v(" "),s("p",[t._v("我们可以推测下full gc比minor gc还多的原因有哪些？")]),t._v(" "),s("p",[t._v("1、元空间不够导致的多余full gc")]),t._v(" "),s("p",[t._v("2、显示调用System.gc()造成多余的full gc，这种一般线上尽量通过-XX:+DisableExplicitGC参数禁用，如果加上了这个JVM启动参数，那么代码中调用System.gc()没有任何效果")]),t._v(" "),s("p",[t._v("3、老年代空间分配担保机制")]),t._v(" "),s("p",[t._v("最快速度分析完这些我们推测的原因以及优化后，我们发现young gc和full gc依然很频繁了，而且看到有大量的对象频繁的被挪动到老年代，这种情况我们可以借助jmap命令大概看下是什么对象")]),t._v(" "),s("p",[t._v("​    "),s("img",{attrs:{src:"https://img.jssjqd.cn/20221010233130.png",alt:""}})]),t._v(" "),s("p",[t._v("查到了有大量User对象产生，这个可能是问题所在，但不确定，还必须找到对应的代码确认，如何去找对应的代码了？")]),t._v(" "),s("p",[t._v("1、代码里全文搜索生成User对象的地方(适合只有少数几处地方的情况)")]),t._v(" "),s("p",[t._v("2、如果生成User对象的地方太多，无法定位具体代码，我们可以同时分析下占用cpu较高的线程，一般有大量对象不断产生，对应的方法代码肯定会被频繁调用，占用的cpu必然较高")]),t._v(" "),s("p",[t._v("可以用上面讲过的jstack或jvisualvm来定位cpu使用较高的代码，最终定位到的代码如下：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RestController")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IndexController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/user/process"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processUserData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" users "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("queryUsers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//TODO 业务处理")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"end"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 模拟批量查询用户场景\n     * @return\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("queryUsers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" users "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zhuge"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("同时，java的代码也是需要优化的，一次查询出500M的对象出来，明显不合适，要根据之前说的各种原则尽量优化到合适的值，尽量消除这种朝生夕死的对象导致的full gc")]),t._v(" "),s("h3",{attrs:{id:"内存泄露到底是怎么回事"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内存泄露到底是怎么回事"}},[t._v("#")]),t._v(" "),s("strong",[t._v("内存泄露到底是怎么回事")])]),t._v(" "),s("p",[t._v("再给大家讲一种情况，一般电商架构可能会使用多级缓存架构，就是redis加上JVM级缓存，大多数同学可能为了图方便对于JVM级缓存就简单使用一个hashmap，于是不断往里面放缓存数据，但是很少考虑这个map的容量问题，结果这个缓存map越来越大，一直占用着老年代的很多空间，时间长了就会导致full gc非常频繁，这就是一种内存泄漏，对于一些老旧数据没有及时清理导致一直占用着宝贵的内存资源，时间长了除了导致full gc，还有可能导致OOM。")]),t._v(" "),s("p",[t._v("这种情况完全可以考虑采用一些成熟的JVM级缓存框架来解决，比如ehcache等自带一些LRU数据淘汰算法的框架来作为JVM级的缓存。")])])}),[],!1,null,null,null);s.default=r.exports}}]);