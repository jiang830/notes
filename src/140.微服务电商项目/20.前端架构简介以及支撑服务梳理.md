---
title: 前端架构简介以及支撑服务梳理
date: 2023-05-04 07:36:32
permalink: /pages/cb5d91/
categories: 
  - 微服务电商平台
author: 
  name: 江
---
快速梳理电商项目中一些非核心的支撑服务。包括前端的重要流程以及分布式任务调度。课程内容主要是带一些基础比较薄弱的同学快速的熟悉整个电商项目，为后面马上就要开始的微服务内容进行铺垫。

主要关注点是以下几个问题：

- 电商前端重要功能梳理：快速熟悉前端项目的启动方式，路由策略，以及状态保存机制电商登录用户状态同步机制梳理：以这个示例场景熟悉电商项目前后端交互的机制。
- 分布式任务调度系统部署及使用：快速部署并开发一个xxljob定时任务。具体的业务会在后续课程中讲解，这里只介绍xxljob的部署及开发方式。

## 电商前端项目简介

电商项目采用前后端分离的架构，前端有两个应用

- mall-admin-web：这个是电商管理系统的前端工程
- tlmall-front：这个是电商项目的前端工程。这两个前端工程都是采用VUE框架开发的前端项目。关于VUE框架的基础知识，比如Nodejs环境搭建、VUE的模版加载、双向绑定等

### 前端项目启动方式

**mall-admin-web项目的开发环境启动指令： npm run dev 。 本地可以通过开发环境直接启动。**

**tlmall-front项目的开发环境启动指令： npm run serve 。注：需要在本地先安装nodejs，建议版本v14.15.0**

如果第一次启动，需要使用npm install指令下载node依赖。所有依赖会下载到node_modules目录下。

如果出现错误**Local package.json exists, but node_modules missing, did you mean to install？**可以使用cnpm install指令下载。cnpm指令默认访问的是国内阿里的镜像库资源，比npm更稳定。

如果不清楚指令，可以查看项目中的package.json文件。里面的scripts部分就对应具体的指令。

开发环境下可以启动本地调试模式。在IDE中修改前端代码，会即时编译并生效。

如果要部署到生产环境，可以使用 npm run build(两个项目配的都一样)。Vue会将整个项目编译成压缩的文件，放到项目的dist目录下。后续如果需要执行的话，需要自行部署nginx。将dist目录下的文件全部拷贝到nginx的工作目录中即可执行。nginx中的参考配置如下

```properties
server {
	listen 81;
	index index.html index.htm index.php;
	root /www/server/nginx;
	#error_page 404 /404. html;
	include enable-php.conf;
	location / {
		root tlmall - admin;
		index index.html index.htm index.php;
	}
	access_log /www/wwwlogs/access.log;
}

server {
	listen 88;
	index index.html index.htm index.php;
	root /www/server/nginx;
	#error_page 404 /404. html;
	include enable-php.conf;
	location / {
		index index.html index.htm index.php;
		root tlmall - front;
	}
	location /home/ {
		proxy_set_header Host $http_host;
		proxy_set_header X - Real - IP $remote_addr;
		proxy_set_header REMOTE - HOST $remote_addr;
		proxy_set_header X - Forwarded - For $proxy_add_x_forwarded_for;
		#proxy_pass http: //192.168.65.214:8887/home/;
		proxy_pass http: //192.168.65.214:8888/home/;
	}
	location /pms/ {
		proxy_set_header Host $http_host;
		proxy_set_header X - Real - IP $remote_addr;
		proxy_set_header REMOTE - HOST $remote_addr;
		proxy_set_header X - Forwarded - For $proxy_add_x_forwarded_for;
		#proxy_pass http: //192.168.65.220:8866/pms/;
		proxy_pass http: //192.168.65.214:8888/pms/;
	}
	location /cart/ {
		proxy_set_header Host $http_host;
		proxy_set_header X - Real - IP $remote_addr;
		proxy_set_header REMOTE - HOST $remote_addr;
		proxy_set_header X - Forwarded - For $proxy_add_x_forwarded_for;
		#proxy_pass http: //192.168.65.165:8855/cart/;
		proxy_pass http: //192.168.65.214:8888/cart/;
	}
	location /sso/ {
		proxy_set_header Host $http_host;
		proxy_set_header X - Real - IP $remote_addr;
		proxy_set_header REMOTE - HOST $remote_addr;
		proxy_set_header X - Forwarded - For $proxy_add_x_forwarded_for;
		#proxy_pass http: //192.168.65.152:8877/sso/;
		proxy_pass http: //192.168.65.214:8888/sso/;
	}
	location /member/ {
		proxy_set_header Host $http_host;
		proxy_set_header X - Real - IP $remote_addr;
		proxy_set_header REMOTE - HOST $remote_addr;
		proxy_set_header X - Forwarded - For $proxy_add_x_forwarded_for;
		#proxy_pass http: //192.168.65.152:8877/member/;
		proxy_pass http: //192.168.65.214:8888/member/;
	}
	location /order/ {
		proxy_set_header Host $http_host;
		proxy_set_header X - Real - IP $remote_addr;
		proxy_set_header REMOTE - HOST $remote_addr;
		proxy_set_header X - Forwarded - For $proxy_add_x_forwarded_for;
		#proxy_pass http: //192.168.65.221:8844/order/;
		proxy_pass http: //192.168.65.214:8888/order/;
	}
	location /static/qrcode/ {
		proxy_set_header Host $http_host;
		proxy_set_header X - Real - IP $remote_addr;
		proxy_set_header REMOTE - HOST $remote_addr;
		proxy_set_header X - Forwarded - For $proxy_add_x_forwarded_for;
		proxy_pass http://192.168.65.221:8844/static/qrcode/;
	}
	location /es/ {
		proxy_set_header Host $http_host;
		proxy_set_header X - Real - IP $remote_addr;
		proxy_set_header REMOTE - HOST $remote_addr;
		proxy_set_header X - Forwarded - For $proxy_add_x_forwarded_for;
		proxy_pass http://192.168.65.152:8054/;
	}
	access_log /www/wwwlogs/access.log;
}
```

> 88端口为mall-admin-web。 81端口为tlmall-front
> 192.168.65.214:8888 为网关服务的部署地址。 后端服务地址根据部署情况自行调整。网关模块会对登录状态进行验证后， 再通过微服务进行请求转发。

### 前端页面路由机制

这一部分主要是要能通过前端路径快速定位到vue源码。 项目中使用vue-router组件快速进行前端跳转。 核心的配置文件是router.js。这个文件会列出vue框架支持的所有URL。

> mall-admin-web中的文件是src /router/index.js

可以通过下图快速进行前端路径定位

![image-20230419072247282](https://img.jssjqd.cn/202304190722608.png)

### 后端请求路由机制

vue的前端请求地址都是以/#/开头，后端跳转地址没有#号。

mall-admin-web的后端地址配置在/config/dev.env.js中。

