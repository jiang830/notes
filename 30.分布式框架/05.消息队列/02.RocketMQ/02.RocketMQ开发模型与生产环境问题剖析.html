<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html"><meta property="og:site_name" content="å­¦ä¹ ç¬”è®°"><meta property="og:title" content="RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ"><meta property="og:description" content="ä¸€ã€RocketMQåŸç”ŸAPIä½¿ç”¨ ä½¿ç”¨RocketMQçš„åŸç”ŸAPIå¼€å‘æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯ç›®å‰çœ‹æ¥æœ€ç‰¢é çš„æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨SpringBootæ¥æ­å»ºä¸€ç³»åˆ—æ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œæ¥è®¿é—®æˆ‘ä»¬ä¹‹å‰æ­å»ºçš„RocketMQé›†ç¾¤ã€‚ æµ‹è¯•ç¯å¢ƒæ­å»º é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸºäºMavençš„SpringBootå·¥ç¨‹ï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š &lt;dependency&gt; &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt; &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt; &lt;version&gt;4.9.1&lt;/version&gt; &lt;/dependency&gt;"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-08-04T19:54:20.000Z"><meta property="article:author" content="æ±Ÿ"><meta property="article:published_time" content="2023-05-06T01:54:45.000Z"><meta property="article:modified_time" content="2023-08-04T19:54:20.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ","image":[""],"datePublished":"2023-05-06T01:54:45.000Z","dateModified":"2023-08-04T19:54:20.000Z","author":[{"@type":"Person","name":"æ±Ÿ","url":""}]}</script><title>RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ | å­¦ä¹ ç¬”è®°</title><meta name="description" content="ä¸€ã€RocketMQåŸç”ŸAPIä½¿ç”¨ ä½¿ç”¨RocketMQçš„åŸç”ŸAPIå¼€å‘æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯ç›®å‰çœ‹æ¥æœ€ç‰¢é çš„æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨SpringBootæ¥æ­å»ºä¸€ç³»åˆ—æ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œæ¥è®¿é—®æˆ‘ä»¬ä¹‹å‰æ­å»ºçš„RocketMQé›†ç¾¤ã€‚ æµ‹è¯•ç¯å¢ƒæ­å»º é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸºäºMavençš„SpringBootå·¥ç¨‹ï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š &lt;dependency&gt; &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt; &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt; &lt;version&gt;4.9.1&lt;/version&gt; &lt;/dependency&gt;">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-850a8bcc.css" as="style"><link rel="stylesheet" href="/assets/style-850a8bcc.css">
    <link rel="modulepreload" href="/assets/app-f4353c56.js"><link rel="modulepreload" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-a65d40cf.js"><link rel="modulepreload" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-123b3c01.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/index.html-5f01c542.js" as="script"><link rel="prefetch" href="/assets/index.html-08138681.js" as="script"><link rel="prefetch" href="/assets/index.html-d14d0c68.js" as="script"><link rel="prefetch" href="/assets/index.html-98383a1a.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-dcf53bc4.js" as="script"><link rel="prefetch" href="/assets/index.html-40146f04.js" as="script"><link rel="prefetch" href="/assets/index.html-7c6de113.js" as="script"><link rel="prefetch" href="/assets/index.html-90c4edb6.js" as="script"><link rel="prefetch" href="/assets/index.html-5740cc96.js" as="script"><link rel="prefetch" href="/assets/index.html-79f5cf89.js" as="script"><link rel="prefetch" href="/assets/index.html-d42c9465.js" as="script"><link rel="prefetch" href="/assets/index.html-fbfeb765.js" as="script"><link rel="prefetch" href="/assets/index.html-a52ad201.js" as="script"><link rel="prefetch" href="/assets/index.html-adeb5ba1.js" as="script"><link rel="prefetch" href="/assets/index.html-13d75c62.js" as="script"><link rel="prefetch" href="/assets/index.html-339df355.js" as="script"><link rel="prefetch" href="/assets/index.html-dea7e948.js" as="script"><link rel="prefetch" href="/assets/index.html-06915e7d.js" as="script"><link rel="prefetch" href="/assets/index.html-6d0b2ab3.js" as="script"><link rel="prefetch" href="/assets/index.html-586f2c43.js" as="script"><link rel="prefetch" href="/assets/index.html-bf02eb80.js" as="script"><link rel="prefetch" href="/assets/index.html-dbeee8f1.js" as="script"><link rel="prefetch" href="/assets/index.html-ee64cb4d.js" as="script"><link rel="prefetch" href="/assets/index.html-674a8b56.js" as="script"><link rel="prefetch" href="/assets/index.html-58ab8062.js" as="script"><link rel="prefetch" href="/assets/index.html-83a0e995.js" as="script"><link rel="prefetch" href="/assets/index.html-b73af924.js" as="script"><link rel="prefetch" href="/assets/index.html-84b41bc2.js" as="script"><link rel="prefetch" href="/assets/index.html-513b3acd.js" as="script"><link rel="prefetch" href="/assets/index.html-86c88439.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-dcb18191.js" as="script"><link rel="prefetch" href="/assets/index.html-0cedfbf4.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-3cb03205.js" as="script"><link rel="prefetch" href="/assets/index.html-e73145da.js" as="script"><link rel="prefetch" href="/assets/index.html-2a667421.js" as="script"><link rel="prefetch" href="/assets/index.html-7e99793c.js" as="script"><link rel="prefetch" href="/assets/index.html-0caa24d1.js" as="script"><link rel="prefetch" href="/assets/index.html-ec040a6f.js" as="script"><link rel="prefetch" href="/assets/index.html-5c7760e6.js" as="script"><link rel="prefetch" href="/assets/index.html-e05cfd95.js" as="script"><link rel="prefetch" href="/assets/index.html-56864292.js" as="script"><link rel="prefetch" href="/assets/index.html-85f12f8e.js" as="script"><link rel="prefetch" href="/assets/index.html-36215535.js" as="script"><link rel="prefetch" href="/assets/index.html-a0b00179.js" as="script"><link rel="prefetch" href="/assets/index.html-b369598e.js" as="script"><link rel="prefetch" href="/assets/index.html-16522702.js" as="script"><link rel="prefetch" href="/assets/index.html-d4b10f11.js" as="script"><link rel="prefetch" href="/assets/index.html-32274a84.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-e098d384.js" as="script"><link rel="prefetch" href="/assets/index.html-a1c2babe.js" as="script"><link rel="prefetch" href="/assets/index.html-5051cb2a.js" as="script"><link rel="prefetch" href="/assets/index.html-704bd40d.js" as="script"><link rel="prefetch" href="/assets/index.html-a330a4f6.js" as="script"><link rel="prefetch" href="/assets/index.html-73eb089a.js" as="script"><link rel="prefetch" href="/assets/index.html-ea985e38.js" as="script"><link rel="prefetch" href="/assets/index.html-180ee8bd.js" as="script"><link rel="prefetch" href="/assets/index.html-a4691e29.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-e4a8ebba.js" as="script"><link rel="prefetch" href="/assets/index.html-fa35c6ae.js" as="script"><link rel="prefetch" href="/assets/index.html-a5b1adc0.js" as="script"><link rel="prefetch" href="/assets/index.html-8523baf4.js" as="script"><link rel="prefetch" href="/assets/index.html-f1423e85.js" as="script"><link rel="prefetch" href="/assets/index.html-a29aaa91.js" as="script"><link rel="prefetch" href="/assets/index.html-c522de6a.js" as="script"><link rel="prefetch" href="/assets/index.html-c2625ab5.js" as="script"><link rel="prefetch" href="/assets/index.html-15d3439f.js" as="script"><link rel="prefetch" href="/assets/index.html-4ed4f2a7.js" as="script"><link rel="prefetch" href="/assets/index.html-54029dde.js" as="script"><link rel="prefetch" href="/assets/index.html-9b058eec.js" as="script"><link rel="prefetch" href="/assets/index.html-0b0842a7.js" as="script"><link rel="prefetch" href="/assets/index.html-7ca879a5.js" as="script"><link rel="prefetch" href="/assets/index.html-088e693e.js" as="script"><link rel="prefetch" href="/assets/index.html-8491a2ab.js" as="script"><link rel="prefetch" href="/assets/index.html-2294b9e3.js" as="script"><link rel="prefetch" href="/assets/index.html-52663ab2.js" as="script"><link rel="prefetch" href="/assets/index.html-0470b4a8.js" as="script"><link rel="prefetch" href="/assets/index.html-dd96616c.js" as="script"><link rel="prefetch" href="/assets/index.html-dacf5e8c.js" as="script"><link rel="prefetch" href="/assets/index.html-0195ab12.js" as="script"><link rel="prefetch" href="/assets/index.html-81e66c91.js" as="script"><link rel="prefetch" href="/assets/index.html-21894421.js" as="script"><link rel="prefetch" href="/assets/index.html-a69111a2.js" as="script"><link rel="prefetch" href="/assets/index.html-2a70b06b.js" as="script"><link rel="prefetch" href="/assets/index.html-e1ee66ee.js" as="script"><link rel="prefetch" href="/assets/index.html-73dc6004.js" as="script"><link rel="prefetch" href="/assets/index.html-e30581c4.js" as="script"><link rel="prefetch" href="/assets/index.html-19438a35.js" as="script"><link rel="prefetch" href="/assets/index.html-a853432a.js" as="script"><link rel="prefetch" href="/assets/index.html-bccd5e37.js" as="script"><link rel="prefetch" href="/assets/index.html-ac802804.js" as="script"><link rel="prefetch" href="/assets/index.html-b2987cf7.js" as="script"><link rel="prefetch" href="/assets/index.html-017f4326.js" as="script"><link rel="prefetch" href="/assets/index.html-a3bb24a5.js" as="script"><link rel="prefetch" href="/assets/index.html-075db68e.js" as="script"><link rel="prefetch" href="/assets/index.html-a30c67c6.js" as="script"><link rel="prefetch" href="/assets/index.html-4b0b29b8.js" as="script"><link rel="prefetch" href="/assets/index.html-5adf10a2.js" as="script"><link rel="prefetch" href="/assets/index.html-e032b77c.js" as="script"><link rel="prefetch" href="/assets/index.html-247fc759.js" as="script"><link rel="prefetch" href="/assets/index.html-9723bbb5.js" as="script"><link rel="prefetch" href="/assets/index.html-b7ebaa41.js" as="script"><link rel="prefetch" href="/assets/index.html-c0f0c131.js" as="script"><link rel="prefetch" href="/assets/index.html-1c7a6a63.js" as="script"><link rel="prefetch" href="/assets/index.html-79c69ebd.js" as="script"><link rel="prefetch" href="/assets/index.html-4c87ebab.js" as="script"><link rel="prefetch" href="/assets/index.html-92f8e24b.js" as="script"><link rel="prefetch" href="/assets/index.html-dece1655.js" as="script"><link rel="prefetch" href="/assets/index.html-04a8aa76.js" as="script"><link rel="prefetch" href="/assets/index.html-c5471860.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-8f82a790.js" as="script"><link rel="prefetch" href="/assets/index.html-892e0cda.js" as="script"><link rel="prefetch" href="/assets/index.html-a8692883.js" as="script"><link rel="prefetch" href="/assets/index.html-310b6b1f.js" as="script"><link rel="prefetch" href="/assets/index.html-b485e1a0.js" as="script"><link rel="prefetch" href="/assets/index.html-7b88635d.js" as="script"><link rel="prefetch" href="/assets/index.html-e002aeb8.js" as="script"><link rel="prefetch" href="/assets/index.html-7670fed3.js" as="script"><link rel="prefetch" href="/assets/index.html-c5e9c0b1.js" as="script"><link rel="prefetch" href="/assets/index.html-7eb4d909.js" as="script"><link rel="prefetch" href="/assets/404.html-f4f9fdbe.js" as="script"><link rel="prefetch" href="/assets/index.html-ccedd87a.js" as="script"><link rel="prefetch" href="/assets/index.html-6b635626.js" as="script"><link rel="prefetch" href="/assets/index.html-f3c1ea90.js" as="script"><link rel="prefetch" href="/assets/index.html-39a19522.js" as="script"><link rel="prefetch" href="/assets/index.html-4e6ecfce.js" as="script"><link rel="prefetch" href="/assets/index.html-c37db087.js" as="script"><link rel="prefetch" href="/assets/index.html-7f2f880b.js" as="script"><link rel="prefetch" href="/assets/index.html-f8546af5.js" as="script"><link rel="prefetch" href="/assets/index.html-36e6cb8c.js" as="script"><link rel="prefetch" href="/assets/index.html-27371869.js" as="script"><link rel="prefetch" href="/assets/index.html-4c15c6fc.js" as="script"><link rel="prefetch" href="/assets/index.html-116aca17.js" as="script"><link rel="prefetch" href="/assets/index.html-2a643c60.js" as="script"><link rel="prefetch" href="/assets/index.html-21236a9b.js" as="script"><link rel="prefetch" href="/assets/index.html-b238d9f4.js" as="script"><link rel="prefetch" href="/assets/index.html-46e55ee3.js" as="script"><link rel="prefetch" href="/assets/index.html-6d53c5d1.js" as="script"><link rel="prefetch" href="/assets/index.html-778d883e.js" as="script"><link rel="prefetch" href="/assets/index.html-d798a209.js" as="script"><link rel="prefetch" href="/assets/index.html-ab8b6fb7.js" as="script"><link rel="prefetch" href="/assets/index.html-200c9b62.js" as="script"><link rel="prefetch" href="/assets/index.html-c93e5cd2.js" as="script"><link rel="prefetch" href="/assets/index.html-9fa57983.js" as="script"><link rel="prefetch" href="/assets/index.html-30ef2e2b.js" as="script"><link rel="prefetch" href="/assets/index.html-2a6dfb95.js" as="script"><link rel="prefetch" href="/assets/index.html-3fd779a7.js" as="script"><link rel="prefetch" href="/assets/index.html-0118c6d9.js" as="script"><link rel="prefetch" href="/assets/index.html-942ff972.js" as="script"><link rel="prefetch" href="/assets/index.html-41b511cf.js" as="script"><link rel="prefetch" href="/assets/index.html-2be3f4a2.js" as="script"><link rel="prefetch" href="/assets/index.html-4b04c8af.js" as="script"><link rel="prefetch" href="/assets/index.html-940c35a3.js" as="script"><link rel="prefetch" href="/assets/index.html-f3f33451.js" as="script"><link rel="prefetch" href="/assets/index.html-1a8f23e9.js" as="script"><link rel="prefetch" href="/assets/index.html-6508b456.js" as="script"><link rel="prefetch" href="/assets/index.html-ed0506a1.js" as="script"><link rel="prefetch" href="/assets/index.html-31f68f17.js" as="script"><link rel="prefetch" href="/assets/index.html-d92890df.js" as="script"><link rel="prefetch" href="/assets/index.html-b2b41008.js" as="script"><link rel="prefetch" href="/assets/index.html-ac4c44c1.js" as="script"><link rel="prefetch" href="/assets/index.html-0ef231d8.js" as="script"><link rel="prefetch" href="/assets/index.html-0c77fea3.js" as="script"><link rel="prefetch" href="/assets/index.html-256266f9.js" as="script"><link rel="prefetch" href="/assets/index.html-9e26885f.js" as="script"><link rel="prefetch" href="/assets/index.html-913c5320.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-01a56eed.js" as="script"><link rel="prefetch" href="/assets/index.html-771d5a5a.js" as="script"><link rel="prefetch" href="/assets/index.html-f96e0ef6.js" as="script"><link rel="prefetch" href="/assets/index.html-f22a5db7.js" as="script"><link rel="prefetch" href="/assets/index.html-fce214fe.js" as="script"><link rel="prefetch" href="/assets/index.html-23a71902.js" as="script"><link rel="prefetch" href="/assets/index.html-ac397ef1.js" as="script"><link rel="prefetch" href="/assets/index.html-c127ba3e.js" as="script"><link rel="prefetch" href="/assets/index.html-7703916c.js" as="script"><link rel="prefetch" href="/assets/index.html-1d86eadf.js" as="script"><link rel="prefetch" href="/assets/index.html-5c0dbfb6.js" as="script"><link rel="prefetch" href="/assets/index.html-f22951df.js" as="script"><link rel="prefetch" href="/assets/index.html-becda579.js" as="script"><link rel="prefetch" href="/assets/index.html-9b9eb0e7.js" as="script"><link rel="prefetch" href="/assets/index.html-04d083fd.js" as="script"><link rel="prefetch" href="/assets/index.html-bf82d2d5.js" as="script"><link rel="prefetch" href="/assets/index.html-710e42fe.js" as="script"><link rel="prefetch" href="/assets/index.html-1726d597.js" as="script"><link rel="prefetch" href="/assets/index.html-9ab74df1.js" as="script"><link rel="prefetch" href="/assets/index.html-1f489264.js" as="script"><link rel="prefetch" href="/assets/index.html-b692a8e7.js" as="script"><link rel="prefetch" href="/assets/index.html-98da7a26.js" as="script"><link rel="prefetch" href="/assets/index.html-b15471d6.js" as="script"><link rel="prefetch" href="/assets/index.html-546d2ebe.js" as="script"><link rel="prefetch" href="/assets/index.html-31dcb54a.js" as="script"><link rel="prefetch" href="/assets/index.html-18baa2c9.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-470c9528.js" as="script"><link rel="prefetch" href="/assets/index.html-d7bdc7d6.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-bd0a9579.js" as="script"><link rel="prefetch" href="/assets/index.html-e9de0925.js" as="script"><link rel="prefetch" href="/assets/index.html-4665c9ca.js" as="script"><link rel="prefetch" href="/assets/index.html-6f2e6903.js" as="script"><link rel="prefetch" href="/assets/index.html-0527ad65.js" as="script"><link rel="prefetch" href="/assets/index.html-1695f027.js" as="script"><link rel="prefetch" href="/assets/index.html-0339efc2.js" as="script"><link rel="prefetch" href="/assets/index.html-36e22a52.js" as="script"><link rel="prefetch" href="/assets/index.html-47de07cc.js" as="script"><link rel="prefetch" href="/assets/index.html-1e3114a4.js" as="script"><link rel="prefetch" href="/assets/index.html-f8b2f743.js" as="script"><link rel="prefetch" href="/assets/index.html-14c68d00.js" as="script"><link rel="prefetch" href="/assets/index.html-017a26b0.js" as="script"><link rel="prefetch" href="/assets/index.html-3c8c75e5.js" as="script"><link rel="prefetch" href="/assets/index.html-18747319.js" as="script"><link rel="prefetch" href="/assets/index.html-15890f18.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-83b1a389.js" as="script"><link rel="prefetch" href="/assets/index.html-546c97bc.js" as="script"><link rel="prefetch" href="/assets/index.html-29799b4a.js" as="script"><link rel="prefetch" href="/assets/index.html-5d16a176.js" as="script"><link rel="prefetch" href="/assets/index.html-288d2385.js" as="script"><link rel="prefetch" href="/assets/index.html-4c6e04ce.js" as="script"><link rel="prefetch" href="/assets/index.html-c62199db.js" as="script"><link rel="prefetch" href="/assets/index.html-a6187740.js" as="script"><link rel="prefetch" href="/assets/index.html-8a56c9a0.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-67af11db.js" as="script"><link rel="prefetch" href="/assets/index.html-a5ef91bf.js" as="script"><link rel="prefetch" href="/assets/index.html-4f274499.js" as="script"><link rel="prefetch" href="/assets/index.html-570eed0d.js" as="script"><link rel="prefetch" href="/assets/index.html-a28aeda9.js" as="script"><link rel="prefetch" href="/assets/index.html-c594304c.js" as="script"><link rel="prefetch" href="/assets/index.html-65524bf6.js" as="script"><link rel="prefetch" href="/assets/index.html-1ac22699.js" as="script"><link rel="prefetch" href="/assets/index.html-caf82437.js" as="script"><link rel="prefetch" href="/assets/index.html-9e90020f.js" as="script"><link rel="prefetch" href="/assets/index.html-dca36996.js" as="script"><link rel="prefetch" href="/assets/index.html-c6da5813.js" as="script"><link rel="prefetch" href="/assets/index.html-bca63335.js" as="script"><link rel="prefetch" href="/assets/index.html-00735902.js" as="script"><link rel="prefetch" href="/assets/index.html-2d168519.js" as="script"><link rel="prefetch" href="/assets/index.html-0a0f4412.js" as="script"><link rel="prefetch" href="/assets/index.html-b0283288.js" as="script"><link rel="prefetch" href="/assets/index.html-882db5c5.js" as="script"><link rel="prefetch" href="/assets/index.html-9fa015b8.js" as="script"><link rel="prefetch" href="/assets/index.html-8d977631.js" as="script"><link rel="prefetch" href="/assets/index.html-bb4639ce.js" as="script"><link rel="prefetch" href="/assets/index.html-2daeac95.js" as="script"><link rel="prefetch" href="/assets/index.html-4f860884.js" as="script"><link rel="prefetch" href="/assets/index.html-6672d33d.js" as="script"><link rel="prefetch" href="/assets/index.html-e66fda64.js" as="script"><link rel="prefetch" href="/assets/index.html-c303c772.js" as="script"><link rel="prefetch" href="/assets/index.html-50018e99.js" as="script"><link rel="prefetch" href="/assets/index.html-7e7f7e22.js" as="script"><link rel="prefetch" href="/assets/index.html-df94e079.js" as="script"><link rel="prefetch" href="/assets/index.html-c51cf5a6.js" as="script"><link rel="prefetch" href="/assets/index.html-60e51594.js" as="script"><link rel="prefetch" href="/assets/index.html-06f1385e.js" as="script"><link rel="prefetch" href="/assets/index.html-7448705b.js" as="script"><link rel="prefetch" href="/assets/index.html-d43d6abd.js" as="script"><link rel="prefetch" href="/assets/index.html-14cc0868.js" as="script"><link rel="prefetch" href="/assets/index.html-02c57081.js" as="script"><link rel="prefetch" href="/assets/index.html-f4558cf8.js" as="script"><link rel="prefetch" href="/assets/index.html-7a7b5de9.js" as="script"><link rel="prefetch" href="/assets/index.html-d9b3200b.js" as="script"><link rel="prefetch" href="/assets/index.html-04a327f7.js" as="script"><link rel="prefetch" href="/assets/index.html-aaddcfbf.js" as="script"><link rel="prefetch" href="/assets/index.html-30853592.js" as="script"><link rel="prefetch" href="/assets/index.html-4afd33d4.js" as="script"><link rel="prefetch" href="/assets/index.html-b43ba0f7.js" as="script"><link rel="prefetch" href="/assets/index.html-00a3cd7d.js" as="script"><link rel="prefetch" href="/assets/index.html-52dc4a35.js" as="script"><link rel="prefetch" href="/assets/index.html-488100f3.js" as="script"><link rel="prefetch" href="/assets/index.html-c53c8ca3.js" as="script"><link rel="prefetch" href="/assets/index.html-e85a41f6.js" as="script"><link rel="prefetch" href="/assets/index.html-ba6902b1.js" as="script"><link rel="prefetch" href="/assets/index.html-6961317a.js" as="script"><link rel="prefetch" href="/assets/index.html-b4d8eb3d.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-898a92aa.js" as="script"><link rel="prefetch" href="/assets/index.html-5c426c9c.js" as="script"><link rel="prefetch" href="/assets/index.html-0748344f.js" as="script"><link rel="prefetch" href="/assets/index.html-b65b5773.js" as="script"><link rel="prefetch" href="/assets/index.html-e2861395.js" as="script"><link rel="prefetch" href="/assets/index.html-9b02ee5f.js" as="script"><link rel="prefetch" href="/assets/index.html-99f50e4a.js" as="script"><link rel="prefetch" href="/assets/index.html-afbe62b6.js" as="script"><link rel="prefetch" href="/assets/index.html-072ecb17.js" as="script"><link rel="prefetch" href="/assets/index.html-2cb8c4c9.js" as="script"><link rel="prefetch" href="/assets/404.html-674fba9b.js" as="script"><link rel="prefetch" href="/assets/index.html-00536d18.js" as="script"><link rel="prefetch" href="/assets/index.html-03b902c7.js" as="script"><link rel="prefetch" href="/assets/index.html-2429bdfb.js" as="script"><link rel="prefetch" href="/assets/index.html-06d1dbab.js" as="script"><link rel="prefetch" href="/assets/index.html-0d0e09cc.js" as="script"><link rel="prefetch" href="/assets/index.html-8759e5fb.js" as="script"><link rel="prefetch" href="/assets/index.html-91172372.js" as="script"><link rel="prefetch" href="/assets/index.html-6599cbc3.js" as="script"><link rel="prefetch" href="/assets/index.html-a58f5767.js" as="script"><link rel="prefetch" href="/assets/index.html-1b797ab6.js" as="script"><link rel="prefetch" href="/assets/index.html-0f8c8ddc.js" as="script"><link rel="prefetch" href="/assets/index.html-e9bda0c4.js" as="script"><link rel="prefetch" href="/assets/index.html-c8a44035.js" as="script"><link rel="prefetch" href="/assets/index.html-ce4cfbbc.js" as="script"><link rel="prefetch" href="/assets/index.html-656ade32.js" as="script"><link rel="prefetch" href="/assets/index.html-06a9687b.js" as="script"><link rel="prefetch" href="/assets/index.html-88067b63.js" as="script"><link rel="prefetch" href="/assets/index.html-cddd233c.js" as="script"><link rel="prefetch" href="/assets/index.html-e33c43c7.js" as="script"><link rel="prefetch" href="/assets/index.html-179fbbb4.js" as="script"><link rel="prefetch" href="/assets/index.html-3257904d.js" as="script"><link rel="prefetch" href="/assets/index.html-bd4a7aa4.js" as="script"><link rel="prefetch" href="/assets/index.html-350a3bf9.js" as="script"><link rel="prefetch" href="/assets/index.html-5a0cea13.js" as="script"><link rel="prefetch" href="/assets/index.html-c7b6231a.js" as="script"><link rel="prefetch" href="/assets/index.html-25092415.js" as="script"><link rel="prefetch" href="/assets/index.html-95ca6ee5.js" as="script"><link rel="prefetch" href="/assets/index.html-7c78757b.js" as="script"><link rel="prefetch" href="/assets/index.html-33c49ab5.js" as="script"><link rel="prefetch" href="/assets/index.html-cb9e0d0e.js" as="script"><link rel="prefetch" href="/assets/index.html-524251fd.js" as="script"><link rel="prefetch" href="/assets/index.html-3da8edc6.js" as="script"><link rel="prefetch" href="/assets/index.html-f3dc57a7.js" as="script"><link rel="prefetch" href="/assets/index.html-3c4992f2.js" as="script"><link rel="prefetch" href="/assets/index.html-777879b1.js" as="script"><link rel="prefetch" href="/assets/index.html-6ac2cbeb.js" as="script"><link rel="prefetch" href="/assets/index.html-112eed93.js" as="script"><link rel="prefetch" href="/assets/index.html-c326d17b.js" as="script"><link rel="prefetch" href="/assets/index.html-6b1c27b7.js" as="script"><link rel="prefetch" href="/assets/index.html-f8320d44.js" as="script"><link rel="prefetch" href="/assets/index.html-f3495400.js" as="script"><link rel="prefetch" href="/assets/giscus-765fdce2.js" as="script"><link rel="prefetch" href="/assets/auto-bce451fc.js" as="script"><link rel="prefetch" href="/assets/index-a49a0f47.js" as="script"><link rel="prefetch" href="/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-b4b1a5e7.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-3d35f30a.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-5794cde2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="å­¦ä¹ ç¬”è®°"><!----><span class="site-name hide-in-pad">å­¦ä¹ ç¬”è®°</span></a><!--]--><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">æ±Ÿ</span></span><span property="author" content="æ±Ÿ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-05-06T01:54:45.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 40 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT40M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#ä¸€ã€rocketmqåŸç”Ÿapiä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level2">ä¸€ã€RocketMQåŸç”ŸAPIä½¿ç”¨</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#æµ‹è¯•ç¯å¢ƒæ­å»º" class="router-link-active router-link-exact-active toc-link level3">æµ‹è¯•ç¯å¢ƒæ­å»º</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#rocketmqçš„ç¼–ç¨‹æ¨¡å‹" class="router-link-active router-link-exact-active toc-link level3">RocketMQçš„ç¼–ç¨‹æ¨¡å‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#rocketmqçš„æ¶ˆæ¯æ ·ä¾‹" class="router-link-active router-link-exact-active toc-link level3">RocketMQçš„æ¶ˆæ¯æ ·ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#äºŒã€springbootæ•´åˆrocketmq" class="router-link-active router-link-exact-active toc-link level2">äºŒã€SpringBootæ•´åˆRocketMQ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#å…¶ä»–æ›´å¤šæ¶ˆæ¯ç±»å‹" class="router-link-active router-link-exact-active toc-link level3">å…¶ä»–æ›´å¤šæ¶ˆæ¯ç±»å‹ï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#æ€»ç»“" class="router-link-active router-link-exact-active toc-link level3">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#ä¸‰ã€springcloudstreamæ•´åˆrocketmq" class="router-link-active router-link-exact-active toc-link level2">ä¸‰ã€SpringCloudStreamæ•´åˆRocketMQ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#å¿«é€Ÿå®æˆ˜" class="router-link-active router-link-exact-active toc-link level3">å¿«é€Ÿå®æˆ˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#æ€»ç»“-1" class="router-link-active router-link-exact-active toc-link level3">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#å››ã€rocketmqä½¿ç”¨ä¸­å¸¸è§çš„é—®é¢˜" class="router-link-active router-link-exact-active toc-link level2">å››ã€RocketMQä½¿ç”¨ä¸­å¸¸è§çš„é—®é¢˜</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#ä½¿ç”¨rocketmqå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨RocketMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#ä½¿ç”¨rocketmqå¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨RocketMQå¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#ä½¿ç”¨rocketmqå¦‚ä½•å¿«é€Ÿå¤„ç†ç§¯å‹æ¶ˆæ¯" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨RocketMQå¦‚ä½•å¿«é€Ÿå¤„ç†ç§¯å‹æ¶ˆæ¯ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/30.%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6/05.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/02.RocketMQ/02.RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%E5%89%96%E6%9E%90.html#rocketmqçš„æ¶ˆæ¯è½¨è¿¹" class="router-link-active router-link-exact-active toc-link level3">RocketMQçš„æ¶ˆæ¯è½¨è¿¹</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="ä¸€ã€rocketmqåŸç”Ÿapiä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€rocketmqåŸç”Ÿapiä½¿ç”¨" aria-hidden="true">#</a> ä¸€ã€RocketMQåŸç”ŸAPIä½¿ç”¨</h2><p>ä½¿ç”¨RocketMQçš„åŸç”ŸAPIå¼€å‘æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯ç›®å‰çœ‹æ¥æœ€ç‰¢é çš„æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨SpringBootæ¥æ­å»ºä¸€ç³»åˆ—æ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œæ¥è®¿é—®æˆ‘ä»¬ä¹‹å‰æ­å»ºçš„RocketMQé›†ç¾¤ã€‚</p><h3 id="æµ‹è¯•ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•ç¯å¢ƒæ­å»º" aria-hidden="true">#</a> æµ‹è¯•ç¯å¢ƒæ­å»º</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸºäºMavençš„SpringBootå·¥ç¨‹ï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦å¤–è¿˜ä¸ä¸€äº›ä¾èµ–ï¼Œä¾‹å¦‚openmessageã€aclç­‰æ‰©å±•åŠŸèƒ½è¿˜éœ€è¦æ·»åŠ å¯¹åº”çš„ä¾èµ–ã€‚å…·ä½“å¯ä»¥å‚è§RocketMQæºç ä¸­çš„exampleæ¨¡å—ã€‚åœ¨RocketMQæºç åŒ…ä¸­çš„exampleæ¨¡å—æä¾›äº†éå¸¸è¯¦å°½çš„æµ‹è¯•ä»£ç ï¼Œä¹Ÿå¯ä»¥æ‹¿æ¥ç›´æ¥è°ƒè¯•ã€‚æˆ‘ä»¬è¿™é‡Œå°±ç”¨æºç åŒ…ä¸­çš„ç¤ºä¾‹æ¥è¿æ¥æˆ‘ä»¬è‡ªå·±æ­å»ºçš„RocketMQé›†ç¾¤æ¥è¿›è¡Œæ¼”ç¤ºã€‚</p><blockquote><p>RocketMQçš„å®˜ç½‘ä¸Šæœ‰å¾ˆå¤šç»å…¸çš„æµ‹è¯•ä»£ç ï¼Œè¿™äº›ä»£ç è™½ç„¶ä¾èµ–çš„ç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œä½†æ˜¯è¿˜æ˜¯éƒ½å¯ä»¥è¿è¡Œçš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯ä»¥å®˜ç½‘ä¸Šçš„é¡ºåºè¿›è¡Œå­¦ä¹ ã€‚</p></blockquote><p>ä½†æ˜¯åœ¨è°ƒè¯•è¿™äº›ä»£ç çš„æ—¶å€™è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼šè¿™äº›æµ‹è¯•ä»£ç ä¸­çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½éœ€è¦ä¾èµ–NameServeræ‰èƒ½è¿è¡Œï¼Œåªéœ€è¦å°†NameServeræŒ‡å‘æˆ‘ä»¬è‡ªå·±æ­å»ºçš„RocketMQé›†ç¾¤ï¼Œè€Œä¸éœ€è¦ç®¡Brokeråœ¨å“ªé‡Œï¼Œå°±å¯ä»¥è¿æ¥æˆ‘ä»¬è‡ªå·±çš„è‡ªå·±çš„RocketMQé›†ç¾¤ã€‚è€ŒRocketMQæä¾›çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯»æ‰¾NameServerçš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><p>1ã€åœ¨ä»£ç ä¸­æŒ‡å®šnamesrvAddrå±æ€§ã€‚ä¾‹å¦‚ï¼šconsumer.setNamesrvAddr(&quot;127.0.0.1:9876&quot;);</p><p>2ã€é€šè¿‡NAMESRV_ADDRç¯å¢ƒå˜é‡æ¥æŒ‡å®šã€‚å¤šä¸ªNameServerä¹‹é—´ç”¨åˆ†å·è¿æ¥ã€‚</p><h3 id="rocketmqçš„ç¼–ç¨‹æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#rocketmqçš„ç¼–ç¨‹æ¨¡å‹" aria-hidden="true">#</a> RocketMQçš„ç¼–ç¨‹æ¨¡å‹</h3><p>ç„¶åRocketMQçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ç¼–ç¨‹æ¨¡å‹éƒ½æ˜¯æœ‰ä¸ªæ¯”è¾ƒå›ºå®šçš„æ­¥éª¤çš„ï¼ŒæŒæ¡è¿™ä¸ªå›ºå®šçš„æ­¥éª¤ï¼Œå¯¹äºæˆ‘ä»¬å­¦ä¹ æºç ä»¥åŠä»¥åä½¿ç”¨éƒ½æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚</p><ul><li><p>æ¶ˆæ¯å‘é€è€…çš„å›ºå®šæ­¥éª¤</p><p>1.åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…producerï¼Œå¹¶åˆ¶å®šç”Ÿäº§è€…ç»„å 2.æŒ‡å®šNameserveråœ°å€ 3.å¯åŠ¨producer 4.åˆ›å»ºæ¶ˆæ¯å¯¹è±¡ï¼ŒæŒ‡å®šä¸»é¢˜Topicã€Tagå’Œæ¶ˆæ¯ä½“ 5.å‘é€æ¶ˆæ¯ 6.å…³é—­ç”Ÿäº§è€…producer</p></li><li><p>æ¶ˆæ¯æ¶ˆè´¹è€…çš„å›ºå®šæ­¥éª¤</p><p>1.åˆ›å»ºæ¶ˆè´¹è€…Consumerï¼Œåˆ¶å®šæ¶ˆè´¹è€…ç»„å 2.æŒ‡å®šNameserveråœ°å€ 3.è®¢é˜…ä¸»é¢˜Topicå’ŒTag 4.è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå¤„ç†æ¶ˆæ¯ 5.å¯åŠ¨æ¶ˆè´¹è€…consumer</p></li></ul><h3 id="rocketmqçš„æ¶ˆæ¯æ ·ä¾‹" tabindex="-1"><a class="header-anchor" href="#rocketmqçš„æ¶ˆæ¯æ ·ä¾‹" aria-hidden="true">#</a> RocketMQçš„æ¶ˆæ¯æ ·ä¾‹</h3><p>é‚£æˆ‘ä»¬æ¥é€ä¸€è¿æ¥ä¸‹RocketMQéƒ½æ”¯æŒå“ªäº›ç±»å‹çš„æ¶ˆæ¯ï¼š</p><h4 id="åŸºæœ¬æ ·ä¾‹" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ ·ä¾‹" aria-hidden="true">#</a> åŸºæœ¬æ ·ä¾‹</h4><p>åŸºæœ¬æ ·ä¾‹éƒ¨åˆ†æˆ‘ä»¬ä½¿ç”¨æ¶ˆæ¯ç”Ÿäº§è€…åˆ†åˆ«é€šè¿‡ä¸‰ç§æ–¹å¼å‘é€æ¶ˆæ¯ï¼ŒåŒæ­¥å‘é€ã€å¼‚æ­¥å‘é€ä»¥åŠå•å‘å‘é€ã€‚</p><p>ç„¶åä½¿ç”¨æ¶ˆè´¹è€…æ¥æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ã€‚</p><p>1ã€åŒæ­¥å‘é€æ¶ˆæ¯çš„æ ·ä¾‹è§ï¼šorg.apache.rocketmq.example.simple.Producer</p><blockquote><p>ç­‰å¾…æ¶ˆæ¯è¿”å›åå†ç»§ç»­è¿›è¡Œä¸‹é¢çš„æ“ä½œã€‚</p></blockquote><p>2ã€å¼‚æ­¥å‘é€æ¶ˆæ¯çš„æ ·ä¾‹è§ï¼šorg.apache.rocketmq.example.simple.AsyncProducer</p><blockquote><p>è¿™ä¸ªç¤ºä¾‹æœ‰ä¸ªæ¯”è¾ƒæœ‰è¶£çš„åœ°æ–¹å°±æ˜¯å¼•å…¥äº†ä¸€ä¸ªcountDownLatchæ¥ä¿è¯æ‰€æœ‰æ¶ˆæ¯å›è°ƒæ–¹æ³•éƒ½æ‰§è¡Œå®Œäº†å†å…³é—­Producerã€‚ æ‰€ä»¥ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒRocketMQçš„Producerä¹Ÿæ˜¯ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œåœ¨å¾€Brokerå‘é€æ¶ˆæ¯çš„æ—¶å€™ä¹Ÿè¦ä½œä¸ºæœåŠ¡ç«¯æä¾›æœåŠ¡ã€‚</p></blockquote><p>3ã€å•å‘å‘é€æ¶ˆæ¯çš„æ ·ä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnewayProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//Instantiate with a producer group name.</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Specify name server addresses.</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Launch the instance.</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Create a message instance, specifying topic, tag and message body.</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
                <span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span>
                    i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//Call send message to deliver message to one of brokers.</span>
            producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//Wait for sending to complete</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å…³é”®ç‚¹å°±æ˜¯ä½¿ç”¨producer.sendOneWayæ–¹å¼æ¥å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œä¹Ÿæ²¡æœ‰å›è°ƒã€‚å°±æ˜¯åªç®¡æŠŠæ¶ˆæ¯å‘å‡ºå»å°±è¡Œäº†ã€‚</p></blockquote><p>4ã€ä½¿ç”¨æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€‚</p><p>æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯æ¶ˆè´¹è€…ä¸»åŠ¨å»Brokerä¸Šæ‹‰å–æ¶ˆæ¯çš„æ‹‰æ¨¡å¼ï¼Œå¦ä¸€ç§æ˜¯æ¶ˆè´¹è€…ç­‰å¾…BrokeræŠŠæ¶ˆæ¯æ¨é€è¿‡æ¥çš„æ¨æ¨¡å¼ã€‚</p><p>æ‹‰æ¨¡å¼çš„æ ·ä¾‹è§ï¼šorg.apache.rocketmq.example.simple.PullConsumer</p><p>æ¨æ¨¡å¼çš„æ ·ä¾‹è§ï¼šorg.apache.rocketmq.example.simple.PushConsumer</p><blockquote><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨æ¨æ¨¡å¼æ¯”è¾ƒç®€å•ã€‚</p><p>å®é™…ä¸ŠRocketMQçš„æ¨æ¨¡å¼ä¹Ÿæ˜¯ç”±æ‹‰æ¨¡å¼å°è£…å‡ºæ¥çš„ã€‚</p><p>DefaultMQPullConsumerImplè¿™ä¸ªæ¶ˆè´¹è€…ç±»å·²æ ‡è®°ä¸ºè¿‡æœŸï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚æ›¿æ¢çš„ç±»æ˜¯DefaultLitePullConsumerImplã€‚</p></blockquote><h4 id="é¡ºåºæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#é¡ºåºæ¶ˆæ¯" aria-hidden="true">#</a> é¡ºåºæ¶ˆæ¯</h4><p>é¡ºåºæ¶ˆæ¯ç”Ÿäº§è€…æ ·ä¾‹è§ï¼šorg.apache.rocketmq.example.order.Producer</p><p>é¡ºåºæ¶ˆæ¯æ¶ˆè´¹è€…æ ·ä¾‹è§ï¼šorg.apache.rocketmq.example.order.Consumer</p><blockquote><p>éªŒè¯æ—¶ï¼Œå¯ä»¥å¯åŠ¨å¤šä¸ªConsumerå®ä¾‹ï¼Œè§‚å¯Ÿä¸‹æ¯ä¸€ä¸ªè®¢å•çš„æ¶ˆæ¯åˆ†é…ä»¥åŠæ¯ä¸ªè®¢å•ä¸‹å¤šä¸ªæ­¥éª¤çš„æ¶ˆè´¹é¡ºåºã€‚</p><p>ä¸ç®¡è®¢å•åœ¨å¤šä¸ªConsumerå®ä¾‹ä¹‹å‰æ˜¯å¦‚ä½•åˆ†é…çš„ï¼Œæ¯ä¸ªè®¢å•ä¸‹çš„å¤šæ¡æ¶ˆæ¯é¡ºåºéƒ½æ˜¯å›ºå®šä»0~5çš„ã€‚</p><p>RocketMQä¿è¯çš„æ˜¯æ¶ˆæ¯çš„å±€éƒ¨æœ‰åºï¼Œè€Œä¸æ˜¯å…¨å±€æœ‰åºã€‚</p></blockquote><blockquote><p>å…ˆä»æ§åˆ¶å°ä¸Šçœ‹ä¸‹List&lt;MessageQueue&gt; mqsæ˜¯ä»€ä¹ˆã€‚</p><p>å†å›çœ‹æˆ‘ä»¬çš„æ ·ä¾‹ï¼Œå®é™…ä¸Šï¼ŒRocketMQä¹Ÿåªä¿è¯äº†æ¯ä¸ªOrderIDçš„æ‰€æœ‰æ¶ˆæ¯æœ‰åº(å‘åˆ°äº†åŒä¸€ä¸ªqueue)ï¼Œè€Œå¹¶ä¸èƒ½ä¿è¯æ‰€æœ‰æ¶ˆæ¯éƒ½æœ‰åºã€‚æ‰€ä»¥è¿™å°±æ¶‰åŠåˆ°äº†RocketMQæ¶ˆæ¯æœ‰åºçš„åŸç†ã€‚è¦ä¿è¯æœ€ç»ˆæ¶ˆè´¹åˆ°çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œéœ€è¦ä»Producerã€Brokerã€Consumerä¸‰ä¸ªæ­¥éª¤éƒ½ä¿è¯æ¶ˆæ¯æœ‰åºæ‰è¡Œã€‚</p><p>é¦–å…ˆåœ¨å‘é€è€…ç«¯ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å‘é€è€…ä¼šé‡‡å–Round Robinè½®è¯¢æ–¹å¼æŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„MessageQueue(åˆ†åŒºé˜Ÿåˆ—)ï¼Œè€Œæ¶ˆè´¹è€…æ¶ˆè´¹çš„æ—¶å€™ä¹Ÿä»å¤šä¸ªMessageQueueä¸Šæ‹‰å–æ¶ˆæ¯ï¼Œè¿™ç§æƒ…å†µä¸‹æ¶ˆæ¯æ˜¯ä¸èƒ½ä¿è¯é¡ºåºçš„ã€‚è€Œåªæœ‰å½“ä¸€ç»„æœ‰åºçš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€ä¸ªMessageQueueä¸Šæ—¶ï¼Œæ‰èƒ½åˆ©ç”¨MessageQueueå…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§ä¿è¯è¿™ä¸€ç»„æ¶ˆæ¯æœ‰åºã€‚</p><p>è€ŒBrokerä¸­ä¸€ä¸ªé˜Ÿåˆ—å†…çš„æ¶ˆæ¯æ˜¯å¯ä»¥ä¿è¯æœ‰åºçš„ã€‚</p><p>ç„¶ååœ¨æ¶ˆè´¹è€…ç«¯ï¼šæ¶ˆè´¹è€…ä¼šä»å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸Šå»æ‹¿æ¶ˆæ¯ã€‚è¿™æ—¶è™½ç„¶æ¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯å¤šä¸ªé˜Ÿåˆ—ä¹‹é—´çš„æ¶ˆæ¯ä»ç„¶æ˜¯ä¹±åºçš„ã€‚æ¶ˆè´¹è€…ç«¯è¦ä¿è¯æ¶ˆæ¯æœ‰åºï¼Œå°±éœ€è¦æŒ‰é˜Ÿåˆ—ä¸€ä¸ªä¸€ä¸ªæ¥å–æ¶ˆæ¯ï¼Œå³å–å®Œä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯åï¼Œå†å»å–ä¸‹ä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚è€Œç»™consumeræ³¨å…¥çš„MessageListenerOrderlyå¯¹è±¡ï¼Œåœ¨RocketMQå†…éƒ¨å°±ä¼šé€šè¿‡é”é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯æ¶ˆæ¯æ˜¯ä¸€ä¸ªä¸€ä¸ªé˜Ÿåˆ—æ¥å–çš„ã€‚MessageListenerConcurrentlyè¿™ä¸ªæ¶ˆæ¯ç›‘å¬å™¨åˆ™ä¸ä¼šé”é˜Ÿåˆ—ï¼Œæ¯æ¬¡éƒ½æ˜¯ä»å¤šä¸ªMessageä¸­å–ä¸€æ‰¹æ•°æ®ï¼ˆé»˜è®¤ä¸è¶…è¿‡32æ¡ï¼‰ã€‚å› æ­¤ä¹Ÿæ— æ³•ä¿è¯æ¶ˆæ¯æœ‰åºã€‚</p></blockquote><h4 id="å¹¿æ’­æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å¹¿æ’­æ¶ˆæ¯" aria-hidden="true">#</a> å¹¿æ’­æ¶ˆæ¯</h4><p>å¹¿æ’­æ¶ˆæ¯çš„æ¶ˆæ¯ç”Ÿäº§è€…æ ·ä¾‹è§ï¼šorg.apache.rocketmq.example.broadcast.PushConsumer</p><blockquote><p>å¹¿æ’­æ¶ˆæ¯å¹¶æ²¡æœ‰ç‰¹å®šçš„æ¶ˆæ¯æ¶ˆè´¹è€…æ ·ä¾‹ï¼Œè¿™æ˜¯å› ä¸ºè¿™æ¶‰åŠåˆ°æ¶ˆè´¹è€…çš„é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ã€‚åœ¨é›†ç¾¤çŠ¶æ€(MessageModel.CLUSTERING)ä¸‹ï¼Œæ¯ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªå®ä¾‹æ¶ˆè´¹åˆ°(è¿™è·Ÿkafkaå’ŒrabbitMQçš„é›†ç¾¤æ¨¡å¼æ˜¯ä¸€æ ·çš„)ã€‚è€Œå¹¿æ’­æ¨¡å¼åˆ™æ˜¯æŠŠæ¶ˆæ¯å‘ç»™äº†æ‰€æœ‰è®¢é˜…äº†å¯¹åº”ä¸»é¢˜çš„æ¶ˆè´¹è€…ï¼Œè€Œä¸ç®¡æ¶ˆè´¹è€…æ˜¯ä¸æ˜¯åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ã€‚</p></blockquote><h4 id="å»¶è¿Ÿæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å»¶è¿Ÿæ¶ˆæ¯" aria-hidden="true">#</a> å»¶è¿Ÿæ¶ˆæ¯</h4><p>å»¶è¿Ÿæ¶ˆæ¯çš„ç”Ÿäº§è€…æ¡ˆä¾‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledMessageProducer</span> <span class="token punctuation">{</span>
    
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         <span class="token comment">// Instantiate a producer to send scheduled messages</span>
         <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleProducerGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// Launch producer</span>
         producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> totalMessagesToSend <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalMessagesToSend<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Hello scheduled message &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">// This message will be delivered to consumer 10 seconds later.</span>
             message<span class="token punctuation">.</span><span class="token function">setDelayTimeLevel</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">// Send the message</span>
             producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    
         <span class="token comment">// Shutdown producer after use.</span>
         producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
        
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å»¶è¿Ÿæ¶ˆæ¯å®ç°çš„æ•ˆæœå°±æ˜¯åœ¨è°ƒç”¨producer.sendæ–¹æ³•åï¼Œæ¶ˆæ¯å¹¶ä¸ä¼šç«‹å³å‘é€å‡ºå»ï¼Œè€Œæ˜¯ä¼šç­‰ä¸€æ®µæ—¶é—´å†å‘é€å‡ºå»ã€‚è¿™æ˜¯RocketMQç‰¹æœ‰çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</p><p>é‚£ä¼šå»¶è¿Ÿå¤šä¹…å‘¢ï¼Ÿå»¶è¿Ÿæ—¶é—´çš„è®¾ç½®å°±æ˜¯åœ¨Messageæ¶ˆæ¯å¯¹è±¡ä¸Šè®¾ç½®ä¸€ä¸ªå»¶è¿Ÿçº§åˆ«message.setDelayTimeLevel(3);</p><p>å¼€æºç‰ˆæœ¬çš„RocketMQä¸­ï¼Œå¯¹å»¶è¿Ÿæ¶ˆæ¯å¹¶ä¸æ”¯æŒä»»æ„æ—¶é—´çš„å»¶è¿Ÿè®¾å®š(å•†ä¸šç‰ˆæœ¬ä¸­æ”¯æŒ)ï¼Œè€Œæ˜¯åªæ”¯æŒ18ä¸ªå›ºå®šçš„å»¶è¿Ÿçº§åˆ«ï¼Œ1åˆ°18åˆ†åˆ«å¯¹åº”messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2hã€‚è¿™ä»å“ªé‡Œçœ‹å‡ºæ¥çš„ï¼Ÿå…¶å®ä»rocketmq-consoleæ§åˆ¶å°å°±èƒ½çœ‹å‡ºæ¥ã€‚è€Œè¿™18ä¸ªå»¶è¿Ÿçº§åˆ«ä¹Ÿæ”¯æŒè‡ªè¡Œå®šä¹‰ï¼Œä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹æœ€å¥½ä¸è¦è‡ªå®šä¹‰ä¿®æ”¹ã€‚</p><p>é‚£è¿™ä¹ˆå¥½ç”¨çš„å»¶è¿Ÿæ¶ˆæ¯æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿè¿™18ä¸ªå»¶è¿Ÿçº§åˆ«é™¤äº†åœ¨å»¶è¿Ÿæ¶ˆæ¯ä¸­ç”¨ï¼Œè¿˜æœ‰ä»€ä¹ˆåœ°æ–¹ç”¨åˆ°äº†ï¼Ÿåˆ«æ€¥ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢éƒ¨åˆ†è¿›è¡Œè¯¦ç»†è®²è§£ã€‚</p></blockquote><h4 id="æ‰¹é‡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#æ‰¹é‡æ¶ˆæ¯" aria-hidden="true">#</a> æ‰¹é‡æ¶ˆæ¯</h4><p>æ‰¹é‡æ¶ˆæ¯æ˜¯æŒ‡å°†å¤šæ¡æ¶ˆæ¯åˆå¹¶æˆä¸€ä¸ªæ‰¹é‡æ¶ˆæ¯ï¼Œä¸€æ¬¡å‘é€å‡ºå»ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥å‡å°‘ç½‘ç»œIOï¼Œæå‡ååé‡ã€‚</p><p>æ‰¹é‡æ¶ˆæ¯çš„æ¶ˆæ¯ç”Ÿäº§è€…æ ·ä¾‹è§ï¼šorg.apache.rocketmq.example.batch.SimpleBatchProducerå’Œorg.apache.rocketmq.example.batch.SplitBatchProducer</p><blockquote><p>ç›¸ä¿¡å¤§å®¶åœ¨å®˜ç½‘ä»¥åŠæµ‹è¯•ä»£ç ä¸­éƒ½çœ‹åˆ°äº†å…³é”®çš„æ³¨é‡Šï¼šå¦‚æœæ‰¹é‡æ¶ˆæ¯å¤§äº1MBå°±ä¸è¦ç”¨ä¸€ä¸ªæ‰¹æ¬¡å‘é€ï¼Œè€Œè¦æ‹†åˆ†æˆå¤šä¸ªæ‰¹æ¬¡æ¶ˆæ¯å‘é€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ‰¹æ¬¡æ¶ˆæ¯çš„å¤§å°ä¸è¦è¶…è¿‡1MB</p><p>å®é™…ä½¿ç”¨æ—¶ï¼Œè¿™ä¸ª1MBçš„é™åˆ¶å¯ä»¥ç¨å¾®æ‰©å¤§ç‚¹ï¼Œå®é™…æœ€å¤§çš„é™åˆ¶æ˜¯4194304å­—èŠ‚ï¼Œå¤§æ¦‚4MBã€‚ä½†æ˜¯ä½¿ç”¨æ‰¹é‡æ¶ˆæ¯æ—¶ï¼Œè¿™ä¸ªæ¶ˆæ¯é•¿åº¦ç¡®å®æ˜¯å¿…é¡»è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜ã€‚è€Œä¸”æ‰¹é‡æ¶ˆæ¯çš„ä½¿ç”¨æ˜¯æœ‰ä¸€å®šé™åˆ¶çš„ï¼Œè¿™äº›æ¶ˆæ¯åº”è¯¥æœ‰ç›¸åŒçš„Topicï¼Œç›¸åŒçš„waitStoreMsgOKã€‚è€Œä¸”ä¸èƒ½æ˜¯å»¶è¿Ÿæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ç­‰ã€‚</p></blockquote><h4 id="è¿‡æ»¤æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#è¿‡æ»¤æ¶ˆæ¯" aria-hidden="true">#</a> è¿‡æ»¤æ¶ˆæ¯</h4><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Messageçš„Tagå±æ€§æ¥ç®€å•å¿«é€Ÿçš„è¿‡æ»¤ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨Tagè¿‡æ»¤æ¶ˆæ¯çš„æ¶ˆæ¯ç”Ÿäº§è€…æ¡ˆä¾‹è§ï¼šorg.apache.rocketmq.example.filter.TagFilterProducer</p><p>ä½¿ç”¨Tagè¿‡æ»¤æ¶ˆæ¯çš„æ¶ˆæ¯æ¶ˆè´¹è€…æ¡ˆä¾‹è§ï¼šorg.apache.rocketmq.example.filter.TagFilterConsumer</p><blockquote><p>ä¸»è¦æ˜¯çœ‹æ¶ˆæ¯æ¶ˆè´¹è€…ã€‚consumer.subscribe(&quot;TagFilterTest&quot;, &quot;TagA || TagC&quot;); è¿™å¥åªè®¢é˜…TagAå’ŒTagCçš„æ¶ˆæ¯ã€‚</p><p>TAGæ˜¯RocketMQä¸­ç‰¹æœ‰çš„ä¸€ä¸ªæ¶ˆæ¯å±æ€§ã€‚RocketMQçš„æœ€ä½³å®è·µä¸­å°±å»ºè®®ï¼Œä½¿ç”¨RocketMQæ—¶ï¼Œä¸€ä¸ªåº”ç”¨å¯ä»¥å°±ç”¨ä¸€ä¸ªTopicï¼Œè€Œåº”ç”¨ä¸­çš„ä¸åŒä¸šåŠ¡å°±ç”¨TAGæ¥åŒºåˆ†ã€‚</p></blockquote><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼Œå°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯åªèƒ½æœ‰ä¸€ä¸ªTAGï¼Œè¿™åœ¨ä¸€äº›æ¯”è¾ƒå¤æ‚çš„åœºæ™¯å°±æœ‰ç‚¹ä¸è¶³äº†ã€‚ è¿™æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨SQLè¡¨è¾¾å¼æ¥å¯¹æ¶ˆæ¯è¿›è¡Œè¿‡æ»¤ã€‚</p><p>SQLè¿‡æ»¤çš„æ¶ˆæ¯ç”Ÿäº§è€…æ¡ˆä¾‹è§ï¼šorg.apache.rocketmq.example.filter.SqlFilterProducer</p><p>SQLè¿‡æ»¤çš„æ¶ˆæ¯æ¶ˆè´¹è€…æ¡ˆä¾‹è§ï¼šorg.apache.rocketmq.example.filter.SqlFilterConsumer</p><blockquote><p>è¿™ä¸ªæ¨¡å¼çš„å…³é”®æ˜¯åœ¨æ¶ˆè´¹è€…ç«¯ä½¿ç”¨MessageSelector.bySql(String sql)è¿”å›çš„ä¸€ä¸ªMessageSelectorã€‚è¿™é‡Œé¢çš„sqlè¯­å¥æ˜¯æŒ‰ç…§SQL92æ ‡å‡†æ¥æ‰§è¡Œçš„ã€‚sqlä¸­å¯ä»¥ä½¿ç”¨çš„å‚æ•°æœ‰é»˜è®¤çš„TAGSå’Œä¸€ä¸ªåœ¨ç”Ÿäº§è€…ä¸­åŠ å…¥çš„aå±æ€§ã€‚</p><p>SQL92è¯­æ³•ï¼š</p><p>RocketMQåªå®šä¹‰äº†ä¸€äº›åŸºæœ¬è¯­æ³•æ¥æ”¯æŒè¿™ä¸ªç‰¹æ€§ã€‚ä½ ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•å®ƒã€‚</p><ul><li>æ•°å€¼æ¯”è¾ƒï¼Œæ¯”å¦‚ï¼š<strong>&gt;ï¼Œ&gt;=ï¼Œ&lt;ï¼Œ&lt;=ï¼ŒBETWEENï¼Œ=ï¼›</strong></li><li>å­—ç¬¦æ¯”è¾ƒï¼Œæ¯”å¦‚ï¼š<strong>=ï¼Œ&lt;&gt;ï¼ŒINï¼›</strong></li><li><strong>IS NULL</strong> æˆ–è€… <strong>IS NOT NULLï¼›</strong></li><li>é€»è¾‘ç¬¦å· <strong>ANDï¼ŒORï¼ŒNOTï¼›</strong></li></ul><p>å¸¸é‡æ”¯æŒç±»å‹ä¸ºï¼š</p><ul><li>æ•°å€¼ï¼Œæ¯”å¦‚ï¼š<strong>123ï¼Œ3.1415ï¼›</strong></li><li>å­—ç¬¦ï¼Œæ¯”å¦‚ï¼š<strong>&#39;abc&#39;ï¼Œå¿…é¡»ç”¨å•å¼•å·åŒ…è£¹èµ·æ¥ï¼›</strong></li><li><strong>NULL</strong>ï¼Œç‰¹æ®Šçš„å¸¸é‡</li><li>å¸ƒå°”å€¼ï¼Œ<strong>TRUE</strong> æˆ– <strong>FALSE</strong></li></ul><p>ä½¿ç”¨æ³¨æ„ï¼šåªæœ‰æ¨æ¨¡å¼çš„æ¶ˆè´¹è€…å¯ä»¥ä½¿ç”¨SQLè¿‡æ»¤ã€‚æ‹‰æ¨¡å¼æ˜¯ç”¨ä¸äº†çš„ã€‚</p></blockquote><blockquote><p>å¤§å®¶æƒ³ä¸€ä¸‹ï¼Œè¿™ä¸ªæ¶ˆæ¯è¿‡æ»¤æ˜¯åœ¨Brokerç«¯è¿›è¡Œçš„è¿˜æ˜¯åœ¨Consumerç«¯è¿›è¡Œçš„ï¼Ÿ</p></blockquote><h4 id="äº‹åŠ¡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡æ¶ˆæ¯" aria-hidden="true">#</a> äº‹åŠ¡æ¶ˆæ¯</h4><p>è¿™ä¸ªäº‹åŠ¡æ¶ˆæ¯æ˜¯RocketMQæä¾›çš„ä¸€ä¸ªéå¸¸æœ‰ç‰¹è‰²çš„åŠŸèƒ½ï¼Œéœ€è¦ç€é‡ç†è§£ã€‚</p><p><strong>é¦–å…ˆ</strong>ï¼Œæˆ‘ä»¬äº†è§£ä¸‹ä»€ä¹ˆæ˜¯äº‹åŠ¡æ¶ˆæ¯ã€‚å®˜ç½‘çš„ä»‹ç»æ˜¯ï¼šäº‹åŠ¡æ¶ˆæ¯æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„ä¸¤é˜¶æ®µæäº¤çš„æ¶ˆæ¯å®ç°ã€‚ä»–å¯ä»¥ä¿è¯æœ¬åœ°äº‹åŠ¡æ‰§è¡Œä¸æ¶ˆæ¯å‘é€ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸¤ä¸ªæ“ä½œä¸€èµ·æˆåŠŸæˆ–è€…ä¸€èµ·å¤±è´¥ã€‚</p><p><strong>å…¶æ¬¡</strong>ï¼Œæˆ‘ä»¬æ¥ç†è§£ä¸‹äº‹åŠ¡æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ã€‚äº‹åŠ¡æ¶ˆæ¯åªä¿è¯æ¶ˆæ¯å‘é€è€…çš„æœ¬åœ°äº‹åŠ¡ä¸å‘æ¶ˆæ¯è¿™ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œå› æ­¤ï¼Œäº‹åŠ¡æ¶ˆæ¯çš„ç¤ºä¾‹åªæ¶‰åŠåˆ°æ¶ˆæ¯å‘é€è€…ï¼Œå¯¹äºæ¶ˆæ¯æ¶ˆè´¹è€…æ¥è¯´ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚</p><p>äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…çš„æ¡ˆä¾‹è§ï¼šorg.apache.rocketmq.example.transaction.TransactionProducer</p><blockquote><p>äº‹åŠ¡æ¶ˆæ¯çš„å…³é”®æ˜¯åœ¨TransactionMQProducerä¸­æŒ‡å®šäº†ä¸€ä¸ªTransactionListeneräº‹åŠ¡ç›‘å¬å™¨ï¼Œè¿™ä¸ªäº‹åŠ¡ç›‘å¬å™¨å°±æ˜¯äº‹åŠ¡æ¶ˆæ¯çš„å…³é”®æ§åˆ¶å™¨ã€‚æºç ä¸­çš„æ¡ˆä¾‹æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘è¿™é‡Œå‡†å¤‡äº†ä¸€ä¸ªæ›´æ¸…æ™°æ˜äº†çš„äº‹åŠ¡ç›‘å¬å™¨ç¤ºä¾‹</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionListenerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransactionListener</span> <span class="token punctuation">{</span>
 <span class="token comment">//åœ¨æäº¤å®Œäº‹åŠ¡æ¶ˆæ¯åæ‰§è¡Œã€‚</span>
 <span class="token comment">//è¿”å›COMMIT_MESSAGEçŠ¶æ€çš„æ¶ˆæ¯ä¼šç«‹å³è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ã€‚</span>
 <span class="token comment">//è¿”å›ROLLBACK_MESSAGEçŠ¶æ€çš„æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒã€‚</span>
 <span class="token comment">//è¿”å›UNKNOWNçŠ¶æ€çš„æ¶ˆæ¯ä¼šç”±Brokerè¿‡ä¸€æ®µæ—¶é—´å†æ¥å›æŸ¥äº‹åŠ¡çš„çŠ¶æ€ã€‚</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">executeLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> tags <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//TagAçš„æ¶ˆæ¯ä¼šç«‹å³è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>tags<span class="token punctuation">,</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token comment">//TagBçš„æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>tags<span class="token punctuation">,</span><span class="token string">&quot;TagB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">ROLLBACK_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token comment">//å…¶ä»–æ¶ˆæ¯ä¼šç­‰å¾…Brokerè¿›è¡Œäº‹åŠ¡çŠ¶æ€å›æŸ¥ã€‚</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">UNKNOW</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 <span class="token comment">//åœ¨å¯¹UNKNOWNçŠ¶æ€çš„æ¶ˆæ¯è¿›è¡ŒçŠ¶æ€å›æŸ¥æ—¶æ‰§è¡Œã€‚è¿”å›çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">checkLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> tags <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//TagCçš„æ¶ˆæ¯è¿‡ä¸€æ®µæ—¶é—´ä¼šè¢«æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>tags<span class="token punctuation">,</span><span class="token string">&quot;TagC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token comment">//TagDçš„æ¶ˆæ¯ä¹Ÿä¼šåœ¨çŠ¶æ€å›æŸ¥æ—¶è¢«ä¸¢å¼ƒæ‰</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>tags<span class="token punctuation">,</span><span class="token string">&quot;TagD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">ROLLBACK_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token comment">//å‰©ä¸‹TagEçš„æ¶ˆæ¯ä¼šåœ¨å¤šæ¬¡çŠ¶æ€å›æŸ¥åæœ€ç»ˆä¸¢å¼ƒ</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">UNKNOW</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç„¶å</strong>ï¼Œæˆ‘ä»¬è¦äº†è§£ä¸‹äº‹åŠ¡æ¶ˆæ¯çš„ä½¿ç”¨é™åˆ¶ï¼š</p><p>1ã€äº‹åŠ¡æ¶ˆæ¯ä¸æ”¯æŒå»¶è¿Ÿæ¶ˆæ¯å’Œæ‰¹é‡æ¶ˆæ¯ã€‚</p><p>2ã€ä¸ºäº†é¿å…å•ä¸ªæ¶ˆæ¯è¢«æ£€æŸ¥å¤ªå¤šæ¬¡è€Œå¯¼è‡´åŠé˜Ÿåˆ—æ¶ˆæ¯ç´¯ç§¯ï¼Œæˆ‘ä»¬é»˜è®¤å°†å•ä¸ªæ¶ˆæ¯çš„æ£€æŸ¥æ¬¡æ•°é™åˆ¶ä¸º 15 æ¬¡ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥é€šè¿‡ Broker é…ç½®æ–‡ä»¶çš„ <code>transactionCheckMax</code>å‚æ•°æ¥ä¿®æ”¹æ­¤é™åˆ¶ã€‚å¦‚æœå·²ç»æ£€æŸ¥æŸæ¡æ¶ˆæ¯è¶…è¿‡ N æ¬¡çš„è¯ï¼ˆ N = <code>transactionCheckMax</code> ï¼‰ åˆ™ Broker å°†ä¸¢å¼ƒæ­¤æ¶ˆæ¯ï¼Œå¹¶åœ¨é»˜è®¤æƒ…å†µä¸‹åŒæ—¶æ‰“å°é”™è¯¯æ—¥å¿—ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡é‡å†™ <code>AbstractTransactionCheckListener</code> ç±»æ¥ä¿®æ”¹è¿™ä¸ªè¡Œä¸ºã€‚</p><p>3ã€äº‹åŠ¡æ¶ˆæ¯å°†åœ¨ Broker é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•° transactionMsgTimeout è¿™æ ·çš„ç‰¹å®šæ—¶é—´é•¿åº¦ä¹‹åè¢«æ£€æŸ¥ã€‚å½“å‘é€äº‹åŠ¡æ¶ˆæ¯æ—¶ï¼Œç”¨æˆ·è¿˜å¯ä»¥é€šè¿‡è®¾ç½®ç”¨æˆ·å±æ€§ CHECK_IMMUNITY_TIME_IN_SECONDS æ¥æ”¹å˜è¿™ä¸ªé™åˆ¶ï¼Œè¯¥å‚æ•°ä¼˜å…ˆäº <code>transactionMsgTimeout</code> å‚æ•°ã€‚</p><p>4ã€äº‹åŠ¡æ€§æ¶ˆæ¯å¯èƒ½ä¸æ­¢ä¸€æ¬¡è¢«æ£€æŸ¥æˆ–æ¶ˆè´¹ã€‚</p><p>5ã€æäº¤ç»™ç”¨æˆ·çš„ç›®æ ‡ä¸»é¢˜æ¶ˆæ¯å¯èƒ½ä¼šå¤±è´¥ï¼Œç›®å‰è¿™ä¾æ—¥å¿—çš„è®°å½•è€Œå®šã€‚å®ƒçš„é«˜å¯ç”¨æ€§é€šè¿‡ RocketMQ æœ¬èº«çš„é«˜å¯ç”¨æ€§æœºåˆ¶æ¥ä¿è¯ï¼Œå¦‚æœå¸Œæœ›ç¡®ä¿äº‹åŠ¡æ¶ˆæ¯ä¸ä¸¢å¤±ã€å¹¶ä¸”äº‹åŠ¡å®Œæ•´æ€§å¾—åˆ°ä¿è¯ï¼Œå»ºè®®ä½¿ç”¨åŒæ­¥çš„åŒé‡å†™å…¥æœºåˆ¶ã€‚</p><p>6ã€äº‹åŠ¡æ¶ˆæ¯çš„ç”Ÿäº§è€… ID ä¸èƒ½ä¸å…¶ä»–ç±»å‹æ¶ˆæ¯çš„ç”Ÿäº§è€… ID å…±äº«ã€‚ä¸å…¶ä»–ç±»å‹çš„æ¶ˆæ¯ä¸åŒï¼Œäº‹åŠ¡æ¶ˆæ¯å…è®¸åå‘æŸ¥è¯¢ã€MQæœåŠ¡å™¨èƒ½é€šè¿‡å®ƒä»¬çš„ç”Ÿäº§è€… ID æŸ¥è¯¢åˆ°æ¶ˆè´¹è€…ã€‚</p><p><strong>æ¥ä¸‹æ¥</strong>ï¼Œæˆ‘ä»¬è¿˜è¦äº†è§£ä¸‹äº‹åŠ¡æ¶ˆæ¯çš„å®ç°æœºåˆ¶ï¼Œå‚è§ä¸‹å›¾ï¼š</p><figure><img src="https://img.jssjqd.cn//202305052009139.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶çš„å…³é”®æ˜¯åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šå°†æ¶ˆæ¯è½¬ä¸ºä¸€ä¸ªhalfåŠæ¶ˆæ¯ï¼Œå¹¶å­˜å…¥RocketMQå†…éƒ¨çš„ä¸€ä¸ª RMQ_SYS_TRANS_HALF_TOPIC è¿™ä¸ªTopicï¼Œè¿™æ ·å¯¹æ¶ˆè´¹è€…æ˜¯ä¸å¯è§çš„ã€‚å†ç»è¿‡ä¸€ç³»åˆ—äº‹åŠ¡æ£€æŸ¥é€šè¿‡åï¼Œå†å°†æ¶ˆæ¯è½¬å­˜åˆ°ç›®æ ‡Topicï¼Œè¿™æ ·å¯¹æ¶ˆè´¹è€…å°±å¯è§äº†ã€‚</p><p><strong>æœ€å</strong>ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ€è€ƒä¸‹äº‹åŠ¡æ¶ˆæ¯çš„ä½œç”¨ã€‚</p><p>å¤§å®¶æƒ³ä¸€ä¸‹è¿™ä¸ªäº‹åŠ¡æ¶ˆæ¯è·Ÿåˆ†å¸ƒå¼äº‹åŠ¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿä¸ºä»€ä¹ˆæ‰¯åˆ°äº†åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³çš„ä¸¤é˜¶æ®µæäº¤ä¸Šäº†ï¼Ÿäº‹åŠ¡æ¶ˆæ¯åªä¿è¯äº†å‘é€è€…æœ¬åœ°äº‹åŠ¡å’Œå‘é€æ¶ˆæ¯è¿™ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯æ¶ˆè´¹è€…æœ¬åœ°äº‹åŠ¡çš„åŸå­æ€§ï¼Œæ‰€ä»¥ï¼Œäº‹åŠ¡æ¶ˆæ¯åªä¿è¯äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€åŠã€‚ä½†æ˜¯å³ä½¿è¿™æ ·ï¼Œ<strong>å¯¹äºå¤æ‚çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒRocketMQæä¾›çš„äº‹åŠ¡æ¶ˆæ¯ä¹Ÿæ˜¯ç›®å‰ä¸šå†…æœ€ä½³çš„é™çº§æ–¹æ¡ˆ</strong>ã€‚</p><h4 id="aclæƒé™æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#aclæƒé™æ§åˆ¶" aria-hidden="true">#</a> ACLæƒé™æ§åˆ¶</h4><p>æƒé™æ§åˆ¶ï¼ˆACLï¼‰ä¸»è¦ä¸ºRocketMQæä¾›Topicèµ„æºçº§åˆ«çš„ç”¨æˆ·è®¿é—®æ§åˆ¶ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨RocketMQæƒé™æ§åˆ¶æ—¶ï¼Œå¯ä»¥åœ¨Clientå®¢æˆ·ç«¯é€šè¿‡ RPCHookæ³¨å…¥AccessKeyå’ŒSecretKeyç­¾åï¼›åŒæ—¶ï¼Œå°†å¯¹åº”çš„æƒé™æ§åˆ¶å±æ€§ï¼ˆåŒ…æ‹¬Topicè®¿é—®æƒé™ã€IPç™½åå•å’ŒAccessKeyå’ŒSecretKeyç­¾åç­‰ï¼‰è®¾ç½®åœ¨$ROCKETMQ_HOME/conf/plain_acl.ymlçš„é…ç½®æ–‡ä»¶ä¸­ã€‚Brokerç«¯å¯¹AccessKeyæ‰€æ‹¥æœ‰çš„æƒé™è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒä¸è¿‡ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼› ACLå®¢æˆ·ç«¯å¯ä»¥å‚è€ƒï¼š<strong>org.apache.rocketmq.example.simple</strong>åŒ…ä¸‹é¢çš„<strong>AclClient</strong>ä»£ç ã€‚</p><blockquote><p>æ³¨æ„ï¼Œå¦‚æœè¦åœ¨è‡ªå·±çš„å®¢æˆ·ç«¯ä¸­ä½¿ç”¨RocketMQçš„ACLåŠŸèƒ½ï¼Œè¿˜éœ€è¦å¼•å…¥ä¸€ä¸ªå•ç‹¬çš„ä¾èµ–åŒ…</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
	&lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;
	&lt;artifactId&gt;rocketmq-acl&lt;/artifactId&gt;
	&lt;version&gt;4.9.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>è€ŒBrokerç«¯å…·ä½“çš„é…ç½®ä¿¡æ¯å¯ä»¥å‚è§æºç åŒ…ä¸‹docs/cn/acl/user_guide.mdã€‚ä¸»è¦æ˜¯åœ¨broker.confä¸­æ‰“å¼€aclçš„æ ‡å¿—ï¼šaclEnable=trueã€‚ç„¶åå°±å¯ä»¥ç”¨plain_acl.ymlæ¥è¿›è¡Œæƒé™é…ç½®äº†ã€‚å¹¶ä¸”è¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯çƒ­åŠ è½½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ä¿®æ”¹é…ç½®æ—¶ï¼Œåªè¦ä¿®æ”¹é…ç½®æ–‡ä»¶å°±å¯ä»¥äº†ï¼Œä¸ç”¨é‡å¯BrokeræœåŠ¡ã€‚æˆ‘ä»¬æ¥ç®€å•åˆ†æä¸‹æºç ä¸­çš„plan_acl.ymlçš„é…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">#å…¨å±€ç™½åå•ï¼Œä¸å—ACLæ§åˆ¶</span>
<span class="token comment">#é€šå¸¸éœ€è¦å°†ä¸»ä»æ¶æ„ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹åŠ è¿›æ¥</span>
<span class="token key atrule">globalWhiteRemoteAddresses</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> 10.10.103.*
<span class="token punctuation">-</span> 192.168.0.*

<span class="token key atrule">accounts</span><span class="token punctuation">:</span>
<span class="token comment">#ç¬¬ä¸€ä¸ªè´¦æˆ·</span>
<span class="token punctuation">-</span> <span class="token key atrule">accessKey</span><span class="token punctuation">:</span> RocketMQ
  <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> <span class="token number">12345678</span>
  <span class="token key atrule">whiteRemoteAddress</span><span class="token punctuation">:</span>
  <span class="token key atrule">admin</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> 
  <span class="token key atrule">defaultTopicPerm</span><span class="token punctuation">:</span> DENY <span class="token comment">#é»˜è®¤Topicè®¿é—®ç­–ç•¥æ˜¯æ‹’ç»</span>
  <span class="token key atrule">defaultGroupPerm</span><span class="token punctuation">:</span> SUB <span class="token comment">#é»˜è®¤Groupè®¿é—®ç­–ç•¥æ˜¯åªå…è®¸è®¢é˜…</span>
  <span class="token key atrule">topicPerms</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> topicA=DENY <span class="token comment">#topicAæ‹’ç»</span>
  <span class="token punctuation">-</span> topicB=PUB<span class="token punctuation">|</span>SUB <span class="token comment">#topicBå…è®¸å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯</span>
  <span class="token punctuation">-</span> topicC=SUB <span class="token comment">#topicCåªå…è®¸è®¢é˜…</span>
  <span class="token key atrule">groupPerms</span><span class="token punctuation">:</span>
  <span class="token comment"># the group should convert to retry topic</span>
  <span class="token punctuation">-</span> groupA=DENY
  <span class="token punctuation">-</span> groupB=PUB<span class="token punctuation">|</span>SUB
  <span class="token punctuation">-</span> groupC=SUB
<span class="token comment">#ç¬¬äºŒä¸ªè´¦æˆ·ï¼Œåªè¦æ˜¯æ¥è‡ª192.168.1.*çš„IPï¼Œå°±å¯ä»¥è®¿é—®æ‰€æœ‰èµ„æº</span>
<span class="token punctuation">-</span> <span class="token key atrule">accessKey</span><span class="token punctuation">:</span> rocketmq2
  <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> <span class="token number">12345678</span>
  <span class="token key atrule">whiteRemoteAddress</span><span class="token punctuation">:</span> 192.168.1.*
  <span class="token comment"># if it is admin, it could access all resources</span>
  <span class="token key atrule">admin</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äºŒã€springbootæ•´åˆrocketmq" tabindex="-1"><a class="header-anchor" href="#äºŒã€springbootæ•´åˆrocketmq" aria-hidden="true">#</a> äºŒã€SpringBootæ•´åˆRocketMQ</h2><p>å¿«é€Ÿå®æˆ˜</p><p>è¿™éƒ¨åˆ†æˆ‘ä»¬çœ‹ä¸‹SpringBootå¦‚ä½•å¿«é€Ÿé›†æˆRocketMQã€‚</p><blockquote><p>åœ¨ä½¿ç”¨SpringBootçš„starteré›†æˆåŒ…æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„ç‰ˆæœ¬ã€‚å› ä¸ºSpringBooté›†æˆRocketMQçš„starterä¾èµ–æ˜¯ç”±Springç¤¾åŒºæä¾›çš„ï¼Œç›®å‰æ­£åœ¨å¿«é€Ÿè¿­ä»£çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®è·éå¸¸å¤§ï¼Œç”šè‡³åŸºç¡€çš„åº•å±‚å¯¹è±¡éƒ½ä¼šç»å¸¸æœ‰æ”¹åŠ¨ã€‚ä¾‹å¦‚å¦‚æœä½¿ç”¨rocketmq-spring-boot-starter:2.0.4ç‰ˆæœ¬å¼€å‘çš„ä»£ç ï¼Œå‡çº§åˆ°ç›®å‰æœ€æ–°çš„rocketmq-spring-boot-starter:2.1.1åï¼ŒåŸºæœ¬å°±ç”¨ä¸äº†äº†ã€‚</p></blockquote><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼Œå¼•å…¥å…³é”®ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>rocketmq-spring-boot-starter:2.1.1å¼•å…¥çš„SpringBootåŒ…ç‰ˆæœ¬æ˜¯2.0.5.RELEASEï¼Œè¿™é‡ŒæŠŠSpringBootçš„ä¾èµ–åŒ…å‡çº§äº†ä¸€ä¸‹ã€‚</p></blockquote><p>ç„¶åæˆ‘ä»¬ä»¥SpringBootçš„æ–¹å¼ï¼Œå¿«é€Ÿåˆ›å»ºä¸€ä¸ªç®€å•çš„Demo</p><p>å¯åŠ¨ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RocketMQScApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">RocketMQScApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æ–‡ä»¶ application.properties</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#NameServeråœ°å€</span>
<span class="token key attr-name">rocketmq.name-server</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.232.128:9876</span>
<span class="token comment">#é»˜è®¤çš„æ¶ˆæ¯ç”Ÿäº§è€…ç»„</span>
<span class="token key attr-name">rocketmq.producer.group</span><span class="token punctuation">=</span><span class="token value attr-value">springBootGroup</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¶ˆæ¯ç”Ÿäº§è€…</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>rocket<span class="token punctuation">.</span>basic</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">MQClientException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RocketMQTransactionListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">MessageBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">UnsupportedEncodingException</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> ï¼šæ¥¼å…°
 * <span class="token keyword">@description</span>:
 **/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringProducer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RocketMQTemplate</span> rocketMQTemplate<span class="token punctuation">;</span>
 <span class="token comment">//å‘é€æ™®é€šæ¶ˆæ¯çš„ç¤ºä¾‹</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rocketMQTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token comment">//å‘é€äº‹åŠ¡æ¶ˆæ¯çš„ç¤ºä¾‹</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessageInTransaction</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> message <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> destination <span class="token operator">=</span>topic<span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> rocketMQTemplate<span class="token punctuation">.</span><span class="token function">sendMessageInTransaction</span><span class="token punctuation">(</span>destination<span class="token punctuation">,</span> message<span class="token punctuation">,</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¶ˆæ¯æ¶ˆè´¹è€…</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>rocket<span class="token punctuation">.</span>basic</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RocketMQMessageListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> ï¼šæ¥¼å…°
 * <span class="token keyword">@description</span>:
 **/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RocketMQMessageListener</span><span class="token punctuation">(</span>consumerGroup <span class="token operator">=</span> <span class="token string">&quot;MyConsumerGroup&quot;</span><span class="token punctuation">,</span> topic <span class="token operator">=</span> <span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConsumer</span> <span class="token keyword">implements</span> <span class="token class-name">RocketMQListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received message : &quot;</span><span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>SpringBooté›†æˆRocketMQï¼Œæ¶ˆè´¹è€…éƒ¨åˆ†çš„æ ¸å¿ƒå°±åœ¨è¿™ä¸ª@RocketMQMessageListeneræ³¨è§£ä¸Šã€‚æ‰€æœ‰æ¶ˆè´¹è€…çš„æ ¸å¿ƒåŠŸèƒ½ä¹Ÿéƒ½ä¼šé›†æˆåˆ°è¿™ä¸ªæ³¨è§£ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜è¦æ³¨æ„ä¸‹è¿™ä¸ªæ³¨è§£é‡Œé¢çš„å±æ€§ï¼š</p><p>ä¾‹å¦‚ï¼šæ¶ˆæ¯è¿‡æ»¤å¯ä»¥ç”±é‡Œé¢çš„selectorTypeå±æ€§å’ŒselectorExpressionæ¥å®šåˆ¶</p><p>æ¶ˆæ¯æœ‰åºæ¶ˆè´¹è¿˜æ˜¯å¹¶å‘æ¶ˆè´¹åˆ™ç”±consumeModeå±æ€§å®šåˆ¶ã€‚</p><p>æ¶ˆè´¹è€…æ˜¯é›†ç¾¤éƒ¨ç½²è¿˜æ˜¯å¹¿æ’­éƒ¨ç½²ç”±messageModelå±æ€§å®šåˆ¶ã€‚</p></blockquote><p>ç„¶åå…³äºäº‹åŠ¡æ¶ˆæ¯ï¼Œè¿˜éœ€è¦é…ç½®ä¸€ä¸ªäº‹åŠ¡æ¶ˆæ¯ç›‘å¬å™¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>rocket<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">LocalTransactionState</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RocketMQTransactionListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQLocalTransactionListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQLocalTransactionState</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">RocketMQUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>converter<span class="token punctuation">.</span></span><span class="token class-name">StringMessageConverter</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ConcurrentHashMap</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> ï¼šæ¥¼å…°
 * <span class="token keyword">@description</span>:
 **/</span>

<span class="token annotation punctuation">@RocketMQTransactionListener</span><span class="token punctuation">(</span>rocketMQTemplateBeanName <span class="token operator">=</span> <span class="token string">&quot;rocketMQTemplate&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTransactionImpl</span> <span class="token keyword">implements</span> <span class="token class-name">RocketMQLocalTransactionListener</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> localTrans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">RocketMQLocalTransactionState</span> <span class="token function">executeLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> id <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> destination <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        localTrans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span>Message</span> message <span class="token operator">=</span> <span class="token class-name">RocketMQUtil</span><span class="token punctuation">.</span><span class="token function">convertToRocketMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">,</span>destination<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> tags <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>tags<span class="token punctuation">,</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">RocketMQLocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>tags<span class="token punctuation">,</span><span class="token string">&quot;TagB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">RocketMQLocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">ROLLBACK</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">RocketMQLocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">UNKNOWN</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">RocketMQLocalTransactionState</span> <span class="token function">checkLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//SpringBootçš„æ¶ˆæ¯å¯¹è±¡ä¸­ï¼Œå¹¶æ²¡æœ‰transactionIdè¿™ä¸ªå±æ€§ã€‚è·ŸåŸç”ŸAPIä¸ä¸€æ ·ã€‚</span>
<span class="token comment">//        String destination = localTrans.get(msg.getTransactionId());</span>
        <span class="token keyword">return</span> <span class="token class-name">RocketMQLocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·æˆ‘ä»¬å¯åŠ¨åº”ç”¨åï¼Œå°±èƒ½å¤Ÿé€šè¿‡è®¿é—® <a href="http://localhost:8080/MQTest/sendMessage?message=123" target="_blank" rel="noopener noreferrer">http://localhost:8080/MQTest/sendMessage?message=123<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æ¥å£æ¥å‘é€ä¸€æ¡ç®€å•æ¶ˆæ¯ã€‚å¹¶åœ¨SpringConsumerä¸­æ¶ˆè´¹åˆ°ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡è®¿é—®<a href="http://localhost:8080/MQTest/sendTransactionMessage?message=123" target="_blank" rel="noopener noreferrer">http://localhost:8080/MQTest/sendTransactionMessage?message=123<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ï¼Œæ¥å‘é€ä¸€æ¡äº‹åŠ¡æ¶ˆæ¯ã€‚</p><blockquote><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº‹åŠ¡æ¶ˆæ¯ï¼ŒSpringBootè¿›è¡Œå°è£…æ—¶ï¼Œå°±ç¼ºå°‘äº†transactionIdï¼Œè¿™åœ¨äº‹åŠ¡æ§åˆ¶ä¸­æ˜¯éå¸¸å…³é”®çš„ã€‚</p></blockquote><h3 id="å…¶ä»–æ›´å¤šæ¶ˆæ¯ç±»å‹" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–æ›´å¤šæ¶ˆæ¯ç±»å‹" aria-hidden="true">#</a> å…¶ä»–æ›´å¤šæ¶ˆæ¯ç±»å‹ï¼š</h3><p>å¯¹äºå…¶ä»–çš„æ¶ˆæ¯ç±»å‹ï¼Œæ–‡æ¡£ä¸­å°±ä¸ä¸€ä¸€è®°å½•äº†ã€‚å…·ä½“å¯ä»¥å‚è§æºç ä¸­çš„junitæµ‹è¯•æ¡ˆä¾‹ã€‚</p><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h3><ul><li>SpringBoot å¼•å…¥org.apache.rocketmq:rocketmq-spring-boot-starterä¾èµ–åï¼Œå°±å¯ä»¥é€šè¿‡å†…ç½®çš„RocketMQTemplateæ¥ä¸RocketMQäº¤äº’ã€‚ç›¸å…³å±æ€§éƒ½ä»¥rockemq.å¼€å¤´ã€‚å…·ä½“æ‰€æœ‰çš„é…ç½®ä¿¡æ¯å¯ä»¥å‚è§org.apache.rocketmq.spring.autoconfigure.RocketMQPropertiesè¿™ä¸ªç±»ã€‚</li><li>SpringBootä¾èµ–ä¸­çš„Messageå¯¹è±¡å’ŒRocketMQ-clientä¸­çš„Messageå¯¹è±¡æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œè¿™åœ¨ä½¿ç”¨çš„æ—¶å€™è¦éå¸¸å®¹æ˜“å¼„é”™ã€‚ä¾‹å¦‚RocketMQ-clientä¸­çš„Messageé‡Œçš„TAGå±æ€§ï¼Œåœ¨SpringBootä¾èµ–ä¸­çš„Messageä¸­å°±æ²¡æœ‰ã€‚Tagå±æ€§è¢«ç§»åˆ°äº†å‘é€ç›®æ ‡ä¸­ï¼Œä¸Topicä¸€èµ·ï¼Œä»¥Topic:Tagçš„æ–¹å¼æŒ‡å®šã€‚</li><li>æœ€åå¼ºè°ƒä¸€æ¬¡ï¼Œä¸€å®šè¦æ³¨æ„ç‰ˆæœ¬ã€‚rocketmq-spring-boot-starterçš„æ›´æ–°è¿›åº¦ä¸€èˆ¬éƒ½ä¼šç•¥æ…¢äºRocketMQçš„ç‰ˆæœ¬æ›´æ–°ï¼Œå¹¶ä¸”ç‰ˆæœ¬ä¸åŒä¼šå¼•å‘å¾ˆå¤šå¥‡æ€ªçš„é—®é¢˜ã€‚apacheæœ‰ä¸€ä¸ªå®˜æ–¹çš„rocketmq-springç¤ºä¾‹ï¼Œåœ°å€ï¼š<a href="https://github.com/apache/rocketmq-spring.git" target="_blank" rel="noopener noreferrer">https://github.com/apache/rocketmq-spring.git<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä»¥åå¦‚æœç‰ˆæœ¬æ›´æ–°äº†ï¼Œå¯ä»¥å‚è€ƒä¸‹è¿™ä¸ªç¤ºä¾‹ä»£ç ã€‚</li></ul><h2 id="ä¸‰ã€springcloudstreamæ•´åˆrocketmq" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€springcloudstreamæ•´åˆrocketmq" aria-hidden="true">#</a> ä¸‰ã€SpringCloudStreamæ•´åˆRocketMQ</h2><p>SpringCloudStreamæ˜¯Springç¤¾åŒºæä¾›çš„ä¸€ä¸ªç»Ÿä¸€çš„æ¶ˆæ¯é©±åŠ¨æ¡†æ¶ï¼Œç›®çš„æ˜¯æƒ³è¦ä»¥ä¸€ä¸ªç»Ÿä¸€çš„ç¼–ç¨‹æ¨¡å‹æ¥å¯¹æ¥æ‰€æœ‰çš„MQæ¶ˆæ¯ä¸­é—´ä»¶äº§å“ã€‚æˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹çœ‹SpringCloudStreamå¦‚ä½•æ¥é›†æˆRocketMQã€‚</p><h3 id="å¿«é€Ÿå®æˆ˜" tabindex="-1"><a class="header-anchor" href="#å¿«é€Ÿå®æˆ˜" aria-hidden="true">#</a> å¿«é€Ÿå®æˆ˜</h3><p>åˆ›å»ºMavenå·¥ç¨‹ï¼Œå¼•å…¥ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-acl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-stream-rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.3.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-acl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.3.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åº”ç”¨å¯åŠ¨ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableBinding</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Sink</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Source</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> ï¼šæ¥¼å…°
 * <span class="token keyword">@description</span>:
 **/</span>
<span class="token annotation punctuation">@EnableBinding</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Source</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Sink</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScRocketMQApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ScRocketMQApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ³¨æ„è¿™ä¸ª@EnableBinding({Source.class, Sink.class})æ³¨è§£ï¼Œè¿™æ˜¯SpringCloudStreamå¼•å…¥çš„Binderé…ç½®ã€‚</p></blockquote><p>ç„¶åå¢åŠ é…ç½®æ–‡ä»¶application.properties</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#ScStreamé€šç”¨çš„é…ç½®ä»¥spring.cloud.streamå¼€å¤´</span>
<span class="token key attr-name">spring.cloud.stream.bindings.input.destination</span><span class="token punctuation">=</span><span class="token value attr-value">TestTopic</span>
<span class="token key attr-name">spring.cloud.stream.bindings.input.group</span><span class="token punctuation">=</span><span class="token value attr-value">scGroup</span>
<span class="token key attr-name">spring.cloud.stream.bindings.output.destination</span><span class="token punctuation">=</span><span class="token value attr-value">TestTopic</span>
<span class="token comment">#rocketMQçš„ä¸ªæ€§åŒ–é…ç½®ä»¥spring.cloud.stream.rocketmqå¼€å¤´</span>
<span class="token comment">#spring.cloud.stream.rocketmq.binder.name-server=192.168.232.128:9876;192.168.232.129:9876;192.168.232.130:9876</span>
<span class="token key attr-name">spring.cloud.stream.rocketmq.binder.name-server</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.232.128:9876</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>SpringCloudStreamä¸­ï¼Œä¸€ä¸ªbindingå¯¹åº”ä¸€ä¸ªæ¶ˆæ¯é€šé“ã€‚è¿™å…¶ä¸­é…ç½®çš„inputï¼Œæ˜¯åœ¨Sink.classä¸­å®šä¹‰çš„ï¼Œå¯¹åº”ä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹è€…ã€‚è€Œoutputï¼Œæ˜¯åœ¨Source.classä¸­å®šä¹‰çš„ï¼Œå¯¹åº”ä¸€ä¸ªæ¶ˆæ¯ç”Ÿäº§è€…ã€‚</p></blockquote><p>ç„¶åå°±å¯ä»¥å¢åŠ æ¶ˆæ¯æ¶ˆè´¹è€…ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>scrocket<span class="token punctuation">.</span>basic</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">StreamListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Sink</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> ï¼šæ¥¼å…°
 * <span class="token keyword">@description</span>:
 **/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScConsumer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@StreamListener</span><span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token punctuation">.</span><span class="token constant">INPUT</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> messsage<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;received message:&quot;</span><span class="token operator">+</span>messsage<span class="token operator">+</span><span class="token string">&quot; from binding:&quot;</span><span class="token operator">+</span> <span class="token class-name">Sink</span><span class="token punctuation">.</span><span class="token constant">INPUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¶ˆæ¯ç”Ÿäº§è€…ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>scrocket<span class="token punctuation">.</span>basic</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageConst</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Source</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">MessageHeaders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">MessageBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> ï¼šæ¥¼å…°
 * <span class="token keyword">@description</span>:
 **/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScProducer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">Source</span> source<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">MessageConst</span><span class="token punctuation">.</span><span class="token constant">PROPERTY_TAGS</span><span class="token punctuation">,</span> <span class="token string">&quot;testTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MessageHeaders</span> messageHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageHeaders</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> message <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">createMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> messageHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åå¢åŠ ä¸€ä¸ªControllerç±»ç”¨äºæµ‹è¯•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>scrocket<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>scrocket<span class="token punctuation">.</span>basic<span class="token punctuation">.</span></span><span class="token class-name">ScProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> ï¼šæ¥¼å…°
 * <span class="token keyword">@description</span>:
 **/</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/MQTest&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MQTestController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">ScProducer</span> producer<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sendMessage&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        producer<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;æ¶ˆæ¯å‘é€å®Œæˆ&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨åº”ç”¨åï¼Œå°±å¯ä»¥è®¿é—®<a href="http://localhost:8080/MQTest/sendMessage?message=123%EF%BC%8C%E7%BB%99RocketMQ%E5%8F%91%E9%80%81%E4%B8%80%E6%9D%A1%E6%B6%88%E6%81%AF%E5%88%B0TestTopic%EF%BC%8C%E5%B9%B6%E5%9C%A8ScConsumer%E4%B8%AD%E6%B6%88%E8%B4%B9%E5%88%B0%E4%BA%86%E3%80%82" target="_blank" rel="noopener noreferrer">http://localhost:8080/MQTest/sendMessage?message=123ï¼Œç»™RocketMQå‘é€ä¸€æ¡æ¶ˆæ¯åˆ°TestTopicï¼Œå¹¶åœ¨ScConsumerä¸­æ¶ˆè´¹åˆ°äº†ã€‚<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1" aria-hidden="true">#</a> æ€»ç»“</h3><ul><li>å…³äºSpringCloudStreamæ¡†æ¶ã€‚è¿™æ˜¯ä¸€å¥—å‡ ä¹é€šç”¨çš„æ¶ˆæ¯ä¸­é—´ä»¶ç¼–ç¨‹æ¡†æ¶ï¼Œä»å¯¹æ¥RocketMQæ¢åˆ°å¯¹æ¥Kafkaï¼Œä¸šåŠ¡ä»£ç å‡ ä¹ä¸éœ€è¦åŠ¨ï¼Œåªéœ€è¦æ›´æ¢pomä¾èµ–å¹¶ä¸”ä¿®æ”¹é…ç½®æ–‡ä»¶å°±è¡Œäº†ã€‚ä½†æ˜¯ï¼Œç”±äºå„ä¸ªMQäº§å“éƒ½æœ‰è‡ªå·±çš„ä¸šåŠ¡æ¨¡å‹ï¼Œå·®è·éå¸¸å¤§ï¼Œæ‰€ä»¥ä½¿ç”¨ä½¿ç”¨SpringCloudStreamæ—¶è¦æ³¨æ„ä¸šåŠ¡æ¨¡å‹è½¬æ¢ã€‚å¹¶ä¸”åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¦éå¸¸æ³¨æ„å„ä¸ªMQçš„ä¸ªæ€§åŒ–é…ç½®å±æ€§ã€‚ä¾‹å¦‚RocketMQçš„ä¸ªæ€§åŒ–å±æ€§éƒ½æ˜¯ä»¥spring.cloud.stream.rocketmqå¼€å¤´ï¼Œåªæœ‰é€šè¿‡è¿™äº›å±æ€§æ‰èƒ½ç”¨ä¸ŠRocketMQçš„å»¶è¿Ÿæ¶ˆæ¯ã€æ’åºæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ç­‰ä¸ªæ€§åŒ–åŠŸèƒ½ã€‚</li><li>å…³äºSpringCloudStreamæ¡†æ¶ä¸‹çš„RocketMQå®¢æˆ·ç«¯ç‰ˆæœ¬ï¼šRocketMQçš„SpringCloudStreamä¾èµ–æ˜¯äº¤ç”±å‚å•†è‡ªå·±ç»´æŠ¤çš„ï¼Œä¹Ÿå°±æ˜¯ç”±é˜¿é‡Œå·´å·´è‡ªå·±æ¥ç»´æŠ¤ã€‚è¿™ä¸ªç»´æŠ¤åŠ›åº¦ä¸Springç¤¾åŒºç›¸æ¯”è¿˜æ˜¯æœ‰ä¸å°å·®è·çš„ã€‚æ‰€ä»¥ä¸€æ–¹é¢å¯ä»¥çœ‹åˆ°ä¹‹å‰åœ¨ä½¿ç”¨SpringBootæ—¶ç€é‡å¼ºè°ƒçš„ç‰ˆæœ¬é—®é¢˜ï¼Œåœ¨ä½¿ç”¨SpringCloudStreamä¸­è¢«æ”¾å¤§äº†å¾ˆå¤šã€‚ç¤ºä¾‹ä¸­çš„spring-cloud-starter-stream-rocketmqçš„ä¾èµ–ç‰ˆæœ¬æ˜¯2.2.7.RELEASEï¼Œè€Œå…¶ä¸­åŒ…å«çš„rocketmq-clientç‰ˆæœ¬è¿˜æ˜¯4.6.1ã€‚è¿™ä¸ªå·®è·å°±éå¸¸å¤§äº†ã€‚rocketmqç›¸å…³çš„é€‚é…ç‰ˆæœ¬ï¼Œç›®å‰æ¥çœ‹ï¼Œè¿˜æ˜¯è·Ÿä¸ä¸Šçš„ã€‚</li><li>SpringCloudStreamStreamæ¡†æ¶æœ¬èº«ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ã€‚ä»SpringCloudStream3.1.xç‰ˆæœ¬å¼€å§‹ï¼Œå°±ä¸å†æ¨èä½¿ç”¨@EnableBindingæ³¨è§£æ¥å£°æ˜Bindingäº†ï¼Œè½¬è€Œæ¨èä½¿ç”¨Consumerï¼ŒSupplierï¼ŒFunctionè¿™ä¸€ç³»åˆ—å‡½æ•°å¼ç¼–ç¨‹ç»„ä»¶æ¥å£°æ˜Bindingï¼Œè¿™å…¶ä¸­åˆä¼šå¼•å…¥å“åº”å¼ç¼–ç¨‹çš„ä¸€ç³»åˆ—ç¼–ç¨‹é£æ ¼ã€‚ä»ç›®å‰æ¥çœ‹ï¼Œæœ‰ç‚¹å¤æ‚ï¼Œä¸å¤ªå»ºè®®ä½¿ç”¨æ–°ç‰ˆæœ¬ ã€‚</li></ul><h2 id="å››ã€rocketmqä½¿ç”¨ä¸­å¸¸è§çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å››ã€rocketmqä½¿ç”¨ä¸­å¸¸è§çš„é—®é¢˜" aria-hidden="true">#</a> å››ã€RocketMQä½¿ç”¨ä¸­å¸¸è§çš„é—®é¢˜</h2><h3 id="ä½¿ç”¨rocketmqå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨rocketmqå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" aria-hidden="true">#</a> ä½¿ç”¨RocketMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</h3><p>è¿™ä¸ªæ˜¯åœ¨é¢è¯•æ—¶ï¼Œå…³äºMQï¼Œé¢è¯•å®˜æœ€å–œæ¬¢é—®çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜æ˜¯æ‰€æœ‰MQéƒ½éœ€è¦é¢å¯¹çš„ä¸€ä¸ªå…±æ€§é—®é¢˜ã€‚å¤§è‡´çš„è§£å†³æ€è·¯éƒ½æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯é’ˆå¯¹ä¸åŒçš„MQäº§å“åˆæœ‰ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚åˆ†æè¿™ä¸ªé—®é¢˜è¦ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦å…¥æ‰‹ï¼š</p><h4 id="_1ã€å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½" tabindex="-1"><a class="header-anchor" href="#_1ã€å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½" aria-hidden="true">#</a> 1ã€å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½ï¼Ÿ</h4><p>æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªé€šç”¨çš„MQåœºæ™¯ï¼š</p><figure><img src="https://img.jssjqd.cn//202305052008481.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>å…¶ä¸­ï¼Œ1ï¼Œ2ï¼Œ4ä¸‰ä¸ªåœºæ™¯éƒ½æ˜¯è·¨ç½‘ç»œçš„ï¼Œè€Œè·¨ç½‘ç»œå°±è‚¯å®šä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½ã€‚</p><p>ç„¶åå…³äº3è¿™ä¸ªç¯èŠ‚ï¼Œé€šå¸¸MQå­˜ç›˜æ—¶éƒ½ä¼šå…ˆå†™å…¥æ“ä½œç³»ç»Ÿçš„ç¼“å­˜page cacheä¸­ï¼Œç„¶åå†ç”±æ“ä½œç³»ç»Ÿå¼‚æ­¥çš„å°†æ¶ˆæ¯å†™å…¥ç¡¬ç›˜ã€‚è¿™ä¸ªä¸­é—´æœ‰ä¸ªæ—¶é—´å·®ï¼Œå°±å¯èƒ½ä¼šé€ æˆæ¶ˆæ¯ä¸¢å¤±ã€‚å¦‚æœæœåŠ¡æŒ‚äº†ï¼Œç¼“å­˜ä¸­è¿˜æ²¡æœ‰æ¥å¾—åŠå†™å…¥ç¡¬ç›˜çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚</p><p>è¿™ä¸ªæ˜¯MQåœºæ™¯éƒ½ä¼šé¢å¯¹çš„é€šç”¨çš„ä¸¢æ¶ˆæ¯é—®é¢˜ã€‚é‚£æˆ‘ä»¬çœ‹çœ‹ç”¨RocketMQæ—¶è¦å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜</p><h4 id="_2ã€rocketmqæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_2ã€rocketmqæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ" aria-hidden="true">#</a> 2ã€RocketMQæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ</h4><h5 id="ç”Ÿäº§è€…ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶ä¿è¯æ¶ˆæ¯é›¶ä¸¢å¤±" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è€…ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶ä¿è¯æ¶ˆæ¯é›¶ä¸¢å¤±" aria-hidden="true">#</a> ç”Ÿäº§è€…ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶ä¿è¯æ¶ˆæ¯é›¶ä¸¢å¤±</h5><p>è¿™ä¸ªç»“è®ºæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå› ä¸ºRocketMQçš„äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶å°±æ˜¯ä¸ºäº†ä¿è¯é›¶ä¸¢å¤±æ¥è®¾è®¡çš„ï¼Œå¹¶ä¸”ç»è¿‡é˜¿é‡Œçš„éªŒè¯ï¼Œè‚¯å®šæ˜¯éå¸¸é è°±çš„ã€‚</p><p>ä½†æ˜¯å¦‚æœæ·±å…¥ä¸€ç‚¹çš„è¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦ç†è§£ä¸‹è¿™ä¸ªäº‹åŠ¡æ¶ˆæ¯åˆ°åº•æ˜¯ä¸æ˜¯é è°±ã€‚æˆ‘ä»¬ä»¥æœ€å¸¸è§çš„ç”µå•†è®¢å•åœºæ™¯ä¸ºä¾‹ï¼Œæ¥ç®€å•åˆ†æä¸‹äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚æˆ‘ä»¬çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªæµç¨‹å›¾ï¼š</p><figure><img src="https://img.jssjqd.cn//202305052008593.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p><strong>1ã€ä¸ºä»€ä¹ˆè¦å‘é€ä¸ªhalfæ¶ˆæ¯ï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</strong></p><p>è¿™ä¸ªhalfæ¶ˆæ¯æ˜¯åœ¨è®¢å•ç³»ç»Ÿè¿›è¡Œä¸‹å•æ“ä½œå‰å‘é€ï¼Œå¹¶ä¸”å¯¹ä¸‹æ¸¸æœåŠ¡çš„æ¶ˆè´¹è€…æ˜¯ä¸å¯è§çš„ã€‚é‚£è¿™ä¸ªæ¶ˆæ¯çš„ä½œç”¨æ›´å¤šçš„ä½“ç°åœ¨ç¡®è®¤RocketMQçš„æœåŠ¡æ˜¯å¦æ­£å¸¸ã€‚ç›¸å½“äºå—…æ¢ä¸‹RocketMQæœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œå¹¶ä¸”é€šçŸ¥RocketMQï¼Œæˆ‘é©¬ä¸Šå°±è¦å‘ä¸€ä¸ªå¾ˆé‡è¦çš„æ¶ˆæ¯äº†ï¼Œä½ åšå¥½å‡†å¤‡ã€‚</p><p><strong>2.halfæ¶ˆæ¯å¦‚æœå†™å…¥å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ</strong></p><p>å¦‚æœæ²¡æœ‰halfæ¶ˆæ¯è¿™ä¸ªæµç¨‹ï¼Œé‚£æˆ‘ä»¬é€šå¸¸æ˜¯ä¼šåœ¨è®¢å•ç³»ç»Ÿä¸­å…ˆå®Œæˆä¸‹å•ï¼Œå†å‘é€æ¶ˆæ¯ç»™MQã€‚è¿™æ—¶å€™å†™å…¥æ¶ˆæ¯åˆ°MQå¦‚æœå¤±è´¥å°±ä¼šéå¸¸å°´å°¬äº†ã€‚è€Œhalfæ¶ˆæ¯å¦‚æœå†™å…¥å¤±è´¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºMQçš„æœåŠ¡æ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™æ—¶ï¼Œå°±ä¸èƒ½é€šçŸ¥ä¸‹æ¸¸æœåŠ¡äº†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹å•æ—¶ç»™è®¢å•ä¸€ä¸ªçŠ¶æ€æ ‡è®°ï¼Œç„¶åç­‰å¾…MQæœåŠ¡æ­£å¸¸åå†è¿›è¡Œè¡¥å¿æ“ä½œï¼Œç­‰MQæœåŠ¡æ­£å¸¸åé‡æ–°ä¸‹å•é€šçŸ¥ä¸‹æ¸¸æœåŠ¡ã€‚</p><p><strong>3.è®¢å•ç³»ç»Ÿå†™æ•°æ®åº“å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ</strong></p><p>è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åŒæ ·æ¯”è¾ƒä¸‹æ²¡æœ‰ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶æ—¶ä¼šæ€ä¹ˆåŠï¼Ÿå¦‚æœæ²¡æœ‰ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¬åªèƒ½åˆ¤æ–­ä¸‹å•å¤±è´¥ï¼ŒæŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£å°±ä¸å¾€MQå‘æ¶ˆæ¯äº†ï¼Œè¿™æ ·è‡³å°‘ä¿è¯ä¸ä¼šå¯¹ä¸‹æ¸¸æœåŠ¡è¿›è¡Œé”™è¯¯çš„é€šçŸ¥ã€‚ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œå¦‚æœè¿‡ä¸€æ®µæ—¶é—´æ•°æ®åº“æ¢å¤è¿‡æ¥äº†ï¼Œè¿™ä¸ªæ¶ˆæ¯å°±æ— æ³•å†æ¬¡å‘é€äº†ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è®¾è®¡å¦å¤–çš„è¡¥å¿æœºåˆ¶ï¼Œä¾‹å¦‚å°†è®¢å•æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œå†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å®šæ—¶å°è¯•å¾€æ•°æ®åº“å†™ã€‚è€Œå¦‚æœä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶ï¼Œå°±å¯ä»¥æœ‰ä¸€ç§æ›´ä¼˜é›…çš„æ–¹æ¡ˆã€‚</p><p>å¦‚æœä¸‹å•æ—¶ï¼Œå†™æ•°æ®åº“å¤±è´¥(å¯èƒ½æ˜¯æ•°æ®åº“å´©äº†ï¼Œéœ€è¦ç­‰ä¸€æ®µæ—¶é—´æ‰èƒ½æ¢å¤)ã€‚é‚£æˆ‘ä»¬å¯ä»¥å¦å¤–æ‰¾ä¸ªåœ°æ–¹æŠŠè®¢å•æ¶ˆæ¯å…ˆç¼“å­˜èµ·æ¥(Redisã€æ–‡æœ¬æˆ–è€…å…¶ä»–æ–¹å¼)ï¼Œç„¶åç»™RocketMQè¿”å›ä¸€ä¸ªUNKNOWNçŠ¶æ€ã€‚è¿™æ ·RocketMQå°±ä¼šè¿‡ä¸€æ®µæ—¶é—´æ¥å›æŸ¥äº‹åŠ¡çŠ¶æ€ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨å›æŸ¥äº‹åŠ¡çŠ¶æ€æ—¶å†å°è¯•æŠŠè®¢å•æ•°æ®å†™å…¥æ•°æ®åº“ï¼Œå¦‚æœæ•°æ®åº“è¿™æ—¶å€™å·²ç»æ¢å¤äº†ï¼Œé‚£å°±èƒ½å®Œæ•´æ­£å¸¸çš„ä¸‹å•ï¼Œå†ç»§ç»­åé¢çš„ä¸šåŠ¡ã€‚è¿™æ ·è¿™ä¸ªè®¢å•çš„æ¶ˆæ¯å°±ä¸ä¼šå› ä¸ºæ•°æ®åº“ä¸´æ—¶å´©äº†è€Œä¸¢å¤±ã€‚</p><p><strong>4.halfæ¶ˆæ¯å†™å…¥æˆåŠŸåRocketMQæŒ‚äº†æ€ä¹ˆåŠï¼Ÿ</strong></p><p>æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸‹ï¼Œåœ¨äº‹åŠ¡æ¶ˆæ¯çš„å¤„ç†æœºåˆ¶ä¸­ï¼ŒæœªçŸ¥çŠ¶æ€çš„äº‹åŠ¡çŠ¶æ€å›æŸ¥æ˜¯ç”±RocketMQçš„Brokerä¸»åŠ¨å‘èµ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœå‡ºç°äº†è¿™ç§æƒ…å†µï¼Œé‚£RocketMQå°±ä¸ä¼šå›è°ƒåˆ°äº‹åŠ¡æ¶ˆæ¯ä¸­å›æŸ¥äº‹åŠ¡çŠ¶æ€çš„æœåŠ¡ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è®¢å•ä¸€ç›´æ ‡è®°ä¸º&quot;æ–°ä¸‹å•&quot;çš„çŠ¶æ€ã€‚è€Œç­‰RocketMQæ¢å¤åï¼Œåªè¦å­˜å‚¨çš„æ¶ˆæ¯æ²¡æœ‰ä¸¢å¤±ï¼ŒRocketMQå°±ä¼šå†æ¬¡ç»§ç»­çŠ¶æ€å›æŸ¥çš„æµç¨‹ã€‚</p><p><strong>5.ä¸‹å•æˆåŠŸåå¦‚ä½•ä¼˜é›…çš„ç­‰å¾…æ”¯ä»˜æˆåŠŸï¼Ÿ</strong></p><p>åœ¨è®¢å•åœºæ™¯ä¸‹ï¼Œé€šå¸¸ä¼šè¦æ±‚ä¸‹å•å®Œæˆåï¼Œå®¢æˆ·åœ¨ä¸€å®šæ—¶é—´å†…ï¼Œä¾‹å¦‚10åˆ†é’Ÿï¼Œå†…å®Œæˆè®¢å•æ”¯ä»˜ï¼Œæ”¯ä»˜å®Œæˆåæ‰ä¼šé€šçŸ¥ä¸‹æ¸¸æœåŠ¡è¿›è¡Œè¿›ä¸€æ­¥çš„è¥é”€è¡¥å¿ã€‚</p><p>å¦‚æœä¸ç”¨äº‹åŠ¡æ¶ˆæ¯ï¼Œé‚£é€šå¸¸ä¼šæ€ä¹ˆåŠï¼Ÿ</p><p>æœ€ç®€å•çš„æ–¹å¼æ˜¯å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ‰«æè®¢å•è¡¨ï¼Œæ¯”å¯¹æœªæ”¯ä»˜çš„è®¢å•çš„ä¸‹å•æ—¶é—´ï¼Œå°†è¶…è¿‡æ—¶é—´çš„è®¢å•å›æ”¶ã€‚è¿™ç§æ–¹å¼æ˜¾ç„¶æ˜¯æœ‰å¾ˆå¤§é—®é¢˜çš„ï¼Œéœ€è¦å®šæ—¶æ‰«æå¾ˆåºå¤§çš„ä¸€ä¸ªè®¢å•ä¿¡æ¯ï¼Œè¿™å¯¹ç³»ç»Ÿæ˜¯ä¸ªä¸å°çš„å‹åŠ›ã€‚</p><p>é‚£æ›´è¿›ä¸€æ­¥çš„æ–¹æ¡ˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯ä¸æ˜¯å°±å¯ä»¥ä½¿ç”¨RocketMQæä¾›çš„å»¶è¿Ÿæ¶ˆæ¯æœºåˆ¶ã€‚å¾€MQå‘ä¸€ä¸ªå»¶è¿Ÿ1åˆ†é’Ÿçš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹åˆ°è¿™ä¸ªæ¶ˆæ¯åå»æ£€æŸ¥è®¢å•çš„æ”¯ä»˜çŠ¶æ€ï¼Œå¦‚æœè®¢å•å·²ç»æ”¯ä»˜ï¼Œå°±å¾€ä¸‹æ¸¸å‘é€ä¸‹å•çš„é€šçŸ¥ã€‚è€Œå¦‚æœæ²¡æœ‰æ”¯ä»˜ï¼Œå°±å†å‘ä¸€ä¸ªå»¶è¿Ÿ1åˆ†é’Ÿçš„æ¶ˆæ¯ã€‚æœ€ç»ˆåœ¨ç¬¬åä¸ªæ¶ˆæ¯æ—¶æŠŠè®¢å•å›æ”¶ã€‚è¿™ä¸ªæ–¹æ¡ˆå°±ä¸ç”¨å¯¹å…¨éƒ¨çš„è®¢å•è¡¨è¿›è¡Œæ‰«æï¼Œè€Œåªéœ€è¦æ¯æ¬¡å¤„ç†ä¸€ä¸ªå•ç‹¬çš„è®¢å•æ¶ˆæ¯ã€‚</p><p>é‚£å¦‚æœä½¿ç”¨ä¸Šäº†äº‹åŠ¡æ¶ˆæ¯å‘¢ï¼Ÿæˆ‘ä»¬å°±å¯ä»¥ç”¨äº‹åŠ¡æ¶ˆæ¯çš„çŠ¶æ€å›æŸ¥æœºåˆ¶æ¥æ›¿ä»£å®šæ—¶çš„ä»»åŠ¡ã€‚åœ¨ä¸‹å•æ—¶ï¼Œç»™Brokerè¿”å›ä¸€ä¸ªUNKNOWNçš„æœªçŸ¥çŠ¶æ€ã€‚è€Œåœ¨çŠ¶æ€å›æŸ¥çš„æ–¹æ³•ä¸­å»æŸ¥è¯¢è®¢å•çš„æ”¯ä»˜çŠ¶æ€ã€‚è¿™æ ·æ•´ä¸ªä¸šåŠ¡é€»è¾‘å°±ä¼šç®€å•å¾ˆå¤šã€‚æˆ‘ä»¬åªéœ€è¦é…ç½®RocketMQä¸­çš„äº‹åŠ¡æ¶ˆæ¯å›æŸ¥æ¬¡æ•°(é»˜è®¤15æ¬¡)å’Œäº‹åŠ¡å›æŸ¥é—´éš”æ—¶é—´(messageDelayLevel)ï¼Œå°±å¯ä»¥æ›´ä¼˜é›…çš„å®Œæˆè¿™ä¸ªæ”¯ä»˜çŠ¶æ€æ£€æŸ¥çš„éœ€æ±‚ã€‚</p><p><strong>6ã€äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶çš„ä½œç”¨</strong></p><p>æ•´ä½“æ¥è¯´ï¼Œåœ¨è®¢å•è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæ¶ˆæ¯ä¸ä¸¢å¤±çš„é—®é¢˜å®é™…ä¸Šå°±è¿˜æ˜¯è½¬åŒ–æˆäº†ä¸‹å•è¿™ä¸ªä¸šåŠ¡ä¸ä¸‹æ¸¸æœåŠ¡çš„ä¸šåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜ã€‚è€Œäº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜ä¸€ç›´ä»¥æ¥éƒ½æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„é—®é¢˜ã€‚è€ŒRocketMQçš„äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶ï¼Œå®é™…ä¸Šåªä¿è¯äº†æ•´ä¸ªäº‹åŠ¡æ¶ˆæ¯çš„ä¸€åŠï¼Œä»–ä¿è¯çš„æ˜¯è®¢å•ç³»ç»Ÿä¸‹å•å’Œå‘æ¶ˆæ¯è¿™ä¸¤ä¸ªäº‹ä»¶çš„äº‹åŠ¡ä¸€è‡´æ€§ï¼Œè€Œå¯¹ä¸‹æ¸¸æœåŠ¡çš„äº‹åŠ¡å¹¶æ²¡æœ‰ä¿è¯ã€‚ä½†æ˜¯å³ä¾¿å¦‚æ­¤ï¼Œä¹Ÿæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€ä¸ªå¾ˆå¥½çš„é™çº§æ–¹æ¡ˆã€‚ç›®å‰æ¥çœ‹ï¼Œä¹Ÿæ˜¯ä¸šå†…æœ€å¥½çš„é™çº§æ–¹æ¡ˆã€‚</p><h5 id="rocketmqé…ç½®åŒæ­¥åˆ·ç›˜-dledgerä¸»ä»æ¶æ„ä¿è¯mqä¸»ä»åŒæ­¥æ—¶ä¸ä¼šä¸¢æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#rocketmqé…ç½®åŒæ­¥åˆ·ç›˜-dledgerä¸»ä»æ¶æ„ä¿è¯mqä¸»ä»åŒæ­¥æ—¶ä¸ä¼šä¸¢æ¶ˆæ¯" aria-hidden="true">#</a> RocketMQé…ç½®åŒæ­¥åˆ·ç›˜+Dledgerä¸»ä»æ¶æ„ä¿è¯MQä¸»ä»åŒæ­¥æ—¶ä¸ä¼šä¸¢æ¶ˆæ¯</h5><p><strong>1ã€åŒæ­¥åˆ·ç›˜</strong></p><p>è¿™ä¸ªä»æˆ‘ä»¬ä¹‹å‰çš„åˆ†æï¼Œå°±å¾ˆå¥½ç†è§£äº†ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•çš„æŠŠRocketMQçš„åˆ·ç›˜æ–¹å¼ flushDiskTypeé…ç½®æˆåŒæ­¥åˆ·ç›˜å°±å¯ä»¥ä¿è¯æ¶ˆæ¯åœ¨åˆ·ç›˜è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±äº†ã€‚</p><p><strong>2ã€Dledgerçš„æ–‡ä»¶åŒæ­¥</strong></p><figure><img src="https://img.jssjqd.cn//202305052008415.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>åœ¨ä½¿ç”¨DledgeræŠ€æœ¯æ­å»ºçš„RocketMQé›†ç¾¤ä¸­ï¼ŒDledgerä¼šé€šè¿‡ä¸¤é˜¶æ®µæäº¤çš„æ–¹å¼ä¿è¯æ–‡ä»¶åœ¨ä¸»ä»ä¹‹é—´æˆåŠŸåŒæ­¥ã€‚</p><blockquote><p>ç®€å•æ¥è¯´ï¼Œæ•°æ®åŒæ­¥ä¼šé€šè¿‡ä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯uncommittedé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯commitedé˜¶æ®µã€‚</p><p>Leader Brokerä¸Šçš„Dledgeræ”¶åˆ°ä¸€æ¡æ•°æ®åï¼Œä¼šæ ‡è®°ä¸ºuncommittedçŠ¶æ€ï¼Œç„¶åä»–é€šè¿‡è‡ªå·±çš„DledgerServerç»„ä»¶æŠŠè¿™ä¸ªuncommittedæ•°æ®å‘ç»™Follower Brokerçš„DledgerServerç»„ä»¶ã€‚</p><p>æ¥ç€Follower Brokerçš„DledgerServeræ”¶åˆ°uncommittedæ¶ˆæ¯ä¹‹åï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªackç»™Leader Brokerçš„Dledgerã€‚ç„¶åå¦‚æœLeader Brokeræ”¶åˆ°è¶…è¿‡åŠæ•°çš„Follower Brokerè¿”å›çš„ackä¹‹åï¼Œå°±ä¼šæŠŠæ¶ˆæ¯æ ‡è®°ä¸ºcommittedçŠ¶æ€ã€‚</p><p>å†æ¥ä¸‹æ¥ï¼Œ Leader Brokerä¸Šçš„DledgerServerå°±ä¼šå‘é€committedæ¶ˆæ¯ç»™Follower Brokerä¸Šçš„DledgerServerï¼Œè®©ä»–ä»¬æŠŠæ¶ˆæ¯ä¹Ÿæ ‡è®°ä¸ºcommittedçŠ¶æ€ã€‚è¿™æ ·ï¼Œå°±åŸºäºRaftåè®®å®Œæˆäº†ä¸¤é˜¶æ®µçš„æ•°æ®åŒæ­¥ã€‚</p></blockquote><h5 id="æ¶ˆè´¹è€…ç«¯ä¸è¦ä½¿ç”¨å¼‚æ­¥æ¶ˆè´¹æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹è€…ç«¯ä¸è¦ä½¿ç”¨å¼‚æ­¥æ¶ˆè´¹æœºåˆ¶" aria-hidden="true">#</a> æ¶ˆè´¹è€…ç«¯ä¸è¦ä½¿ç”¨å¼‚æ­¥æ¶ˆè´¹æœºåˆ¶</h5><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…ç«¯éƒ½æ˜¯éœ€è¦å…ˆå¤„ç†æœ¬åœ°äº‹åŠ¡ï¼Œç„¶åå†ç»™MQä¸€ä¸ªACKå“åº”ï¼Œè¿™æ—¶MQå°±ä¼šä¿®æ”¹Offsetï¼Œå°†æ¶ˆæ¯æ ‡è®°ä¸ºå·²æ¶ˆè´¹ï¼Œä»è€Œä¸å†å¾€å…¶ä»–æ¶ˆè´¹è€…æ¨é€æ¶ˆæ¯ã€‚æ‰€ä»¥åœ¨Brokerçš„è¿™ç§é‡æ–°æ¨é€æœºåˆ¶ä¸‹ï¼Œæ¶ˆæ¯æ˜¯ä¸ä¼šåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±çš„ã€‚ä½†æ˜¯ä¹Ÿä¼šæœ‰ä¸‹é¢è¿™ç§æƒ…å†µä¼šé€ æˆæœåŠ¡ç«¯æ¶ˆæ¯ä¸¢å¤±ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name_4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                                                            <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment">//å¤„ç†ä¸šåŠ¡é€»è¾‘</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§å¼‚æ­¥æ¶ˆè´¹çš„æ–¹å¼ï¼Œå°±æœ‰å¯èƒ½é€ æˆæ¶ˆæ¯çŠ¶æ€è¿”å›åæ¶ˆè´¹è€…æœ¬åœ°ä¸šåŠ¡é€»è¾‘å¤„ç†å¤±è´¥é€ æˆæ¶ˆæ¯ä¸¢å¤±çš„å¯èƒ½ã€‚</p><h5 id="rocketmqç‰¹æœ‰çš„é—®é¢˜-nameserveræŒ‚äº†å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" tabindex="-1"><a class="header-anchor" href="#rocketmqç‰¹æœ‰çš„é—®é¢˜-nameserveræŒ‚äº†å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" aria-hidden="true">#</a> RocketMQç‰¹æœ‰çš„é—®é¢˜ï¼ŒNameServeræŒ‚äº†å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</h5><p>NameServeråœ¨RocketMQä¸­ï¼Œæ˜¯æ‰®æ¼”çš„ä¸€ä¸ªè·¯ç”±ä¸­å¿ƒçš„è§’è‰²ï¼Œæä¾›åˆ°Brokerçš„è·¯ç”±åŠŸèƒ½ã€‚ä½†æ˜¯å…¶å®è·¯ç”±ä¸­å¿ƒè¿™æ ·çš„åŠŸèƒ½ï¼Œåœ¨æ‰€æœ‰çš„MQä¸­éƒ½æ˜¯éœ€è¦çš„ã€‚kafkaæ˜¯ç”¨zookeeperå’Œä¸€ä¸ªä½œä¸ºControllerçš„Brokerä¸€èµ·æ¥æä¾›è·¯ç”±æœåŠ¡ï¼Œæ•´ä¸ªåŠŸèƒ½æ˜¯ç›¸å½“å¤æ‚çº ç»“çš„ã€‚è€ŒRabbitMQæ˜¯ç”±æ¯ä¸€ä¸ªBrokeræ¥æä¾›è·¯ç”±æœåŠ¡ã€‚è€Œåªæœ‰RocketMQæŠŠè¿™ä¸ªè·¯ç”±ä¸­å¿ƒå•ç‹¬æŠ½å–äº†å‡ºæ¥ï¼Œå¹¶ç‹¬ç«‹éƒ¨ç½²ã€‚</p><p>è¿™ä¸ªNameServerä¹‹å‰éƒ½äº†è§£è¿‡ï¼Œé›†ç¾¤ä¸­ä»»æ„å¤šçš„èŠ‚ç‚¹æŒ‚æ‰ï¼Œéƒ½ä¸ä¼šå½±å“ä»–æä¾›çš„è·¯ç”±åŠŸèƒ½ã€‚é‚£<strong>å¦‚æœé›†ç¾¤ä¸­æ‰€æœ‰çš„NameServerèŠ‚ç‚¹éƒ½æŒ‚äº†å‘¢ï¼Ÿ</strong></p><p>æœ‰å¾ˆå¤šäººå°±ä¼šè®¤ä¸ºåœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸­éƒ½ä¼šæœ‰å…¨éƒ¨è·¯ç”±ä¿¡æ¯çš„ç¼“å­˜å‰¯æœ¬ï¼Œé‚£æ•´ä¸ªæœåŠ¡å¯ä»¥æ­£å¸¸å·¥ä½œä¸€æ®µæ—¶é—´ã€‚å…¶å®è¿™ä¸ªé—®é¢˜å¤§å®¶å¯ä»¥åšä¸€ä¸‹å®éªŒï¼Œå½“NameServerå…¨éƒ¨æŒ‚äº†åï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯ç«‹å³å°±æ— æ³•å·¥ä½œäº†çš„ã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œå¯ä»¥å»æºç ä¸­æ‰¾æ‰¾ç­”æ¡ˆã€‚</p><p><strong>é‚£å†å›åˆ°æˆ‘ä»¬çš„æ¶ˆæ¯ä¸ä¸¢å¤±çš„é—®é¢˜</strong>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRocketMQç›¸å½“äºæ•´ä¸ªæœåŠ¡éƒ½ä¸å¯ç”¨äº†ï¼Œé‚£ä»–æœ¬èº«è‚¯å®šæ— æ³•ç»™æˆ‘ä»¬ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±äº†ã€‚æˆ‘ä»¬åªèƒ½è‡ªå·±è®¾è®¡ä¸€ä¸ªé™çº§æ–¹æ¡ˆæ¥å¤„ç†è¿™ä¸ªé—®é¢˜äº†ã€‚ä¾‹å¦‚åœ¨è®¢å•ç³»ç»Ÿä¸­ï¼Œå¦‚æœå¤šæ¬¡å°è¯•å‘é€RocketMQä¸æˆåŠŸï¼Œé‚£å°±åªèƒ½å¦å¤–æ‰¾ç»™åœ°æ–¹(Redisã€æ–‡ä»¶æˆ–è€…å†…å­˜ç­‰)æŠŠè®¢å•æ¶ˆæ¯ç¼“å­˜ä¸‹æ¥ï¼Œç„¶åèµ·ä¸€ä¸ªçº¿ç¨‹å®šæ—¶çš„æ‰«æè¿™äº›å¤±è´¥çš„è®¢å•æ¶ˆæ¯ï¼Œå°è¯•å¾€RocketMQå‘é€ã€‚è¿™æ ·ç­‰RocketMQçš„æœåŠ¡æ¢å¤è¿‡æ¥åï¼Œå°±èƒ½ç¬¬ä¸€æ—¶é—´æŠŠè¿™äº›æ¶ˆæ¯é‡æ–°å‘é€å‡ºå»ã€‚æ•´ä¸ªè¿™å¥—é™çº§çš„æœºåˆ¶ï¼Œåœ¨å¤§å‹äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œéƒ½æ˜¯å¿…é¡»è¦æœ‰çš„ã€‚</p><h5 id="rocketmqæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆæ€»ç»“" tabindex="-1"><a class="header-anchor" href="#rocketmqæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆæ€»ç»“" aria-hidden="true">#</a> RocketMQæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆæ€»ç»“</h5><p>å®Œæ•´åˆ†æè¿‡åï¼Œæ•´ä¸ªRocketMQæ¶ˆæ¯é›¶ä¸¢å¤±çš„æ–¹æ¡ˆå…¶å®æŒºç®€å•</p><ul><li>ç”Ÿäº§è€…ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶ã€‚</li><li>Brokeré…ç½®åŒæ­¥åˆ·ç›˜+Dledgerä¸»ä»æ¶æ„</li><li>æ¶ˆè´¹è€…ä¸è¦ä½¿ç”¨å¼‚æ­¥æ¶ˆè´¹ã€‚</li><li>æ•´ä¸ªMQæŒ‚äº†ä¹‹åå‡†å¤‡é™çº§æ–¹æ¡ˆ</li></ul><p>é‚£è¿™å¥—æ–¹æ¡ˆæ˜¯ä¸æ˜¯å°±å¾ˆå®Œç¾å‘¢ï¼Ÿå…¶å®å¾ˆæ˜æ˜¾ï¼Œè¿™æ•´å¥—çš„æ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆï¼Œåœ¨å„ä¸ªç¯èŠ‚éƒ½å¤§é‡çš„é™ä½äº†ç³»ç»Ÿçš„å¤„ç†æ€§èƒ½ä»¥åŠååé‡ã€‚åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œè¿™å¥—æ–¹æ¡ˆå¸¦æ¥çš„æ€§èƒ½æŸå¤±çš„ä»£ä»·å¯èƒ½è¿œè¿œå¤§äºéƒ¨åˆ†æ¶ˆæ¯ä¸¢å¤±çš„ä»£ä»·ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡RocketMQä½¿ç”¨æ–¹æ¡ˆæ—¶ï¼Œè¦æ ¹æ®å®é™…çš„ä¸šåŠ¡æƒ…å†µæ¥è€ƒè™‘ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé’ˆå¯¹æ‰€æœ‰æœåŠ¡å™¨éƒ½åœ¨åŒä¸€ä¸ªæœºæˆ¿çš„åœºæ™¯ï¼Œå®Œå…¨å¯ä»¥æŠŠBrokeré…ç½®æˆå¼‚æ­¥åˆ·ç›˜æ¥æå‡ååé‡ã€‚è€Œåœ¨æœ‰äº›å¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚æ²¡æœ‰é‚£ä¹ˆé«˜çš„åœºæ™¯ï¼Œåœ¨ç”Ÿäº§è€…ç«¯å°±å¯ä»¥é‡‡ç”¨å…¶ä»–ä¸€äº›æ›´ç®€å•çš„æ–¹æ¡ˆæ¥æå‡ååï¼Œè€Œé‡‡ç”¨å®šæ—¶å¯¹è´¦ã€è¡¥å¿çš„æœºåˆ¶æ¥æé«˜æ¶ˆæ¯çš„å¯é æ€§ã€‚è€Œå¦‚æœæ¶ˆè´¹è€…ä¸éœ€è¦è¿›è¡Œæ¶ˆæ¯å­˜ç›˜ï¼Œé‚£ä½¿ç”¨å¼‚æ­¥æ¶ˆè´¹çš„æœºåˆ¶å¸¦æ¥çš„æ€§èƒ½æå‡ä¹Ÿæ˜¯éå¸¸æ˜¾è‘—çš„ã€‚</p><p>æ€»ä¹‹ï¼Œè¿™å¥—æ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆçš„æ€»ç»“æ˜¯ä¸ºäº†åœ¨è®¾è®¡RocketMQä½¿ç”¨æ–¹æ¡ˆæ—¶çš„ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒã€‚</p><h3 id="ä½¿ç”¨rocketmqå¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨rocketmqå¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº" aria-hidden="true">#</a> ä½¿ç”¨RocketMQå¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº</h3><h4 id="_1ã€ä¸ºä»€ä¹ˆè¦ä¿è¯æ¶ˆæ¯æœ‰åº" tabindex="-1"><a class="header-anchor" href="#_1ã€ä¸ºä»€ä¹ˆè¦ä¿è¯æ¶ˆæ¯æœ‰åº" aria-hidden="true">#</a> 1ã€ä¸ºä»€ä¹ˆè¦ä¿è¯æ¶ˆæ¯æœ‰åºï¼Ÿ</h4><p>è¿™ä¸ªä¹Ÿæ˜¯é¢è¯•æ—¶æœ€å¸¸è§çš„é—®é¢˜ï¼Œéœ€è¦å¯¹MQåœºæ™¯æœ‰ä¸€å®šçš„æ·±å…¥ç†è§£ã€‚ä¾‹å¦‚å¦‚æœæˆ‘ä»¬æœ‰ä¸ªå¤§æ•°æ®ç³»ç»Ÿï¼Œéœ€è¦å¯¹ä¸šåŠ¡ç³»ç»Ÿçš„æ—¥å¿—è¿›è¡Œæ”¶é›†åˆ†æï¼Œè¿™æ—¶å€™ä¸ºäº†å‡å°‘å¯¹ä¸šåŠ¡ç³»ç»Ÿçš„å½±å“ï¼Œé€šå¸¸éƒ½ä¼šé€šè¿‡MQæ¥åšæ¶ˆæ¯ä¸­è½¬ã€‚è€Œè¿™æ—¶å€™ï¼Œå¯¹æ¶ˆæ¯çš„é¡ºåºå°±æœ‰ä¸€å®šçš„è¦æ±‚äº†ã€‚ä¾‹å¦‚æˆ‘ä»¬è€ƒè™‘ä¸‹é¢è¿™ä¸€ç³»åˆ—çš„æ“ä½œã€‚</p><ol><li>ç”¨æˆ·çš„ç§¯åˆ†é»˜è®¤æ˜¯0åˆ†ï¼Œè€Œæ–°æ³¨å†Œç”¨æˆ·è®¾ç½®ä¸ºé»˜è®¤çš„10åˆ†ã€‚</li><li>ç”¨æˆ·æœ‰å¥–åŠ±è¡Œä¸ºï¼Œç§¯åˆ†+2åˆ†ã€‚</li><li>ç”¨æˆ·æœ‰ä¸æ­£å½“è¡Œä¸ºï¼Œç§¯åˆ†-3åˆ†ã€‚</li></ol><p>è¿™æ ·ä¸€ç»„æ“ä½œï¼Œæ­£å¸¸ç”¨æˆ·ç§¯åˆ†è¦å˜æˆ9åˆ†ã€‚ä½†æ˜¯å¦‚æœé¡ºåºä¹±äº†ï¼Œè¿™ä¸ªç»“æœå°±å…¨éƒ¨å¯¹ä¸äº†ã€‚è¿™æ—¶ï¼Œå°±éœ€è¦å¯¹è¿™ä¸€ç»„æ“ä½œï¼Œä¿è¯æ¶ˆæ¯éƒ½æ˜¯æœ‰åºçš„ã€‚</p><h4 id="_2ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åº" tabindex="-1"><a class="header-anchor" href="#_2ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åº" aria-hidden="true">#</a> 2ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åºï¼Ÿ</h4><p>MQçš„é¡ºåºé—®é¢˜åˆ†ä¸ºå…¨å±€æœ‰åºå’Œå±€éƒ¨æœ‰åºã€‚</p><ul><li>å…¨å±€æœ‰åºï¼šæ•´ä¸ªMQç³»ç»Ÿçš„æ‰€æœ‰æ¶ˆæ¯ä¸¥æ ¼æŒ‰ç…§é˜Ÿåˆ—å…ˆå…¥å…ˆå‡ºé¡ºåºè¿›è¡Œæ¶ˆè´¹ã€‚</li><li>å±€éƒ¨æœ‰åºï¼šåªä¿è¯ä¸€éƒ¨åˆ†å…³é”®æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºã€‚</li></ul><p><strong>é¦–å…ˆ</strong> æˆ‘ä»¬éœ€è¦åˆ†æä¸‹è¿™ä¸ªé—®é¢˜ï¼Œåœ¨é€šå¸¸çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå…¨å±€æœ‰åºå’Œå±€éƒ¨æœ‰åºå“ªä¸ªæ›´é‡è¦ï¼Ÿå…¶å®åœ¨å¤§éƒ¨åˆ†çš„MQä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬åªéœ€è¦èƒ½å¤Ÿä¿è¯å±€éƒ¨æœ‰åºå°±å¯ä»¥äº†ã€‚ä¾‹å¦‚æˆ‘ä»¬ç”¨QQèŠå¤©ï¼Œåªéœ€è¦ä¿è¯ä¸€ä¸ªèŠå¤©çª—å£é‡Œçš„æ¶ˆæ¯æœ‰åºå°±å¯ä»¥äº†ã€‚è€Œå¯¹äºç”µå•†è®¢å•åœºæ™¯ï¼Œä¹Ÿåªè¦ä¿è¯ä¸€ä¸ªè®¢å•çš„æ‰€æœ‰æ¶ˆæ¯æ˜¯æœ‰åºçš„å°±å¯ä»¥äº†ã€‚è‡³äºå…¨å±€æ¶ˆæ¯çš„é¡ºåºï¼Œå¹¶ä¸ä¼šå¤ªå…³å¿ƒã€‚è€Œé€šå¸¸æ„ä¹‰ä¸‹ï¼Œå…¨å±€æœ‰åºéƒ½å¯ä»¥å‹ç¼©æˆå±€éƒ¨æœ‰åºçš„é—®é¢˜ã€‚ä¾‹å¦‚ä»¥å‰æˆ‘ä»¬å¸¸ç”¨çš„èŠå¤©å®¤ï¼Œå°±æ˜¯ä¸ªå…¸å‹çš„éœ€è¦ä¿è¯æ¶ˆæ¯å…¨å±€æœ‰åºçš„åœºæ™¯ã€‚ä½†æ˜¯è¿™ç§åœºæ™¯ï¼Œé€šå¸¸å¯ä»¥å‹ç¼©æˆåªæœ‰ä¸€ä¸ªèŠå¤©çª—å£çš„QQæ¥ç†è§£ã€‚å³æ•´ä¸ªç³»ç»Ÿåªæœ‰ä¸€ä¸ªèŠå¤©é€šé“ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨QQé‚£ç§ä¿è¯ä¸€ä¸ªèŠå¤©çª—å£æ¶ˆæ¯æœ‰åºçš„æ–¹å¼æ¥ä¿è¯æ•´ä¸ªç³»ç»Ÿçš„å…¨å±€æ¶ˆæ¯æœ‰åºã€‚</p><p><strong>ç„¶å</strong> è½åœ°åˆ°RocketMQã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå‘é€è€…å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šé€šè¿‡MessageQueueè½®è¯¢çš„æ–¹å¼ä¿è¯æ¶ˆæ¯å°½é‡å‡åŒ€çš„åˆ†å¸ƒåˆ°æ‰€æœ‰çš„MessageQueueä¸Šï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿå°±åŒæ ·éœ€è¦ä»å¤šä¸ªMessageQueueä¸Šæ¶ˆè´¹æ¶ˆæ¯ã€‚è€ŒMessageQueueæ˜¯RocketMQå­˜å‚¨æ¶ˆæ¯çš„æœ€å°å•å…ƒï¼Œä»–ä»¬ä¹‹é—´çš„æ¶ˆæ¯éƒ½æ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯æ— æ³•ä¿è¯æ¶ˆæ¯å…¨å±€æœ‰åºçš„ã€‚</p><p>è€Œå¯¹äºå±€éƒ¨æœ‰åºçš„è¦æ±‚ï¼Œåªéœ€è¦å°†æœ‰åºçš„ä¸€ç»„æ¶ˆæ¯éƒ½å­˜å…¥åŒä¸€ä¸ªMessageQueueé‡Œï¼Œè¿™æ ·MessageQueueçš„FIFOè®¾è®¡å¤©ç”Ÿå°±å¯ä»¥ä¿è¯è¿™ä¸€ç»„æ¶ˆæ¯çš„æœ‰åºã€‚RocketMQä¸­ï¼Œå¯ä»¥åœ¨å‘é€è€…å‘é€æ¶ˆæ¯æ—¶æŒ‡å®šä¸€ä¸ªMessageSelectorå¯¹è±¡ï¼Œè®©è¿™ä¸ªå¯¹è±¡æ¥å†³å®šæ¶ˆæ¯å‘å…¥å“ªä¸€ä¸ªMessageQueueã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯ä¸€ç»„æœ‰åºçš„æ¶ˆæ¯èƒ½å¤Ÿå‘åˆ°åŒä¸€ä¸ªMessageQueueé‡Œã€‚</p><p>å¦å¤–ï¼Œé€šå¸¸æ‰€è°“çš„ä¿è¯Topicå…¨å±€æ¶ˆæ¯æœ‰åºçš„æ–¹å¼ï¼Œå°±æ˜¯å°†Topicé…ç½®æˆåªæœ‰ä¸€ä¸ªMessageQueueé˜Ÿåˆ—(é»˜è®¤æ˜¯4ä¸ª)ã€‚è¿™æ ·å¤©ç”Ÿå°±èƒ½ä¿è¯æ¶ˆæ¯å…¨å±€æœ‰åºäº†ã€‚è¿™ä¸ªè¯´æ³•å…¶å®å°±æ˜¯æˆ‘ä»¬å°†èŠå¤©å®¤åœºæ™¯å‹ç¼©æˆåªæœ‰ä¸€ä¸ªèŠå¤©çª—å£çš„QQä¸€æ ·çš„ç†è§£æ–¹å¼ã€‚è€Œè¿™ç§æ–¹å¼å¯¹æ•´ä¸ªTopicçš„æ¶ˆæ¯ååå½±å“æ˜¯éå¸¸å¤§çš„ï¼Œå¦‚æœè¿™æ ·ç”¨ï¼ŒåŸºæœ¬ä¸Šå°±æ²¡æœ‰ç”¨MQçš„å¿…è¦äº†ã€‚</p><h3 id="ä½¿ç”¨rocketmqå¦‚ä½•å¿«é€Ÿå¤„ç†ç§¯å‹æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨rocketmqå¦‚ä½•å¿«é€Ÿå¤„ç†ç§¯å‹æ¶ˆæ¯" aria-hidden="true">#</a> ä½¿ç”¨RocketMQå¦‚ä½•å¿«é€Ÿå¤„ç†ç§¯å‹æ¶ˆæ¯ï¼Ÿ</h3><h4 id="_1ã€å¦‚ä½•ç¡®å®šrocketmqæœ‰å¤§é‡çš„æ¶ˆæ¯ç§¯å‹" tabindex="-1"><a class="header-anchor" href="#_1ã€å¦‚ä½•ç¡®å®šrocketmqæœ‰å¤§é‡çš„æ¶ˆæ¯ç§¯å‹" aria-hidden="true">#</a> 1ã€å¦‚ä½•ç¡®å®šRocketMQæœ‰å¤§é‡çš„æ¶ˆæ¯ç§¯å‹ï¼Ÿ</h4><p>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨MQéƒ½ä¼šè¦å°½é‡ä¿è¯ä»–çš„æ¶ˆæ¯ç”Ÿäº§é€Ÿåº¦å’Œæ¶ˆè´¹é€Ÿåº¦æ•´ä½“ä¸Šæ˜¯å¹³è¡¡çš„ï¼Œä½†æ˜¯å¦‚æœéƒ¨åˆ†æ¶ˆè´¹è€…ç³»ç»Ÿå‡ºç°æ•…éšœï¼Œå°±ä¼šé€ æˆå¤§é‡çš„æ¶ˆæ¯ç§¯ç´¯ã€‚è¿™ç±»é—®é¢˜é€šå¸¸åœ¨å®é™…å·¥ä½œä¸­ä¼šå‡ºç°å¾—æ¯”è¾ƒéšè”½ã€‚ä¾‹å¦‚æŸä¸€å¤©ä¸€ä¸ªæ•°æ®åº“çªç„¶æŒ‚äº†ï¼Œå¤§å®¶å¤§æ¦‚ç‡å°±ä¼šé›†ä¸­å¤„ç†æ•°æ®åº“çš„é—®é¢˜ã€‚ç­‰å¥½ä¸å®¹æ˜“æŠŠæ•°æ®åº“æ¢å¤è¿‡æ¥äº†ï¼Œè¿™æ—¶åŸºäºè¿™ä¸ªæ•°æ®åº“æœåŠ¡çš„æ¶ˆè´¹è€…ç¨‹åºå°±ä¼šç§¯ç´¯å¤§é‡çš„æ¶ˆæ¯ã€‚æˆ–è€…ç½‘ç»œæ³¢åŠ¨ç­‰æƒ…å†µï¼Œä¹Ÿä¼šå¯¼è‡´æ¶ˆæ¯å¤§é‡çš„ç§¯ç´¯ã€‚è¿™åœ¨ä¸€äº›å¤§å‹çš„äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œæ¶ˆæ¯ç§¯å‹çš„é€Ÿåº¦æ˜¯ç›¸å½“ææ€–çš„ã€‚æ‰€ä»¥æ¶ˆæ¯ç§¯å‹æ˜¯ä¸ªéœ€è¦æ—¶æ—¶å…³æ³¨çš„é—®é¢˜ã€‚</p><p>å¯¹äºæ¶ˆæ¯ç§¯å‹ï¼Œå¦‚æœæ˜¯RocketMQæˆ–è€…kafkaè¿˜å¥½ï¼Œä»–ä»¬çš„æ¶ˆæ¯ç§¯å‹ä¸ä¼šå¯¹æ€§èƒ½é€ æˆå¾ˆå¤§çš„å½±å“ã€‚è€Œå¦‚æœæ˜¯RabbitMQçš„è¯ï¼Œé‚£å°±æƒ¨äº†ï¼Œå¤§é‡çš„æ¶ˆæ¯ç§¯å‹å¯ä»¥ç¬é—´é€ æˆæ€§èƒ½ç›´çº¿ä¸‹æ»‘ã€‚</p><p>å¯¹äºRocketMQæ¥è¯´ï¼Œæœ‰ä¸ªæœ€ç®€å•çš„æ–¹å¼æ¥ç¡®å®šæ¶ˆæ¯æ˜¯å¦æœ‰ç§¯å‹ã€‚é‚£å°±æ˜¯ä½¿ç”¨webæ§åˆ¶å°ï¼Œå°±èƒ½ç›´æ¥çœ‹åˆ°æ¶ˆæ¯çš„ç§¯å‹æƒ…å†µã€‚</p><p>åœ¨Webæ§åˆ¶å°çš„ä¸»é¢˜é¡µé¢ï¼Œå¯ä»¥é€šè¿‡ Consumerç®¡ç† æŒ‰é’®å®æ—¶çœ‹åˆ°æ¶ˆæ¯çš„ç§¯å‹æƒ…å†µã€‚</p><figure><img src="https://img.jssjqd.cn//202305052008060.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>å¦å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡mqadminæŒ‡ä»¤åœ¨åå°æ£€æŸ¥å„ä¸ªTopicçš„æ¶ˆæ¯å»¶è¿Ÿæƒ…å†µã€‚</p><p>è¿˜æœ‰RocketMQä¹Ÿä¼šåœ¨ä»–çš„ ${storePathRootDir}/config ç›®å½•ä¸‹è½åœ°ä¸€ç³»åˆ—çš„jsonæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è·Ÿè¸ªæ¶ˆæ¯ç§¯å‹æƒ…å†µã€‚</p><h4 id="_2ã€å¦‚ä½•å¤„ç†å¤§é‡ç§¯å‹çš„æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_2ã€å¦‚ä½•å¤„ç†å¤§é‡ç§¯å‹çš„æ¶ˆæ¯" aria-hidden="true">#</a> 2ã€å¦‚ä½•å¤„ç†å¤§é‡ç§¯å‹çš„æ¶ˆæ¯ï¼Ÿ</h4><p>å…¶å®æˆ‘ä»¬å›é¡¾ä¸‹RocketMQçš„è´Ÿè½½å‡è¡¡çš„å†…å®¹å°±ä¸éš¾æƒ³åˆ°è§£å†³æ–¹æ¡ˆã€‚</p><p>å¦‚æœTopicä¸‹çš„MessageQueueé…ç½®å¾—æ˜¯è¶³å¤Ÿå¤šçš„ï¼Œé‚£æ¯ä¸ªConsumerå®é™…ä¸Šä¼šåˆ†é…å¤šä¸ªMessageQueueæ¥è¿›è¡Œæ¶ˆè´¹ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥ç®€å•çš„é€šè¿‡å¢åŠ Consumerçš„æœåŠ¡èŠ‚ç‚¹æ•°é‡æ¥åŠ å¿«æ¶ˆæ¯çš„æ¶ˆè´¹ï¼Œç­‰ç§¯å‹æ¶ˆæ¯æ¶ˆè´¹å®Œäº†ï¼Œå†æ¢å¤æˆæ­£å¸¸æƒ…å†µã€‚æœ€æé™çš„æƒ…å†µæ˜¯æŠŠConsumerçš„èŠ‚ç‚¹ä¸ªæ•°è®¾ç½®æˆè·ŸMessageQueueçš„ä¸ªæ•°ç›¸åŒã€‚ä½†æ˜¯å¦‚æœæ­¤æ—¶å†ç»§ç»­å¢åŠ Consumerçš„æœåŠ¡èŠ‚ç‚¹å°±æ²¡æœ‰ç”¨äº†ã€‚</p><p>è€Œå¦‚æœTopicä¸‹çš„MessageQueueé…ç½®å¾—ä¸å¤Ÿå¤šçš„è¯ï¼Œé‚£å°±ä¸èƒ½ç”¨ä¸Šé¢è¿™ç§å¢åŠ ConsumerèŠ‚ç‚¹ä¸ªæ•°çš„æ–¹æ³•äº†ã€‚è¿™æ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿ è¿™æ—¶å¦‚æœè¦å¿«é€Ÿå¤„ç†ç§¯å‹çš„æ¶ˆæ¯ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Topicï¼Œé…ç½®è¶³å¤Ÿå¤šçš„MessageQueueã€‚ç„¶åæŠŠæ‰€æœ‰æ¶ˆè´¹è€…èŠ‚ç‚¹çš„ç›®æ ‡Topicè½¬å‘æ–°çš„Topicï¼Œå¹¶ç´§æ€¥ä¸Šçº¿ä¸€ç»„æ–°çš„æ¶ˆè´¹è€…ï¼Œåªè´Ÿè´£æ¶ˆè´¹æ—§Topicä¸­çš„æ¶ˆæ¯ï¼Œå¹¶è½¬å‚¨åˆ°æ–°çš„Topicä¸­ï¼Œè¿™ä¸ªé€Ÿåº¦æ˜¯å¯ä»¥å¾ˆå¿«çš„ã€‚ç„¶ååœ¨æ–°çš„Topicä¸Šï¼Œå°±å¯ä»¥é€šè¿‡å¢åŠ æ¶ˆè´¹è€…ä¸ªæ•°æ¥æé«˜æ¶ˆè´¹é€Ÿåº¦äº†ã€‚ä¹‹åå†æ ¹æ®æƒ…å†µæ¢å¤æˆæ­£å¸¸æƒ…å†µã€‚</p><blockquote><p>åœ¨å®˜ç½‘ä¸­ï¼Œè¿˜åˆ†æäº†ä¸€ä¸ªç‰¹æ®Šçš„æƒ…å†µã€‚å°±æ˜¯å¦‚æœRocketMQåŸæœ¬æ˜¯é‡‡ç”¨çš„æ™®é€šæ–¹å¼æ­å»ºä¸»ä»æ¶æ„ï¼Œè€Œç°åœ¨æƒ³è¦ä¸­é€”æ”¹ä¸ºä½¿ç”¨Dledgeré«˜å¯ç”¨é›†ç¾¤ï¼Œè¿™æ—¶å€™å¦‚æœä¸æƒ³å†å²æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±éœ€è¦å…ˆå°†æ¶ˆæ¯è¿›è¡Œå¯¹é½ï¼Œä¹Ÿå°±æ˜¯è¦æ¶ˆè´¹è€…æŠŠæ‰€æœ‰çš„æ¶ˆæ¯éƒ½æ¶ˆè´¹å®Œï¼Œå†æ¥åˆ‡æ¢ä¸»ä»æ¶æ„ã€‚å› ä¸ºDledgeré›†ç¾¤ä¼šæ¥ç®¡RocketMQåŸæœ‰çš„CommitLogæ—¥å¿—ï¼Œæ‰€ä»¥åˆ‡æ¢ä¸»ä»æ¶æ„æ—¶ï¼Œå¦‚æœæœ‰æ¶ˆæ¯æ²¡æœ‰æ¶ˆè´¹å®Œï¼Œè¿™äº›æ¶ˆæ¯æ˜¯å­˜åœ¨æ—§çš„CommitLogä¸­çš„ï¼Œå°±æ— æ³•å†è¿›è¡Œæ¶ˆè´¹äº†ã€‚è¿™ä¸ªåœºæ™¯ä¸‹ä¹Ÿæ˜¯éœ€è¦å°½å¿«çš„å¤„ç†æ‰ç§¯å‹çš„æ¶ˆæ¯ã€‚</p></blockquote><h3 id="rocketmqçš„æ¶ˆæ¯è½¨è¿¹" tabindex="-1"><a class="header-anchor" href="#rocketmqçš„æ¶ˆæ¯è½¨è¿¹" aria-hidden="true">#</a> RocketMQçš„æ¶ˆæ¯è½¨è¿¹</h3><p>RocketMQé»˜è®¤æä¾›äº†æ¶ˆæ¯è½¨è¿¹çš„åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨æ’æŸ¥é—®é¢˜æ—¶æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><h4 id="_1ã€rocketmqæ¶ˆæ¯è½¨è¿¹æ•°æ®çš„å…³é”®å±æ€§" tabindex="-1"><a class="header-anchor" href="#_1ã€rocketmqæ¶ˆæ¯è½¨è¿¹æ•°æ®çš„å…³é”®å±æ€§" aria-hidden="true">#</a> 1ã€RocketMQæ¶ˆæ¯è½¨è¿¹æ•°æ®çš„å…³é”®å±æ€§ï¼š</h4><table><thead><tr><th>Producerç«¯</th><th>Consumerç«¯</th><th>Brokerç«¯</th></tr></thead><tbody><tr><td>ç”Ÿäº§å®ä¾‹ä¿¡æ¯</td><td>æ¶ˆè´¹å®ä¾‹ä¿¡æ¯</td><td>æ¶ˆæ¯çš„Topic</td></tr><tr><td>å‘é€æ¶ˆæ¯æ—¶é—´</td><td>æŠ•é€’æ—¶é—´,æŠ•é€’è½®æ¬¡</td><td>æ¶ˆæ¯å­˜å‚¨ä½ç½®</td></tr><tr><td>æ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸ</td><td>æ¶ˆæ¯æ˜¯å¦æ¶ˆè´¹æˆåŠŸ</td><td>æ¶ˆæ¯çš„Keyå€¼</td></tr><tr><td>å‘é€è€—æ—¶</td><td>æ¶ˆè´¹è€—æ—¶</td><td>æ¶ˆæ¯çš„Tagå€¼</td></tr></tbody></table><h4 id="_2ã€æ¶ˆæ¯è½¨è¿¹é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2ã€æ¶ˆæ¯è½¨è¿¹é…ç½®" aria-hidden="true">#</a> 2ã€æ¶ˆæ¯è½¨è¿¹é…ç½®</h4><p>æ‰“å¼€æ¶ˆæ¯è½¨è¿¹åŠŸèƒ½ï¼Œéœ€è¦åœ¨broker.confä¸­æ‰“å¼€ä¸€ä¸ªå…³é”®é…ç½®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>traceTopicEnable=true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªé…ç½®çš„é»˜è®¤å€¼æ˜¯falseã€‚ä¹Ÿå°±æ˜¯è¯´é»˜è®¤æ˜¯å…³é—­çš„ã€‚</p><h4 id="_3ã€æ¶ˆæ¯è½¨è¿¹æ•°æ®å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#_3ã€æ¶ˆæ¯è½¨è¿¹æ•°æ®å­˜å‚¨" aria-hidden="true">#</a> 3ã€æ¶ˆæ¯è½¨è¿¹æ•°æ®å­˜å‚¨</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯è½¨è¿¹æ•°æ®æ˜¯å­˜äºä¸€ä¸ªç³»ç»Ÿçº§åˆ«çš„Topic ,RMQ_SYS_TRACE_TOPICã€‚è¿™ä¸ªTopicåœ¨BrokerèŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå‡ºæ¥ã€‚</p><figure><img src="https://img.jssjqd.cn//202305052007680.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>å¦å¤–ï¼Œä¹Ÿæ”¯æŒå®¢æˆ·ç«¯è‡ªå®šä¹‰è½¨è¿¹æ•°æ®å­˜å‚¨çš„Topicã€‚</p><p>åœ¨å®¢æˆ·ç«¯çš„ä¸¤ä¸ªæ ¸å¿ƒå¯¹è±¡ DefaultMQProducerå’ŒDefaultMQPushConsumerï¼Œä»–ä»¬çš„æ„é€ å‡½æ•°ä¸­ï¼Œéƒ½æœ‰ä¸¤ä¸ªå¯é€‰çš„å‚æ•°æ¥æ‰“å¼€æ¶ˆæ¯è½¨è¿¹å­˜å‚¨</p><ul><li><strong>enableMsgTrace</strong>ï¼šæ˜¯å¦æ‰“å¼€æ¶ˆæ¯è½¨è¿¹ã€‚é»˜è®¤æ˜¯falseã€‚</li><li><strong>customizedTraceTopic</strong>ï¼šé…ç½®å°†æ¶ˆæ¯è½¨è¿¹æ•°æ®å­˜å‚¨åˆ°ç”¨æˆ·æŒ‡å®šçš„Topic ã€‚</li></ul></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><!----><div class="copyright">Copyright Â© 2023 æ±Ÿ</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-f4353c56.js" defer></script>
  </body>
</html>
