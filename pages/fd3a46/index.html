<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.26" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <title>JVMå¯¹è±¡åˆ›å»ºä¸å†…å­˜åˆ†é…æœºåˆ¶</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-CV-aSyL0.css" as="style"><link rel="stylesheet" href="/assets/style-CV-aSyL0.css">
    <link rel="modulepreload" href="/assets/app-CcJZcE5q.js"><link rel="modulepreload" href="/assets/index.html-joJLtsXk.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-CySwgr6W.js" as="script"><link rel="prefetch" href="/assets/index.html-DIQ6wV2c.js" as="script"><link rel="prefetch" href="/assets/index.html-DA9ZST6q.js" as="script"><link rel="prefetch" href="/assets/index.html-B1qwKQDM.js" as="script"><link rel="prefetch" href="/assets/index.html-QtYXnaPY.js" as="script"><link rel="prefetch" href="/assets/index.html-BoWZ1hiX.js" as="script"><link rel="prefetch" href="/assets/index.html-D1eqxnz4.js" as="script"><link rel="prefetch" href="/assets/index.html-Bkd8jpbq.js" as="script"><link rel="prefetch" href="/assets/index.html-CaPpN9fA.js" as="script"><link rel="prefetch" href="/assets/é˜¿é‡Œäº‘é¢è¯•é¢˜.html-BdFdwHHT.js" as="script"><link rel="prefetch" href="/assets/index.html-Dar6C79p.js" as="script"><link rel="prefetch" href="/assets/index.html-3LHzgUol.js" as="script"><link rel="prefetch" href="/assets/index.html-CNyrWvjP.js" as="script"><link rel="prefetch" href="/assets/index.html-tMJw4xAU.js" as="script"><link rel="prefetch" href="/assets/index.html-BBna-ubM.js" as="script"><link rel="prefetch" href="/assets/index.html-CQDrMRFa.js" as="script"><link rel="prefetch" href="/assets/index.html-BHHkC0SB.js" as="script"><link rel="prefetch" href="/assets/index.html-BT27OHXI.js" as="script"><link rel="prefetch" href="/assets/index.html-Ph_N0RhT.js" as="script"><link rel="prefetch" href="/assets/index.html-C0SZgDj-.js" as="script"><link rel="prefetch" href="/assets/index.html-COW2J1ah.js" as="script"><link rel="prefetch" href="/assets/index.html-CwlZk0kb.js" as="script"><link rel="prefetch" href="/assets/index.html-mOUgrTfQ.js" as="script"><link rel="prefetch" href="/assets/index.html-StCMFG4Y.js" as="script"><link rel="prefetch" href="/assets/index.html-pkZ_qPdt.js" as="script"><link rel="prefetch" href="/assets/index.html-meFoXNUk.js" as="script"><link rel="prefetch" href="/assets/index.html-D6UDt-z1.js" as="script"><link rel="prefetch" href="/assets/index.html-C4CeTDFP.js" as="script"><link rel="prefetch" href="/assets/index.html-DJOa7j38.js" as="script"><link rel="prefetch" href="/assets/index.html-u2YQwqCK.js" as="script"><link rel="prefetch" href="/assets/index.html-BoiC8F1t.js" as="script"><link rel="prefetch" href="/assets/index.html-CSq9YTr5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cyr0Ht9E.js" as="script"><link rel="prefetch" href="/assets/index.html-CpAXHyhZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DLvEiH8j.js" as="script"><link rel="prefetch" href="/assets/index.html-DfVjwGrn.js" as="script"><link rel="prefetch" href="/assets/index.html-BhnlQTe0.js" as="script"><link rel="prefetch" href="/assets/index.html-B3Q99jzV.js" as="script"><link rel="prefetch" href="/assets/index.html-C_jS85gJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DTuYMkqZ.js" as="script"><link rel="prefetch" href="/assets/index.html-ByDsocQC.js" as="script"><link rel="prefetch" href="/assets/index.html-Dx60V46q.js" as="script"><link rel="prefetch" href="/assets/index.html-B2169YvJ.js" as="script"><link rel="prefetch" href="/assets/index.html-u7yWxVkO.js" as="script"><link rel="prefetch" href="/assets/index.html-BAcuX6ex.js" as="script"><link rel="prefetch" href="/assets/index.html-CKFJiaUe.js" as="script"><link rel="prefetch" href="/assets/index.html-BQolQXiO.js" as="script"><link rel="prefetch" href="/assets/index.html-CV5OM5nX.js" as="script"><link rel="prefetch" href="/assets/index.html-edSgNf-M.js" as="script"><link rel="prefetch" href="/assets/index.html-BfO_EaOy.js" as="script"><link rel="prefetch" href="/assets/index.html-nyRG_LTF.js" as="script"><link rel="prefetch" href="/assets/index.html-D-frKFlo.js" as="script"><link rel="prefetch" href="/assets/00.åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-Cpl05HCa.js" as="script"><link rel="prefetch" href="/assets/index.html-Cq20v4BB.js" as="script"><link rel="prefetch" href="/assets/index.html-BVORs3On.js" as="script"><link rel="prefetch" href="/assets/index.html-BP6aZUE6.js" as="script"><link rel="prefetch" href="/assets/index.html-B-3_fbg6.js" as="script"><link rel="prefetch" href="/assets/index.html-CpJC_HeG.js" as="script"><link rel="prefetch" href="/assets/index.html-DjnTf6fe.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-D7z1G1-N.js" as="script"><link rel="prefetch" href="/assets/07.MySQLé”æœºåˆ¶ä¸ä¼˜åŒ–å®è·µä»¥åŠMVCCåº•å±‚åŸç†å‰–æ.html-BKAa643F.js" as="script"><link rel="prefetch" href="/assets/index.html-CxmzedXX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dzfk79WX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dn63XTEd.js" as="script"><link rel="prefetch" href="/assets/index.html-CzdtGl0g.js" as="script"><link rel="prefetch" href="/assets/index.html-9PiiOmcM.js" as="script"><link rel="prefetch" href="/assets/index.html-BmA5G_Wx.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-DuPwqrAu.js" as="script"><link rel="prefetch" href="/assets/index.html-BQ7HKii8.js" as="script"><link rel="prefetch" href="/assets/index.html-Ba0Idv51.js" as="script"><link rel="prefetch" href="/assets/index.html-L8Hlw6sX.js" as="script"><link rel="prefetch" href="/assets/index.html-C8_gL8dh.js" as="script"><link rel="prefetch" href="/assets/index.html-6Tc1Q6ZE.js" as="script"><link rel="prefetch" href="/assets/index.html-VO0-ALK9.js" as="script"><link rel="prefetch" href="/assets/index.html-BPdXD1cL.js" as="script"><link rel="prefetch" href="/assets/index.html-j-8Qjm4N.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz_Qhpe9.js" as="script"><link rel="prefetch" href="/assets/index.html-CcaTKqjZ.js" as="script"><link rel="prefetch" href="/assets/index.html-o-IA65eG.js" as="script"><link rel="prefetch" href="/assets/index.html-y0YOCSWX.js" as="script"><link rel="prefetch" href="/assets/index.html-BdP5ezWY.js" as="script"><link rel="prefetch" href="/assets/index.html-C6GUmZlK.js" as="script"><link rel="prefetch" href="/assets/index.html-zkImwKAM.js" as="script"><link rel="prefetch" href="/assets/index.html-B-rM7PKP.js" as="script"><link rel="prefetch" href="/assets/index.html-Bdbd7zWB.js" as="script"><link rel="prefetch" href="/assets/index.html-PQLu_cdG.js" as="script"><link rel="prefetch" href="/assets/index.html-BaByp152.js" as="script"><link rel="prefetch" href="/assets/index.html-DQrw1sGU.js" as="script"><link rel="prefetch" href="/assets/404.html-Xl7f9Pk5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cim6WBqA.js" as="script"><link rel="prefetch" href="/assets/index.html-DBgI0Ctx.js" as="script"><link rel="prefetch" href="/assets/index.html-CjlsAUhS.js" as="script"><link rel="prefetch" href="/assets/index.html-DBEQHe26.js" as="script"><link rel="prefetch" href="/assets/index.html-BrqbaMMm.js" as="script"><link rel="prefetch" href="/assets/index.html-B_JMJTKH.js" as="script"><link rel="prefetch" href="/assets/index.html-8JHj6Ere.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script"><link rel="prefetch" href="/assets/SearchResult-FVi5R2x7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><!----><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="é¦–é¡µ"><span class="font-icon icon circle-question" style=""></span>é¦–é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link active" href="/pages/" aria-label="æ–‡æ¡£"><span class="font-icon icon circle-question" style=""></span>æ–‡æ¡£<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">åˆ†å¸ƒå¼</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å®¹å™¨</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å¹¶å‘ç¼–ç¨‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å¾®æœåŠ¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">æ€§èƒ½è°ƒä¼˜</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">00. My SQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">03.åˆ†åº“åˆ†è¡¨</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">JVM</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/d64172/" aria-label="Classæ–‡ä»¶ç»“æ„"><!---->Classæ–‡ä»¶ç»“æ„<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/a3b500/" aria-label="JVMå†…å­˜æ¨¡å‹æ·±åº¦å‰–æä¸ä¼˜åŒ–"><!---->JVMå†…å­˜æ¨¡å‹æ·±åº¦å‰–æä¸ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/pages/fd3a46/" aria-label="JVMå¯¹è±¡åˆ›å»ºä¸å†…å­˜åˆ†é…æœºåˆ¶"><!---->JVMå¯¹è±¡åˆ›å»ºä¸å†…å­˜åˆ†é…æœºåˆ¶<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/fd3a46/#å¯¹è±¡çš„åˆ›å»º" aria-label="å¯¹è±¡çš„åˆ›å»º"><!---->å¯¹è±¡çš„åˆ›å»º<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/fd3a46/#å¯¹è±¡å¤§å°ä¸æŒ‡é’ˆå‹ç¼©" aria-label="å¯¹è±¡å¤§å°ä¸æŒ‡é’ˆå‹ç¼©"><!---->å¯¹è±¡å¤§å°ä¸æŒ‡é’ˆå‹ç¼©<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/fd3a46/#å¯¹è±¡æ ˆä¸Šåˆ†é…" aria-label="å¯¹è±¡æ ˆä¸Šåˆ†é…"><!---->å¯¹è±¡æ ˆä¸Šåˆ†é…<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/fd3a46/#å¯¹è±¡åœ¨edenåŒºåˆ†é…" aria-label="å¯¹è±¡åœ¨EdenåŒºåˆ†é…"><!---->å¯¹è±¡åœ¨EdenåŒºåˆ†é…<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/fd3a46/#å¯¹è±¡å†…å­˜å›æ”¶" aria-label="å¯¹è±¡å†…å­˜å›æ”¶"><!---->å¯¹è±¡å†…å­˜å›æ”¶<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/a80a7f/" aria-label="JVMç±»åŠ è½½æœºåˆ¶"><!---->JVMç±»åŠ è½½æœºåˆ¶<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/bc8703/" aria-label="JVMè°ƒä¼˜å®æˆ˜åŠå¸¸é‡æ± è¯¦è§£"><!---->JVMè°ƒä¼˜å®æˆ˜åŠå¸¸é‡æ± è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/80485b/" aria-label="JVMè°ƒä¼˜å·¥å…·è¯¦è§£åŠè°ƒä¼˜å®æˆ˜"><!---->JVMè°ƒä¼˜å·¥å…·è¯¦è§£åŠè°ƒä¼˜å®æˆ˜<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/c9b6ed/" aria-label="åƒåœ¾æ”¶é›†å™¨G1&amp;ZGCè¯¦è§£"><!---->åƒåœ¾æ”¶é›†å™¨G1&amp;ZGCè¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/1d1280/" aria-label="åƒåœ¾æ”¶é›†å™¨ParNew&amp;CMSä¸åº•å±‚ä¸‰è‰²æ ‡è®°ç®—æ³•è¯¦è§£"><!---->åƒåœ¾æ”¶é›†å™¨ParNew&amp;CMSä¸åº•å±‚ä¸‰è‰²æ ‡è®°ç®—æ³•è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Tomcat</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">æºç æ¡†æ¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ç®—æ³•</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">è®¡ç®—æœºç½‘ç»œ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">é¢è¯•</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->JVMå¯¹è±¡åˆ›å»ºä¸å†…å­˜åˆ†é…æœºåˆ¶</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">æ±Ÿ</span></span><span property="author" content="æ±Ÿ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-08-31T01:56:40.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 21 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT21M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#å¯¹è±¡çš„åˆ›å»º">å¯¹è±¡çš„åˆ›å»º</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#å¯¹è±¡å¤§å°ä¸æŒ‡é’ˆå‹ç¼©">å¯¹è±¡å¤§å°ä¸æŒ‡é’ˆå‹ç¼©</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#å¯¹è±¡æ ˆä¸Šåˆ†é…">å¯¹è±¡æ ˆä¸Šåˆ†é…</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#å¯¹è±¡åœ¨edenåŒºåˆ†é…">å¯¹è±¡åœ¨EdenåŒºåˆ†é…</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#å¯¹è±¡å†…å­˜å›æ”¶">å¯¹è±¡å†…å­˜å›æ”¶</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h3 id="å¯¹è±¡çš„åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡çš„åˆ›å»º"><span>å¯¹è±¡çš„åˆ›å»º</span></a></h3><p>å¯¹è±¡åˆ›å»ºçš„ä¸»è¦æµç¨‹:</p><p>â€‹ <img src="https://img.jssjqd.cn/20221002232842.png" alt=""></p><p><strong>1.ç±»åŠ è½½æ£€æŸ¥</strong></p><p>è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡newæŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><p>newæŒ‡ä»¤å¯¹åº”åˆ°è¯­è¨€å±‚é¢ä¸Šè®²æ˜¯ï¼Œnewå…³é”®è¯ã€å¯¹è±¡å…‹éš†ã€å¯¹è±¡åºåˆ—åŒ–ç­‰ã€‚</p><p><strong>2.åˆ†é…å†…å­˜</strong></p><p>åœ¨ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚å¯¹è±¡æ‰€éœ€å†…å­˜çš„å¤§å°åœ¨ç±» åŠ è½½å®Œæˆåä¾¿å¯å®Œå…¨ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠ ä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä»Javaå †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚</p><p>è¿™ä¸ªæ­¥éª¤æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><p>1.å¦‚ä½•åˆ’åˆ†å†…å­˜ã€‚</p><p>2.åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œ å¯èƒ½å‡ºç°æ­£åœ¨ç»™å¯¹è±¡Aåˆ†é…å†…å­˜ï¼ŒæŒ‡é’ˆè¿˜æ²¡æ¥å¾—åŠä¿®æ”¹ï¼Œå¯¹è±¡BåˆåŒæ—¶ä½¿ç”¨äº†åŸæ¥çš„æŒ‡é’ˆæ¥åˆ†é…å†…å­˜çš„æƒ…å†µã€‚</p><p><em><strong>åˆ’åˆ†å†…å­˜çš„æ–¹æ³•ï¼š</strong></em></p><ul><li><strong>æŒ‡é’ˆç¢°æ’</strong>ï¼ˆBump the Pointerï¼‰(é»˜è®¤ç”¨æŒ‡é’ˆç¢°æ’)</li></ul><p>å¦‚æœJavaå †ä¸­å†…å­˜æ˜¯ç»å¯¹è§„æ•´çš„ï¼Œæ‰€æœ‰ç”¨è¿‡çš„å†…å­˜éƒ½æ”¾åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œé‚£æ‰€åˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠé‚£ä¸ªæŒ‡é’ˆå‘ç©ºé—²ç©ºé—´é‚£è¾¹æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ã€‚</p><ul><li><strong>ç©ºé—²åˆ—è¡¨</strong>ï¼ˆFree Listï¼‰</li></ul><p>å¦‚æœJavaå †ä¸­çš„å†…å­˜å¹¶ä¸æ˜¯è§„æ•´çš„ï¼Œå·²ä½¿ç”¨çš„å†…å­˜å’Œç©º é—²çš„å†…å­˜ç›¸äº’äº¤é”™ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•ç®€å•åœ°è¿›è¡ŒæŒ‡é’ˆç¢°æ’äº†ï¼Œè™šæ‹Ÿæœºå°±å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè®° å½•ä¸Šå“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œ å¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•</p><p><strong>è§£å†³å¹¶å‘é—®é¢˜çš„æ–¹æ³•ï¼š</strong></p><ul><li><strong>CASï¼ˆcompare and swapï¼‰</strong></li></ul><p>è™šæ‹Ÿæœºé‡‡ç”¨<strong>CASé…ä¸Šå¤±è´¥é‡è¯•</strong>çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§æ¥å¯¹åˆ†é…å†…å­˜ç©ºé—´çš„åŠ¨ä½œè¿›è¡ŒåŒæ­¥å¤„ç†ã€‚</p><ul><li><strong>æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼ˆThread Local Allocation Buffer,TLABï¼‰</strong></li></ul><p>æŠŠå†…å­˜åˆ†é…çš„åŠ¨ä½œæŒ‰ç…§çº¿ç¨‹åˆ’åˆ†åœ¨ä¸åŒçš„ç©ºé—´ä¹‹ä¸­è¿›è¡Œï¼Œå³æ¯ä¸ªçº¿ç¨‹åœ¨Javaå †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ã€‚é€šè¿‡**-XX:+/-UseTLAB<strong>å‚æ•°æ¥è®¾å®šè™šæ‹Ÿæœºæ˜¯å¦ä½¿ç”¨TLAB(JVMä¼šé»˜è®¤å¼€å¯</strong>-XX:+UseTLAB**)ï¼Œ<strong>-XX:TLABSize</strong> æŒ‡å®šTLABå¤§å°ã€‚</p><p><strong>3.åˆå§‹åŒ–é›¶å€¼</strong></p><p>å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œ å¦‚æœä½¿ç”¨TLABï¼Œè¿™ä¸€å·¥ä½œè¿‡ç¨‹ä¹Ÿå¯ä»¥æå‰è‡³TLABåˆ†é…æ—¶è¿›è¡Œã€‚è¿™ä¸€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨Javaä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</p><p><strong>4.è®¾ç½®å¯¹è±¡å¤´</strong></p><p>åˆå§‹åŒ–é›¶å€¼ä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„GCåˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡çš„å¯¹è±¡å¤´Object Headerä¹‹ä¸­ã€‚</p><p>åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º3å—åŒºåŸŸï¼šå¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€ å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰ã€‚ HotSpotè™šæ‹Ÿæœºçš„å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œ å¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶ é—´æˆ³ç­‰ã€‚å¯¹è±¡å¤´çš„å¦å¤–ä¸€éƒ¨åˆ†æ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚</p><p><strong>32ä½å¯¹è±¡å¤´</strong></p><p><img src="https://img.jssjqd.cn/20221002232857.png" alt=""></p><p><strong>64ä½å¯¹è±¡å¤´</strong></p><p><img src="https://img.jssjqd.cn/20221002232906.png" alt=""></p><p>å¯¹è±¡å¤´åœ¨hotspotçš„C++æºç markOop.hppæ–‡ä»¶é‡Œçš„æ³¨é‡Šå¦‚ä¸‹ï¼š</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><pre class="language-c++"><code>// Bit-format of an object header (most significant first, big endian layout below):
//
//  32 bits:
//  --------
//             hash:25 ------------&gt;| age:4    biased_lock:1 lock:2 (normal object)
//             JavaThread*:23 epoch:2 age:4    biased_lock:1 lock:2 (biased object)
//             size:32 ------------------------------------------&gt;| (CMS free block)
//             PromotedObject*:29 ----------&gt;| promo_bits:3 -----&gt;| (CMS promoted object)
//
//  64 bits:
//  --------
//  unused:25 hash:31 --&gt;| unused:1   age:4    biased_lock:1 lock:2 (normal object)
//  JavaThread*:54 epoch:2 unused:1   age:4    biased_lock:1 lock:2 (biased object)
//  PromotedObject*:61 ---------------------&gt;| promo_bits:3 -----&gt;| (CMS promoted object)
//  size:64 -----------------------------------------------------&gt;| (CMS free block)
//
//  unused:25 hash:31 --&gt;| cms_free:1 age:4    biased_lock:1 lock:2 (COOPs &amp;&amp; normal object)
//  JavaThread*:54 epoch:2 cms_free:1 age:4    biased_lock:1 lock:2 (COOPs &amp;&amp; biased object)
//  narrowOop:32 unused:24 cms_free:1 unused:4 promo_bits:3 -----&gt;| (COOPs &amp;&amp; CMS promoted object)
//  unused:21 size:35 --&gt;| cms_free:1 unused:7 ------------------&gt;| (COOPs &amp;&amp; CMS free block)  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5.æ‰§è¡Œæ–¹æ³•</strong></p><p>æ‰§è¡Œæ–¹æ³•ï¼Œå³å¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ã€‚å¯¹åº”åˆ°è¯­è¨€å±‚é¢ä¸Šè®²ï¼Œå°±æ˜¯ä¸ºå±æ€§èµ‹å€¼ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ä¸Šé¢çš„èµ‹é›¶å€¼ä¸åŒï¼Œè¿™æ˜¯ç”±ç¨‹åºå‘˜èµ‹çš„å€¼ï¼‰ï¼Œå’Œæ‰§è¡Œæ„é€ æ–¹æ³•ã€‚</p><p><strong>å¯¹è±¡åŠåˆå§‹åŒ–</strong></p><h3 id="å¯¹è±¡å¤§å°ä¸æŒ‡é’ˆå‹ç¼©" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡å¤§å°ä¸æŒ‡é’ˆå‹ç¼©"><span>å¯¹è±¡å¤§å°ä¸æŒ‡é’ˆå‹ç¼©</span></a></h3><p>å¯¹è±¡å¤§å°å¯ä»¥ç”¨jol-coreåŒ…æŸ¥çœ‹ï¼Œå¼•å…¥ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.openjdk.jol<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jol-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>openjdk<span class="token punctuation">.</span>jol<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span><span class="token class-name">ClassLayout</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * è®¡ç®—å¯¹è±¡å¤§å°
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JOLSample</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassLayout</span> layout <span class="token operator">=</span> <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>layout<span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClassLayout</span> layout1 <span class="token operator">=</span> <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>layout1<span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClassLayout</span> layout2 <span class="token operator">=</span> <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>layout2<span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// -XX:+UseCompressedOops           é»˜è®¤å¼€å¯çš„å‹ç¼©æ‰€æœ‰æŒ‡é’ˆ</span>
    <span class="token comment">// -XX:+UseCompressedClassPointers  é»˜è®¤å¼€å¯çš„å‹ç¼©å¯¹è±¡å¤´é‡Œçš„ç±»å‹æŒ‡é’ˆKlass Pointer</span>
    <span class="token comment">// Oops : Ordinary Object Pointers</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
                       <span class="token comment">//8B mark word</span>
                       <span class="token comment">//4B Klass Pointer   å¦‚æœå…³é—­å‹ç¼©-XX:-UseCompressedClassPointersæˆ–-XX:-UseCompressedOopsï¼Œåˆ™å ç”¨8B</span>
        <span class="token keyword">int</span> id<span class="token punctuation">;</span>        <span class="token comment">//4B</span>
        <span class="token class-name">String</span> name<span class="token punctuation">;</span>   <span class="token comment">//4B  å¦‚æœå…³é—­å‹ç¼©-XX:-UseCompressedOopsï¼Œåˆ™å ç”¨8B</span>
        <span class="token keyword">byte</span> b<span class="token punctuation">;</span>        <span class="token comment">//1B </span>
        <span class="token class-name">Object</span> o<span class="token punctuation">;</span>      <span class="token comment">//4B  å¦‚æœå…³é—­å‹ç¼©-XX:-UseCompressedOopsï¼Œåˆ™å ç”¨8B</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


è¿è¡Œç»“æœï¼š
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span> object internals<span class="token operator">:</span>
 <span class="token constant">OFFSET</span>  <span class="token constant">SIZE</span>   <span class="token constant">TYPE</span> <span class="token constant">DESCRIPTION</span>                               <span class="token constant">VALUE</span>
      <span class="token number">0</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">00000001</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment">//mark word</span>
      <span class="token number">4</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment">//mark word     </span>
      <span class="token number">8</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           e5 <span class="token number">01</span> <span class="token number">00</span> f8 <span class="token punctuation">(</span><span class="token number">11100101</span> <span class="token number">00000001</span> <span class="token number">00000000</span> <span class="token number">11111000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">134217243</span><span class="token punctuation">)</span>    <span class="token comment">//Klass Pointer</span>
     <span class="token number">12</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>loss due <span class="token keyword">to</span> <span class="token namespace">the</span> next object alignment<span class="token punctuation">)</span>
<span class="token class-name">Instance</span> size<span class="token operator">:</span> <span class="token number">16</span> bytes
<span class="token class-name">Space</span> losses<span class="token operator">:</span> <span class="token number">0</span> bytes internal <span class="token operator">+</span> <span class="token number">4</span> bytes external <span class="token operator">=</span> <span class="token number">4</span> bytes total


<span class="token punctuation">[</span><span class="token class-name">I</span> object internals<span class="token operator">:</span>
 <span class="token constant">OFFSET</span>  <span class="token constant">SIZE</span>   <span class="token constant">TYPE</span> <span class="token constant">DESCRIPTION</span>                               <span class="token constant">VALUE</span>
      <span class="token number">0</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">00000001</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token number">4</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token number">8</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">6d</span> <span class="token number">01</span> <span class="token number">00</span> f8 <span class="token punctuation">(</span><span class="token number">01101101</span> <span class="token number">00000001</span> <span class="token number">00000000</span> <span class="token number">11111000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">134217363</span><span class="token punctuation">)</span>
     <span class="token number">12</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
     <span class="token number">16</span>     <span class="token number">0</span>    <span class="token keyword">int</span> <span class="token punctuation">[</span><span class="token class-name">I</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>elements<span class="token punctuation">&gt;</span></span>                             <span class="token class-name">N</span><span class="token operator">/</span><span class="token class-name">A</span>
<span class="token class-name">Instance</span> size<span class="token operator">:</span> <span class="token number">16</span> bytes
<span class="token class-name">Space</span> losses<span class="token operator">:</span> <span class="token number">0</span> bytes internal <span class="token operator">+</span> <span class="token number">0</span> bytes external <span class="token operator">=</span> <span class="token number">0</span> bytes total


<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>tuling<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span></span>JOLSample</span>$<span class="token class-name">A</span> object internals<span class="token operator">:</span>
 <span class="token constant">OFFSET</span>  <span class="token constant">SIZE</span>               <span class="token constant">TYPE</span> <span class="token constant">DESCRIPTION</span>                               <span class="token constant">VALUE</span>
      <span class="token number">0</span>     <span class="token number">4</span>                    <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">00000001</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token number">4</span>     <span class="token number">4</span>                    <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token number">8</span>     <span class="token number">4</span>                    <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">61</span> cc <span class="token number">00</span> f8 <span class="token punctuation">(</span><span class="token number">01100001</span> <span class="token number">11001100</span> <span class="token number">00000000</span> <span class="token number">11111000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">134165407</span><span class="token punctuation">)</span>
     <span class="token number">12</span>     <span class="token number">4</span>                <span class="token keyword">int</span> <span class="token class-name">A</span><span class="token punctuation">.</span>id                                      <span class="token number">0</span>
     <span class="token number">16</span>     <span class="token number">1</span>               <span class="token keyword">byte</span> <span class="token class-name">A</span><span class="token punctuation">.</span>b                                       <span class="token number">0</span>
     <span class="token number">17</span>     <span class="token number">3</span>                    <span class="token punctuation">(</span>alignment<span class="token operator">/</span>padding gap<span class="token punctuation">)</span>                  
     <span class="token number">20</span>     <span class="token number">4</span>   <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span> <span class="token class-name">A</span><span class="token punctuation">.</span>name                                    <span class="token keyword">null</span>
     <span class="token number">24</span>     <span class="token number">4</span>   <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span> <span class="token class-name">A</span><span class="token punctuation">.</span>o                                       <span class="token keyword">null</span>
     <span class="token number">28</span>     <span class="token number">4</span>                    <span class="token punctuation">(</span>loss due <span class="token keyword">to</span> <span class="token namespace">the</span> next object alignment<span class="token punctuation">)</span>
<span class="token class-name">Instance</span> size<span class="token operator">:</span> <span class="token number">32</span> bytes
<span class="token class-name">Space</span> losses<span class="token operator">:</span> <span class="token number">3</span> bytes internal <span class="token operator">+</span> <span class="token number">4</span> bytes external <span class="token operator">=</span> <span class="token number">7</span> bytes total
           
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä»€ä¹ˆæ˜¯javaå¯¹è±¡çš„æŒ‡é’ˆå‹ç¼©" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯javaå¯¹è±¡çš„æŒ‡é’ˆå‹ç¼©"><span>ä»€ä¹ˆæ˜¯javaå¯¹è±¡çš„æŒ‡é’ˆå‹ç¼©ï¼Ÿ</span></a></h4><ol><li><p>jdk1.6 update14å¼€å§‹ï¼Œåœ¨64bitæ“ä½œç³»ç»Ÿä¸­ï¼ŒJVMæ”¯æŒæŒ‡é’ˆå‹ç¼©</p></li><li><p>jvmé…ç½®å‚æ•°:UseCompressedOopsï¼Œcompressed--å‹ç¼©ã€oop(ordinary object pointer)--å¯¹è±¡æŒ‡é’ˆ</p></li><li><p>å¯ç”¨æŒ‡é’ˆå‹ç¼©:-XX:+UseCompressedOops(é»˜è®¤å¼€å¯)ï¼Œ</p><p>ç¦æ­¢æŒ‡é’ˆå‹ç¼©:-XX:-UseCompressedOops</p><p>åªå‹ç¼©å¯¹è±¡å¤´é‡Œçš„ç±»å‹æŒ‡é’ˆKlass Pointer: -XX:+UserCompressedClassPointers</p></li></ol><h4 id="ä¸ºä»€ä¹ˆè¦è¿›è¡ŒæŒ‡é’ˆå‹ç¼©" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦è¿›è¡ŒæŒ‡é’ˆå‹ç¼©"><span>ä¸ºä»€ä¹ˆè¦è¿›è¡ŒæŒ‡é’ˆå‹ç¼©ï¼Ÿ</span></a></h4><p>1.åœ¨64ä½å¹³å°çš„HotSpotä¸­ä½¿ç”¨32ä½æŒ‡é’ˆ(å®é™…å­˜å‚¨ç”¨64ä½)ï¼Œå†…å­˜ä½¿ç”¨ä¼šå¤šå‡º1.5å€å·¦å³ï¼Œä½¿ç”¨è¾ƒå¤§æŒ‡é’ˆåœ¨ä¸»å†…å­˜å’Œç¼“å­˜ä¹‹é—´ç§»åŠ¨æ•°æ®ï¼Œå ç”¨è¾ƒå¤§å®½å¸¦ï¼ŒåŒæ—¶GCä¹Ÿä¼šæ‰¿å—è¾ƒå¤§å‹åŠ›</p><p>2.ä¸ºäº†å‡å°‘64ä½å¹³å°ä¸‹å†…å­˜çš„æ¶ˆè€—ï¼Œå¯ç”¨æŒ‡é’ˆå‹ç¼©åŠŸèƒ½</p><p>3.åœ¨jvmä¸­ï¼Œ32ä½åœ°å€æœ€å¤§æ”¯æŒ4Gå†…å­˜(2çš„32æ¬¡æ–¹)ï¼Œå¯ä»¥é€šè¿‡å¯¹å¯¹è±¡æŒ‡é’ˆçš„å­˜å…¥<strong>å †å†…å­˜</strong>æ—¶å‹ç¼©ç¼–ç ã€å–å‡ºåˆ°<strong>cpuå¯„å­˜å™¨</strong>åè§£ç æ–¹å¼è¿›è¡Œä¼˜åŒ–(å¯¹è±¡æŒ‡é’ˆåœ¨å †ä¸­æ˜¯32ä½ï¼Œåœ¨å¯„å­˜å™¨ä¸­æ˜¯35ä½ï¼Œ2çš„35æ¬¡æ–¹=32G)ï¼Œä½¿å¾—jvmåªç”¨32ä½åœ°å€å°±å¯ä»¥æ”¯æŒæ›´å¤§çš„å†…å­˜é…ç½®(å°äºç­‰äº32G)</p><p>4.å †å†…å­˜å°äº4Gæ—¶ï¼Œä¸éœ€è¦å¯ç”¨æŒ‡é’ˆå‹ç¼©ï¼Œjvmä¼šç›´æ¥å»é™¤é«˜32ä½åœ°å€ï¼Œå³ä½¿ç”¨ä½è™šæ‹Ÿåœ°å€ç©ºé—´</p><p>5.å †å†…å­˜å¤§äº32Gæ—¶ï¼Œå‹ç¼©æŒ‡é’ˆä¼šå¤±æ•ˆï¼Œä¼šå¼ºåˆ¶ä½¿ç”¨64ä½(å³8å­—èŠ‚)æ¥å¯¹javaå¯¹è±¡å¯»å€ï¼Œè¿™å°±ä¼šå‡ºç°1çš„é—®é¢˜ï¼Œæ‰€ä»¥å †å†…å­˜ä¸è¦å¤§äº32Gä¸ºå¥½</p><p>**å…³äºå¯¹é½å¡«å……ï¼š**å¯¹äºå¤§éƒ¨åˆ†å¤„ç†å™¨ï¼Œå¯¹è±¡ä»¥8å­—èŠ‚æ•´æ•°å€æ¥å¯¹é½å¡«å……éƒ½æ˜¯æœ€é«˜æ•ˆçš„å­˜å–æ–¹å¼ã€‚</p><p><strong>å¯¹è±¡å†…å­˜åˆ†é…</strong></p><p><strong>å¯¹è±¡å†…å­˜åˆ†é…æµç¨‹å›¾</strong></p><p>â€‹ <img src="https://img.jssjqd.cn/20221002232915.png" alt=""></p><h3 id="å¯¹è±¡æ ˆä¸Šåˆ†é…" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡æ ˆä¸Šåˆ†é…"><span>å¯¹è±¡æ ˆä¸Šåˆ†é…</span></a></h3><p>æˆ‘ä»¬é€šè¿‡JVMå†…å­˜åˆ†é…å¯ä»¥çŸ¥é“JAVAä¸­çš„å¯¹è±¡éƒ½æ˜¯åœ¨å †ä¸Šè¿›è¡Œåˆ†é…ï¼Œå½“å¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œéœ€è¦ä¾é GCè¿›è¡Œå›æ”¶å†…å­˜ï¼Œå¦‚æœå¯¹è±¡æ•°é‡è¾ƒå¤šçš„æ—¶å€™ï¼Œä¼šç»™GCå¸¦æ¥è¾ƒå¤§å‹åŠ›ï¼Œä¹Ÿé—´æ¥å½±å“äº†åº”ç”¨çš„æ€§èƒ½ã€‚ä¸ºäº†å‡å°‘ä¸´æ—¶å¯¹è±¡åœ¨å †å†…åˆ†é…çš„æ•°é‡ï¼ŒJVMé€šè¿‡<strong>é€ƒé€¸åˆ†æ</strong>ç¡®å®šè¯¥å¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ã€‚å¦‚æœä¸ä¼šé€ƒé€¸å¯ä»¥å°†è¯¥å¯¹è±¡åœ¨<strong>æ ˆä¸Šåˆ†é…</strong>å†…å­˜ï¼Œè¿™æ ·è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´å°±å¯ä»¥éšæ ˆå¸§å‡ºæ ˆè€Œé”€æ¯ï¼Œå°±å‡è½»äº†åƒåœ¾å›æ”¶çš„å‹åŠ›ã€‚</p><p><strong>å¯¹è±¡é€ƒé€¸åˆ†æ</strong>ï¼šå°±æ˜¯åˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸï¼Œå½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå®ƒå¯èƒ½è¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–åœ°æ–¹ä¸­ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;zhuge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//TODO ä¿å­˜åˆ°æ•°æ®åº“</span>
   <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;zhuge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//TODO ä¿å­˜åˆ°æ•°æ®åº“</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾ˆæ˜¾ç„¶test1æ–¹æ³•ä¸­çš„userå¯¹è±¡è¢«è¿”å›äº†ï¼Œè¿™ä¸ªå¯¹è±¡çš„ä½œç”¨åŸŸèŒƒå›´ä¸ç¡®å®šï¼Œtest2æ–¹æ³•ä¸­çš„userå¯¹è±¡æˆ‘ä»¬å¯ä»¥ç¡®å®šå½“æ–¹æ³•ç»“æŸè¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è®¤ä¸ºæ˜¯æ— æ•ˆå¯¹è±¡äº†ï¼Œå¯¹äºè¿™æ ·çš„å¯¹è±¡æˆ‘ä»¬å…¶å®å¯ä»¥å°†å…¶åˆ†é…åœ¨æ ˆå†…å­˜é‡Œï¼Œè®©å…¶åœ¨æ–¹æ³•ç»“æŸæ—¶è·Ÿéšæ ˆå†…å­˜ä¸€èµ·è¢«å›æ”¶æ‰ã€‚</p><p>JVMå¯¹äºè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å¼€å¯é€ƒé€¸åˆ†æå‚æ•°(-XX:+DoEscapeAnalysis)æ¥ä¼˜åŒ–å¯¹è±¡å†…å­˜åˆ†é…ä½ç½®ï¼Œä½¿å…¶é€šè¿‡<strong>æ ‡é‡æ›¿æ¢</strong>ä¼˜å…ˆåˆ†é…åœ¨æ ˆä¸Š(<strong>æ ˆä¸Šåˆ†é…</strong>)ï¼Œ<strong>JDK7ä¹‹åé»˜è®¤å¼€å¯é€ƒé€¸åˆ†æ</strong>ï¼Œå¦‚æœè¦å…³é—­ä½¿ç”¨å‚æ•°(-XX:-DoEscapeAnalysis)</p><p>**æ ‡é‡æ›¿æ¢ï¼š**é€šè¿‡é€ƒé€¸åˆ†æç¡®å®šè¯¥å¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”å¯¹è±¡å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æ—¶ï¼Œ<strong>JVMä¸ä¼šåˆ›å»ºè¯¥å¯¹è±¡</strong>ï¼Œè€Œæ˜¯å°†è¯¥å¯¹è±¡æˆå‘˜å˜é‡åˆ†è§£è‹¥å¹²ä¸ªè¢«è¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„æˆå‘˜å˜é‡æ‰€ä»£æ›¿ï¼Œè¿™äº›ä»£æ›¿çš„æˆå‘˜å˜é‡åœ¨æ ˆå¸§æˆ–å¯„å­˜å™¨ä¸Šåˆ†é…ç©ºé—´ï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºæ²¡æœ‰ä¸€å¤§å—è¿ç»­ç©ºé—´å¯¼è‡´å¯¹è±¡å†…å­˜ä¸å¤Ÿåˆ†é…ã€‚å¼€å¯æ ‡é‡æ›¿æ¢å‚æ•°(-XX:+EliminateAllocations)ï¼Œ<strong>JDK7ä¹‹åé»˜è®¤å¼€å¯</strong>ã€‚</p><p>**æ ‡é‡ä¸èšåˆé‡ï¼š**æ ‡é‡å³ä¸å¯è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€ŒJAVAçš„åŸºæœ¬æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ï¼ˆå¦‚ï¼šintï¼Œlongç­‰åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠreferenceç±»å‹ç­‰ï¼‰ï¼Œæ ‡é‡çš„å¯¹ç«‹å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€Œè¿™ç§é‡ç§°ä¹‹ä¸ºèšåˆé‡ã€‚è€Œåœ¨JAVAä¸­å¯¹è±¡å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„èšåˆé‡ã€‚</p><p><strong>æ ˆä¸Šåˆ†é…ç¤ºä¾‹ï¼š</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ ˆä¸Šåˆ†é…ï¼Œæ ‡é‡æ›¿æ¢
 * ä»£ç è°ƒç”¨äº†1äº¿æ¬¡alloc()ï¼Œå¦‚æœæ˜¯åˆ†é…åˆ°å †ä¸Šï¼Œå¤§æ¦‚éœ€è¦1GBä»¥ä¸Šå †ç©ºé—´ï¼Œå¦‚æœå †ç©ºé—´å°äºè¯¥å€¼ï¼Œå¿…ç„¶ä¼šè§¦å‘GCã€‚
 * 
 * ä½¿ç”¨å¦‚ä¸‹å‚æ•°ä¸ä¼šå‘ç”ŸGC
 * -Xmx15m -Xms15m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:+EliminateAllocations
 * ä½¿ç”¨å¦‚ä¸‹å‚æ•°éƒ½ä¼šå‘ç”Ÿå¤§é‡GC
 * -Xmx15m -Xms15m -XX:-DoEscapeAnalysis -XX:+PrintGC -XX:+EliminateAllocations
 * -Xmx15m -Xms15m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:-EliminateAllocations
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AllotOnStack</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;zhuge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**ç»“è®ºï¼š**æ ˆä¸Šåˆ†é…ä¾èµ–äºé€ƒé€¸åˆ†æå’Œæ ‡é‡æ›¿æ¢</p><h3 id="å¯¹è±¡åœ¨edenåŒºåˆ†é…" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡åœ¨edenåŒºåˆ†é…"><span>å¯¹è±¡åœ¨EdenåŒºåˆ†é…</span></a></h3><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ Eden åŒºåˆ†é…ã€‚å½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡Minor GCã€‚æˆ‘ä»¬æ¥è¿›è¡Œå®é™…æµ‹è¯•ä¸€ä¸‹ã€‚</p><p>åœ¨æµ‹è¯•ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ <strong>Minor GCå’ŒFull GC æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</strong></p><ul><li><strong>Minor GC/Young GC</strong>ï¼šæŒ‡å‘ç”Ÿæ–°ç”Ÿä»£çš„çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼ŒMinor GCéå¸¸é¢‘ç¹ï¼Œå›æ”¶é€Ÿåº¦ä¸€èˆ¬ä¹Ÿæ¯”è¾ƒå¿«ã€‚</li><li><strong>Major GC/Full GC</strong>ï¼šä¸€èˆ¬ä¼šå›æ”¶è€å¹´ä»£ ï¼Œå¹´è½»ä»£ï¼Œæ–¹æ³•åŒºçš„åƒåœ¾ï¼ŒMajor GCçš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯”Minor GCçš„æ…¢10å€ä»¥ä¸Šã€‚</li></ul><p><strong>Edenä¸SurvivoråŒºé»˜è®¤8:1:1</strong></p><p>å¤§é‡çš„å¯¹è±¡è¢«åˆ†é…åœ¨edenåŒºï¼ŒedenåŒºæ»¡äº†åä¼šè§¦å‘minor gcï¼Œå¯èƒ½ä¼šæœ‰99%ä»¥ä¸Šçš„å¯¹è±¡æˆä¸ºåƒåœ¾è¢«å›æ”¶æ‰ï¼Œå‰©ä½™å­˜æ´»çš„å¯¹è±¡ä¼šè¢«æŒªåˆ°ä¸ºç©ºçš„é‚£å—survivoråŒºï¼Œä¸‹ä¸€æ¬¡edenåŒºæ»¡äº†ååˆä¼šè§¦å‘minor gcï¼ŒæŠŠedenåŒºå’ŒsurvivoråŒºåƒåœ¾å¯¹è±¡å›æ”¶ï¼ŒæŠŠå‰©ä½™å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§æŒªåŠ¨åˆ°å¦å¤–ä¸€å—ä¸ºç©ºçš„survivoråŒºï¼Œå› ä¸ºæ–°ç”Ÿä»£çš„å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œå­˜æ´»æ—¶é—´å¾ˆçŸ­ï¼Œæ‰€ä»¥JVMé»˜è®¤çš„8:1:1çš„æ¯”ä¾‹æ˜¯å¾ˆåˆé€‚çš„ï¼Œ<strong>è®©edenåŒºå°½é‡çš„å¤§ï¼ŒsurvivoråŒºå¤Ÿç”¨å³å¯ï¼Œ</strong></p><p>JVMé»˜è®¤æœ‰è¿™ä¸ªå‚æ•°-XX:+UseAdaptiveSizePolicy(é»˜è®¤å¼€å¯)ï¼Œä¼šå¯¼è‡´è¿™ä¸ª8:1:1æ¯”ä¾‹è‡ªåŠ¨å˜åŒ–ï¼Œå¦‚æœä¸æƒ³è¿™ä¸ªæ¯”ä¾‹æœ‰å˜åŒ–å¯ä»¥è®¾ç½®å‚æ•°-XX:-UseAdaptiveSizePolicy</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>//æ·»åŠ è¿è¡ŒJVMå‚æ•°ï¼š -XX:+PrintGCDetails
public class GCTest {
   public static void main(String[] args) throws InterruptedException {
      byte[] allocation1, allocation2/*, allocation3, allocation4, allocation5, allocation6*/;
      allocation1 = new byte[60000*1024];

      //allocation2 = new byte[8000*1024];

      /*allocation3 = new byte[1000*1024];
     allocation4 = new byte[1000*1024];
     allocation5 = new byte[1000*1024];
     allocation6 = new byte[1000*1024];*/
   }
}

è¿è¡Œç»“æœï¼š
Heap
 PSYoungGen      total 76288K, used 65536K [0x000000076b400000, 0x0000000770900000, 0x00000007c0000000)
  eden space 65536K, 100% used [0x000000076b400000,0x000000076f400000,0x000000076f400000)
  from space 10752K, 0% used [0x000000076fe80000,0x000000076fe80000,0x0000000770900000)
  to   space 10752K, 0% used [0x000000076f400000,0x000000076f400000,0x000000076fe80000)
 ParOldGen       total 175104K, used 0K [0x00000006c1c00000, 0x00000006cc700000, 0x000000076b400000)
  object space 175104K, 0% used [0x00000006c1c00000,0x00000006c1c00000,0x00000006cc700000)
 Metaspace       used 3342K, capacity 4496K, committed 4864K, reserved 1056768K
  class space    used 361K, capacity 388K, committed 512K, reserved 1048576K
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºedenåŒºå†…å­˜å‡ ä¹å·²ç»è¢«åˆ†é…å®Œå…¨ï¼ˆå³ä½¿ç¨‹åºä»€ä¹ˆä¹Ÿä¸åšï¼Œæ–°ç”Ÿä»£ä¹Ÿä¼šä½¿ç”¨è‡³å°‘å‡ Må†…å­˜ï¼‰ã€‚<strong>å‡å¦‚æˆ‘ä»¬å†ä¸ºallocation2åˆ†é…å†…å­˜ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//æ·»åŠ è¿è¡ŒJVMå‚æ•°ï¼š -XX:+PrintGCDetails</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GCTest</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation1<span class="token punctuation">,</span> allocation2<span class="token comment">/*, allocation3, allocation4, allocation5, allocation6*/</span><span class="token punctuation">;</span>
      allocation1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">60000</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      allocation2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">8000</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">/*allocation3 = new byte[1000*1024];
      allocation4 = new byte[1000*1024];
      allocation5 = new byte[1000*1024];
      allocation6 = new byte[1000*1024];*/</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

è¿è¡Œç»“æœï¼š
<span class="token punctuation">[</span><span class="token constant">GC</span> <span class="token punctuation">(</span><span class="token class-name">Allocation</span> <span class="token class-name">Failure</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">65253</span>K<span class="token operator">-&gt;</span><span class="token function">936K</span><span class="token punctuation">(</span><span class="token number">76288</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">65253</span>K<span class="token operator">-&gt;</span><span class="token function">60944K</span><span class="token punctuation">(</span><span class="token number">251392</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0279083</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.13</span> sys<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.03</span> secs<span class="token punctuation">]</span> 
<span class="token class-name">Heap</span>
 <span class="token class-name">PSYoungGen</span>      total <span class="token number">76288</span>K<span class="token punctuation">,</span> used <span class="token number">9591</span>K <span class="token punctuation">[</span><span class="token number">0x000000076b400000</span><span class="token punctuation">,</span> <span class="token number">0x0000000774900000</span><span class="token punctuation">,</span> <span class="token number">0x00000007c0000000</span><span class="token punctuation">)</span>
  eden space <span class="token number">65536</span>K<span class="token punctuation">,</span> <span class="token number">13</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x000000076b400000</span><span class="token punctuation">,</span><span class="token number">0x000000076bc73ef8</span><span class="token punctuation">,</span><span class="token number">0x000000076f400000</span><span class="token punctuation">)</span>
  from space <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">8</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x000000076f400000</span><span class="token punctuation">,</span><span class="token number">0x000000076f4ea020</span><span class="token punctuation">,</span><span class="token number">0x000000076fe80000</span><span class="token punctuation">)</span>
  <span class="token keyword">to</span>   <span class="token namespace">space</span> <span class="token number">10752</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x0000000773e80000</span><span class="token punctuation">,</span><span class="token number">0x0000000773e80000</span><span class="token punctuation">,</span><span class="token number">0x0000000774900000</span><span class="token punctuation">)</span>
 <span class="token class-name">ParOldGen</span>       total <span class="token number">175104</span>K<span class="token punctuation">,</span> used <span class="token number">60008</span>K <span class="token punctuation">[</span><span class="token number">0x00000006c1c00000</span><span class="token punctuation">,</span> <span class="token number">0x00000006cc700000</span><span class="token punctuation">,</span> <span class="token number">0x000000076b400000</span><span class="token punctuation">)</span>
  object space <span class="token number">175104</span>K<span class="token punctuation">,</span> <span class="token number">34</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000006c1c00000</span><span class="token punctuation">,</span><span class="token number">0x00000006c569a010</span><span class="token punctuation">,</span><span class="token number">0x00000006cc700000</span><span class="token punctuation">)</span>
 <span class="token class-name">Metaspace</span>       used <span class="token number">3342</span>K<span class="token punctuation">,</span> capacity <span class="token number">4496</span>K<span class="token punctuation">,</span> committed <span class="token number">4864</span>K<span class="token punctuation">,</span> reserved <span class="token number">1056768</span>K
  <span class="token keyword">class</span> space    used <span class="token number">361</span>K<span class="token punctuation">,</span> capacity <span class="token number">388</span>K<span class="token punctuation">,</span> committed <span class="token number">512</span>K<span class="token punctuation">,</span> reserved <span class="token number">1048576</span>K    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç®€å•è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š</strong> å› ä¸ºç»™allocation2åˆ†é…å†…å­˜çš„æ—¶å€™edenåŒºå†…å­˜å‡ ä¹å·²ç»è¢«åˆ†é…å®Œäº†ï¼Œæˆ‘ä»¬åˆšåˆšè®²äº†å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡Minor GCï¼ŒGCæœŸé—´è™šæ‹Ÿæœºåˆå‘ç°allocation1æ— æ³•å­˜å…¥Surviorç©ºé—´ï¼Œæ‰€ä»¥åªå¥½æŠŠæ–°ç”Ÿä»£çš„å¯¹è±¡<strong>æå‰è½¬ç§»åˆ°è€å¹´ä»£</strong>ä¸­å»ï¼Œè€å¹´ä»£ä¸Šçš„ç©ºé—´è¶³å¤Ÿå­˜æ”¾allocation1ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°Full GCã€‚æ‰§è¡ŒMinor GCåï¼Œåé¢åˆ†é…çš„å¯¹è±¡å¦‚æœèƒ½å¤Ÿå­˜åœ¨edenåŒºçš„è¯ï¼Œè¿˜æ˜¯ä¼šåœ¨edenåŒºåˆ†é…å†…å­˜ã€‚å¯ä»¥æ‰§è¡Œå¦‚ä¸‹ä»£ç éªŒè¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>public class GCTest {
   public static void main(String[] args) throws InterruptedException {
      byte[] allocation1, allocation2, allocation3, allocation4, allocation5, allocation6;
      allocation1 = new byte[60000*1024];

      allocation2 = new byte[8000*1024];

      allocation3 = new byte[1000*1024];
      allocation4 = new byte[1000*1024];
     allocation5 = new byte[1000*1024];
     allocation6 = new byte[1000*1024];
   }
}

è¿è¡Œç»“æœï¼š
[GC (Allocation Failure) [PSYoungGen: 65253K-&gt;952K(76288K)] 65253K-&gt;60960K(251392K), 0.0311467 secs] [Times: user=0.08 sys=0.02, real=0.03 secs] 
Heap
 PSYoungGen      total 76288K, used 13878K [0x000000076b400000, 0x0000000774900000, 0x00000007c0000000)
  eden space 65536K, 19% used [0x000000076b400000,0x000000076c09fb68,0x000000076f400000)
  from space 10752K, 8% used [0x000000076f400000,0x000000076f4ee030,0x000000076fe80000)
  to   space 10752K, 0% used [0x0000000773e80000,0x0000000773e80000,0x0000000774900000)
 ParOldGen       total 175104K, used 60008K [0x00000006c1c00000, 0x00000006cc700000, 0x000000076b400000)
  object space 175104K, 34% used [0x00000006c1c00000,0x00000006c569a010,0x00000006cc700000)
 Metaspace       used 3343K, capacity 4496K, committed 4864K, reserved 1056768K
  class space    used 361K, capacity 388K, committed 512K, reserved 1048576K
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong></p><p>å¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ã€‚JVMå‚æ•° <strong>-XX:PretenureSizeThreshold</strong> å¯ä»¥è®¾ç½®å¤§å¯¹è±¡çš„å¤§å°ï¼Œå¦‚æœå¯¹è±¡è¶…è¿‡è®¾ç½®å¤§å°ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä¸ä¼šè¿›å…¥å¹´è½»ä»£ï¼Œè¿™ä¸ªå‚æ•°åªåœ¨ <strong>Serial å’ŒParNew</strong>ä¸¤ä¸ªæ”¶é›†å™¨ä¸‹æœ‰æ•ˆã€‚</p><p>æ¯”å¦‚è®¾ç½®JVMå‚æ•°ï¼š<strong>-XX:PretenureSizeThreshold=1000000 (å•ä½æ˜¯å­—èŠ‚) -XX:+UseSerialGC</strong> ï¼Œå†æ‰§è¡Œä¸‹ä¸Šé¢çš„ç¬¬ä¸€ä¸ªç¨‹åºä¼šå‘ç°å¤§å¯¹è±¡ç›´æ¥è¿›äº†è€å¹´ä»£</p><p><strong>ä¸ºä»€ä¹ˆè¦è¿™æ ·å‘¢ï¼Ÿ</strong></p><p>ä¸ºäº†é¿å…ä¸ºå¤§å¯¹è±¡åˆ†é…å†…å­˜æ—¶çš„å¤åˆ¶æ“ä½œè€Œé™ä½æ•ˆç‡ã€‚</p><p><strong>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£</strong></p><p>æ—¢ç„¶è™šæ‹Ÿæœºé‡‡ç”¨äº†åˆ†ä»£æ”¶é›†çš„æ€æƒ³æ¥ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆå†…å­˜å›æ”¶æ—¶å°±å¿…é¡»èƒ½è¯†åˆ«å“ªäº›å¯¹è±¡åº”æ”¾åœ¨æ–°ç”Ÿä»£ï¼Œå“ªäº›å¯¹è±¡åº”æ”¾åœ¨è€å¹´ä»£ä¸­ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œè™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡ä¸€ä¸ªå¯¹è±¡å¹´é¾„ï¼ˆAgeï¼‰è®¡æ•°å™¨ã€‚</p><p>å¦‚æœå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€æ¬¡ Minor GC åä»ç„¶èƒ½å¤Ÿå­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢« Survivor å®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ° Survivor ç©ºé—´ä¸­ï¼Œå¹¶å°†å¯¹è±¡å¹´é¾„è®¾ä¸º1ã€‚å¯¹è±¡åœ¨ Survivor ä¸­æ¯ç†¬è¿‡ä¸€æ¬¡ MinorGCï¼Œå¹´é¾„å°±å¢åŠ 1å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º15å²ï¼ŒCMSæ”¶é›†å™¨é»˜è®¤6å²ï¼Œä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ä¼šç•¥å¾®æœ‰ç‚¹ä¸åŒï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° <strong>-XX:MaxTenuringThreshold</strong> æ¥è®¾ç½®ã€‚</p><p><strong>å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­</strong></p><p>å½“å‰æ”¾å¯¹è±¡çš„SurvivoråŒºåŸŸé‡Œ(å…¶ä¸­ä¸€å—åŒºåŸŸï¼Œæ”¾å¯¹è±¡çš„é‚£å—såŒº)ï¼Œä¸€æ‰¹å¯¹è±¡çš„æ€»å¤§å°å¤§äºè¿™å—SurvivoråŒºåŸŸå†…å­˜å¤§å°çš„50%(-XX:TargetSurvivorRatioå¯ä»¥æŒ‡å®š)ï¼Œé‚£ä¹ˆæ­¤æ—¶<strong>å¤§äºç­‰äº</strong>è¿™æ‰¹å¯¹è±¡å¹´é¾„æœ€å¤§å€¼çš„å¯¹è±¡ï¼Œå°±å¯ä»¥<strong>ç›´æ¥è¿›å…¥è€å¹´ä»£</strong>äº†ï¼Œä¾‹å¦‚SurvivoråŒºåŸŸé‡Œç°åœ¨æœ‰ä¸€æ‰¹å¯¹è±¡ï¼Œå¹´é¾„1+å¹´é¾„2+å¹´é¾„nçš„å¤šä¸ªå¹´é¾„å¯¹è±¡æ€»å’Œè¶…è¿‡äº†SurvivoråŒºåŸŸçš„50%ï¼Œæ­¤æ—¶å°±ä¼šæŠŠå¹´é¾„n(å«)ä»¥ä¸Šçš„å¯¹è±¡éƒ½æ”¾å…¥è€å¹´ä»£ã€‚è¿™ä¸ªè§„åˆ™å…¶å®æ˜¯å¸Œæœ›é‚£äº›å¯èƒ½æ˜¯é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œå°½æ—©è¿›å…¥è€å¹´ä»£ã€‚<strong>å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­æœºåˆ¶ä¸€èˆ¬æ˜¯åœ¨minor gcä¹‹åè§¦å‘çš„ã€‚</strong></p><p><strong>è€å¹´ä»£ç©ºé—´åˆ†é…æ‹…ä¿æœºåˆ¶</strong></p><p>å¹´è½»ä»£æ¯æ¬¡<strong>minor gc</strong>ä¹‹å‰JVMéƒ½ä¼šè®¡ç®—ä¸‹è€å¹´ä»£<strong>å‰©ä½™å¯ç”¨ç©ºé—´</strong></p><p>å¦‚æœè¿™ä¸ªå¯ç”¨ç©ºé—´å°äºå¹´è½»ä»£é‡Œç°æœ‰çš„æ‰€æœ‰å¯¹è±¡å¤§å°ä¹‹å’Œ(<strong>åŒ…æ‹¬åƒåœ¾å¯¹è±¡</strong>)</p><p>å°±ä¼šçœ‹ä¸€ä¸ªâ€œ-XX:-HandlePromotionFailureâ€(jdk1.8é»˜è®¤å°±è®¾ç½®äº†)çš„å‚æ•°æ˜¯å¦è®¾ç½®äº†</p><p>å¦‚æœæœ‰è¿™ä¸ªå‚æ•°ï¼Œå°±ä¼šçœ‹çœ‹è€å¹´ä»£çš„å¯ç”¨å†…å­˜å¤§å°ï¼Œæ˜¯å¦å¤§äºä¹‹å‰æ¯ä¸€æ¬¡minor gcåè¿›å…¥è€å¹´ä»£çš„å¯¹è±¡çš„<strong>å¹³å‡å¤§å°</strong>ã€‚</p><p>å¦‚æœä¸Šä¸€æ­¥ç»“æœæ˜¯å°äºæˆ–è€…ä¹‹å‰è¯´çš„å‚æ•°æ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ä¸€æ¬¡Full gcï¼Œå¯¹è€å¹´ä»£å’Œå¹´è½»ä»£ä¸€èµ·å›æ”¶ä¸€æ¬¡åƒåœ¾ï¼Œå¦‚æœå›æ”¶å®Œè¿˜æ˜¯æ²¡æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾æ–°çš„å¯¹è±¡å°±ä¼šå‘ç”Ÿ&quot;OOM&quot;</p><p>å½“ç„¶ï¼Œå¦‚æœminor gcä¹‹åå‰©ä½™å­˜æ´»çš„éœ€è¦æŒªåŠ¨åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§å°è¿˜æ˜¯å¤§äºè€å¹´ä»£å¯ç”¨ç©ºé—´ï¼Œé‚£ä¹ˆä¹Ÿä¼šè§¦å‘full gcï¼Œfull gcå®Œä¹‹åå¦‚æœè¿˜æ˜¯æ²¡æœ‰ç©ºé—´æ”¾minor gcä¹‹åçš„å­˜æ´»å¯¹è±¡ï¼Œåˆ™ä¹Ÿä¼šå‘ç”Ÿâ€œOOMâ€</p><p>â€‹ <img src="https://img.jssjqd.cn/20221002232924.png" alt=""></p><h3 id="å¯¹è±¡å†…å­˜å›æ”¶" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡å†…å­˜å›æ”¶"><span>å¯¹è±¡å†…å­˜å›æ”¶</span></a></h3><p>å †ä¸­å‡ ä¹æ”¾ç€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œå¯¹å †åƒåœ¾å›æ”¶å‰çš„ç¬¬ä¸€æ­¥å°±æ˜¯è¦åˆ¤æ–­å“ªäº›å¯¹è±¡å·²ç»æ­»äº¡ï¼ˆå³ä¸èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡ï¼‰ã€‚</p><p><strong>å¼•ç”¨è®¡æ•°æ³•</strong></p><p>ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒï¼Œè®¡æ•°å™¨å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨å°±å‡1ï¼›ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p><p><strong>è¿™ä¸ªæ–¹æ³•å®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºä¸­å¹¶æ²¡æœ‰é€‰æ‹©è¿™ä¸ªç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œå…¶æœ€ä¸»è¦çš„åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</strong> æ‰€è°“å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨é—®é¢˜ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼šé™¤äº†å¯¹è±¡objA å’Œ objB ç›¸äº’å¼•ç”¨ç€å¯¹æ–¹ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å†æ— ä»»ä½•å¼•ç”¨ã€‚ä½†æ˜¯ä»–ä»¬å› ä¸ºäº’ç›¸å¼•ç”¨å¯¹æ–¹ï¼Œå¯¼è‡´å®ƒä»¬çš„å¼•ç”¨è®¡æ•°å™¨éƒ½ä¸ä¸º0ï¼Œäºæ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•é€šçŸ¥ GC å›æ”¶å™¨å›æ”¶ä»–ä»¬ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceCountingGc</span> <span class="token punctuation">{</span>
   <span class="token class-name">Object</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">ReferenceCountingGc</span> objA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">ReferenceCountingGc</span> objB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      objA<span class="token punctuation">.</span>instance <span class="token operator">=</span> objB<span class="token punctuation">;</span>
      objB<span class="token punctuation">.</span>instance <span class="token operator">=</span> objA<span class="token punctuation">;</span>
      objA <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      objB <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong></p><p>å°†**â€œGC Rootsâ€** å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢å¼•ç”¨çš„å¯¹è±¡ï¼Œæ‰¾åˆ°çš„å¯¹è±¡éƒ½æ ‡è®°ä¸º<strong>éåƒåœ¾å¯¹è±¡</strong>ï¼Œå…¶ä½™æœªæ ‡è®°çš„å¯¹è±¡éƒ½æ˜¯åƒåœ¾å¯¹è±¡</p><p><strong>GC Roots</strong>æ ¹èŠ‚ç‚¹ï¼šçº¿ç¨‹æ ˆçš„æœ¬åœ°å˜é‡ã€é™æ€å˜é‡ã€æœ¬åœ°æ–¹æ³•æ ˆçš„å˜é‡ç­‰ç­‰</p><p>â€‹ <img src="https://img.jssjqd.cn/20221002232932.png" alt=""></p><p><strong>å¸¸è§å¼•ç”¨ç±»å‹</strong></p><p>javaçš„å¼•ç”¨ç±»å‹ä¸€èˆ¬åˆ†ä¸ºå››ç§ï¼š<strong>å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨</strong></p><p><strong>å¼ºå¼•ç”¨</strong>ï¼šæ™®é€šçš„å˜é‡å¼•ç”¨</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>è½¯å¼•ç”¨</strong>ï¼šå°†å¯¹è±¡ç”¨SoftReferenceè½¯å¼•ç”¨ç±»å‹çš„å¯¹è±¡åŒ…è£¹ï¼Œæ­£å¸¸æƒ…å†µä¸ä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯GCåšå®Œåå‘ç°é‡Šæ”¾ä¸å‡ºç©ºé—´å­˜æ”¾æ–°çš„å¯¹è±¡ï¼Œåˆ™ä¼šæŠŠè¿™äº›è½¯å¼•ç”¨çš„å¯¹è±¡å›æ”¶æ‰ã€‚<strong>è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è½¯å¼•ç”¨åœ¨å®é™…ä¸­æœ‰é‡è¦çš„åº”ç”¨ï¼Œä¾‹å¦‚æµè§ˆå™¨çš„åé€€æŒ‰é’®ã€‚æŒ‰åé€€æ—¶ï¼Œè¿™ä¸ªåé€€æ—¶æ˜¾ç¤ºçš„ç½‘é¡µå†…å®¹æ˜¯é‡æ–°è¿›è¡Œè¯·æ±‚è¿˜æ˜¯ä»ç¼“å­˜ä¸­å–å‡ºå‘¢ï¼Ÿè¿™å°±è¦çœ‹å…·ä½“çš„å®ç°ç­–ç•¥äº†ã€‚</p><p>ï¼ˆ1ï¼‰å¦‚æœä¸€ä¸ªç½‘é¡µåœ¨æµè§ˆç»“æŸæ—¶å°±è¿›è¡Œå†…å®¹çš„å›æ”¶ï¼Œåˆ™æŒ‰åé€€æŸ¥çœ‹å‰é¢æµè§ˆè¿‡çš„é¡µé¢æ—¶ï¼Œéœ€è¦é‡æ–°æ„å»º</p><p>ï¼ˆ2ï¼‰å¦‚æœå°†æµè§ˆè¿‡çš„ç½‘é¡µå­˜å‚¨åˆ°å†…å­˜ä¸­ä¼šé€ æˆå†…å­˜çš„å¤§é‡æµªè´¹ï¼Œç”šè‡³ä¼šé€ æˆå†…å­˜æº¢å‡º</p><p><strong>å¼±å¼•ç”¨</strong>ï¼šå°†å¯¹è±¡ç”¨WeakReferenceè½¯å¼•ç”¨ç±»å‹çš„å¯¹è±¡åŒ…è£¹ï¼Œå¼±å¼•ç”¨è·Ÿæ²¡å¼•ç”¨å·®ä¸å¤šï¼Œ<strong>GCä¼šç›´æ¥å›æ”¶æ‰</strong>ï¼Œå¾ˆå°‘ç”¨</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>**è™šå¼•ç”¨ï¼š**è™šå¼•ç”¨ä¹Ÿç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨ï¼Œå®ƒæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œå‡ ä¹ä¸ç”¨</p><p><strong>finalize()æ–¹æ³•æœ€ç»ˆåˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»</strong></p><p>å³ä½¿åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘â€é˜¶æ®µï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†å†æ¬¡æ ‡è®°è¿‡ç¨‹ã€‚</p><p><strong>æ ‡è®°çš„å‰ææ˜¯å¯¹è±¡åœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸GC Rootsç›¸è¿æ¥çš„å¼•ç”¨é“¾ã€‚</strong></p><p><strong>1. ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶è¿›è¡Œä¸€æ¬¡ç­›é€‰ã€‚</strong></p><p>ç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ã€‚</p><p>å½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalizeæ–¹æ³•ï¼Œå¯¹è±¡å°†ç›´æ¥è¢«å›æ”¶ã€‚</p><p><strong>2. ç¬¬äºŒæ¬¡æ ‡è®°</strong></p><p>å¦‚æœè¿™ä¸ªå¯¹è±¡è¦†ç›–äº†finalizeæ–¹æ³•ï¼Œfinalizeæ–¹æ³•æ˜¯å¯¹è±¡è„±é€ƒæ­»äº¡å‘½è¿çš„æœ€åä¸€æ¬¡æœºä¼šï¼Œå¦‚æœå¯¹è±¡è¦åœ¨finalize()ä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·±ï¼Œåªè¦é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•çš„ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”å³å¯ï¼Œè­¬å¦‚æŠŠè‡ªå·±èµ‹å€¼ç»™æŸä¸ªç±»å˜é‡æˆ–å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œé‚£åœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶å®ƒå°†ç§»é™¤å‡ºâ€œå³å°†å›æ”¶â€çš„é›†åˆã€‚å¦‚æœå¯¹è±¡è¿™æ—¶å€™è¿˜æ²¡é€ƒè„±ï¼Œé‚£åŸºæœ¬ä¸Šå®ƒå°±çœŸçš„è¢«å›æ”¶äº†ã€‚</p><p>æ³¨æ„ï¼šä¸€ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡è°ƒç”¨finalizeæ–¹æ³•è‡ªæˆ‘æ•‘å‘½çš„æœºä¼šå°±ä¸€æ¬¡ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OOMTest</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//Userç±»éœ€è¦é‡å†™finalizeæ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token class-name">OOMTest</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å…³é—­èµ„æºï¼Œuserid=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;å³å°†è¢«å›æ”¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>finalize()æ–¹æ³•çš„è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œ ä¸ç¡®å®šæ€§å¤§ï¼Œ æ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼Œ å¦‚ä»Šå·²è¢«å®˜æ–¹æ˜ç¡®å£°æ˜ä¸ºä¸æ¨èä½¿ç”¨çš„è¯­æ³•ã€‚ æœ‰äº›èµ„æ–™æè¿°å®ƒé€‚åˆåšâ€œå…³é—­å¤–éƒ¨èµ„æºâ€ä¹‹ç±»çš„æ¸…ç†æ€§å·¥ä½œï¼Œ è¿™å®Œå…¨æ˜¯å¯¹finalize()æ–¹æ³•ç”¨é€”çš„ä¸€ç§è‡ªæˆ‘å®‰æ…°ã€‚ finalize()èƒ½åšçš„æ‰€æœ‰å·¥ä½œï¼Œ ä½¿ç”¨try-finallyæˆ–è€…å…¶ä»–æ–¹å¼éƒ½å¯ä»¥åšå¾—æ›´å¥½ã€æ›´åŠæ—¶ï¼Œ æ‰€ä»¥å»ºè®®å¤§å®¶å®Œå…¨å¯ä»¥å¿˜æ‰Javaè¯­è¨€é‡Œé¢çš„è¿™ä¸ªæ–¹æ³•ã€‚</p><p><strong>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»</strong></p><p>æ–¹æ³•åŒºä¸»è¦å›æ”¶çš„æ˜¯æ— ç”¨çš„ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»å‘¢ï¼Ÿ</p><p>ç±»éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢3ä¸ªæ¡ä»¶æ‰èƒ½ç®—æ˜¯ <strong>â€œæ— ç”¨çš„ç±»â€</strong> ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ ClassLoaderå·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</li></ul><p>â€‹</p></div><!--[--><!----><!--]--><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/pages/a3b500/" aria-label="JVMå†…å­˜æ¨¡å‹æ·±åº¦å‰–æä¸ä¼˜åŒ–"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->JVMå†…å­˜æ¨¡å‹æ·±åº¦å‰–æä¸ä¼˜åŒ–</div></a><a class="route-link nav-link next" href="/pages/a80a7f/" aria-label="JVMç±»åŠ è½½æœºåˆ¶"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">JVMç±»åŠ è½½æœºåˆ¶<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CcJZcE5q.js" defer></script>
  </body>
</html>
