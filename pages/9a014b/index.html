<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.26" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <title>RabbitMQ上手以及集群架构</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-CV-aSyL0.css" as="style"><link rel="stylesheet" href="/assets/style-CV-aSyL0.css">
    <link rel="modulepreload" href="/assets/app-CcJZcE5q.js"><link rel="modulepreload" href="/assets/index.html-o-IA65eG.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-CySwgr6W.js" as="script"><link rel="prefetch" href="/assets/index.html-DIQ6wV2c.js" as="script"><link rel="prefetch" href="/assets/index.html-DA9ZST6q.js" as="script"><link rel="prefetch" href="/assets/index.html-B1qwKQDM.js" as="script"><link rel="prefetch" href="/assets/index.html-QtYXnaPY.js" as="script"><link rel="prefetch" href="/assets/index.html-BoWZ1hiX.js" as="script"><link rel="prefetch" href="/assets/index.html-D1eqxnz4.js" as="script"><link rel="prefetch" href="/assets/index.html-Bkd8jpbq.js" as="script"><link rel="prefetch" href="/assets/index.html-CaPpN9fA.js" as="script"><link rel="prefetch" href="/assets/阿里云面试题.html-BdFdwHHT.js" as="script"><link rel="prefetch" href="/assets/index.html-Dar6C79p.js" as="script"><link rel="prefetch" href="/assets/index.html-3LHzgUol.js" as="script"><link rel="prefetch" href="/assets/index.html-CNyrWvjP.js" as="script"><link rel="prefetch" href="/assets/index.html-tMJw4xAU.js" as="script"><link rel="prefetch" href="/assets/index.html-BBna-ubM.js" as="script"><link rel="prefetch" href="/assets/index.html-CQDrMRFa.js" as="script"><link rel="prefetch" href="/assets/index.html-BHHkC0SB.js" as="script"><link rel="prefetch" href="/assets/index.html-BT27OHXI.js" as="script"><link rel="prefetch" href="/assets/index.html-Ph_N0RhT.js" as="script"><link rel="prefetch" href="/assets/index.html-C0SZgDj-.js" as="script"><link rel="prefetch" href="/assets/index.html-COW2J1ah.js" as="script"><link rel="prefetch" href="/assets/index.html-CwlZk0kb.js" as="script"><link rel="prefetch" href="/assets/index.html-mOUgrTfQ.js" as="script"><link rel="prefetch" href="/assets/index.html-StCMFG4Y.js" as="script"><link rel="prefetch" href="/assets/index.html-pkZ_qPdt.js" as="script"><link rel="prefetch" href="/assets/index.html-meFoXNUk.js" as="script"><link rel="prefetch" href="/assets/index.html-D6UDt-z1.js" as="script"><link rel="prefetch" href="/assets/index.html-C4CeTDFP.js" as="script"><link rel="prefetch" href="/assets/index.html-DJOa7j38.js" as="script"><link rel="prefetch" href="/assets/index.html-u2YQwqCK.js" as="script"><link rel="prefetch" href="/assets/index.html-BoiC8F1t.js" as="script"><link rel="prefetch" href="/assets/index.html-CSq9YTr5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cyr0Ht9E.js" as="script"><link rel="prefetch" href="/assets/index.html-CpAXHyhZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DLvEiH8j.js" as="script"><link rel="prefetch" href="/assets/index.html-DfVjwGrn.js" as="script"><link rel="prefetch" href="/assets/index.html-BhnlQTe0.js" as="script"><link rel="prefetch" href="/assets/index.html-B3Q99jzV.js" as="script"><link rel="prefetch" href="/assets/index.html-C_jS85gJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DTuYMkqZ.js" as="script"><link rel="prefetch" href="/assets/index.html-ByDsocQC.js" as="script"><link rel="prefetch" href="/assets/index.html-Dx60V46q.js" as="script"><link rel="prefetch" href="/assets/index.html-B2169YvJ.js" as="script"><link rel="prefetch" href="/assets/index.html-u7yWxVkO.js" as="script"><link rel="prefetch" href="/assets/index.html-BAcuX6ex.js" as="script"><link rel="prefetch" href="/assets/index.html-CKFJiaUe.js" as="script"><link rel="prefetch" href="/assets/index.html-BQolQXiO.js" as="script"><link rel="prefetch" href="/assets/index.html-CV5OM5nX.js" as="script"><link rel="prefetch" href="/assets/index.html-edSgNf-M.js" as="script"><link rel="prefetch" href="/assets/index.html-BfO_EaOy.js" as="script"><link rel="prefetch" href="/assets/index.html-nyRG_LTF.js" as="script"><link rel="prefetch" href="/assets/index.html-D-frKFlo.js" as="script"><link rel="prefetch" href="/assets/00.分布式事务组件Seata.html-Cpl05HCa.js" as="script"><link rel="prefetch" href="/assets/index.html-Cq20v4BB.js" as="script"><link rel="prefetch" href="/assets/index.html-BVORs3On.js" as="script"><link rel="prefetch" href="/assets/index.html-BP6aZUE6.js" as="script"><link rel="prefetch" href="/assets/index.html-B-3_fbg6.js" as="script"><link rel="prefetch" href="/assets/index.html-CpJC_HeG.js" as="script"><link rel="prefetch" href="/assets/index.html-DjnTf6fe.js" as="script"><link rel="prefetch" href="/assets/06.MySQL事务原理与优化最佳实践.html-D7z1G1-N.js" as="script"><link rel="prefetch" href="/assets/07.MySQL锁机制与优化实践以及MVCC底层原理剖析.html-BKAa643F.js" as="script"><link rel="prefetch" href="/assets/index.html-CxmzedXX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dzfk79WX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dn63XTEd.js" as="script"><link rel="prefetch" href="/assets/index.html-CzdtGl0g.js" as="script"><link rel="prefetch" href="/assets/index.html-9PiiOmcM.js" as="script"><link rel="prefetch" href="/assets/index.html-BmA5G_Wx.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBC源码与内核解析.html-DuPwqrAu.js" as="script"><link rel="prefetch" href="/assets/index.html-BQ7HKii8.js" as="script"><link rel="prefetch" href="/assets/index.html-Ba0Idv51.js" as="script"><link rel="prefetch" href="/assets/index.html-joJLtsXk.js" as="script"><link rel="prefetch" href="/assets/index.html-L8Hlw6sX.js" as="script"><link rel="prefetch" href="/assets/index.html-C8_gL8dh.js" as="script"><link rel="prefetch" href="/assets/index.html-6Tc1Q6ZE.js" as="script"><link rel="prefetch" href="/assets/index.html-VO0-ALK9.js" as="script"><link rel="prefetch" href="/assets/index.html-BPdXD1cL.js" as="script"><link rel="prefetch" href="/assets/index.html-j-8Qjm4N.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz_Qhpe9.js" as="script"><link rel="prefetch" href="/assets/index.html-CcaTKqjZ.js" as="script"><link rel="prefetch" href="/assets/index.html-y0YOCSWX.js" as="script"><link rel="prefetch" href="/assets/index.html-BdP5ezWY.js" as="script"><link rel="prefetch" href="/assets/index.html-C6GUmZlK.js" as="script"><link rel="prefetch" href="/assets/index.html-zkImwKAM.js" as="script"><link rel="prefetch" href="/assets/index.html-B-rM7PKP.js" as="script"><link rel="prefetch" href="/assets/index.html-Bdbd7zWB.js" as="script"><link rel="prefetch" href="/assets/index.html-PQLu_cdG.js" as="script"><link rel="prefetch" href="/assets/index.html-BaByp152.js" as="script"><link rel="prefetch" href="/assets/index.html-DQrw1sGU.js" as="script"><link rel="prefetch" href="/assets/404.html-Xl7f9Pk5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cim6WBqA.js" as="script"><link rel="prefetch" href="/assets/index.html-DBgI0Ctx.js" as="script"><link rel="prefetch" href="/assets/index.html-CjlsAUhS.js" as="script"><link rel="prefetch" href="/assets/index.html-DBEQHe26.js" as="script"><link rel="prefetch" href="/assets/index.html-BrqbaMMm.js" as="script"><link rel="prefetch" href="/assets/index.html-B_JMJTKH.js" as="script"><link rel="prefetch" href="/assets/index.html-8JHj6Ere.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script"><link rel="prefetch" href="/assets/SearchResult-FVi5R2x7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><!----><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="首页"><span class="font-icon icon circle-question" style=""></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link active" href="/pages/" aria-label="文档"><span class="font-icon icon circle-question" style=""></span>文档<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">分布式</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">00. Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">02. Elastic Search</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">03. Dubbo</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">04. Zookeeper</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">05.消息队列</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">00. Rabbit MQ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/pages/9a014b/" aria-label="RabbitMQ上手以及集群架构"><!---->RabbitMQ上手以及集群架构<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#mq介绍" aria-label="MQ介绍"><!---->MQ介绍<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#什么是mq-为什么要用mq" aria-label="什么是MQ？为什么要用MQ？"><!---->什么是MQ？为什么要用MQ？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#mq的优缺点" aria-label="MQ的优缺点"><!---->MQ的优缺点<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#几大mq产品特点比较" aria-label="几大MQ产品特点比较"><!---->几大MQ产品特点比较<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#rabbitmq安装" aria-label="RabbitMQ安装"><!---->RabbitMQ安装<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#实验环境" aria-label="实验环境"><!---->实验环境<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#版本选择" aria-label="版本选择"><!---->版本选择<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#安装erlang语言包" aria-label="安装Erlang语言包"><!---->安装Erlang语言包<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#安装rabbitmq" aria-label="安装RabbitMQ"><!---->安装RabbitMQ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#rabbitmq集群搭建" aria-label="RabbitMQ集群搭建"><!---->RabbitMQ集群搭建<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#搭建普通集群" aria-label="搭建普通集群"><!---->搭建普通集群<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#搭建镜像集群" aria-label="搭建镜像集群"><!---->搭建镜像集群<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/9a014b/#rabbitmq基础使用" aria-label="RabbitMQ基础使用"><!---->RabbitMQ基础使用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/def779/" aria-label="RabbitMQ使用中的常见问题"><!---->RabbitMQ使用中的常见问题<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/d02edd/" aria-label="RabbitMQ消费端异常处理"><!---->RabbitMQ消费端异常处理<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/b891f5/" aria-label="RabbitMQ编程模型"><!---->RabbitMQ编程模型<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/ae15fa/" aria-label="RabbitMQ高级使用场景"><!---->RabbitMQ高级使用场景<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">01. Kafka</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">02. Rocket MQ</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">容器</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">并发编程</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">微服务</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">性能调优</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">源码框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">算法</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">计算机网络</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">面试</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->RabbitMQ上手以及集群架构</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">江</span></span><span property="author" content="江"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-11-07T11:28:12.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 16 分钟</span><meta property="timeRequired" content="PT16M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#mq介绍">MQ介绍</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#什么是mq-为什么要用mq">什么是MQ？为什么要用MQ？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#mq的优缺点">MQ的优缺点</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#几大mq产品特点比较">几大MQ产品特点比较</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#rabbitmq安装">RabbitMQ安装</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#实验环境">实验环境</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#版本选择">版本选择</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#安装erlang语言包">安装Erlang语言包</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#安装rabbitmq">安装RabbitMQ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#rabbitmq集群搭建">RabbitMQ集群搭建</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#搭建普通集群">搭建普通集群</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#搭建镜像集群">搭建镜像集群</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#rabbitmq基础使用">RabbitMQ基础使用</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h2 id="mq介绍" tabindex="-1"><a class="header-anchor" href="#mq介绍"><span>MQ介绍</span></a></h2><blockquote><p>这一部分理论介绍，其实在每个MQ产品中都是大致相同的，可以参考RocketMQ的部分。</p></blockquote><h3 id="什么是mq-为什么要用mq" tabindex="-1"><a class="header-anchor" href="#什么是mq-为什么要用mq"><span>什么是MQ？为什么要用MQ？</span></a></h3><p><strong>MQ：MessageQueue</strong>，消息队列。 队列，是一种FIFO先进先出的数据结构。消息由生产者发送到MQ进行排队，然后按原来的顺序交由消息的消费者进行处理。QQ和微信就是典型的MQ。</p><p>MQ的作用主要有以下三个方面：</p><ul><li><p><strong>异步</strong></p><p>例子：快递员发快递，直接到客户家效率会很低。引入菜鸟驿站后，快递员只需要把快递放到菜鸟驿站，就可以继续发其他快递去了。客户再按自己的时间安排去菜鸟驿站取快递。</p><p>作用：异步能提高系统的响应速度、吞吐量。</p></li><li><p><strong>解耦</strong></p><p>例子：《Thinking in JAVA》很经典，但是都是英文，我们看不懂，所以需要编辑社，将文章翻译成其他语言，这样就可以完成英语与其他语言的交流。</p><p>作用：</p><p>1、服务之间进行解耦，才可以减少服务之间的影响。提高系统整体的稳定性以及可扩展性。</p><p>2、另外，解耦后可以实现数据分发。生产者发送一个消息后，可以由一个或者多个消费者进行消费，并且消费者的增加或者减少对生产者没有影响。</p></li><li><p><strong>削峰</strong></p><p>例子：长江每年都会涨水，但是下游出水口的速度是基本稳定的，所以会涨水。引入三峡大坝后，可以把水储存起来，下游慢慢排水。</p><p>作用：以稳定的系统资源应对突发的流量冲击。</p></li></ul><h3 id="mq的优缺点" tabindex="-1"><a class="header-anchor" href="#mq的优缺点"><span>MQ的优缺点</span></a></h3><p>上面MQ的所用也就是使用MQ的优点。 但是引入MQ也是有他的缺点的：</p><ul><li><strong>系统可用性降低</strong></li></ul><p>系统引入的外部依赖增多，系统的稳定性就会变差。一旦MQ宕机，对业务会产生影响。这就需要考虑如何保证MQ的高可用。</p><ul><li><strong>系统复杂度提高</strong></li></ul><p>引入MQ后系统的复杂度会大大提高。以前服务之间可以进行同步的服务调用，引入MQ后，会变为异步调用，数据的链路就会变得更复杂。并且还会带来其他一些问题。比如：<strong>如何保证消费不会丢失？不会被重复调用？怎么保证消息的顺序性等问题</strong>。</p><ul><li><strong>消息一致性问题</strong></li></ul><p>A系统处理完业务，通过MQ发送消息给B、C系统进行后续的业务处理。如果B系统处理成功，C系统处理失败怎么办？这就需要考虑如何保证消息数据处理的一致性。</p><h3 id="几大mq产品特点比较" tabindex="-1"><a class="header-anchor" href="#几大mq产品特点比较"><span>几大MQ产品特点比较</span></a></h3><p>常用的MQ产品包括Kafka、RabbitMQ和RocketMQ。我们对这三个产品做下简单的比较，重点需要理解他们的适用场景。</p><p><img src="https://img.jssjqd.cn/202212040127055.png" alt="image-20221204012712978"></p><blockquote><p>关于RabbitMQ的功能特性，可以在官网( https://www.rabbitmq.com/ )上看到，包含 Asynchronous Message(异步消息)、Developer Experience(开发体验)、Distributed Deployment(分布式部署)、Enterprise &amp; Cloud Ready(企业云部署)、Tools &amp; Plugins(工具和插件)、Management &amp; Monitoring(管理和监控)六大部分。所以其中的功能是相当丰富的，而我们肯定只能关注重点的部分内容，所以还是要经常到官网上去看看的。</p></blockquote><h2 id="rabbitmq安装" tabindex="-1"><a class="header-anchor" href="#rabbitmq安装"><span>RabbitMQ安装</span></a></h2><h3 id="实验环境" tabindex="-1"><a class="header-anchor" href="#实验环境"><span>实验环境</span></a></h3><p>准备了三台虚拟机 192.168.232.128~130，预备搭建三台机器的集群。</p><p>三台机器均预装CentOS7 操作系统。分别配置机器名 worker1，worker2，worker3。然后需要关闭防火墙(或者找到RabbitMQ的业务端口全部打开。 5672(amqp端口)；15672(http Api端口)；25672(集群通信端口))。</p><h3 id="版本选择" tabindex="-1"><a class="header-anchor" href="#版本选择"><span>版本选择</span></a></h3><p>RabbitMQ版本，通常与他的大的功能是有关系的。3.8.x版本主要是围绕Quorum Queue功能，而3.9.x版本主要是围绕Streams功能。目前还有3.10.x版本，还在rc阶段。我们这次选择3.9.15版本。</p><p>RabbitMQ是基于Erlang语言开发，所以安装前需要安装Erlang语言环境。需要注意下的是RabbitMQ与ErLang是有版本对应关系的。3.9.15版本的RabbitMQ只支持23.2以上到24.3版本的Erlang。</p><blockquote><p>Docker hub上也已经有官方上传的镜像</p></blockquote><h3 id="安装erlang语言包" tabindex="-1"><a class="header-anchor" href="#安装erlang语言包"><span>安装Erlang语言包</span></a></h3><p>这个语言包，在windows下的安装比较简单，是一个可执行程序，直接图形化安装就行了。</p><p>Linux上的安装稍微复杂，需要有非常多的依赖包。简单起见，可以下载rabbitmq提供的zero dependency版本。 下载地址 https://github.com/rabbitmq/erlang-rpm/releases</p><p>下载完成后，可以尝试使用下面的指令安装</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@worker1 tools<span class="token punctuation">]</span><span class="token comment"># rpm -ivh erlang-23.2.7-1.el7.x86_64.rpm </span>
警告：erlang-23.2.7-1.el7.x86_64.rpm: 头V4 RSA/SHA1 Signature, 密钥 ID 6026dfca: NOKEY
准备中<span class="token punctuation">..</span>.                          <span class="token comment">################################# [100%]</span>
正在升级/安装<span class="token punctuation">..</span>.
   <span class="token number">1</span>:erlang-23.2.7-1.el7              <span class="token comment">################################# [100%]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样Erlang语言包就安装完成了。 安装完后可以使用 erl -version 指令检测下erlang是否安装成功。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@worker1 tools<span class="token punctuation">]</span><span class="token comment"># erl -version</span>
Erlang <span class="token punctuation">(</span>SMP,ASYNC_THREADS,HIPE<span class="token punctuation">)</span> <span class="token punctuation">(</span>BEAM<span class="token punctuation">)</span> emulator version <span class="token number">11.1</span>.8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装rabbitmq" tabindex="-1"><a class="header-anchor" href="#安装rabbitmq"><span>安装RabbitMQ</span></a></h3><p>RabbitMQ的安装方式有很多，我们采用RPM安装包的方式。安装包可以到github仓库中下载发布包。</p><blockquote><p>下载地址：https://github.com/rabbitmq/rabbitmq-server/releases</p></blockquote><p>然后使用 rpm -Uvh 指令安装RabbitMQ的rpm包时，会报错，需要安装一个socat。</p><p>而这个socat我也在网上下载到了rpm安装包。 socat-1.7.3.2-1.1.el7.x86_64.rpm ，但是安装时，却提示需要tcp_wrappers依赖。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>[root@worker2 tools]# rpm -ivh socat-1.7.3.2-1.1.el7.x86_64.rpm 
警告：socat-1.7.3.2-1.1.el7.x86_64.rpm: 头V4 RSA/SHA1 Signature, 密钥 ID 87e360b8: NOKEY
错误：依赖检测失败：
        tcp_wrappers 被 socat-1.7.3.2-1.1.el7.x86_64 需要
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这时，当然可以按他的提示去安装依赖包。 但是我就没有这么做了。 直接用yum安装这个socat依赖。在使用yum时，可以做一个小配置，将yum源配置成阿里的yum源，这样速度会比较快。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup

<span class="token function">curl</span> <span class="token parameter variable">-o</span> /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo

yum makecache

然后安装socat
yum <span class="token function">install</span> socat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>socat安装完成后，就可以安装RabbitMQ了。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@worker1 tools<span class="token punctuation">]</span><span class="token comment"># rpm -Uvh rabbitmq-server-3.9.15-1.el7.noarch.rpm </span>
警告：rabbitmq-server-3.9.15-1.el7.noarch.rpm: 头V4 RSA/SHA512 Signature, 密钥 ID 6026dfca: NOKEY
准备中<span class="token punctuation">..</span>.                          <span class="token comment">################################# [100%]</span>
正在升级/安装<span class="token punctuation">..</span>.
   <span class="token number">1</span>:rabbitmq-server-3.9.15-1.el7     <span class="token comment">################################# [100%]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装完成后，可以查看下他的安装情况</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@worker1 share<span class="token punctuation">]</span><span class="token comment"># whereis rabbitmqctl</span>
rabbitmqctl: /usr/sbin/rabbitmqctl /usr/share/man/man8/rabbitmqctl.8.gz
<span class="token comment">##启动RabbitMQ服务</span>
<span class="token punctuation">[</span>root@worker1 rabbitmq<span class="token punctuation">]</span><span class="token comment"># service rabbitmq-server start</span>
Redirecting to /bin/systemctl start rabbitmq-server.service
Job <span class="token keyword">for</span> rabbitmq-server.service failed because the control process exited with error code. See <span class="token string">&quot;systemctl status rabbitmq-server.service&quot;</span> and <span class="token string">&quot;journalctl -xe&quot;</span> <span class="token keyword">for</span> details.
<span class="token comment">##查看服务状态</span>
<span class="token punctuation">[</span>root@worker1 rabbitmq<span class="token punctuation">]</span><span class="token comment"># service rabbitmq-server status</span>
Redirecting to /bin/systemctl status rabbitmq-server.service
● rabbitmq-server.service - RabbitMQ broker
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/rabbitmq-server.service<span class="token punctuation">;</span> disabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: activating <span class="token punctuation">(</span>start<span class="token punctuation">)</span> since 五 <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:47 CST<span class="token punctuation">;</span> 5s ago
 Main PID: <span class="token number">4327</span> <span class="token punctuation">(</span>beam.smp<span class="token punctuation">)</span>
   Status: <span class="token string">&quot;Startup in progress&quot;</span>
   CGroup: /system.slice/rabbitmq-server.service
           ├─4327 /usr/lib64/erlang/erts-11.1.8/bin/beam.smp <span class="token parameter variable">-W</span> w <span class="token parameter variable">-MBas</span> ageffcbf <span class="token parameter variable">-MHas</span> ageffcbf <span class="token parameter variable">-MBlmbcs</span> <span class="token number">512</span> <span class="token parameter variable">-MHlmbcs</span> <span class="token number">512</span> <span class="token parameter variable">-MMmcs</span> <span class="token number">30</span> <span class="token parameter variable">-P</span> <span class="token number">1048576</span> <span class="token parameter variable">-t</span> <span class="token number">5000000</span> <span class="token parameter variable">-stbt</span> db <span class="token parameter variable">-zdbbl</span> <span class="token number">128000</span> <span class="token parameter variable">-sbwt</span> <span class="token punctuation">..</span>.
           ├─4342 erl_child_setup <span class="token number">32768</span>
           ├─4390 inet_gethost <span class="token number">4</span>
           └─4391 inet_gethost <span class="token number">4</span>

<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.126900+08:00 <span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.229</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Feature flags: list of feature flags found:
<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.144773+08:00 <span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.229</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Feature flags:   <span class="token punctuation">[</span>x<span class="token punctuation">]</span> implicit_default_bindings
<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.144856+08:00 <span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.229</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Feature flags:   <span class="token punctuation">[</span>x<span class="token punctuation">]</span> maintenance_mode_status
<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.144903+08:00 <span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.229</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Feature flags:   <span class="token punctuation">[</span>x<span class="token punctuation">]</span> quorum_queue
<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.145025+08:00 <span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.229</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Feature flags:   <span class="token punctuation">[</span> <span class="token punctuation">]</span> stream_queue
<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.145075+08:00 <span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.229</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Feature flags:   <span class="token punctuation">[</span> <span class="token punctuation">]</span> user_limits
<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.145110+08:00 <span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.229</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Feature flags:   <span class="token punctuation">[</span>x<span class="token punctuation">]</span> virtual_host_metadata
<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.145154+08:00 <span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.229</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Feature flags: feature flag states written to disk: <span class="token function">yes</span>
<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.605843+08:00 <span class="token punctuation">[</span>noti<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.44</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Application syslog exited with reason: stopped
<span class="token number">4</span>月 <span class="token number">22</span> <span class="token number">17</span>:16:49 worker1 rabbitmq-server<span class="token punctuation">[</span><span class="token number">4327</span><span class="token punctuation">]</span>: <span class="token number">2022</span>-04-22 <span class="token number">17</span>:16:49.605930+08:00 <span class="token punctuation">[</span>noti<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">0.229</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> Logging: switching to configured handler<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> following messages may not be<span class="token punctuation">..</span>. log output
Hint: Some lines were ellipsized, use <span class="token parameter variable">-l</span> to show <span class="token keyword">in</span> full.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>其他常用的启停操作：</p><p>rabbitmq-server -deched --后台启动服务</p><p>rabbitmqctl start_app --启动服务</p><p>rabbitmqctl stop_app --关闭服务</p></blockquote><p>这样RabbitMQ服务就启动完成了。 之后可以配置下打开他的Web管理页面：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@worker1 rabbitmq<span class="token punctuation">]</span><span class="token comment"># rabbitmq-plugins enable rabbitmq_management </span>
Enabling plugins on <span class="token function">node</span> rabbit@worker1:
rabbitmq_management
The following plugins have been configured:
  rabbitmq_management
  rabbitmq_management_agent
  rabbitmq_web_dispatch
Applying plugin configuration to rabbit@worker1<span class="token punctuation">..</span>.
The following plugins have been enabled:
  rabbitmq_management
  rabbitmq_management_agent
  rabbitmq_web_dispatch

<span class="token builtin class-name">set</span> <span class="token number">3</span> plugins.
Offline change<span class="token punctuation">;</span> changes will take effect at broker restart.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，这时需要重启RabbitMQ服务才能生效。重启后，就可以访问Web控制台了。 访问端口192.168.232.129：15672。</p><p>这时，可以使用默认的guest/guest用户登录。 但是注意下，默认情况下，只允许在localhost本地登录，远程访问是无法登录的。这时，可以创建一个管理员账户来登录。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@worker1 ~<span class="token punctuation">]</span><span class="token comment"># rabbitmqctl add_user admin admin</span>
Adding user <span class="token string">&quot;admin&quot;</span> <span class="token punctuation">..</span>.
Done. Don<span class="token string">&#39;t forget to grant the user permissions to some virtual hosts! See &#39;</span>rabbitmqctl <span class="token builtin class-name">help</span> set_permissions&#39; to learn more.
<span class="token punctuation">[</span>root@worker2 tools<span class="token punctuation">]</span><span class="token comment"># rabbitmqctl set_permissions -p / admin &quot;.&quot; &quot;.&quot; &quot;.*&quot;</span>
Setting permissions <span class="token keyword">for</span> user <span class="token string">&quot;admin&quot;</span> <span class="token keyword">in</span> vhost <span class="token string">&quot;/&quot;</span> <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@worker2 tools<span class="token punctuation">]</span><span class="token comment"># rabbitmqctl set_user_tags admin administrator</span>
Setting tags <span class="token keyword">for</span> user <span class="token string">&quot;admin&quot;</span> to <span class="token punctuation">[</span>administrator<span class="token punctuation">]</span> <span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样就可以用admin/admin用户登录Web控制台了。</p><h2 id="rabbitmq集群搭建" tabindex="-1"><a class="header-anchor" href="#rabbitmq集群搭建"><span>RabbitMQ集群搭建</span></a></h2><p>在RabbitMQ中，一个节点的服务其实也是作为一个集群来处理的，在web控制台的admin-&gt; cluster中可以看到集群的名字，并且可以在页面上修改。而多节点的集群有两种方式</p><ul><li><p><strong>普通集群模式</strong>：</p><p>这种模式使用Erlang语言天生具备的集群方式搭建。这种集群模式下，集群的各个节点之间只会有相同的元数据，即队列结构，而消息不会进行冗余，只存在一个节点中。消费时，如果消费的不是存有数据的节点， RabbitMQ会临时在节点之间进行数据传输，将消息从存有数据的节点传输到消费的节点。</p><p>很显然，这种集群模式的消息可靠性不是很高。因为如果其中有个节点服务宕机了，那这个节点上的数据就无法消费了，需要等到这个节点服务恢复后才能消费，而这时，消费者端已经消费过的消息就有可能给不了服务端正确应答，服务起来后，就会再次消费这些消息，造成这部分消息重复消费。 另外，如果消息没有做持久化，重启就消息就会丢失。</p><p>并且，这种集群模式也不支持高可用，即当某一个节点服务挂了后，需要手动重启服务，才能保证这一部分消息能正常消费。</p><p>所以这种集群模式只适合一些对消息安全性不是很高的场景。而在使用这种模式时，消费者应该尽量的连接上每一个节点，减少消息在集群中的传输。</p></li><li><p><strong>镜像模式</strong>：</p><p>这种模式是在普通集群模式基础上的一种增强方案，这也就是RabbitMQ的官方HA高可用方案。需要在搭建了普通集群之后再补充搭建。其本质区别在于，这种模式会在镜像节点中间主动进行消息同步，而不是在客户端拉取消息时临时同步。</p><p>并且在集群内部有一个算法会选举产生master和slave，当一个master挂了后，也会自动选出一个来。从而给整个集群提供高可用能力。</p><p>这种模式的消息可靠性更高，因为每个节点上都存着全量的消息。而他的弊端也是明显的，集群内部的网络带宽会被这种同步通讯大量的消耗，进而降低整个集群的性能。这种模式下，队列数量最好不要过多。</p></li></ul><h3 id="搭建普通集群" tabindex="-1"><a class="header-anchor" href="#搭建普通集群"><span>搭建普通集群</span></a></h3><p>1：需要同步集群节点中的cookie。</p><p>默认会在 /var/lib/rabbitmq/目录下生成一个.erlang.cookie。 里面有一个字符串。我们要做的就是保证集群中三个节点的这个cookie字符串一致。</p><p>我们实验中将worker1和worker3加入到worker2的RabbitMQ集群中，所以将worker2的.erlang.cookie文件分发到worker1和worker3。</p><p>2：将worker1的服务加入到worker2的集群中。</p><p>首先需要保证worker1上的rabbitmq服务是正常启动的。 然后执行以下指令：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@worker1 rabbitmq<span class="token punctuation">]</span><span class="token comment"># rabbitmqctl stop_app</span>
Stopping rabbit application on <span class="token function">node</span> rabbit@worker1 <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@worker1 rabbitmq<span class="token punctuation">]</span><span class="token comment"># rabbitmqctl join_cluster --ram rabbit@worker2</span>
Clustering <span class="token function">node</span> rabbit@worker1 with rabbit@worker2
<span class="token punctuation">[</span>root@worker1 rabbitmq<span class="token punctuation">]</span><span class="token comment"># rabbitmqctl start_app</span>
Starting <span class="token function">node</span> rabbit@worker1 <span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>--ram 表示以Ram节点加入集群。RabbitMQ的集群节点分为disk和ram。disk节点会将元数据保存到硬盘当中，而ram节点只是在内存中保存元数据。</p><p>1、由于ram节点减少了很多与硬盘的交互，所以，ram节点的元数据使用性能会比较高。但是，同时，这也意味着元数据的安全性是不如disk节点的。在我们这个集群中，worker1和worker3都以ram节点的身份加入到worker2集群里，因此，是存在单点故障的。如果worker2节点服务崩溃，那么元数据就有可能丢失。在企业进行部署时，性能与安全性需要自己进行平衡。</p><p>2、这里说的元数据仅仅只包含交换机、队列等的定义，而不包含具体的消息。因此，ram节点的性能提升，仅仅体现在对元数据进行管理时，比如修改队列queue，交换机exchange，虚拟机vhosts等时，与消息的生产和消费速度无关。</p><p>3、如果一个集群中，全部都是ram节点，那么元数据就有可能丢失。这会造成集群停止之后就启动不起来了。RabbitMQ会尽量阻止创建一个全是ram节点的集群，但是并不能彻底阻止。所以，综合考虑，官方其实并不建议使用ram节点，更推荐保证集群中节点的资源投入，使用disk节点。</p></blockquote><p>然后同样把worer3上的rabbitmq加入到worker2的集群中。</p><p>加入完成后，可以在worker2的Web管理界面上看到集群的节点情况：</p><p><img src="https://img.jssjqd.cn/202212040127829.png" alt="image-20221204012725683"></p><blockquote><p>也可以用后台指令查看集群状态 rabbitmqctl cluster_status</p></blockquote><h3 id="搭建镜像集群" tabindex="-1"><a class="header-anchor" href="#搭建镜像集群"><span>搭建镜像集群</span></a></h3><p>这样就完成了普通集群的搭建。 再此基础上，可以继续搭建<strong>镜像集群</strong>。</p><p>通常在生产环境中，为了减少RabbitMQ集群之间的数据传输，在配置镜像策略时，会针对固定的虚拟主机virtual host来配置。</p><blockquote><p>RabbitMQ中的virtual host可以类比为MySQL中的库，针对每个虚拟主机，可以配置不同的权限、策略等。并且不同虚拟主机之间的数据是相互隔离的。</p></blockquote><p>我们首先创建一个/mirror的虚拟主机，然后再添加给对应的镜像策略：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>[root@worker2 rabbitmq]# rabbitmqctl add_vhost /mirror
Adding vhost &quot;/mirror&quot; ...
[root@worker2 rabbitmq]# rabbitmqctl set_policy ha-all --vhost &quot;/mirror&quot; &quot;^&quot; &#39;{&quot;ha-mode&quot;:&quot;all&quot;}&#39;
Setting policy &quot;ha-all&quot; for pattern &quot;^&quot; to &quot;{&quot;ha-mode&quot;:&quot;all&quot;}&quot; with priority &quot;0&quot; for vhost &quot;/mirror&quot; ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样，这些配置的策略也可以在Web控制台操作。另外也提供了HTTP API来进行这些操作。</p><p><img src="https://img.jssjqd.cn/202212040127657.png" alt="image-20221204012735597"></p><blockquote><p>这些参数需要大致了解下。其中，pattern是队列的匹配规则, ^表示全部匹配。 ^ ha \ 这样的配置表示以ha开头。通常就用虚拟主机来区分就够了，这个队列匹配规则就配置成全匹配。</p><p>然后几个关键的参数：</p><p>HA mode: 可选值 all , exactly, nodes。生产上通常为了保证高可用，就配all</p><ul><li>all : 队列镜像到集群中的所有节点。当新节点加入集群时，队列也会被镜像到这个节点。</li><li>exactly : 需要搭配一个数字类型的参数(ha-params)。队列镜像到集群中指定数量的节点。如果集群内节点数少于这个数字，则队列镜像到集群内的所有节点。如果集群内节点少于这个数，当一个包含镜像的节点停止服务后，新的镜像就不会去另外找节点进行镜像备份了。</li><li>nodes: 需要搭配一个字符串类型的参数。将队列镜像到指定的节点上。如果指定的队列不在集群中，不会报错。当声明队列时，如果指定的所有镜像节点都不在线，那队列会被创建在发起声明的客户端节点上。</li></ul><p>还有其他很多参数，可以后面慢慢再了解。</p></blockquote><p>通常镜像模式的集群已经足够满足大部分的生产场景了。虽然他对系统资源消耗比较高，但是在生产环境中，系统的资源都是会做预留的，所以正常的使用是没有问题的。但是在做业务集成时，还是需要注意队列数量不宜过多，并且尽量不要让RabbitMQ产生大量的消息堆积。</p><blockquote><p>这样搭建起来的RabbitMQ已经具备了集群特性，往任何一个节点上发送消息，消息都会及时同步到各个节点中。而在实际企业部署时，往往会以RabbitMQ的镜像队列作为基础，再增加一些运维手段，进一步提高集群的安全性和实用性。</p><p>例如，增加keepalived保证每个RabbitMQ的稳定性，当某一个节点上的RabbitMQ服务崩溃时，可以及时重新启动起来。另外，也可以增加HA-proxy来做前端的负载均衡，通过HA-proxy增加一个前端转发的虚拟节点，应用可以像使用一个单点服务一样使用一个RabbitMQ集群。这些运维方案我们就不做过多介绍了，有兴趣可以自己了解下。</p></blockquote><h3 id="rabbitmq基础使用" tabindex="-1"><a class="header-anchor" href="#rabbitmq基础使用"><span>RabbitMQ基础使用</span></a></h3><p>RabbitMQ搭建完成后，可以在Web控制台上选择Exchange或者Queue来发送消息了，我们可以简单体验下，也可以留到下一部分编程模型时再深入体验。</p><p>例如，先在Admin菜单，配置admin用户可以操作/mirror虚拟机。</p><p><img src="https://img.jssjqd.cn/202212040127215.png" alt="image-20221204012744908"></p><p>然后，创建一个经典队列。</p><p><img src="https://img.jssjqd.cn/202212040127932.png" alt="image-20221204012751095"></p><p>创建完成后，选择这个test1队列，就可以在页面上直接发送消息以及消费消息了。</p><p><img src="https://img.jssjqd.cn/202212040128813.png" alt="image-20221204012800356"></p><blockquote><p>在整体使用过程中你会发现，对于队列，有Classic、Quorum、Stream三种类型，其中，Classic和Quorum两种类型，使用上几乎是没有什么区别的。但是Stream队列就无法直接消费消息了。这种区别也会带到后面的使用过程中。</p></blockquote><p>然后，RabbitMQ的各种管理功能，整理上还是非常简单的，几乎所有的配置都可以在Web管理页面上直观的看到，并直接完成操作。同时，这些管理功能，也都可以通过后端的命令行工具进行。在进行体验的过程中，也可以自行尝试了解后端配置的各种指令。每个指令都有help帮助文档，大家可以自行尝试了解。</p></div><!--[--><!----><!--]--><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="route-link nav-link next" href="/pages/def779/" aria-label="RabbitMQ使用中的常见问题"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">RabbitMQ使用中的常见问题<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CcJZcE5q.js" defer></script>
  </body>
</html>
