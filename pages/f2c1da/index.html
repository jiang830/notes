<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/pages/f2c1da/"><meta property="og:site_name" content="å­¦ä¹ ç¬”è®°"><meta property="og:title" content="Redisç¼“å­˜è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–"><meta property="og:description" content="å¤šçº§ç¼“å­˜æ¶æ„ ç¼“å­˜ç©¿é€ ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®ï¼Œ ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚éƒ½ä¸ä¼šå‘½ä¸­ï¼Œé€šå¸¸å‡ºäºå®¹é”™çš„è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜å±‚ã€‚ ç¼“å­˜ç©¿é€å°†å¯¼è‡´ä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œ å¤±å»äº†ç¼“å­˜ä¿æŠ¤åç«¯å­˜å‚¨çš„æ„ä¹‰ã€‚ é€ æˆç¼“å­˜ç©¿é€çš„åŸºæœ¬åŸå› æœ‰ä¸¤ä¸ªï¼š"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-08-03T16:58:58.000Z"><meta property="article:author" content="æ±Ÿ"><meta property="article:published_time" content="2022-10-21T23:35:03.000Z"><meta property="article:modified_time" content="2023-08-03T16:58:58.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redisç¼“å­˜è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–","image":[""],"datePublished":"2022-10-21T23:35:03.000Z","dateModified":"2023-08-03T16:58:58.000Z","author":[{"@type":"Person","name":"æ±Ÿ"}]}</script><title>Redisç¼“å­˜è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ– | å­¦ä¹ ç¬”è®°</title><meta name="description" content="å¤šçº§ç¼“å­˜æ¶æ„ ç¼“å­˜ç©¿é€ ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®ï¼Œ ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚éƒ½ä¸ä¼šå‘½ä¸­ï¼Œé€šå¸¸å‡ºäºå®¹é”™çš„è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜å±‚ã€‚ ç¼“å­˜ç©¿é€å°†å¯¼è‡´ä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œ å¤±å»äº†ç¼“å­˜ä¿æŠ¤åç«¯å­˜å‚¨çš„æ„ä¹‰ã€‚ é€ æˆç¼“å­˜ç©¿é€çš„åŸºæœ¬åŸå› æœ‰ä¸¤ä¸ªï¼š">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-850a8bcc.css" as="style"><link rel="stylesheet" href="/assets/style-850a8bcc.css">
    <link rel="modulepreload" href="/assets/app-6d45e392.js"><link rel="modulepreload" href="/assets/index.html-02980b5f.js"><link rel="modulepreload" href="/assets/index.html-ce518419.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/index.html-bba30501.js" as="script"><link rel="prefetch" href="/assets/index.html-6e9240b9.js" as="script"><link rel="prefetch" href="/assets/index.html-475cb0e6.js" as="script"><link rel="prefetch" href="/assets/index.html-df2a795e.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-6373254a.js" as="script"><link rel="prefetch" href="/assets/index.html-f49d6e12.js" as="script"><link rel="prefetch" href="/assets/index.html-061b9a53.js" as="script"><link rel="prefetch" href="/assets/index.html-9a702514.js" as="script"><link rel="prefetch" href="/assets/index.html-3c8399ed.js" as="script"><link rel="prefetch" href="/assets/index.html-8bac4fe2.js" as="script"><link rel="prefetch" href="/assets/index.html-a0b7d616.js" as="script"><link rel="prefetch" href="/assets/index.html-84ef939d.js" as="script"><link rel="prefetch" href="/assets/index.html-87ed9aa0.js" as="script"><link rel="prefetch" href="/assets/index.html-bde3909f.js" as="script"><link rel="prefetch" href="/assets/index.html-ef85629f.js" as="script"><link rel="prefetch" href="/assets/index.html-2bc4d19e.js" as="script"><link rel="prefetch" href="/assets/index.html-a0023da4.js" as="script"><link rel="prefetch" href="/assets/index.html-758b8de4.js" as="script"><link rel="prefetch" href="/assets/index.html-b3092d02.js" as="script"><link rel="prefetch" href="/assets/index.html-65bf5569.js" as="script"><link rel="prefetch" href="/assets/index.html-110bf219.js" as="script"><link rel="prefetch" href="/assets/index.html-4dbee09d.js" as="script"><link rel="prefetch" href="/assets/index.html-cc9d808d.js" as="script"><link rel="prefetch" href="/assets/index.html-b39fa39e.js" as="script"><link rel="prefetch" href="/assets/index.html-9997c7c4.js" as="script"><link rel="prefetch" href="/assets/index.html-bb210c51.js" as="script"><link rel="prefetch" href="/assets/index.html-2b609943.js" as="script"><link rel="prefetch" href="/assets/index.html-a385b3e2.js" as="script"><link rel="prefetch" href="/assets/index.html-d27602b9.js" as="script"><link rel="prefetch" href="/assets/index.html-824c3f2b.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-db1bbf23.js" as="script"><link rel="prefetch" href="/assets/index.html-e1b95bee.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-04738cc4.js" as="script"><link rel="prefetch" href="/assets/index.html-2b42c9a6.js" as="script"><link rel="prefetch" href="/assets/50.å¾®æœåŠ¡ç½‘å…³æ•´åˆOAuth2.0æˆæƒä¸­å¿ƒ.html-db62c592.js" as="script"><link rel="prefetch" href="/assets/index.html-4121d5d7.js" as="script"><link rel="prefetch" href="/assets/index.html-57c7f32a.js" as="script"><link rel="prefetch" href="/assets/index.html-c8cc8279.js" as="script"><link rel="prefetch" href="/assets/index.html-cdad1aaf.js" as="script"><link rel="prefetch" href="/assets/index.html-0a2b44f0.js" as="script"><link rel="prefetch" href="/assets/index.html-f48dce59.js" as="script"><link rel="prefetch" href="/assets/index.html-4afd42c7.js" as="script"><link rel="prefetch" href="/assets/index.html-c2c6322c.js" as="script"><link rel="prefetch" href="/assets/index.html-d40fb462.js" as="script"><link rel="prefetch" href="/assets/index.html-4796b4d0.js" as="script"><link rel="prefetch" href="/assets/index.html-ff53f267.js" as="script"><link rel="prefetch" href="/assets/index.html-4d48b6e7.js" as="script"><link rel="prefetch" href="/assets/index.html-22237176.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-2f991798.js" as="script"><link rel="prefetch" href="/assets/index.html-f80752d4.js" as="script"><link rel="prefetch" href="/assets/index.html-f68ff14e.js" as="script"><link rel="prefetch" href="/assets/index.html-399eb32a.js" as="script"><link rel="prefetch" href="/assets/index.html-a6aff505.js" as="script"><link rel="prefetch" href="/assets/index.html-acd4067d.js" as="script"><link rel="prefetch" href="/assets/index.html-67341afa.js" as="script"><link rel="prefetch" href="/assets/index.html-5e21be11.js" as="script"><link rel="prefetch" href="/assets/index.html-0d4b784f.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-71c0f603.js" as="script"><link rel="prefetch" href="/assets/index.html-73a2dd1b.js" as="script"><link rel="prefetch" href="/assets/index.html-672da43e.js" as="script"><link rel="prefetch" href="/assets/index.html-f0edeb3c.js" as="script"><link rel="prefetch" href="/assets/index.html-ab54a6f3.js" as="script"><link rel="prefetch" href="/assets/index.html-d4be5d59.js" as="script"><link rel="prefetch" href="/assets/index.html-80b92347.js" as="script"><link rel="prefetch" href="/assets/index.html-0da9e1c6.js" as="script"><link rel="prefetch" href="/assets/index.html-5fbc8245.js" as="script"><link rel="prefetch" href="/assets/index.html-d9a6d1be.js" as="script"><link rel="prefetch" href="/assets/index.html-884cd1cf.js" as="script"><link rel="prefetch" href="/assets/index.html-3cc02b39.js" as="script"><link rel="prefetch" href="/assets/index.html-9d9f6e80.js" as="script"><link rel="prefetch" href="/assets/index.html-c4985c46.js" as="script"><link rel="prefetch" href="/assets/index.html-0ad213fd.js" as="script"><link rel="prefetch" href="/assets/index.html-65437f8f.js" as="script"><link rel="prefetch" href="/assets/index.html-26d20cf1.js" as="script"><link rel="prefetch" href="/assets/index.html-f7b308d3.js" as="script"><link rel="prefetch" href="/assets/index.html-8ef93226.js" as="script"><link rel="prefetch" href="/assets/index.html-180336df.js" as="script"><link rel="prefetch" href="/assets/index.html-9bfca606.js" as="script"><link rel="prefetch" href="/assets/index.html-db2aad34.js" as="script"><link rel="prefetch" href="/assets/index.html-48009edc.js" as="script"><link rel="prefetch" href="/assets/index.html-b94e89dc.js" as="script"><link rel="prefetch" href="/assets/index.html-fc9d4c27.js" as="script"><link rel="prefetch" href="/assets/index.html-a2c03602.js" as="script"><link rel="prefetch" href="/assets/index.html-ddd0848e.js" as="script"><link rel="prefetch" href="/assets/index.html-0c150beb.js" as="script"><link rel="prefetch" href="/assets/index.html-2fc65ea1.js" as="script"><link rel="prefetch" href="/assets/index.html-e2aafaa6.js" as="script"><link rel="prefetch" href="/assets/index.html-91e14f17.js" as="script"><link rel="prefetch" href="/assets/index.html-bf422f4d.js" as="script"><link rel="prefetch" href="/assets/index.html-b5d81e05.js" as="script"><link rel="prefetch" href="/assets/index.html-4cbb1b2b.js" as="script"><link rel="prefetch" href="/assets/index.html-d39437a2.js" as="script"><link rel="prefetch" href="/assets/index.html-2789544e.js" as="script"><link rel="prefetch" href="/assets/index.html-2f2d3b09.js" as="script"><link rel="prefetch" href="/assets/index.html-6a2d4ab8.js" as="script"><link rel="prefetch" href="/assets/index.html-ff2f82d1.js" as="script"><link rel="prefetch" href="/assets/index.html-9905b46e.js" as="script"><link rel="prefetch" href="/assets/index.html-6117fdaf.js" as="script"><link rel="prefetch" href="/assets/index.html-d5a2010d.js" as="script"><link rel="prefetch" href="/assets/index.html-0f6a6f5a.js" as="script"><link rel="prefetch" href="/assets/index.html-50f991ab.js" as="script"><link rel="prefetch" href="/assets/index.html-14e38234.js" as="script"><link rel="prefetch" href="/assets/index.html-cf4aeb41.js" as="script"><link rel="prefetch" href="/assets/index.html-43045d2a.js" as="script"><link rel="prefetch" href="/assets/index.html-ca943502.js" as="script"><link rel="prefetch" href="/assets/index.html-69aa5bb5.js" as="script"><link rel="prefetch" href="/assets/index.html-606cc55b.js" as="script"><link rel="prefetch" href="/assets/index.html-338af8a1.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-d4af4d18.js" as="script"><link rel="prefetch" href="/assets/index.html-259fa2ec.js" as="script"><link rel="prefetch" href="/assets/index.html-6c113e89.js" as="script"><link rel="prefetch" href="/assets/index.html-d6d41c6d.js" as="script"><link rel="prefetch" href="/assets/index.html-23244f48.js" as="script"><link rel="prefetch" href="/assets/index.html-463942ed.js" as="script"><link rel="prefetch" href="/assets/index.html-336a7153.js" as="script"><link rel="prefetch" href="/assets/index.html-cf2d7eef.js" as="script"><link rel="prefetch" href="/assets/index.html-f68d4ad9.js" as="script"><link rel="prefetch" href="/assets/index.html-973d40e6.js" as="script"><link rel="prefetch" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-6a62419d.js" as="script"><link rel="prefetch" href="/assets/404.html-f4f9fdbe.js" as="script"><link rel="prefetch" href="/assets/index.html-ccedd87a.js" as="script"><link rel="prefetch" href="/assets/index.html-6b635626.js" as="script"><link rel="prefetch" href="/assets/index.html-f3c1ea90.js" as="script"><link rel="prefetch" href="/assets/index.html-39a19522.js" as="script"><link rel="prefetch" href="/assets/index.html-4e6ecfce.js" as="script"><link rel="prefetch" href="/assets/index.html-c37db087.js" as="script"><link rel="prefetch" href="/assets/index.html-7f2f880b.js" as="script"><link rel="prefetch" href="/assets/index.html-f8546af5.js" as="script"><link rel="prefetch" href="/assets/index.html-36e6cb8c.js" as="script"><link rel="prefetch" href="/assets/index.html-27371869.js" as="script"><link rel="prefetch" href="/assets/index.html-4c15c6fc.js" as="script"><link rel="prefetch" href="/assets/index.html-116aca17.js" as="script"><link rel="prefetch" href="/assets/index.html-2a643c60.js" as="script"><link rel="prefetch" href="/assets/index.html-21236a9b.js" as="script"><link rel="prefetch" href="/assets/index.html-b238d9f4.js" as="script"><link rel="prefetch" href="/assets/index.html-46e55ee3.js" as="script"><link rel="prefetch" href="/assets/index.html-6d53c5d1.js" as="script"><link rel="prefetch" href="/assets/index.html-778d883e.js" as="script"><link rel="prefetch" href="/assets/index.html-d798a209.js" as="script"><link rel="prefetch" href="/assets/index.html-ab8b6fb7.js" as="script"><link rel="prefetch" href="/assets/index.html-200c9b62.js" as="script"><link rel="prefetch" href="/assets/index.html-9fa57983.js" as="script"><link rel="prefetch" href="/assets/index.html-30ef2e2b.js" as="script"><link rel="prefetch" href="/assets/index.html-2a6dfb95.js" as="script"><link rel="prefetch" href="/assets/index.html-3fd779a7.js" as="script"><link rel="prefetch" href="/assets/index.html-0118c6d9.js" as="script"><link rel="prefetch" href="/assets/index.html-942ff972.js" as="script"><link rel="prefetch" href="/assets/index.html-41b511cf.js" as="script"><link rel="prefetch" href="/assets/index.html-2be3f4a2.js" as="script"><link rel="prefetch" href="/assets/index.html-4b04c8af.js" as="script"><link rel="prefetch" href="/assets/index.html-940c35a3.js" as="script"><link rel="prefetch" href="/assets/index.html-f3f33451.js" as="script"><link rel="prefetch" href="/assets/index.html-1a8f23e9.js" as="script"><link rel="prefetch" href="/assets/index.html-c93e5cd2.js" as="script"><link rel="prefetch" href="/assets/index.html-6508b456.js" as="script"><link rel="prefetch" href="/assets/index.html-ed0506a1.js" as="script"><link rel="prefetch" href="/assets/index.html-31f68f17.js" as="script"><link rel="prefetch" href="/assets/index.html-d92890df.js" as="script"><link rel="prefetch" href="/assets/index.html-b2b41008.js" as="script"><link rel="prefetch" href="/assets/index.html-ac4c44c1.js" as="script"><link rel="prefetch" href="/assets/index.html-0ef231d8.js" as="script"><link rel="prefetch" href="/assets/index.html-bab80dce.js" as="script"><link rel="prefetch" href="/assets/index.html-d9a5fb97.js" as="script"><link rel="prefetch" href="/assets/index.html-8d390098.js" as="script"><link rel="prefetch" href="/assets/index.html-17f4d67e.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-761328ea.js" as="script"><link rel="prefetch" href="/assets/index.html-e524b9d3.js" as="script"><link rel="prefetch" href="/assets/index.html-6c6e9139.js" as="script"><link rel="prefetch" href="/assets/index.html-60c3031e.js" as="script"><link rel="prefetch" href="/assets/index.html-c2e013fa.js" as="script"><link rel="prefetch" href="/assets/index.html-1c11e766.js" as="script"><link rel="prefetch" href="/assets/index.html-d7321efe.js" as="script"><link rel="prefetch" href="/assets/index.html-5977f8c1.js" as="script"><link rel="prefetch" href="/assets/index.html-1b4da397.js" as="script"><link rel="prefetch" href="/assets/index.html-8e89cd00.js" as="script"><link rel="prefetch" href="/assets/index.html-02d6c807.js" as="script"><link rel="prefetch" href="/assets/index.html-46fae025.js" as="script"><link rel="prefetch" href="/assets/index.html-69cd3c06.js" as="script"><link rel="prefetch" href="/assets/index.html-db3fe939.js" as="script"><link rel="prefetch" href="/assets/index.html-3d984116.js" as="script"><link rel="prefetch" href="/assets/index.html-997bb951.js" as="script"><link rel="prefetch" href="/assets/index.html-68bb7856.js" as="script"><link rel="prefetch" href="/assets/index.html-a700f4f8.js" as="script"><link rel="prefetch" href="/assets/index.html-d18b242d.js" as="script"><link rel="prefetch" href="/assets/index.html-b4f348dd.js" as="script"><link rel="prefetch" href="/assets/index.html-be6c2183.js" as="script"><link rel="prefetch" href="/assets/index.html-a2cee25a.js" as="script"><link rel="prefetch" href="/assets/index.html-730e32b9.js" as="script"><link rel="prefetch" href="/assets/index.html-2997bb3d.js" as="script"><link rel="prefetch" href="/assets/index.html-df970cde.js" as="script"><link rel="prefetch" href="/assets/index.html-f3eadbbe.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-fc3255db.js" as="script"><link rel="prefetch" href="/assets/index.html-bf12af7e.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-73b02be7.js" as="script"><link rel="prefetch" href="/assets/index.html-ef6931ff.js" as="script"><link rel="prefetch" href="/assets/50.å¾®æœåŠ¡ç½‘å…³æ•´åˆOAuth2.0æˆæƒä¸­å¿ƒ.html-24d3145c.js" as="script"><link rel="prefetch" href="/assets/index.html-f60086f0.js" as="script"><link rel="prefetch" href="/assets/index.html-9100e44f.js" as="script"><link rel="prefetch" href="/assets/index.html-0381a938.js" as="script"><link rel="prefetch" href="/assets/index.html-097d63c8.js" as="script"><link rel="prefetch" href="/assets/index.html-22bef521.js" as="script"><link rel="prefetch" href="/assets/index.html-83304cce.js" as="script"><link rel="prefetch" href="/assets/index.html-aec4357f.js" as="script"><link rel="prefetch" href="/assets/index.html-b42efc62.js" as="script"><link rel="prefetch" href="/assets/index.html-73832354.js" as="script"><link rel="prefetch" href="/assets/index.html-48221998.js" as="script"><link rel="prefetch" href="/assets/index.html-37ceb737.js" as="script"><link rel="prefetch" href="/assets/index.html-07c606ad.js" as="script"><link rel="prefetch" href="/assets/index.html-b4e14ecb.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-d97565a5.js" as="script"><link rel="prefetch" href="/assets/index.html-c43a50df.js" as="script"><link rel="prefetch" href="/assets/index.html-8cb8123b.js" as="script"><link rel="prefetch" href="/assets/index.html-f21cdad8.js" as="script"><link rel="prefetch" href="/assets/index.html-8d774be6.js" as="script"><link rel="prefetch" href="/assets/index.html-0ce5820c.js" as="script"><link rel="prefetch" href="/assets/index.html-80240652.js" as="script"><link rel="prefetch" href="/assets/index.html-306ced06.js" as="script"><link rel="prefetch" href="/assets/index.html-94c88d8a.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-ffc9db2f.js" as="script"><link rel="prefetch" href="/assets/index.html-1b1893c3.js" as="script"><link rel="prefetch" href="/assets/index.html-62f81ce5.js" as="script"><link rel="prefetch" href="/assets/index.html-fb202bc3.js" as="script"><link rel="prefetch" href="/assets/index.html-b149f2ea.js" as="script"><link rel="prefetch" href="/assets/index.html-10e7347f.js" as="script"><link rel="prefetch" href="/assets/index.html-fda95f20.js" as="script"><link rel="prefetch" href="/assets/index.html-67b8181d.js" as="script"><link rel="prefetch" href="/assets/index.html-b82ac6d5.js" as="script"><link rel="prefetch" href="/assets/index.html-18cf8f7d.js" as="script"><link rel="prefetch" href="/assets/index.html-e42215a4.js" as="script"><link rel="prefetch" href="/assets/index.html-4bceed98.js" as="script"><link rel="prefetch" href="/assets/index.html-d20a83b0.js" as="script"><link rel="prefetch" href="/assets/index.html-8a5223dd.js" as="script"><link rel="prefetch" href="/assets/index.html-5e0093bb.js" as="script"><link rel="prefetch" href="/assets/index.html-f320d1f5.js" as="script"><link rel="prefetch" href="/assets/index.html-cad64787.js" as="script"><link rel="prefetch" href="/assets/index.html-a8c6716d.js" as="script"><link rel="prefetch" href="/assets/index.html-48c59174.js" as="script"><link rel="prefetch" href="/assets/index.html-7bb25030.js" as="script"><link rel="prefetch" href="/assets/index.html-893823d4.js" as="script"><link rel="prefetch" href="/assets/index.html-d41fc55d.js" as="script"><link rel="prefetch" href="/assets/index.html-7fa8c257.js" as="script"><link rel="prefetch" href="/assets/index.html-de7cfa2f.js" as="script"><link rel="prefetch" href="/assets/index.html-a5ecc648.js" as="script"><link rel="prefetch" href="/assets/index.html-e04e7eb7.js" as="script"><link rel="prefetch" href="/assets/index.html-50c40125.js" as="script"><link rel="prefetch" href="/assets/index.html-f7ae0721.js" as="script"><link rel="prefetch" href="/assets/index.html-a7a669ae.js" as="script"><link rel="prefetch" href="/assets/index.html-b9393f2c.js" as="script"><link rel="prefetch" href="/assets/index.html-921f67f8.js" as="script"><link rel="prefetch" href="/assets/index.html-62b0250c.js" as="script"><link rel="prefetch" href="/assets/index.html-37a1d0fb.js" as="script"><link rel="prefetch" href="/assets/index.html-d5fb0f14.js" as="script"><link rel="prefetch" href="/assets/index.html-58871ffb.js" as="script"><link rel="prefetch" href="/assets/index.html-20f24699.js" as="script"><link rel="prefetch" href="/assets/index.html-ddecb9bd.js" as="script"><link rel="prefetch" href="/assets/index.html-7d43b4c2.js" as="script"><link rel="prefetch" href="/assets/index.html-6e42f3f3.js" as="script"><link rel="prefetch" href="/assets/index.html-c064a334.js" as="script"><link rel="prefetch" href="/assets/index.html-ef359b17.js" as="script"><link rel="prefetch" href="/assets/index.html-e924e41b.js" as="script"><link rel="prefetch" href="/assets/index.html-3d7283b0.js" as="script"><link rel="prefetch" href="/assets/index.html-a06ee49a.js" as="script"><link rel="prefetch" href="/assets/index.html-d47203ec.js" as="script"><link rel="prefetch" href="/assets/index.html-f3c65495.js" as="script"><link rel="prefetch" href="/assets/index.html-368a0dce.js" as="script"><link rel="prefetch" href="/assets/index.html-34d16bb7.js" as="script"><link rel="prefetch" href="/assets/index.html-f9bef08a.js" as="script"><link rel="prefetch" href="/assets/index.html-0fa630ac.js" as="script"><link rel="prefetch" href="/assets/index.html-7f7cdea0.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-f4ac9e4a.js" as="script"><link rel="prefetch" href="/assets/index.html-9e607adc.js" as="script"><link rel="prefetch" href="/assets/index.html-9af77916.js" as="script"><link rel="prefetch" href="/assets/index.html-a24689f2.js" as="script"><link rel="prefetch" href="/assets/index.html-66970517.js" as="script"><link rel="prefetch" href="/assets/index.html-621947c5.js" as="script"><link rel="prefetch" href="/assets/index.html-cdf078ab.js" as="script"><link rel="prefetch" href="/assets/index.html-edcd7965.js" as="script"><link rel="prefetch" href="/assets/index.html-52dc5986.js" as="script"><link rel="prefetch" href="/assets/index.html-d53b3ef9.js" as="script"><link rel="prefetch" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-6772ff48.js" as="script"><link rel="prefetch" href="/assets/404.html-461ff74c.js" as="script"><link rel="prefetch" href="/assets/index.html-b2824715.js" as="script"><link rel="prefetch" href="/assets/index.html-bf630227.js" as="script"><link rel="prefetch" href="/assets/index.html-2ccc13d8.js" as="script"><link rel="prefetch" href="/assets/index.html-025d7978.js" as="script"><link rel="prefetch" href="/assets/index.html-e7281517.js" as="script"><link rel="prefetch" href="/assets/index.html-dd038321.js" as="script"><link rel="prefetch" href="/assets/index.html-7ff3e11e.js" as="script"><link rel="prefetch" href="/assets/index.html-1e0f8ca5.js" as="script"><link rel="prefetch" href="/assets/index.html-91a90aa5.js" as="script"><link rel="prefetch" href="/assets/index.html-b41716bc.js" as="script"><link rel="prefetch" href="/assets/index.html-7fbe4bcc.js" as="script"><link rel="prefetch" href="/assets/index.html-70c76245.js" as="script"><link rel="prefetch" href="/assets/index.html-d91f6c12.js" as="script"><link rel="prefetch" href="/assets/index.html-2e16b465.js" as="script"><link rel="prefetch" href="/assets/index.html-a78a20f3.js" as="script"><link rel="prefetch" href="/assets/index.html-ff2c131a.js" as="script"><link rel="prefetch" href="/assets/index.html-144aa0d9.js" as="script"><link rel="prefetch" href="/assets/index.html-c0eb79ef.js" as="script"><link rel="prefetch" href="/assets/index.html-8d28343e.js" as="script"><link rel="prefetch" href="/assets/index.html-21c61708.js" as="script"><link rel="prefetch" href="/assets/index.html-0f05122a.js" as="script"><link rel="prefetch" href="/assets/index.html-f0710051.js" as="script"><link rel="prefetch" href="/assets/index.html-b5df8347.js" as="script"><link rel="prefetch" href="/assets/index.html-c1db7764.js" as="script"><link rel="prefetch" href="/assets/index.html-9f78e9be.js" as="script"><link rel="prefetch" href="/assets/index.html-5aa72145.js" as="script"><link rel="prefetch" href="/assets/index.html-c12ff88a.js" as="script"><link rel="prefetch" href="/assets/index.html-4439ca13.js" as="script"><link rel="prefetch" href="/assets/index.html-394c9698.js" as="script"><link rel="prefetch" href="/assets/index.html-72f3752a.js" as="script"><link rel="prefetch" href="/assets/index.html-f13b6a87.js" as="script"><link rel="prefetch" href="/assets/index.html-6434280b.js" as="script"><link rel="prefetch" href="/assets/index.html-0572e6e3.js" as="script"><link rel="prefetch" href="/assets/index.html-b8720651.js" as="script"><link rel="prefetch" href="/assets/index.html-80d2c9b0.js" as="script"><link rel="prefetch" href="/assets/index.html-a1cdc00b.js" as="script"><link rel="prefetch" href="/assets/index.html-922369ed.js" as="script"><link rel="prefetch" href="/assets/index.html-e278ab2b.js" as="script"><link rel="prefetch" href="/assets/index.html-c8a31c38.js" as="script"><link rel="prefetch" href="/assets/index.html-545bd13b.js" as="script"><link rel="prefetch" href="/assets/index.html-9d55779e.js" as="script"><link rel="prefetch" href="/assets/giscus-765fdce2.js" as="script"><link rel="prefetch" href="/assets/auto-bce451fc.js" as="script"><link rel="prefetch" href="/assets/index-a49a0f47.js" as="script"><link rel="prefetch" href="/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-8ccca130.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-0f5688fe.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-5794cde2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="å­¦ä¹ ç¬”è®°"><!----><span class="site-name hide-in-pad">å­¦ä¹ ç¬”è®°</span></a><!--]--><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Redisç¼“å­˜è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">æ±Ÿ</span></span><span property="author" content="æ±Ÿ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-10-21T23:35:03.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 23 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT23M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category3 clickable" role="navigation">Redis</span><!--]--><meta property="articleSection" content="Redis"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/pages/f2c1da/#ç¼“å­˜ç©¿é€" class="router-link-active router-link-exact-active toc-link level3">ç¼“å­˜ç©¿é€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/f2c1da/#ç¼“å­˜å‡»ç©¿-å¤±æ•ˆ" class="router-link-active router-link-exact-active toc-link level3">ç¼“å­˜å‡»ç©¿(å¤±æ•ˆ)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/f2c1da/#ç¼“å­˜é›ªå´©" class="router-link-active router-link-exact-active toc-link level3">ç¼“å­˜é›ªå´©</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/f2c1da/#ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´" class="router-link-active router-link-exact-active toc-link level3">ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/f2c1da/#å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–" class="router-link-active router-link-exact-active toc-link level3">å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p><strong>å¤šçº§ç¼“å­˜æ¶æ„</strong></p><figure><img src="https://img.jssjqd.cn/äº¿çº§æµé‡ç”µå•†ç½‘ç«™å¾®æœåŠ¡æ¶æ„.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç©¿é€" aria-hidden="true">#</a> ç¼“å­˜ç©¿é€</h3><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®ï¼Œ ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚éƒ½ä¸ä¼šå‘½ä¸­ï¼Œé€šå¸¸å‡ºäºå®¹é”™çš„è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜å±‚ã€‚</p><p>ç¼“å­˜ç©¿é€å°†å¯¼è‡´ä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œ å¤±å»äº†ç¼“å­˜ä¿æŠ¤åç«¯å­˜å‚¨çš„æ„ä¹‰ã€‚</p><p>é€ æˆç¼“å­˜ç©¿é€çš„åŸºæœ¬åŸå› æœ‰ä¸¤ä¸ªï¼š</p><p>ç¬¬ä¸€ï¼Œ è‡ªèº«ä¸šåŠ¡ä»£ç æˆ–è€…æ•°æ®å‡ºç°é—®é¢˜ã€‚</p><p>ç¬¬äºŒï¼Œ ä¸€äº›æ¶æ„æ”»å‡»ã€çˆ¬è™«ç­‰é€ æˆå¤§é‡ç©ºå‘½ä¸­ã€‚</p><p>ç¼“å­˜ç©¿é€é—®é¢˜è§£å†³æ–¹æ¡ˆï¼š</p><p>1ã€ç¼“å­˜ç©ºå¯¹è±¡</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»ç¼“å­˜ä¸­è·å–æ•°æ®</span>
    <span class="token class-name">String</span> cacheValue <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç¼“å­˜ä¸ºç©º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>cacheValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä»å­˜å‚¨ä¸­è·å–</span>
        <span class="token class-name">String</span> storageValue <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> storageValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœå­˜å‚¨æ•°æ®ä¸ºç©ºï¼Œ éœ€è¦è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´(300ç§’)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>storageValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cache<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> storageValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¼“å­˜éç©º</span>
        <span class="token keyword">return</span> cacheValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>           
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å¸ƒéš†è¿‡æ»¤å™¨</p><p>å¯¹äºæ¶æ„æ”»å‡»ï¼Œå‘æœåŠ¡å™¨è¯·æ±‚å¤§é‡ä¸å­˜åœ¨çš„æ•°æ®é€ æˆçš„ç¼“å­˜ç©¿é€ï¼Œè¿˜å¯ä»¥ç”¨å¸ƒéš†è¿‡æ»¤å™¨å…ˆåšä¸€æ¬¡è¿‡æ»¤ï¼Œå¯¹äºä¸å­˜åœ¨çš„æ•°æ®å¸ƒéš†è¿‡æ»¤å™¨ä¸€èˆ¬éƒ½èƒ½å¤Ÿè¿‡æ»¤æ‰ï¼Œä¸è®©è¯·æ±‚å†å¾€åç«¯å‘é€ã€‚å½“å¸ƒéš†è¿‡æ»¤å™¨è¯´<strong>æŸä¸ªå€¼å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªå€¼å¯èƒ½ä¸å­˜åœ¨ï¼›å½“å®ƒè¯´ä¸å­˜åœ¨æ—¶ï¼Œé‚£å°±è‚¯å®šä¸å­˜åœ¨ã€‚</strong></p><p>â€‹ <img src="https://img.jssjqd.cn/20221021232709.png" alt="" loading="lazy"></p><p>å¸ƒéš†è¿‡æ»¤å™¨å°±æ˜¯<strong>ä¸€ä¸ªå¤§å‹çš„ä½æ•°ç»„å’Œå‡ ä¸ªä¸ä¸€æ ·çš„æ— å hash å‡½æ•°</strong>ã€‚æ‰€è°“æ— åå°±æ˜¯èƒ½å¤ŸæŠŠå…ƒç´ çš„ hash å€¼ç®—å¾—æ¯”è¾ƒå‡åŒ€ã€‚</p><p>å‘å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ·»åŠ  key æ—¶ï¼Œä¼šä½¿ç”¨å¤šä¸ª hash å‡½æ•°å¯¹ key è¿›è¡Œ hash ç®—å¾—ä¸€ä¸ªæ•´æ•°ç´¢å¼•å€¼ç„¶åå¯¹ä½æ•°ç»„é•¿åº¦è¿›è¡Œå–æ¨¡è¿ç®—å¾—åˆ°ä¸€ä¸ªä½ç½®ï¼Œæ¯ä¸ª hash å‡½æ•°éƒ½ä¼šç®—å¾—ä¸€ä¸ªä¸åŒçš„ä½ç½®ã€‚å†æŠŠä½æ•°ç»„çš„è¿™å‡ ä¸ªä½ç½®éƒ½ç½®ä¸º 1 å°±å®Œæˆäº† add æ“ä½œã€‚</p><p>å‘å¸ƒéš†è¿‡æ»¤å™¨è¯¢é—® key æ˜¯å¦å­˜åœ¨æ—¶ï¼Œè·Ÿ add ä¸€æ ·ï¼Œä¹Ÿä¼šæŠŠ hash çš„å‡ ä¸ªä½ç½®éƒ½ç®—å‡ºæ¥ï¼Œçœ‹çœ‹ä½æ•°ç»„ä¸­è¿™å‡ ä¸ªä½ç½®æ˜¯å¦éƒ½ä¸º 1ï¼Œåªè¦æœ‰ä¸€ä¸ªä½ä¸º 0ï¼Œé‚£ä¹ˆè¯´æ˜å¸ƒéš†è¿‡æ»¤å™¨ä¸­è¿™ä¸ªkey ä¸å­˜åœ¨ã€‚å¦‚æœéƒ½æ˜¯ 1ï¼Œè¿™å¹¶ä¸èƒ½è¯´æ˜è¿™ä¸ª key å°±ä¸€å®šå­˜åœ¨ï¼Œåªæ˜¯ææœ‰å¯èƒ½å­˜åœ¨ï¼Œå› ä¸ºè¿™äº›ä½è¢«ç½®ä¸º 1 å¯èƒ½æ˜¯å› ä¸ºå…¶å®ƒçš„ key å­˜åœ¨æ‰€è‡´ã€‚å¦‚æœè¿™ä¸ªä½æ•°ç»„é•¿åº¦æ¯”è¾ƒå¤§ï¼Œå­˜åœ¨æ¦‚ç‡å°±ä¼šå¾ˆå¤§ï¼Œå¦‚æœè¿™ä¸ªä½æ•°ç»„é•¿åº¦æ¯”è¾ƒå°ï¼Œå­˜åœ¨æ¦‚ç‡å°±ä¼šé™ä½ã€‚</p><p>è¿™ç§æ–¹æ³•é€‚ç”¨äºæ•°æ®å‘½ä¸­ä¸é«˜ã€ æ•°æ®ç›¸å¯¹å›ºå®šã€ å®æ—¶æ€§ä½ï¼ˆé€šå¸¸æ˜¯æ•°æ®é›†è¾ƒå¤§ï¼‰ çš„åº”ç”¨åœºæ™¯ï¼Œ ä»£ç ç»´æŠ¤è¾ƒä¸ºå¤æ‚ï¼Œ ä½†æ˜¯<strong>ç¼“å­˜ç©ºé—´å ç”¨å¾ˆå°‘</strong>ã€‚</p><p>å¯ä»¥ç”¨redissonå®ç°å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¼•å…¥ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.6.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ä¼ªä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>redisson</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span></span><span class="token class-name">Redisson</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RBloomFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RedissonClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">Config</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedissonBloomFilter</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;redis://localhost:6379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ„é€ Redisson</span>
        <span class="token class-name">RedissonClient</span> redisson <span class="token operator">=</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">RBloomFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bloomFilter <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getBloomFilter</span><span class="token punctuation">(</span><span class="token string">&quot;nameList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨ï¼šé¢„è®¡å…ƒç´ ä¸º100000000L,è¯¯å·®ç‡ä¸º3%,æ ¹æ®è¿™ä¸¤ä¸ªå‚æ•°ä¼šè®¡ç®—å‡ºåº•å±‚çš„bitæ•°ç»„å¤§å°</span>
        bloomFilter<span class="token punctuation">.</span><span class="token function">tryInit</span><span class="token punctuation">(</span><span class="token number">100000000L</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†zhugeæ’å…¥åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­</span>
        bloomFilter<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;zhuge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//åˆ¤æ–­ä¸‹é¢å·ç æ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bloomFilter<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;guojia&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bloomFilter<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;baiqi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bloomFilter<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;zhuge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨éœ€è¦æŠŠæ‰€æœ‰æ•°æ®æå‰æ”¾å…¥å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”åœ¨å¢åŠ æ•°æ®æ—¶ä¹Ÿè¦å¾€å¸ƒéš†è¿‡æ»¤å™¨é‡Œæ”¾ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ç¼“å­˜è¿‡æ»¤ä¼ªä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨</span>
<span class="token class-name">RBloomFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bloomFilter <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getBloomFilter</span><span class="token punctuation">(</span><span class="token string">&quot;nameList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨ï¼šé¢„è®¡å…ƒç´ ä¸º100000000L,è¯¯å·®ç‡ä¸º3%</span>
bloomFilter<span class="token punctuation">.</span><span class="token function">tryInit</span><span class="token punctuation">(</span><span class="token number">100000000L</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
<span class="token comment">//æŠŠæ‰€æœ‰æ•°æ®å­˜å…¥å¸ƒéš†è¿‡æ»¤å™¨</span>
<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bloomFilter<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»å¸ƒéš†è¿‡æ»¤å™¨è¿™ä¸€çº§ç¼“å­˜åˆ¤æ–­ä¸‹keyæ˜¯å¦å­˜åœ¨</span>
    <span class="token class-name">Boolean</span> exist <span class="token operator">=</span> bloomFilter<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>exist<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ä»ç¼“å­˜ä¸­è·å–æ•°æ®</span>
    <span class="token class-name">String</span> cacheValue <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç¼“å­˜ä¸ºç©º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>cacheValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä»å­˜å‚¨ä¸­è·å–</span>
        <span class="token class-name">String</span> storageValue <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> storageValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœå­˜å‚¨æ•°æ®ä¸ºç©ºï¼Œ éœ€è¦è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´(300ç§’)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>storageValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cache<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> storageValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¼“å­˜éç©º</span>
        <span class="token keyword">return</span> cacheValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>            
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šå¸ƒéš†è¿‡æ»¤å™¨ä¸èƒ½åˆ é™¤æ•°æ®ï¼Œå¦‚æœè¦åˆ é™¤å¾—é‡æ–°åˆå§‹åŒ–æ•°æ®ã€‚</p><h3 id="ç¼“å­˜å‡»ç©¿-å¤±æ•ˆ" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜å‡»ç©¿-å¤±æ•ˆ" aria-hidden="true">#</a> ç¼“å­˜å‡»ç©¿(å¤±æ•ˆ)</h3><p>ç”±äºå¤§æ‰¹é‡ç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤±æ•ˆå¯èƒ½å¯¼è‡´å¤§é‡è¯·æ±‚åŒæ—¶ç©¿é€ç¼“å­˜ç›´è¾¾æ•°æ®åº“ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ç”šè‡³æŒ‚æ‰ï¼Œå¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬åœ¨æ‰¹é‡å¢åŠ ç¼“å­˜æ—¶æœ€å¥½å°†è¿™ä¸€æ‰¹æ•°æ®çš„ç¼“å­˜è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºä¸€ä¸ªæ—¶é—´æ®µå†…çš„ä¸åŒæ—¶é—´ã€‚</p><p>ç¤ºä¾‹ä¼ªä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»ç¼“å­˜ä¸­è·å–æ•°æ®</span>
    <span class="token class-name">String</span> cacheValue <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç¼“å­˜ä¸ºç©º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>cacheValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä»å­˜å‚¨ä¸­è·å–</span>
        <span class="token class-name">String</span> storageValue <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> storageValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´(300åˆ°600ä¹‹é—´çš„ä¸€ä¸ªéšæœºæ•°)</span>
        <span class="token keyword">int</span> expireTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>  <span class="token operator">+</span> <span class="token number">300</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>storageValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cache<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> expireTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> storageValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¼“å­˜éç©º</span>
        <span class="token keyword">return</span> cacheValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
          
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜é›ªå´©" aria-hidden="true">#</a> ç¼“å­˜é›ªå´©</h3><p>ç¼“å­˜é›ªå´©æŒ‡çš„æ˜¯ç¼“å­˜å±‚æ”¯æ’‘ä¸ä½æˆ–å®•æ‰åï¼Œ æµé‡ä¼šåƒå¥”é€ƒçš„é‡ç‰›ä¸€æ ·ï¼Œæ‰“å‘åç«¯å­˜å‚¨å±‚ã€‚</p><p>ç”±äºç¼“å­˜å±‚æ‰¿è½½ç€å¤§é‡è¯·æ±‚ï¼Œ æœ‰æ•ˆåœ°ä¿æŠ¤äº†å­˜å‚¨å±‚ï¼Œ ä½†æ˜¯å¦‚æœç¼“å­˜å±‚ç”±äºæŸäº›åŸå› ä¸èƒ½æä¾›æœåŠ¡(æ¯”å¦‚è¶…å¤§å¹¶å‘è¿‡æ¥ï¼Œç¼“å­˜å±‚æ”¯æ’‘ä¸ä½ï¼Œæˆ–è€…ç”±äºç¼“å­˜è®¾è®¡ä¸å¥½ï¼Œç±»ä¼¼å¤§é‡è¯·æ±‚è®¿é—®bigkeyï¼Œå¯¼è‡´ç¼“å­˜èƒ½æ”¯æ’‘çš„å¹¶å‘æ€¥å‰§ä¸‹é™)ï¼Œ äºæ˜¯å¤§é‡è¯·æ±‚éƒ½ä¼šæ‰“åˆ°å­˜å‚¨å±‚ï¼Œ å­˜å‚¨å±‚çš„è°ƒç”¨é‡ä¼šæš´å¢ï¼Œ é€ æˆå­˜å‚¨å±‚ä¹Ÿä¼šçº§è”å®•æœºçš„æƒ…å†µã€‚</p><p>é¢„é˜²å’Œè§£å†³ç¼“å­˜é›ªå´©é—®é¢˜ï¼Œ å¯ä»¥ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¿›è¡Œç€æ‰‹ã€‚</p><p>1ï¼‰ ä¿è¯ç¼“å­˜å±‚æœåŠ¡é«˜å¯ç”¨æ€§ï¼Œæ¯”å¦‚ä½¿ç”¨Redis Sentinelæˆ–Redis Clusterã€‚</p><p>2ï¼‰ ä¾èµ–éš”ç¦»ç»„ä»¶ä¸ºåç«¯é™æµç†”æ–­å¹¶é™çº§ã€‚æ¯”å¦‚ä½¿ç”¨Sentinelæˆ–Hystrixé™æµé™çº§ç»„ä»¶ã€‚</p><p>æ¯”å¦‚æœåŠ¡é™çº§ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®é‡‡å–ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚å½“ä¸šåŠ¡åº”ç”¨è®¿é—®çš„æ˜¯éæ ¸å¿ƒæ•°æ®ï¼ˆä¾‹å¦‚ç”µå•†å•†å“å±æ€§ï¼Œç”¨æˆ·ä¿¡æ¯ç­‰ï¼‰æ—¶ï¼Œæš‚æ—¶åœæ­¢ä»ç¼“å­˜ä¸­æŸ¥è¯¢è¿™äº›æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é¢„å®šä¹‰çš„é»˜è®¤é™çº§ä¿¡æ¯ã€ç©ºå€¼æˆ–æ˜¯é”™è¯¯æç¤ºä¿¡æ¯ï¼›å½“ä¸šåŠ¡åº”ç”¨è®¿é—®çš„æ˜¯æ ¸å¿ƒæ•°æ®ï¼ˆä¾‹å¦‚ç”µå•†å•†å“åº“å­˜ï¼‰æ—¶ï¼Œä»ç„¶å…è®¸æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ç¼ºå¤±ï¼Œä¹Ÿå¯ä»¥ç»§ç»­é€šè¿‡æ•°æ®åº“è¯»å–ã€‚</p><p>3ï¼‰ æå‰æ¼”ç»ƒã€‚ åœ¨é¡¹ç›®ä¸Šçº¿å‰ï¼Œæ¼”ç»ƒç¼“å­˜å±‚å®•æ‰åï¼Œåº”ç”¨ä»¥åŠåç«¯çš„è´Ÿè½½æƒ…å†µä»¥åŠå¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œ åœ¨æ­¤åŸºç¡€ä¸Šåšä¸€äº›é¢„æ¡ˆè®¾å®šã€‚</p><p><strong>çƒ­ç‚¹ç¼“å­˜keyé‡å»ºä¼˜åŒ–</strong></p><p>å¼€å‘äººå‘˜ä½¿ç”¨â€œç¼“å­˜+è¿‡æœŸæ—¶é—´â€çš„ç­–ç•¥æ—¢å¯ä»¥åŠ é€Ÿæ•°æ®è¯»å†™ï¼Œ åˆä¿è¯æ•°æ®çš„å®šæœŸæ›´æ–°ï¼Œ è¿™ç§æ¨¡å¼åŸºæœ¬èƒ½å¤Ÿæ»¡è¶³ç»å¤§éƒ¨åˆ†éœ€æ±‚ã€‚ ä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜å¦‚æœåŒæ—¶å‡ºç°ï¼Œ å¯èƒ½å°±ä¼šå¯¹åº”ç”¨é€ æˆè‡´å‘½çš„å±å®³ï¼š</p><ul><li>å½“å‰keyæ˜¯ä¸€ä¸ªçƒ­ç‚¹keyï¼ˆä¾‹å¦‚ä¸€ä¸ªçƒ­é—¨çš„å¨±ä¹æ–°é—»ï¼‰ï¼Œå¹¶å‘é‡éå¸¸å¤§ã€‚</li><li>é‡å»ºç¼“å­˜ä¸èƒ½åœ¨çŸ­æ—¶é—´å®Œæˆï¼Œ å¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚è®¡ç®—ï¼Œä¾‹å¦‚å¤æ‚çš„SQLã€å¤šæ¬¡IOã€å¤šä¸ªä¾èµ–ç­‰ã€‚</li></ul><p>åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œ æœ‰å¤§é‡çº¿ç¨‹æ¥é‡å»ºç¼“å­˜ï¼Œ é€ æˆåç«¯è´Ÿè½½åŠ å¤§ï¼Œ ç”šè‡³å¯èƒ½ä¼šè®©åº”ç”¨å´©æºƒã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¸»è¦å°±æ˜¯è¦é¿å…å¤§é‡çº¿ç¨‹åŒæ—¶é‡å»ºç¼“å­˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨äº’æ–¥é”æ¥è§£å†³ï¼Œæ­¤æ–¹æ³•åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œ å…¶ä»–çº¿ç¨‹ç­‰å¾…é‡å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œ é‡æ–°ä»ç¼“å­˜è·å–æ•°æ®å³å¯ã€‚</p><p>ç¤ºä¾‹ä¼ªä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»Redisä¸­è·å–æ•°æ®</span>
    <span class="token class-name">String</span> value <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœvalueä¸ºç©ºï¼Œ åˆ™å¼€å§‹é‡æ„ç¼“å­˜</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œ ä½¿ç”¨nxï¼Œ å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ex</span>
        <span class="token class-name">String</span> mutexKey <span class="token operator">=</span> <span class="token string">&quot;mutext:key:&quot;</span> <span class="token operator">+</span> key<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>mutexKey<span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ex 180&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token comment">// ä»æ•°æ®æºè·å–æ•°æ®</span>
            value <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å›å†™Redisï¼Œ å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´</span>
            redis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åˆ é™¤key_mutex</span>
            redis<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>mutexKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token comment">// å…¶ä»–çº¿ç¨‹ä¼‘æ¯50æ¯«ç§’åé‡è¯•</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´" aria-hidden="true">#</a> ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´</h3><p>åœ¨å¤§å¹¶å‘ä¸‹ï¼ŒåŒæ—¶æ“ä½œæ•°æ®åº“ä¸ç¼“å­˜ä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜</p><p>1ã€åŒå†™ä¸ä¸€è‡´æƒ…å†µ</p><p>â€‹ <img src="https://img.jssjqd.cn/20221021232846.png" alt="" loading="lazy"></p><p>2ã€è¯»å†™å¹¶å‘ä¸ä¸€è‡´</p><p>â€‹ <img src="https://img.jssjqd.cn/20221021232855.png" alt="" loading="lazy"></p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>1ã€å¯¹äºå¹¶å‘å‡ ç‡å¾ˆå°çš„æ•°æ®(å¦‚ä¸ªäººç»´åº¦çš„è®¢å•æ•°æ®ã€ç”¨æˆ·æ•°æ®ç­‰)ï¼Œè¿™ç§å‡ ä¹ä¸ç”¨è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œå¾ˆå°‘ä¼šå‘ç”Ÿç¼“å­˜ä¸ä¸€è‡´ï¼Œå¯ä»¥ç»™ç¼“å­˜æ•°æ®åŠ ä¸Šè¿‡æœŸæ—¶é—´ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è§¦å‘è¯»çš„ä¸»åŠ¨æ›´æ–°å³å¯ã€‚</p><p>2ã€å°±ç®—å¹¶å‘å¾ˆé«˜ï¼Œå¦‚æœä¸šåŠ¡ä¸Šèƒ½å®¹å¿çŸ­æ—¶é—´çš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´(å¦‚å•†å“åç§°ï¼Œå•†å“åˆ†ç±»èœå•ç­‰)ï¼Œç¼“å­˜åŠ ä¸Šè¿‡æœŸæ—¶é—´ä¾ç„¶å¯ä»¥è§£å†³å¤§éƒ¨åˆ†ä¸šåŠ¡å¯¹äºç¼“å­˜çš„è¦æ±‚ã€‚</p><p>3ã€å¦‚æœä¸èƒ½å®¹å¿ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡åŠ <strong>åˆ†å¸ƒå¼è¯»å†™é”</strong>ä¿è¯å¹¶å‘è¯»å†™æˆ–å†™å†™çš„æ—¶å€™æŒ‰é¡ºåºæ’å¥½é˜Ÿï¼Œ<strong>è¯»è¯»çš„æ—¶å€™ç›¸å½“äºæ— é”</strong>ã€‚</p><p>4ã€ä¹Ÿå¯ä»¥ç”¨é˜¿é‡Œå¼€æºçš„canalé€šè¿‡ç›‘å¬æ•°æ®åº“çš„binlogæ—¥å¿—åŠæ—¶çš„å»ä¿®æ”¹ç¼“å­˜ï¼Œä½†æ˜¯å¼•å…¥äº†æ–°çš„ä¸­é—´ä»¶ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</p><p>â€‹ <img src="https://img.jssjqd.cn/20221021232903.png" alt="" loading="lazy"></p><p><strong>æ€»ç»“ï¼š</strong></p><p>ä»¥ä¸Šæˆ‘ä»¬é’ˆå¯¹çš„éƒ½æ˜¯<strong>è¯»å¤šå†™å°‘</strong>çš„æƒ…å†µåŠ å…¥ç¼“å­˜æé«˜æ€§èƒ½ï¼Œå¦‚æœ<strong>å†™å¤šè¯»å¤š</strong>çš„æƒ…å†µåˆä¸èƒ½å®¹å¿ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ï¼Œé‚£å°±æ²¡å¿…è¦åŠ ç¼“å­˜äº†ï¼Œå¯ä»¥ç›´æ¥æ“ä½œæ•°æ®åº“ã€‚å½“ç„¶ï¼Œå¦‚æœæ•°æ®åº“æŠ—ä¸ä½å‹åŠ›ï¼Œè¿˜å¯ä»¥æŠŠç¼“å­˜ä½œä¸ºæ•°æ®è¯»å†™çš„ä¸»å­˜å‚¨ï¼Œå¼‚æ­¥å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®åº“ï¼Œæ•°æ®åº“åªæ˜¯ä½œä¸ºæ•°æ®çš„å¤‡ä»½ã€‚</p><p>æ”¾å…¥ç¼“å­˜çš„æ•°æ®åº”è¯¥æ˜¯å¯¹å®æ—¶æ€§ã€ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜çš„æ•°æ®ã€‚åˆ‡è®°ä¸è¦ä¸ºäº†ç”¨ç¼“å­˜ï¼ŒåŒæ—¶åˆè¦ä¿è¯ç»å¯¹çš„ä¸€è‡´æ€§åšå¤§é‡çš„è¿‡åº¦è®¾è®¡å’Œæ§åˆ¶ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚æ€§ï¼</p><h3 id="å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–" aria-hidden="true">#</a> å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–</h3><p><strong>ä¸€ã€é”®å€¼è®¾è®¡</strong></p><p><strong>1. keyåè®¾è®¡</strong></p><ul><li>(1)ã€å»ºè®®ã€‘: å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§</li></ul><p>ä»¥ä¸šåŠ¡å(æˆ–æ•°æ®åº“å)ä¸ºå‰ç¼€(é˜²æ­¢keyå†²çª)ï¼Œç”¨å†’å·åˆ†éš”ï¼Œæ¯”å¦‚ä¸šåŠ¡å:è¡¨å:id</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>trade:order:1              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>(2)ã€å»ºè®®ã€‘ï¼šç®€æ´æ€§</li></ul><p>ä¿è¯è¯­ä¹‰çš„å‰æä¸‹ï¼Œæ§åˆ¶keyçš„é•¿åº¦ï¼Œå½“keyè¾ƒå¤šæ—¶ï¼Œå†…å­˜å ç”¨ä¹Ÿä¸å®¹å¿½è§†ï¼Œä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>user:{uid}:friends:messages:{mid} ç®€åŒ–ä¸º u:{uid}:fr:m:{mid}              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>(3)ã€å¼ºåˆ¶ã€‘ï¼šä¸è¦åŒ…å«ç‰¹æ®Šå­—ç¬¦</li></ul><p>åä¾‹ï¼šåŒ…å«ç©ºæ ¼ã€æ¢è¡Œã€å•åŒå¼•å·ä»¥åŠå…¶ä»–è½¬ä¹‰å­—ç¬¦</p><p><strong>2. valueè®¾è®¡</strong></p><ul><li>(1)ã€å¼ºåˆ¶ã€‘ï¼šæ‹’ç»bigkey(é˜²æ­¢ç½‘å¡æµé‡ã€æ…¢æŸ¥è¯¢)</li></ul><p>åœ¨Redisä¸­ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²æœ€å¤§512MBï¼Œä¸€ä¸ªäºŒçº§æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚hashã€listã€setã€zsetï¼‰å¯ä»¥å­˜å‚¨å¤§çº¦40äº¿ä¸ª(2^32-1)ä¸ªå…ƒç´ ï¼Œä½†å®é™…ä¸­å¦‚æœä¸‹é¢ä¸¤ç§æƒ…å†µï¼Œæˆ‘å°±ä¼šè®¤ä¸ºå®ƒæ˜¯bigkeyã€‚</p><ol><li>å­—ç¬¦ä¸²ç±»å‹ï¼šå®ƒçš„bigä½“ç°åœ¨å•ä¸ªvalueå€¼å¾ˆå¤§ï¼Œä¸€èˆ¬è®¤ä¸ºè¶…è¿‡10KBå°±æ˜¯bigkeyã€‚</li><li>éå­—ç¬¦ä¸²ç±»å‹ï¼šå“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆï¼Œå®ƒä»¬çš„bigä½“ç°åœ¨å…ƒç´ ä¸ªæ•°å¤ªå¤šã€‚</li></ol><p>ä¸€èˆ¬æ¥è¯´ï¼Œstringç±»å‹æ§åˆ¶åœ¨10KBä»¥å†…ï¼Œhashã€listã€setã€zsetå…ƒç´ ä¸ªæ•°ä¸è¦è¶…è¿‡5000ã€‚</p><p>åä¾‹ï¼šä¸€ä¸ªåŒ…å«200ä¸‡ä¸ªå…ƒç´ çš„listã€‚</p><p>éå­—ç¬¦ä¸²çš„bigkeyï¼Œä¸è¦ä½¿ç”¨delåˆ é™¤ï¼Œä½¿ç”¨hscanã€sscanã€zscanæ–¹å¼æ¸è¿›å¼åˆ é™¤ï¼ŒåŒæ—¶è¦æ³¨æ„é˜²æ­¢bigkeyè¿‡æœŸæ—¶é—´è‡ªåŠ¨åˆ é™¤é—®é¢˜(ä¾‹å¦‚ä¸€ä¸ª200ä¸‡çš„zsetè®¾ç½®1å°æ—¶è¿‡æœŸï¼Œä¼šè§¦å‘delæ“ä½œï¼Œé€ æˆé˜»å¡ï¼‰</p><p><strong>bigkeyçš„å±å®³ï¼š</strong></p><p>1.å¯¼è‡´redisé˜»å¡</p><p>2.ç½‘ç»œæ‹¥å¡</p><p>bigkeyä¹Ÿå°±æ„å‘³ç€æ¯æ¬¡è·å–è¦äº§ç”Ÿçš„ç½‘ç»œæµé‡è¾ƒå¤§ï¼Œå‡è®¾ä¸€ä¸ªbigkeyä¸º1MBï¼Œå®¢æˆ·ç«¯æ¯ç§’è®¿é—®é‡ä¸º1000ï¼Œé‚£ä¹ˆæ¯ç§’äº§ç”Ÿ1000MBçš„æµé‡ï¼Œå¯¹äºæ™®é€šçš„åƒå…†ç½‘å¡(æŒ‰ç…§å­—èŠ‚ç®—æ˜¯128MB/s)çš„æœåŠ¡å™¨æ¥è¯´ç®€ç›´æ˜¯ç­é¡¶ä¹‹ç¾ï¼Œè€Œä¸”ä¸€èˆ¬æœåŠ¡å™¨ä¼šé‡‡ç”¨å•æœºå¤šå®ä¾‹çš„æ–¹å¼æ¥éƒ¨ç½²ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªbigkeyå¯èƒ½ä¼šå¯¹å…¶ä»–å®ä¾‹ä¹Ÿé€ æˆå½±å“ï¼Œå…¶åæœä¸å ªè®¾æƒ³ã€‚</p><ol start="3"><li>è¿‡æœŸåˆ é™¤</li></ol><p>æœ‰ä¸ªbigkeyï¼Œå®ƒåˆ†å®ˆå·±ï¼ˆåªæ‰§è¡Œç®€å•çš„å‘½ä»¤ï¼Œä¾‹å¦‚hgetã€lpopã€zscoreç­‰ï¼‰ï¼Œä½†å®ƒè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå½“å®ƒè¿‡æœŸåï¼Œä¼šè¢«åˆ é™¤ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨Redis 4.0çš„è¿‡æœŸå¼‚æ­¥åˆ é™¤(<strong>lazyfree-lazy-expire yes</strong>)ï¼Œå°±ä¼šå­˜åœ¨é˜»å¡Redisçš„å¯èƒ½æ€§ã€‚</p><p><strong>bigkeyçš„äº§ç”Ÿï¼š</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œbigkeyçš„äº§ç”Ÿéƒ½æ˜¯ç”±äºç¨‹åºè®¾è®¡ä¸å½“ï¼Œæˆ–è€…å¯¹äºæ•°æ®è§„æ¨¡é¢„æ–™ä¸æ¸…æ¥šé€ æˆçš„ï¼Œæ¥çœ‹å‡ ä¸ªä¾‹å­ï¼š</p><p>(1) ç¤¾äº¤ç±»ï¼šç²‰ä¸åˆ—è¡¨ï¼Œå¦‚æœæŸäº›æ˜æ˜Ÿæˆ–è€…å¤§vä¸ç²¾å¿ƒè®¾è®¡ä¸‹ï¼Œå¿…æ˜¯bigkeyã€‚</p><p>(2) ç»Ÿè®¡ç±»ï¼šä¾‹å¦‚æŒ‰å¤©å­˜å‚¨æŸé¡¹åŠŸèƒ½æˆ–è€…ç½‘ç«™çš„ç”¨æˆ·é›†åˆï¼Œé™¤éæ²¡å‡ ä¸ªäººç”¨ï¼Œå¦åˆ™å¿…æ˜¯bigkeyã€‚</p><p>(3) ç¼“å­˜ç±»ï¼šå°†æ•°æ®ä»æ•°æ®åº“loadå‡ºæ¥åºåˆ—åŒ–æ”¾åˆ°Redisé‡Œï¼Œè¿™ä¸ªæ–¹å¼éå¸¸å¸¸ç”¨ï¼Œä½†æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œç¬¬ä¸€ï¼Œæ˜¯ä¸æ˜¯æœ‰å¿…è¦æŠŠæ‰€æœ‰å­—æ®µéƒ½ç¼“å­˜ï¼›ç¬¬äºŒï¼Œæœ‰æ²¡æœ‰ç›¸å…³å…³è”çš„æ•°æ®ï¼Œæœ‰çš„åŒå­¦ä¸ºäº†å›¾æ–¹ä¾¿æŠŠç›¸å…³æ•°æ®éƒ½å­˜ä¸€ä¸ªkeyä¸‹ï¼Œäº§ç”Ÿbigkeyã€‚</p><p><strong>å¦‚ä½•ä¼˜åŒ–bigkey</strong></p><ol><li>æ‹†</li></ol><p>big listï¼š list1ã€list2ã€...listN</p><p>big hashï¼šå¯ä»¥è®²æ•°æ®åˆ†æ®µå­˜å‚¨ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤§çš„keyï¼Œå‡è®¾å­˜äº†1ç™¾ä¸‡çš„ç”¨æˆ·æ•°æ®ï¼Œå¯ä»¥æ‹†åˆ†æˆ200ä¸ªkeyï¼Œæ¯ä¸ªkeyä¸‹é¢å­˜æ”¾5000ä¸ªç”¨æˆ·æ•°æ®</p><ol start="2"><li>å¦‚æœbigkeyä¸å¯é¿å…ï¼Œä¹Ÿè¦æ€è€ƒä¸€ä¸‹è¦ä¸è¦æ¯æ¬¡æŠŠæ‰€æœ‰å…ƒç´ éƒ½å–å‡ºæ¥(ä¾‹å¦‚æœ‰æ—¶å€™ä»…ä»…éœ€è¦hmgetï¼Œè€Œä¸æ˜¯hgetall)ï¼Œåˆ é™¤ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå°½é‡ä½¿ç”¨ä¼˜é›…çš„æ–¹å¼æ¥å¤„ç†ã€‚</li></ol><p>ã€æ¨èã€‘ï¼šé€‰æ‹©é€‚åˆçš„æ•°æ®ç±»å‹ã€‚</p><p>ä¾‹å¦‚ï¼šå®ä½“ç±»å‹(è¦åˆç†æ§åˆ¶å’Œä½¿ç”¨æ•°æ®ç»“æ„ï¼Œä½†ä¹Ÿè¦æ³¨æ„èŠ‚çœå†…å­˜å’Œæ€§èƒ½ä¹‹é—´çš„å¹³è¡¡)</p><p>åä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>set user:1:name tom set user:1:age 19 set user:1:favor football          
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­£ä¾‹:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>hmset user:1 name tom age 19 favor football              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3.ã€æ¨èã€‘ï¼šæ§åˆ¶keyçš„ç”Ÿå‘½å‘¨æœŸï¼Œredisä¸æ˜¯åƒåœ¾æ¡¶ã€‚</p><p>å»ºè®®ä½¿ç”¨expireè®¾ç½®è¿‡æœŸæ—¶é—´(æ¡ä»¶å…è®¸å¯ä»¥æ‰“æ•£è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢é›†ä¸­è¿‡æœŸ)ã€‚</p><p><strong>äºŒã€å‘½ä»¤ä½¿ç”¨</strong></p><p>1.ã€æ¨èã€‘ O(N)å‘½ä»¤å…³æ³¨Nçš„æ•°é‡</p><p>ä¾‹å¦‚hgetallã€lrangeã€smembersã€zrangeã€sinterç­‰å¹¶éä¸èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦æ˜ç¡®Nçš„å€¼ã€‚æœ‰éå†çš„éœ€æ±‚å¯ä»¥ä½¿ç”¨hscanã€sscanã€zscanä»£æ›¿ã€‚</p><p>2.ã€æ¨èã€‘ï¼šç¦ç”¨å‘½ä»¤</p><p>ç¦æ­¢çº¿ä¸Šä½¿ç”¨keysã€flushallã€flushdbç­‰ï¼Œé€šè¿‡redisçš„renameæœºåˆ¶ç¦æ‰å‘½ä»¤ï¼Œæˆ–è€…ä½¿ç”¨scançš„æ–¹å¼æ¸è¿›å¼å¤„ç†ã€‚</p><p>3.ã€æ¨èã€‘åˆç†ä½¿ç”¨select</p><p>redisçš„å¤šæ•°æ®åº“è¾ƒå¼±ï¼Œä½¿ç”¨æ•°å­—è¿›è¡ŒåŒºåˆ†ï¼Œå¾ˆå¤šå®¢æˆ·ç«¯æ”¯æŒè¾ƒå·®ï¼ŒåŒæ—¶å¤šä¸šåŠ¡ç”¨å¤šæ•°æ®åº“å®é™…è¿˜æ˜¯å•çº¿ç¨‹å¤„ç†ï¼Œä¼šæœ‰å¹²æ‰°ã€‚</p><p>4.ã€æ¨èã€‘ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡</p><p>åŸç”Ÿå‘½ä»¤ï¼šä¾‹å¦‚mgetã€msetã€‚ éåŸç”Ÿå‘½ä»¤ï¼šå¯ä»¥ä½¿ç”¨pipelineæé«˜æ•ˆç‡ã€‚</p><p>ä½†è¦æ³¨æ„æ§åˆ¶ä¸€æ¬¡æ‰¹é‡æ“ä½œçš„å…ƒç´ ä¸ªæ•°(ä¾‹å¦‚500ä»¥å†…ï¼Œå®é™…ä¹Ÿå’Œå…ƒç´ å­—èŠ‚æ•°æœ‰å…³)ã€‚</p><p>æ³¨æ„ä¸¤è€…ä¸åŒï¼š</p><pre><code>               1.  åŸç”Ÿå‘½ä»¤æ˜¯åŸå­æ“ä½œï¼Œpipelineæ˜¯éåŸå­æ“ä½œã€‚
               2.  pipelineå¯ä»¥æ‰“åŒ…ä¸åŒçš„å‘½ä»¤ï¼ŒåŸç”Ÿå‘½ä»¤åšä¸åˆ°
               3.  pipelineéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶æ”¯æŒã€‚              
</code></pre><p>5.ã€å»ºè®®ã€‘Redisäº‹åŠ¡åŠŸèƒ½è¾ƒå¼±ï¼Œä¸å»ºè®®è¿‡å¤šä½¿ç”¨ï¼Œå¯ä»¥ç”¨luaæ›¿ä»£</p><p><strong>ä¸‰ã€å®¢æˆ·ç«¯ä½¿ç”¨</strong></p><p>1.ã€æ¨èã€‘</p><p>é¿å…å¤šä¸ªåº”ç”¨ä½¿ç”¨ä¸€ä¸ªRediså®ä¾‹</p><p>æ­£ä¾‹ï¼šä¸ç›¸å¹²çš„ä¸šåŠ¡æ‹†åˆ†ï¼Œå…¬å…±æ•°æ®åšæœåŠ¡åŒ–ã€‚</p><p>2.ã€æ¨èã€‘</p><p>ä½¿ç”¨å¸¦æœ‰è¿æ¥æ± çš„æ•°æ®åº“ï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶è¿æ¥ï¼ŒåŒæ—¶æé«˜æ•ˆç‡ï¼Œæ ‡å‡†ä½¿ç”¨æ–¹å¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JedisPoolConfig</span> jedisPoolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">JedisPool</span> jedisPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPool</span><span class="token punctuation">(</span>jedisPoolConfig<span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.60&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    jedis <span class="token operator">=</span> jedisPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å…·ä½“çš„å‘½ä»¤</span>
    jedis<span class="token punctuation">.</span><span class="token function">executeCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;op key {} error: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ³¨æ„è¿™é‡Œä¸æ˜¯å…³é—­è¿æ¥ï¼Œåœ¨JedisPoolæ¨¡å¼ä¸‹ï¼ŒJedisä¼šè¢«å½’è¿˜ç»™èµ„æºæ± ã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>jedis <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> 
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>        
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿æ¥æ± å‚æ•°å«ä¹‰ï¼š</p><table><thead><tr><th>åºå·</th><th>å‚æ•°å</th><th>å«ä¹‰</th><th>é»˜è®¤å€¼</th><th>ä½¿ç”¨å»ºè®®</th></tr></thead><tbody><tr><td>1</td><td>maxTotal</td><td>èµ„æºæ± ä¸­æœ€å¤§è¿æ¥æ•°</td><td>8</td><td>è®¾ç½®å»ºè®®è§ä¸‹é¢</td></tr><tr><td>2</td><td>maxIdle</td><td>èµ„æºæ± å…è®¸æœ€å¤§ç©ºé—²çš„è¿æ¥æ•°</td><td>8</td><td>è®¾ç½®å»ºè®®è§ä¸‹é¢</td></tr><tr><td>3</td><td>minIdle</td><td>èµ„æºæ± ç¡®ä¿æœ€å°‘ç©ºé—²çš„è¿æ¥æ•°</td><td>0</td><td>è®¾ç½®å»ºè®®è§ä¸‹é¢</td></tr><tr><td>4</td><td>blockWhenExhausted</td><td>å½“èµ„æºæ± ç”¨å°½åï¼Œè°ƒç”¨è€…æ˜¯å¦è¦ç­‰å¾…ã€‚åªæœ‰å½“ä¸ºtrueæ—¶ï¼Œä¸‹é¢çš„maxWaitMillisæ‰ä¼šç”Ÿæ•ˆ</td><td>true</td><td>å»ºè®®ä½¿ç”¨é»˜è®¤å€¼</td></tr><tr><td>5</td><td>maxWaitMillis</td><td>å½“èµ„æºæ± è¿æ¥ç”¨å°½åï¼Œè°ƒç”¨è€…çš„æœ€å¤§ç­‰å¾…æ—¶é—´(å•ä½ä¸ºæ¯«ç§’)</td><td>-1ï¼šè¡¨ç¤ºæ°¸ä¸è¶…æ—¶</td><td>ä¸å»ºè®®ä½¿ç”¨é»˜è®¤å€¼</td></tr><tr><td>6</td><td>testOnBorrow</td><td>å‘èµ„æºæ± å€Ÿç”¨è¿æ¥æ—¶æ˜¯å¦åšè¿æ¥æœ‰æ•ˆæ€§æ£€æµ‹(ping)ï¼Œæ— æ•ˆè¿æ¥ä¼šè¢«ç§»é™¤</td><td>false</td><td>ä¸šåŠ¡é‡å¾ˆå¤§æ—¶å€™å»ºè®®è®¾ç½®ä¸ºfalse(å¤šä¸€æ¬¡pingçš„å¼€é”€)ã€‚</td></tr><tr><td>7</td><td>testOnReturn</td><td>å‘èµ„æºæ± å½’è¿˜è¿æ¥æ—¶æ˜¯å¦åšè¿æ¥æœ‰æ•ˆæ€§æ£€æµ‹(ping)ï¼Œæ— æ•ˆè¿æ¥ä¼šè¢«ç§»é™¤</td><td>false</td><td>ä¸šåŠ¡é‡å¾ˆå¤§æ—¶å€™å»ºè®®è®¾ç½®ä¸ºfalse(å¤šä¸€æ¬¡pingçš„å¼€é”€)ã€‚</td></tr><tr><td>8</td><td>jmxEnabled</td><td>æ˜¯å¦å¼€å¯jmxç›‘æ§ï¼Œå¯ç”¨äºç›‘æ§</td><td>true</td><td>å»ºè®®å¼€å¯ï¼Œä½†åº”ç”¨æœ¬èº«ä¹Ÿè¦å¼€å¯</td></tr></tbody></table><p><strong>ä¼˜åŒ–å»ºè®®ï¼š</strong></p><p>1ï¼‰<strong>maxTotal</strong>ï¼šæœ€å¤§è¿æ¥æ•°ï¼Œæ—©æœŸçš„ç‰ˆæœ¬å«maxActive</p><p>å®é™…ä¸Šè¿™ä¸ªæ˜¯ä¸€ä¸ªå¾ˆéš¾å›ç­”çš„é—®é¢˜ï¼Œè€ƒè™‘çš„å› ç´ æ¯”è¾ƒå¤šï¼š</p><ul><li>ä¸šåŠ¡å¸Œæœ›Rediså¹¶å‘é‡</li><li>å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤æ—¶é—´</li><li>Redisèµ„æºï¼šä¾‹å¦‚ nodes(ä¾‹å¦‚åº”ç”¨ä¸ªæ•°) * maxTotal æ˜¯ä¸èƒ½è¶…è¿‡redisçš„æœ€å¤§è¿æ¥æ•°maxclientsã€‚</li><li>èµ„æºå¼€é”€ï¼šä¾‹å¦‚è™½ç„¶å¸Œæœ›æ§åˆ¶<strong>ç©ºé—²è¿æ¥</strong>(è¿æ¥æ± æ­¤åˆ»å¯é©¬ä¸Šä½¿ç”¨çš„è¿æ¥)ï¼Œä½†æ˜¯ä¸å¸Œæœ›å› ä¸ºè¿æ¥æ± çš„é¢‘ç¹é‡Šæ”¾åˆ›å»ºè¿æ¥é€ æˆä¸å¿…é å¼€é”€ã€‚</li></ul><p><strong>ä»¥ä¸€ä¸ªä¾‹å­è¯´æ˜</strong>ï¼Œå‡è®¾:</p><ul><li>ä¸€æ¬¡å‘½ä»¤æ—¶é—´ï¼ˆborrow|return resource + Jedisæ‰§è¡Œå‘½ä»¤(å«ç½‘ç»œ) ï¼‰çš„å¹³å‡è€—æ—¶çº¦ä¸º1msï¼Œä¸€ä¸ªè¿æ¥çš„QPSå¤§çº¦æ˜¯1000</li><li>ä¸šåŠ¡æœŸæœ›çš„QPSæ˜¯50000</li></ul><p>é‚£ä¹ˆç†è®ºä¸Šéœ€è¦çš„èµ„æºæ± å¤§å°æ˜¯50000 / 1000 = 50ä¸ªã€‚ä½†äº‹å®ä¸Šè¿™æ˜¯ä¸ªç†è®ºå€¼ï¼Œè¿˜è¦è€ƒè™‘åˆ°è¦æ¯”ç†è®ºå€¼é¢„ç•™ä¸€äº›èµ„æºï¼Œé€šå¸¸æ¥è®²maxTotalå¯ä»¥æ¯”ç†è®ºå€¼å¤§ä¸€äº›ã€‚</p><p>ä½†è¿™ä¸ªå€¼ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œä¸€æ–¹é¢è¿æ¥å¤ªå¤šå ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯èµ„æºï¼Œå¦ä¸€æ–¹é¢å¯¹äºRedisè¿™ç§é«˜QPSçš„æœåŠ¡å™¨ï¼Œä¸€ä¸ªå¤§å‘½ä»¤çš„é˜»å¡å³ä½¿è®¾ç½®å†å¤§èµ„æºæ± ä»ç„¶ä¼šæ— æµäºäº‹ã€‚</p><p>2ï¼‰<strong>maxIdleå’ŒminIdle</strong></p><p>maxIdleå®é™…ä¸Šæ‰æ˜¯ä¸šåŠ¡éœ€è¦çš„æœ€å¤§è¿æ¥æ•°ï¼ŒmaxTotalæ˜¯ä¸ºäº†<strong>ç»™å‡ºä½™é‡</strong>ï¼Œæ‰€ä»¥maxIdleä¸è¦è®¾ç½®è¿‡å°ï¼Œå¦åˆ™ä¼šæœ‰new Jedis(æ–°è¿æ¥)å¼€é”€ã€‚</p><p><strong>è¿æ¥æ± çš„æœ€ä½³æ€§èƒ½æ˜¯maxTotal = maxIdle</strong>ï¼Œè¿™æ ·å°±é¿å…è¿æ¥æ± ä¼¸ç¼©å¸¦æ¥çš„æ€§èƒ½å¹²æ‰°ã€‚ä½†æ˜¯å¦‚æœå¹¶å‘é‡ä¸å¤§æˆ–è€…maxTotalè®¾ç½®è¿‡é«˜ï¼Œä¼šå¯¼è‡´ä¸å¿…è¦çš„è¿æ¥èµ„æºæµªè´¹ã€‚ä¸€èˆ¬æ¨èmaxIdleå¯ä»¥è®¾ç½®ä¸ºæŒ‰ä¸Šé¢çš„ä¸šåŠ¡æœŸæœ›QPSè®¡ç®—å‡ºæ¥çš„ç†è®ºè¿æ¥æ•°ï¼ŒmaxTotalå¯ä»¥å†æ”¾å¤§ä¸€å€ã€‚</p><p>minIdleï¼ˆæœ€å°ç©ºé—²è¿æ¥æ•°ï¼‰ï¼Œä¸å…¶è¯´æ˜¯æœ€å°ç©ºé—²è¿æ¥æ•°ï¼Œä¸å¦‚è¯´æ˜¯&quot;<strong>è‡³å°‘éœ€è¦ä¿æŒçš„ç©ºé—²è¿æ¥æ•°</strong>&quot;ï¼Œåœ¨ä½¿ç”¨è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¿æ¥æ•°è¶…è¿‡äº†minIdleï¼Œé‚£ä¹ˆç»§ç»­å»ºç«‹è¿æ¥ï¼Œå¦‚æœè¶…è¿‡äº†maxIdleï¼Œå½“è¶…è¿‡çš„è¿æ¥æ‰§è¡Œå®Œä¸šåŠ¡åä¼šæ…¢æ…¢è¢«ç§»å‡ºè¿æ¥æ± é‡Šæ”¾æ‰ã€‚</p><p>å¦‚æœç³»ç»Ÿå¯åŠ¨å®Œé©¬ä¸Šå°±ä¼šæœ‰å¾ˆå¤šçš„è¯·æ±‚è¿‡æ¥ï¼Œé‚£ä¹ˆå¯ä»¥ç»™redisè¿æ¥æ± åš<strong>é¢„çƒ­</strong>ï¼Œæ¯”å¦‚å¿«é€Ÿçš„åˆ›å»ºä¸€äº›redisè¿æ¥ï¼Œæ‰§è¡Œç®€å•å‘½ä»¤ï¼Œç±»ä¼¼ping()ï¼Œå¿«é€Ÿçš„å°†è¿æ¥æ± é‡Œçš„ç©ºé—²è¿æ¥æå‡åˆ°minIdleçš„æ•°é‡ã€‚</p><p><strong>è¿æ¥æ± é¢„çƒ­</strong></p><p>ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Jedis</span><span class="token punctuation">&gt;</span></span> minIdleJedisList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Jedis</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>jedisPoolConfig<span class="token punctuation">.</span><span class="token function">getMinIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> jedisPoolConfig<span class="token punctuation">.</span><span class="token function">getMinIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        jedis <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        minIdleJedisList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>jedis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ³¨æ„ï¼Œè¿™é‡Œä¸èƒ½é©¬ä¸Šcloseå°†è¿æ¥è¿˜å›è¿æ¥æ± ï¼Œå¦åˆ™æœ€åè¿æ¥æ± é‡Œåªä¼šå»ºç«‹1ä¸ªè¿æ¥ã€‚ã€‚</span>
        <span class="token comment">//jedis.close();</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//ç»Ÿä¸€å°†é¢„çƒ­çš„è¿æ¥è¿˜å›è¿æ¥æ± </span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> jedisPoolConfig<span class="token punctuation">.</span><span class="token function">getMinIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        jedis <span class="token operator">=</span> minIdleJedisList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†è¿æ¥å½’è¿˜å›è¿æ¥æ± </span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ä¹‹ï¼Œè¦æ ¹æ®å®é™…ç³»ç»Ÿçš„QPSå’Œè°ƒç”¨rediså®¢æˆ·ç«¯çš„è§„æ¨¡æ•´ä½“è¯„ä¼°æ¯ä¸ªèŠ‚ç‚¹æ‰€ä½¿ç”¨çš„è¿æ¥æ± å¤§å°ã€‚</p><p>3.ã€å»ºè®®ã€‘</p><p>é«˜å¹¶å‘ä¸‹å»ºè®®å®¢æˆ·ç«¯æ·»åŠ ç†”æ–­åŠŸèƒ½(ä¾‹å¦‚sentinelã€hystrix)</p><p>4.ã€æ¨èã€‘</p><p>è®¾ç½®åˆç†çš„å¯†ç ï¼Œå¦‚æœ‰å¿…è¦å¯ä»¥ä½¿ç”¨SSLåŠ å¯†è®¿é—®</p><p>5.ã€å»ºè®®ã€‘</p><p><strong>Rediså¯¹äºè¿‡æœŸé”®æœ‰ä¸‰ç§æ¸…é™¤ç­–ç•¥ï¼š</strong></p><ol><li>è¢«åŠ¨åˆ é™¤ï¼šå½“è¯»/å†™ä¸€ä¸ªå·²ç»è¿‡æœŸçš„keyæ—¶ï¼Œä¼šè§¦å‘æƒ°æ€§åˆ é™¤ç­–ç•¥ï¼Œç›´æ¥åˆ é™¤æ‰è¿™ä¸ªè¿‡æœŸkey</li><li>ä¸»åŠ¨åˆ é™¤ï¼šç”±äºæƒ°æ€§åˆ é™¤ç­–ç•¥æ— æ³•ä¿è¯å†·æ•°æ®è¢«åŠæ—¶åˆ æ‰ï¼Œæ‰€ä»¥Redisä¼šå®šæœŸ(é»˜è®¤æ¯100ms)ä¸»åŠ¨æ·˜æ±°ä¸€æ‰¹<strong>å·²è¿‡æœŸ</strong>çš„keyï¼Œè¿™é‡Œçš„ä¸€æ‰¹åªæ˜¯éƒ¨åˆ†è¿‡æœŸkeyï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°éƒ¨åˆ†keyå·²ç»è¿‡æœŸä½†è¿˜æ²¡æœ‰è¢«æ¸…ç†æ‰çš„æƒ…å†µï¼Œå¯¼è‡´å†…å­˜å¹¶æ²¡æœ‰è¢«é‡Šæ”¾</li><li>å½“å‰å·²ç”¨å†…å­˜è¶…è¿‡maxmemoryé™å®šæ—¶ï¼Œè§¦å‘<strong>ä¸»åŠ¨æ¸…ç†ç­–ç•¥</strong></li></ol><p><strong>ä¸»åŠ¨æ¸…ç†ç­–ç•¥</strong>åœ¨Redis 4.0 ä¹‹å‰ä¸€å…±å®ç°äº† 6 ç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œåœ¨ 4.0 ä¹‹åï¼Œåˆå¢åŠ äº† 2 ç§ç­–ç•¥ï¼Œæ€»å…±8ç§ï¼š</p><p><strong>a) é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyåšå¤„ç†ï¼š</strong></p><ol><li>volatile-ttlï¼šåœ¨ç­›é€‰æ—¶ï¼Œä¼šé’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼Œæ ¹æ®è¿‡æœŸæ—¶é—´çš„å…ˆåè¿›è¡Œåˆ é™¤ï¼Œè¶Šæ—©è¿‡æœŸçš„è¶Šå…ˆè¢«åˆ é™¤ã€‚</li><li>volatile-randomï¼šå°±åƒå®ƒçš„åç§°ä¸€æ ·ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ä¸­ï¼Œè¿›è¡Œéšæœºåˆ é™¤ã€‚</li><li>volatile-lruï¼šä¼šä½¿ç”¨ LRU ç®—æ³•ç­›é€‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹åˆ é™¤ã€‚</li><li>volatile-lfuï¼šä¼šä½¿ç”¨ LFU ç®—æ³•ç­›é€‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹åˆ é™¤ã€‚</li></ol><p><strong>b) é’ˆå¯¹æ‰€æœ‰çš„keyåšå¤„ç†ï¼š</strong></p><ol><li>allkeys-randomï¼šä»æ‰€æœ‰é”®å€¼å¯¹ä¸­éšæœºé€‰æ‹©å¹¶åˆ é™¤æ•°æ®ã€‚</li><li>allkeys-lruï¼šä½¿ç”¨ LRU ç®—æ³•åœ¨æ‰€æœ‰æ•°æ®ä¸­è¿›è¡Œç­›é€‰åˆ é™¤ã€‚</li><li>allkeys-lfuï¼šä½¿ç”¨ LFU ç®—æ³•åœ¨æ‰€æœ‰æ•°æ®ä¸­è¿›è¡Œç­›é€‰åˆ é™¤ã€‚</li></ol><p><strong>c) ä¸å¤„ç†ï¼š</strong></p><ol><li>noevictionï¼šä¸ä¼šå‰”é™¤ä»»ä½•æ•°æ®ï¼Œæ‹’ç»æ‰€æœ‰å†™å…¥æ“ä½œå¹¶è¿”å›å®¢æˆ·ç«¯é”™è¯¯ä¿¡æ¯&quot;(error) OOM command not allowed when used memory&quot;ï¼Œæ­¤æ—¶Redisåªå“åº”è¯»æ“ä½œã€‚</li></ol><p><strong>LRU ç®—æ³•</strong>ï¼ˆLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰</p><p>æ·˜æ±°å¾ˆä¹…æ²¡è¢«è®¿é—®è¿‡çš„æ•°æ®ï¼Œä»¥<strong>æœ€è¿‘ä¸€æ¬¡è®¿é—®æ—¶é—´</strong>ä½œä¸ºå‚è€ƒã€‚</p><p><strong>LFU ç®—æ³•</strong>ï¼ˆLeast Frequently Usedï¼Œæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼‰</p><p>æ·˜æ±°æœ€è¿‘ä¸€æ®µæ—¶é—´è¢«è®¿é—®æ¬¡æ•°æœ€å°‘çš„æ•°æ®ï¼Œä»¥<strong>æ¬¡æ•°</strong>ä½œä¸ºå‚è€ƒã€‚</p><p>å½“å­˜åœ¨çƒ­ç‚¹æ•°æ®æ—¶ï¼ŒLRUçš„æ•ˆç‡å¾ˆå¥½ï¼Œä½†å¶å‘æ€§çš„ã€å‘¨æœŸæ€§çš„æ‰¹é‡æ“ä½œä¼šå¯¼è‡´LRUå‘½ä¸­ç‡æ€¥å‰§ä¸‹é™ï¼Œç¼“å­˜æ±¡æŸ“æƒ…å†µæ¯”è¾ƒä¸¥é‡ã€‚è¿™æ—¶ä½¿ç”¨LFUå¯èƒ½æ›´å¥½ç‚¹ã€‚</p><p>æ ¹æ®è‡ªèº«ä¸šåŠ¡ç±»å‹ï¼Œé…ç½®å¥½maxmemory-policy(é»˜è®¤æ˜¯noeviction)ï¼Œæ¨èä½¿ç”¨volatile-lruã€‚å¦‚æœä¸è®¾ç½®æœ€å¤§å†…å­˜ï¼Œå½“ Redis å†…å­˜è¶…å‡ºç‰©ç†å†…å­˜é™åˆ¶æ—¶ï¼Œå†…å­˜çš„æ•°æ®ä¼šå¼€å§‹å’Œç£ç›˜äº§ç”Ÿé¢‘ç¹çš„äº¤æ¢ (swap)ï¼Œä¼šè®© Redis çš„æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚</p><p>å½“Redisè¿è¡Œåœ¨ä¸»ä»æ¨¡å¼æ—¶ï¼Œåªæœ‰ä¸»ç»“ç‚¹æ‰ä¼šæ‰§è¡Œè¿‡æœŸåˆ é™¤ç­–ç•¥ï¼Œç„¶åæŠŠåˆ é™¤æ“ä½œâ€del keyâ€åŒæ­¥åˆ°ä»ç»“ç‚¹åˆ é™¤æ•°æ®ã€‚</p><p><strong>å››ã€ç³»ç»Ÿå†…æ ¸å‚æ•°ä¼˜åŒ–</strong></p><p><strong>vm.swapiness</strong></p><p>swapå¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´æ¯”è¾ƒé‡è¦ï¼Œå½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œå¯ä»¥å°†ä¸€éƒ¨åˆ†å†…å­˜é¡µè¿›è¡Œswapåˆ°ç¡¬ç›˜ä¸Šï¼Œä»¥è§£ç‡ƒçœ‰ä¹‹æ€¥ã€‚ä½†ä¸–ç•Œä¸Šæ²¡æœ‰å…è´¹åˆé¤ï¼Œswapç©ºé—´ç”±ç¡¬ç›˜æä¾›ï¼Œå¯¹äºéœ€è¦é«˜å¹¶å‘ã€é«˜ååçš„åº”ç”¨æ¥è¯´ï¼Œç£ç›˜IOé€šå¸¸ä¼šæˆä¸ºç³»ç»Ÿç“¶é¢ˆã€‚åœ¨Linuxä¸­ï¼Œå¹¶ä¸æ˜¯è¦ç­‰åˆ°æ‰€æœ‰ç‰©ç†å†…å­˜éƒ½ä½¿ç”¨å®Œæ‰ä¼šä½¿ç”¨åˆ°swapï¼Œç³»ç»Ÿå‚æ•°swppinessä¼šå†³å®šæ“ä½œç³»ç»Ÿä½¿ç”¨swapçš„å€¾å‘ç¨‹åº¦ã€‚swappinessçš„å–å€¼èŒƒå›´æ˜¯0~100ï¼Œswappinessçš„å€¼è¶Šå¤§ï¼Œè¯´æ˜æ“ä½œç³»ç»Ÿå¯èƒ½ä½¿ç”¨swapçš„æ¦‚ç‡è¶Šé«˜ï¼Œswappinesså€¼è¶Šä½ï¼Œè¡¨ç¤ºæ“ä½œç³»ç»Ÿæ›´åŠ å€¾å‘äºä½¿ç”¨ç‰©ç†å†…å­˜ã€‚swappinessçš„å–å€¼è¶Šå¤§ï¼Œè¯´æ˜æ“ä½œç³»ç»Ÿå¯èƒ½ä½¿ç”¨swapçš„æ¦‚ç‡è¶Šé«˜ï¼Œè¶Šä½åˆ™è¶Šå€¾å‘äºä½¿ç”¨ç‰©ç†å†…å­˜ã€‚</p><p>å¦‚æœlinuxå†…æ ¸ç‰ˆæœ¬&lt;3.5ï¼Œé‚£ä¹ˆswapinessè®¾ç½®ä¸º0ï¼Œè¿™æ ·ç³»ç»Ÿå®æ„¿swapä¹Ÿä¸ä¼šoom killerï¼ˆæ€æ‰è¿›ç¨‹ï¼‰</p><p>å¦‚æœlinuxå†…æ ¸ç‰ˆæœ¬&gt;=3.5ï¼Œé‚£ä¹ˆswapinessè®¾ç½®ä¸º1ï¼Œè¿™æ ·ç³»ç»Ÿå®æ„¿swapä¹Ÿä¸ä¼šoom killer</p><p>ä¸€èˆ¬éœ€è¦ä¿è¯redisä¸ä¼šè¢«killæ‰ï¼š</p><p>â€‹ cat /proc/version #æŸ¥çœ‹linuxå†…æ ¸ç‰ˆæœ¬ echo 1 &gt; /proc/sys/vm/swappiness echo vm.swapiness=1 &gt;&gt; /etc/sysctl.conf</p><p>PSï¼šOOM killer æœºåˆ¶æ˜¯æŒ‡Linuxæ“ä½œç³»ç»Ÿå‘ç°å¯ç”¨å†…å­˜ä¸è¶³æ—¶ï¼Œå¼ºåˆ¶æ€æ­»ä¸€äº›ç”¨æˆ·è¿›ç¨‹ï¼ˆéå†…æ ¸è¿›ç¨‹ï¼‰ï¼Œæ¥ä¿è¯ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜è¿›è¡Œåˆ†é…ã€‚</p><p><strong>vm.overcommit_memory(é»˜è®¤0)</strong></p><p>0ï¼šè¡¨ç¤ºå†…æ ¸å°†æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨ç‰©ç†å†…å­˜(å®é™…ä¸ä¸€å®šç”¨æ»¡)ä¾›åº”ç”¨è¿›ç¨‹ä½¿ç”¨ï¼›å¦‚æœæœ‰è¶³å¤Ÿçš„å¯ç”¨ç‰©ç†å†…å­˜ï¼Œå†…å­˜ç”³è¯·å…è®¸ï¼›å¦åˆ™ï¼Œå†…å­˜ç”³è¯·å¤±è´¥ï¼Œå¹¶æŠŠé”™è¯¯è¿”å›ç»™åº”ç”¨è¿›ç¨‹</p><p>1ï¼šè¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…æ‰€æœ‰çš„ç‰©ç†å†…å­˜ï¼Œè€Œä¸ç®¡å½“å‰çš„å†…å­˜çŠ¶æ€å¦‚ä½•</p><p>å¦‚æœæ˜¯0çš„è¯ï¼Œå¯èƒ½å¯¼è‡´ç±»ä¼¼forkç­‰æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œç”³è¯·ä¸åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´</p><p>Rediså»ºè®®æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸º1ï¼Œå°±æ˜¯ä¸ºäº†è®©forkæ“ä½œèƒ½å¤Ÿåœ¨ä½å†…å­˜ä¸‹ä¹Ÿæ‰§è¡ŒæˆåŠŸã€‚</p><p>â€‹ cat /proc/sys/vm/overcommit_memory echo &quot;vm.overcommit_memory=1&quot; &gt;&gt; /etc/sysctl.conf sysctl vm.overcommit_memory=1</p><p><strong>åˆç†è®¾ç½®æ–‡ä»¶å¥æŸ„æ•°</strong></p><p>æ“ä½œç³»ç»Ÿè¿›ç¨‹è¯•å›¾æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶(æˆ–è€…å«å¥æŸ„)ï¼Œä½†æ˜¯ç°åœ¨è¿›ç¨‹æ‰“å¼€çš„å¥æŸ„æ•°å·²ç»è¾¾åˆ°äº†ä¸Šé™ï¼Œç»§ç»­æ‰“å¼€ä¼šæŠ¥é”™ï¼šâ€œToo many open filesâ€</p><p>ulimit -a #æŸ¥çœ‹ç³»ç»Ÿæ–‡ä»¶å¥æŸ„æ•°ï¼Œçœ‹open filesé‚£é¡¹ ulimit -n 65535 #è®¾ç½®ç³»ç»Ÿæ–‡ä»¶å¥æŸ„æ•°</p><p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šslowlog</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Redisæ…¢æ—¥å¿—å‘½ä»¤è¯´æ˜:
config get slow <span class="token comment">#æŸ¥è¯¢æœ‰å…³æ…¢æ—¥å¿—çš„é…ç½®ä¿¡æ¯</span>
config <span class="token builtin class-name">set</span> slowlog-log-slower-than <span class="token number">20000</span>  <span class="token comment">#è®¾ç½®æ…¢æ—¥å¿—ä½¿æ—¶é—´é˜ˆå€¼,å•ä½å¾®ç§’ï¼Œæ­¤å¤„ä¸º20æ¯«ç§’ï¼Œå³è¶…è¿‡20æ¯«ç§’çš„æ“ä½œéƒ½ä¼šè®°å½•ä¸‹æ¥ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®1000ï¼Œä¹Ÿå°±æ˜¯1msï¼Œè¿™æ ·ç†è®ºä¸Šrediså¹¶å‘è‡³å°‘è¾¾åˆ°1000ï¼Œå¦‚æœè¦æ±‚å•æœºå¹¶å‘è¾¾åˆ°1ä¸‡ä»¥ä¸Šï¼Œè¿™ä¸ªå€¼å¯ä»¥è®¾ç½®ä¸º100</span>
config <span class="token builtin class-name">set</span> slowlog-max-len <span class="token number">1024</span>  <span class="token comment">#è®¾ç½®æ…¢æ—¥å¿—è®°å½•ä¿å­˜æ•°é‡ï¼Œå¦‚æœä¿å­˜æ•°é‡å·²æ»¡ï¼Œä¼šåˆ é™¤æœ€æ—©çš„è®°å½•ï¼Œæœ€æ–°çš„è®°å½•è¿½åŠ è¿›æ¥ã€‚è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—æ—¶Redisä¼šå¯¹é•¿å‘½ä»¤åšæˆªæ–­æ“ä½œï¼Œå¹¶ä¸ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œå»ºè®®è®¾ç½®ç¨å¤§äº›ï¼Œé˜²æ­¢ä¸¢å¤±æ—¥å¿—</span>
config rewrite <span class="token comment">#å°†æœåŠ¡å™¨å½“å‰æ‰€ä½¿ç”¨çš„é…ç½®ä¿å­˜åˆ°redis.conf</span>
slowlog len <span class="token comment">#è·å–æ…¢æŸ¥è¯¢æ—¥å¿—åˆ—è¡¨çš„å½“å‰é•¿åº¦</span>
slowlog get <span class="token number">5</span> <span class="token comment">#è·å–æœ€æ–°çš„5æ¡æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚æ…¢æŸ¥è¯¢æ—¥å¿—ç”±å››ä¸ªå±æ€§ç»„æˆï¼šæ ‡è¯†IDï¼Œå‘ç”Ÿæ—¶é—´æˆ³ï¼Œå‘½ä»¤è€—æ—¶ï¼Œæ‰§è¡Œå‘½ä»¤å’Œå‚æ•°</span>
slowlog reset <span class="token comment">#é‡ç½®æ…¢æŸ¥è¯¢æ—¥å¿— </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><!----><div class="copyright">Copyright Â© 2023 æ±Ÿ</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-6d45e392.js" defer></script>
  </body>
</html>
