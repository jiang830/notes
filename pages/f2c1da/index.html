<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.26" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <title>Redisç¼“å­˜è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-CV-aSyL0.css" as="style"><link rel="stylesheet" href="/assets/style-CV-aSyL0.css">
    <link rel="modulepreload" href="/assets/app-CcJZcE5q.js"><link rel="modulepreload" href="/assets/index.html-pkZ_qPdt.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-CySwgr6W.js" as="script"><link rel="prefetch" href="/assets/index.html-DIQ6wV2c.js" as="script"><link rel="prefetch" href="/assets/index.html-DA9ZST6q.js" as="script"><link rel="prefetch" href="/assets/index.html-B1qwKQDM.js" as="script"><link rel="prefetch" href="/assets/index.html-QtYXnaPY.js" as="script"><link rel="prefetch" href="/assets/index.html-BoWZ1hiX.js" as="script"><link rel="prefetch" href="/assets/index.html-D1eqxnz4.js" as="script"><link rel="prefetch" href="/assets/index.html-Bkd8jpbq.js" as="script"><link rel="prefetch" href="/assets/index.html-CaPpN9fA.js" as="script"><link rel="prefetch" href="/assets/é˜¿é‡Œäº‘é¢è¯•é¢˜.html-BdFdwHHT.js" as="script"><link rel="prefetch" href="/assets/index.html-Dar6C79p.js" as="script"><link rel="prefetch" href="/assets/index.html-3LHzgUol.js" as="script"><link rel="prefetch" href="/assets/index.html-CNyrWvjP.js" as="script"><link rel="prefetch" href="/assets/index.html-tMJw4xAU.js" as="script"><link rel="prefetch" href="/assets/index.html-BBna-ubM.js" as="script"><link rel="prefetch" href="/assets/index.html-CQDrMRFa.js" as="script"><link rel="prefetch" href="/assets/index.html-BHHkC0SB.js" as="script"><link rel="prefetch" href="/assets/index.html-BT27OHXI.js" as="script"><link rel="prefetch" href="/assets/index.html-Ph_N0RhT.js" as="script"><link rel="prefetch" href="/assets/index.html-C0SZgDj-.js" as="script"><link rel="prefetch" href="/assets/index.html-COW2J1ah.js" as="script"><link rel="prefetch" href="/assets/index.html-CwlZk0kb.js" as="script"><link rel="prefetch" href="/assets/index.html-mOUgrTfQ.js" as="script"><link rel="prefetch" href="/assets/index.html-StCMFG4Y.js" as="script"><link rel="prefetch" href="/assets/index.html-meFoXNUk.js" as="script"><link rel="prefetch" href="/assets/index.html-D6UDt-z1.js" as="script"><link rel="prefetch" href="/assets/index.html-C4CeTDFP.js" as="script"><link rel="prefetch" href="/assets/index.html-DJOa7j38.js" as="script"><link rel="prefetch" href="/assets/index.html-u2YQwqCK.js" as="script"><link rel="prefetch" href="/assets/index.html-BoiC8F1t.js" as="script"><link rel="prefetch" href="/assets/index.html-CSq9YTr5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cyr0Ht9E.js" as="script"><link rel="prefetch" href="/assets/index.html-CpAXHyhZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DLvEiH8j.js" as="script"><link rel="prefetch" href="/assets/index.html-DfVjwGrn.js" as="script"><link rel="prefetch" href="/assets/index.html-BhnlQTe0.js" as="script"><link rel="prefetch" href="/assets/index.html-B3Q99jzV.js" as="script"><link rel="prefetch" href="/assets/index.html-C_jS85gJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DTuYMkqZ.js" as="script"><link rel="prefetch" href="/assets/index.html-ByDsocQC.js" as="script"><link rel="prefetch" href="/assets/index.html-Dx60V46q.js" as="script"><link rel="prefetch" href="/assets/index.html-B2169YvJ.js" as="script"><link rel="prefetch" href="/assets/index.html-u7yWxVkO.js" as="script"><link rel="prefetch" href="/assets/index.html-BAcuX6ex.js" as="script"><link rel="prefetch" href="/assets/index.html-CKFJiaUe.js" as="script"><link rel="prefetch" href="/assets/index.html-BQolQXiO.js" as="script"><link rel="prefetch" href="/assets/index.html-CV5OM5nX.js" as="script"><link rel="prefetch" href="/assets/index.html-edSgNf-M.js" as="script"><link rel="prefetch" href="/assets/index.html-BfO_EaOy.js" as="script"><link rel="prefetch" href="/assets/index.html-nyRG_LTF.js" as="script"><link rel="prefetch" href="/assets/index.html-D-frKFlo.js" as="script"><link rel="prefetch" href="/assets/00.åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-Cpl05HCa.js" as="script"><link rel="prefetch" href="/assets/index.html-Cq20v4BB.js" as="script"><link rel="prefetch" href="/assets/index.html-BVORs3On.js" as="script"><link rel="prefetch" href="/assets/index.html-BP6aZUE6.js" as="script"><link rel="prefetch" href="/assets/index.html-B-3_fbg6.js" as="script"><link rel="prefetch" href="/assets/index.html-CpJC_HeG.js" as="script"><link rel="prefetch" href="/assets/index.html-DjnTf6fe.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-D7z1G1-N.js" as="script"><link rel="prefetch" href="/assets/07.MySQLé”æœºåˆ¶ä¸ä¼˜åŒ–å®è·µä»¥åŠMVCCåº•å±‚åŸç†å‰–æ.html-BKAa643F.js" as="script"><link rel="prefetch" href="/assets/index.html-CxmzedXX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dzfk79WX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dn63XTEd.js" as="script"><link rel="prefetch" href="/assets/index.html-CzdtGl0g.js" as="script"><link rel="prefetch" href="/assets/index.html-9PiiOmcM.js" as="script"><link rel="prefetch" href="/assets/index.html-BmA5G_Wx.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-DuPwqrAu.js" as="script"><link rel="prefetch" href="/assets/index.html-BQ7HKii8.js" as="script"><link rel="prefetch" href="/assets/index.html-Ba0Idv51.js" as="script"><link rel="prefetch" href="/assets/index.html-joJLtsXk.js" as="script"><link rel="prefetch" href="/assets/index.html-L8Hlw6sX.js" as="script"><link rel="prefetch" href="/assets/index.html-C8_gL8dh.js" as="script"><link rel="prefetch" href="/assets/index.html-6Tc1Q6ZE.js" as="script"><link rel="prefetch" href="/assets/index.html-VO0-ALK9.js" as="script"><link rel="prefetch" href="/assets/index.html-BPdXD1cL.js" as="script"><link rel="prefetch" href="/assets/index.html-j-8Qjm4N.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz_Qhpe9.js" as="script"><link rel="prefetch" href="/assets/index.html-CcaTKqjZ.js" as="script"><link rel="prefetch" href="/assets/index.html-o-IA65eG.js" as="script"><link rel="prefetch" href="/assets/index.html-y0YOCSWX.js" as="script"><link rel="prefetch" href="/assets/index.html-BdP5ezWY.js" as="script"><link rel="prefetch" href="/assets/index.html-C6GUmZlK.js" as="script"><link rel="prefetch" href="/assets/index.html-zkImwKAM.js" as="script"><link rel="prefetch" href="/assets/index.html-B-rM7PKP.js" as="script"><link rel="prefetch" href="/assets/index.html-Bdbd7zWB.js" as="script"><link rel="prefetch" href="/assets/index.html-PQLu_cdG.js" as="script"><link rel="prefetch" href="/assets/index.html-BaByp152.js" as="script"><link rel="prefetch" href="/assets/index.html-DQrw1sGU.js" as="script"><link rel="prefetch" href="/assets/404.html-Xl7f9Pk5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cim6WBqA.js" as="script"><link rel="prefetch" href="/assets/index.html-DBgI0Ctx.js" as="script"><link rel="prefetch" href="/assets/index.html-CjlsAUhS.js" as="script"><link rel="prefetch" href="/assets/index.html-DBEQHe26.js" as="script"><link rel="prefetch" href="/assets/index.html-BrqbaMMm.js" as="script"><link rel="prefetch" href="/assets/index.html-B_JMJTKH.js" as="script"><link rel="prefetch" href="/assets/index.html-8JHj6Ere.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script"><link rel="prefetch" href="/assets/SearchResult-FVi5R2x7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><!----><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="é¦–é¡µ"><span class="font-icon icon circle-question" style=""></span>é¦–é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link active" href="/pages/" aria-label="æ–‡æ¡£"><span class="font-icon icon circle-question" style=""></span>æ–‡æ¡£<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">åˆ†å¸ƒå¼</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">00. Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/d2145d/" aria-label="Redis HyperLogLogåº•å±‚ä¸GEO"><!---->Redis HyperLogLogåº•å±‚ä¸GEO<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/6af36a/" aria-label="Redisä¸»ä»ä¸å“¨å…µæ¶æ„"><!---->Redisä¸»ä»ä¸å“¨å…µæ¶æ„<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/206e51/" aria-label="Rediså“¨å…µæœºåˆ¶"><!---->Rediså“¨å…µæœºåˆ¶<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/c92b96/" aria-label="Rediså®‰è£…"><!---->Rediså®‰è£…<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/659c00/" aria-label="Rediså¸¸è§é¢è¯•é¢˜"><!---->Rediså¸¸è§é¢è¯•é¢˜<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/44b655/" aria-label="RedisæŒä¹…åŒ–ç­–ç•¥"><!---->RedisæŒä¹…åŒ–ç­–ç•¥<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/d9ed45/" aria-label="Redisæ ¸å¿ƒæ•°æ®ç»“æ„"><!---->Redisæ ¸å¿ƒæ•°æ®ç»“æ„<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/bf6627/" aria-label="Redisæºç ä»¥åŠæ ¸å¿ƒè®¾è®¡åŸç†"><!---->Redisæºç ä»¥åŠæ ¸å¿ƒè®¾è®¡åŸç†<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/pages/f2c1da/" aria-label="Redisç¼“å­˜è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–"><!---->Redisç¼“å­˜è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/f2c1da/#å¤šçº§ç¼“å­˜æ¶æ„" aria-label="å¤šçº§ç¼“å­˜æ¶æ„"><!---->å¤šçº§ç¼“å­˜æ¶æ„<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/f2c1da/#ç¼“å­˜ç©¿é€" aria-label="ç¼“å­˜ç©¿é€"><!---->ç¼“å­˜ç©¿é€<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/f2c1da/#ç¼“å­˜ç©¿é€é—®é¢˜è§£å†³æ–¹æ¡ˆ" aria-label="ç¼“å­˜ç©¿é€é—®é¢˜è§£å†³æ–¹æ¡ˆ"><!---->ç¼“å­˜ç©¿é€é—®é¢˜è§£å†³æ–¹æ¡ˆ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/f2c1da/#ç¼“å­˜å‡»ç©¿-å¤±æ•ˆ" aria-label="ç¼“å­˜å‡»ç©¿(å¤±æ•ˆ)"><!---->ç¼“å­˜å‡»ç©¿(å¤±æ•ˆ)<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/f2c1da/#ç¼“å­˜é›ªå´©" aria-label="ç¼“å­˜é›ªå´©"><!---->ç¼“å­˜é›ªå´©<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/f2c1da/#çƒ­ç‚¹ç¼“å­˜keyé‡å»ºä¼˜åŒ–" aria-label="çƒ­ç‚¹ç¼“å­˜keyé‡å»ºä¼˜åŒ–"><!---->çƒ­ç‚¹ç¼“å­˜keyé‡å»ºä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/f2c1da/#ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´" aria-label="ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´"><!---->ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/f2c1da/#å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–" aria-label="å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–"><!---->å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/7b5ba3/" aria-label="Redisç¼“å­˜é«˜å¯ç”¨é›†ç¾¤"><!---->Redisç¼“å­˜é«˜å¯ç”¨é›†ç¾¤<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/dce166/" aria-label="Redisç¼“å­˜é«˜å¯ç”¨é›†ç¾¤æ°´å¹³æ‰©å±•"><!---->Redisç¼“å­˜é«˜å¯ç”¨é›†ç¾¤æ°´å¹³æ‰©å±•<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/b70464/" aria-label="Redisé«˜å¹¶å‘åˆ†å¸ƒå¼é”"><!---->Redisé«˜å¹¶å‘åˆ†å¸ƒå¼é”<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/187ca5/" aria-label="Redisé«˜æ€§èƒ½åŸç†"><!---->Redisé«˜æ€§èƒ½åŸç†<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/736c6f/" aria-label="ä¸€çº¿å¤§å‚é«˜å¹¶å‘ç¼“å­˜æ¶æ„å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–"><!---->ä¸€çº¿å¤§å‚é«˜å¹¶å‘ç¼“å­˜æ¶æ„å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">02. Elastic Search</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">03. Dubbo</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">04. Zookeeper</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">05.æ¶ˆæ¯é˜Ÿåˆ—</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å®¹å™¨</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å¹¶å‘ç¼–ç¨‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å¾®æœåŠ¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">æ€§èƒ½è°ƒä¼˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">æºç æ¡†æ¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ç®—æ³•</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">è®¡ç®—æœºç½‘ç»œ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">é¢è¯•</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Redisç¼“å­˜è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">æ±Ÿ</span></span><span property="author" content="æ±Ÿ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-10-21T23:35:03.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 23 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT23M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#å¤šçº§ç¼“å­˜æ¶æ„">å¤šçº§ç¼“å­˜æ¶æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#ç¼“å­˜ç©¿é€">ç¼“å­˜ç©¿é€</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#ç¼“å­˜ç©¿é€é—®é¢˜è§£å†³æ–¹æ¡ˆ">ç¼“å­˜ç©¿é€é—®é¢˜è§£å†³æ–¹æ¡ˆ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#ç¼“å­˜å‡»ç©¿-å¤±æ•ˆ">ç¼“å­˜å‡»ç©¿(å¤±æ•ˆ)</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#ç¼“å­˜é›ªå´©">ç¼“å­˜é›ªå´©</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#çƒ­ç‚¹ç¼“å­˜keyé‡å»ºä¼˜åŒ–">çƒ­ç‚¹ç¼“å­˜keyé‡å»ºä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´">ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–">å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h2 id="å¤šçº§ç¼“å­˜æ¶æ„" tabindex="-1"><a class="header-anchor" href="#å¤šçº§ç¼“å­˜æ¶æ„"><span>å¤šçº§ç¼“å­˜æ¶æ„</span></a></h2><p><img src="https://img.jssjqd.cn/äº¿çº§æµé‡ç”µå•†ç½‘ç«™å¾®æœåŠ¡æ¶æ„.png" alt=""></p><h2 id="ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç©¿é€"><span>ç¼“å­˜ç©¿é€</span></a></h2><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®ï¼Œ ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚éƒ½ä¸ä¼šå‘½ä¸­ï¼Œé€šå¸¸å‡ºäºå®¹é”™çš„è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜å±‚ã€‚</p><p>ç¼“å­˜ç©¿é€å°†å¯¼è‡´ä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œ å¤±å»äº†ç¼“å­˜ä¿æŠ¤åç«¯å­˜å‚¨çš„æ„ä¹‰ã€‚</p><p>é€ æˆç¼“å­˜ç©¿é€çš„åŸºæœ¬åŸå› æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>è‡ªèº«ä¸šåŠ¡ä»£ç æˆ–è€…æ•°æ®å‡ºç°é—®é¢˜</p></li><li><p>ä¸€äº›æ¶æ„æ”»å‡»ã€çˆ¬è™«ç­‰é€ æˆå¤§é‡ç©ºå‘½ä¸­</p></li></ul><h3 id="ç¼“å­˜ç©¿é€é—®é¢˜è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç©¿é€é—®é¢˜è§£å†³æ–¹æ¡ˆ"><span>ç¼“å­˜ç©¿é€é—®é¢˜è§£å†³æ–¹æ¡ˆ</span></a></h3><h4 id="_1ã€ç¼“å­˜ç©ºå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_1ã€ç¼“å­˜ç©ºå¯¹è±¡"><span>1ã€ç¼“å­˜ç©ºå¯¹è±¡</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»ç¼“å­˜ä¸­è·å–æ•°æ®</span>
    <span class="token class-name">String</span> cacheValue <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç¼“å­˜ä¸ºç©º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>cacheValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä»å­˜å‚¨ä¸­è·å–</span>
        <span class="token class-name">String</span> storageValue <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> storageValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœå­˜å‚¨æ•°æ®ä¸ºç©ºï¼Œ éœ€è¦è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´(300ç§’)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>storageValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cache<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> storageValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¼“å­˜éç©º</span>
        <span class="token keyword">return</span> cacheValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>           
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2ã€å¸ƒéš†è¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#_2ã€å¸ƒéš†è¿‡æ»¤å™¨"><span>2ã€å¸ƒéš†è¿‡æ»¤å™¨</span></a></h4><p>å¯¹äºæ¶æ„æ”»å‡»ï¼Œå‘æœåŠ¡å™¨è¯·æ±‚å¤§é‡ä¸å­˜åœ¨çš„æ•°æ®é€ æˆçš„ç¼“å­˜ç©¿é€ï¼Œè¿˜å¯ä»¥ç”¨å¸ƒéš†è¿‡æ»¤å™¨å…ˆåšä¸€æ¬¡è¿‡æ»¤ï¼Œå¯¹äºä¸å­˜åœ¨çš„æ•°æ®å¸ƒéš†è¿‡æ»¤å™¨ä¸€èˆ¬éƒ½èƒ½å¤Ÿè¿‡æ»¤æ‰ï¼Œä¸è®©è¯·æ±‚å†å¾€åç«¯å‘é€ã€‚å½“å¸ƒéš†è¿‡æ»¤å™¨è¯´<strong>æŸä¸ªå€¼å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªå€¼å¯èƒ½ä¸å­˜åœ¨ï¼›å½“å®ƒè¯´ä¸å­˜åœ¨æ—¶ï¼Œé‚£å°±è‚¯å®šä¸å­˜åœ¨ã€‚</strong></p><p>â€‹ <img src="https://img.jssjqd.cn/20221021232709.png" alt=""></p><p>å¸ƒéš†è¿‡æ»¤å™¨å°±æ˜¯<strong>ä¸€ä¸ªå¤§å‹çš„ä½æ•°ç»„å’Œå‡ ä¸ªä¸ä¸€æ ·çš„æ— å hash å‡½æ•°</strong>ã€‚æ‰€è°“æ— åå°±æ˜¯èƒ½å¤ŸæŠŠå…ƒç´ çš„ hash å€¼ç®—å¾—æ¯”è¾ƒå‡åŒ€ã€‚</p><p>å‘å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ·»åŠ  key æ—¶ï¼Œä¼šä½¿ç”¨å¤šä¸ª hash å‡½æ•°å¯¹ key è¿›è¡Œ hash ç®—å¾—ä¸€ä¸ªæ•´æ•°ç´¢å¼•å€¼ç„¶åå¯¹ä½æ•°ç»„é•¿åº¦è¿›è¡Œå–æ¨¡è¿ç®—å¾—åˆ°ä¸€ä¸ªä½ç½®ï¼Œæ¯ä¸ª hash å‡½æ•°éƒ½ä¼šç®—å¾—ä¸€ä¸ªä¸åŒçš„ä½ç½®ã€‚å†æŠŠä½æ•°ç»„çš„è¿™å‡ ä¸ªä½ç½®éƒ½ç½®ä¸º 1 å°±å®Œæˆäº† add æ“ä½œã€‚</p><p>å‘å¸ƒéš†è¿‡æ»¤å™¨è¯¢é—® key æ˜¯å¦å­˜åœ¨æ—¶ï¼Œè·Ÿ add ä¸€æ ·ï¼Œä¹Ÿä¼šæŠŠ hash çš„å‡ ä¸ªä½ç½®éƒ½ç®—å‡ºæ¥ï¼Œçœ‹çœ‹ä½æ•°ç»„ä¸­è¿™å‡ ä¸ªä½ç½®æ˜¯å¦éƒ½ä¸º 1ï¼Œåªè¦æœ‰ä¸€ä¸ªä½ä¸º 0ï¼Œé‚£ä¹ˆè¯´æ˜å¸ƒéš†è¿‡æ»¤å™¨ä¸­è¿™ä¸ªkey ä¸å­˜åœ¨ã€‚å¦‚æœéƒ½æ˜¯ 1ï¼Œè¿™å¹¶ä¸èƒ½è¯´æ˜è¿™ä¸ª key å°±ä¸€å®šå­˜åœ¨ï¼Œåªæ˜¯ææœ‰å¯èƒ½å­˜åœ¨ï¼Œå› ä¸ºè¿™äº›ä½è¢«ç½®ä¸º 1 å¯èƒ½æ˜¯å› ä¸ºå…¶å®ƒçš„ key å­˜åœ¨æ‰€è‡´ã€‚å¦‚æœè¿™ä¸ªä½æ•°ç»„é•¿åº¦æ¯”è¾ƒå¤§ï¼Œå­˜åœ¨æ¦‚ç‡å°±ä¼šå¾ˆå¤§ï¼Œå¦‚æœè¿™ä¸ªä½æ•°ç»„é•¿åº¦æ¯”è¾ƒå°ï¼Œå­˜åœ¨æ¦‚ç‡å°±ä¼šé™ä½ã€‚</p><p>è¿™ç§æ–¹æ³•é€‚ç”¨äºæ•°æ®å‘½ä¸­ä¸é«˜ã€ æ•°æ®ç›¸å¯¹å›ºå®šã€ å®æ—¶æ€§ä½ï¼ˆé€šå¸¸æ˜¯æ•°æ®é›†è¾ƒå¤§ï¼‰ çš„åº”ç”¨åœºæ™¯ï¼Œ ä»£ç ç»´æŠ¤è¾ƒä¸ºå¤æ‚ï¼Œ ä½†æ˜¯<strong>ç¼“å­˜ç©ºé—´å ç”¨å¾ˆå°‘</strong>ã€‚</p><p>å¯ä»¥ç”¨redissonå®ç°å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¼•å…¥ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.6.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ä¼ªä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>redisson</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span></span><span class="token class-name">Redisson</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RBloomFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RedissonClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">Config</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedissonBloomFilter</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;redis://localhost:6379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ„é€ Redisson</span>
        <span class="token class-name">RedissonClient</span> redisson <span class="token operator">=</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">RBloomFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bloomFilter <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getBloomFilter</span><span class="token punctuation">(</span><span class="token string">&quot;nameList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨ï¼šé¢„è®¡å…ƒç´ ä¸º100000000L,è¯¯å·®ç‡ä¸º3%,æ ¹æ®è¿™ä¸¤ä¸ªå‚æ•°ä¼šè®¡ç®—å‡ºåº•å±‚çš„bitæ•°ç»„å¤§å°</span>
        bloomFilter<span class="token punctuation">.</span><span class="token function">tryInit</span><span class="token punctuation">(</span><span class="token number">100000000L</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†zhugeæ’å…¥åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­</span>
        bloomFilter<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;zhuge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//åˆ¤æ–­ä¸‹é¢å·ç æ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bloomFilter<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;guojia&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bloomFilter<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;baiqi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bloomFilter<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;zhuge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨éœ€è¦æŠŠæ‰€æœ‰æ•°æ®æå‰æ”¾å…¥å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”åœ¨å¢åŠ æ•°æ®æ—¶ä¹Ÿè¦å¾€å¸ƒéš†è¿‡æ»¤å™¨é‡Œæ”¾ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ç¼“å­˜è¿‡æ»¤ä¼ªä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨</span>
<span class="token class-name">RBloomFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bloomFilter <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getBloomFilter</span><span class="token punctuation">(</span><span class="token string">&quot;nameList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨ï¼šé¢„è®¡å…ƒç´ ä¸º100000000L,è¯¯å·®ç‡ä¸º3%</span>
bloomFilter<span class="token punctuation">.</span><span class="token function">tryInit</span><span class="token punctuation">(</span><span class="token number">100000000L</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
<span class="token comment">//æŠŠæ‰€æœ‰æ•°æ®å­˜å…¥å¸ƒéš†è¿‡æ»¤å™¨</span>
<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bloomFilter<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»å¸ƒéš†è¿‡æ»¤å™¨è¿™ä¸€çº§ç¼“å­˜åˆ¤æ–­ä¸‹keyæ˜¯å¦å­˜åœ¨</span>
    <span class="token class-name">Boolean</span> exist <span class="token operator">=</span> bloomFilter<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>exist<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ä»ç¼“å­˜ä¸­è·å–æ•°æ®</span>
    <span class="token class-name">String</span> cacheValue <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç¼“å­˜ä¸ºç©º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>cacheValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä»å­˜å‚¨ä¸­è·å–</span>
        <span class="token class-name">String</span> storageValue <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> storageValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœå­˜å‚¨æ•°æ®ä¸ºç©ºï¼Œ éœ€è¦è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´(300ç§’)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>storageValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cache<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> storageValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¼“å­˜éç©º</span>
        <span class="token keyword">return</span> cacheValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>            
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šå¸ƒéš†è¿‡æ»¤å™¨ä¸èƒ½åˆ é™¤æ•°æ®ï¼Œå¦‚æœè¦åˆ é™¤å¾—é‡æ–°åˆå§‹åŒ–æ•°æ®ã€‚</p><h2 id="ç¼“å­˜å‡»ç©¿-å¤±æ•ˆ" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜å‡»ç©¿-å¤±æ•ˆ"><span>ç¼“å­˜å‡»ç©¿(å¤±æ•ˆ)</span></a></h2><p>ç”±äºå¤§æ‰¹é‡ç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤±æ•ˆå¯èƒ½å¯¼è‡´å¤§é‡è¯·æ±‚åŒæ—¶ç©¿é€ç¼“å­˜ç›´è¾¾æ•°æ®åº“ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ç”šè‡³æŒ‚æ‰ï¼Œå¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬åœ¨æ‰¹é‡å¢åŠ ç¼“å­˜æ—¶æœ€å¥½å°†è¿™ä¸€æ‰¹æ•°æ®çš„ç¼“å­˜è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºä¸€ä¸ªæ—¶é—´æ®µå†…çš„ä¸åŒæ—¶é—´ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»ç¼“å­˜ä¸­è·å–æ•°æ®</span>
    <span class="token class-name">String</span> cacheValue <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç¼“å­˜ä¸ºç©º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>cacheValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä»å­˜å‚¨ä¸­è·å–</span>
        <span class="token class-name">String</span> storageValue <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> storageValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´(300åˆ°600ä¹‹é—´çš„ä¸€ä¸ªéšæœºæ•°)</span>
        <span class="token keyword">int</span> expireTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>  <span class="token operator">+</span> <span class="token number">300</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>storageValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cache<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> expireTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> storageValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¼“å­˜éç©º</span>
        <span class="token keyword">return</span> cacheValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
          
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜é›ªå´©"><span>ç¼“å­˜é›ªå´©</span></a></h2><p>ç¼“å­˜é›ªå´©æŒ‡çš„æ˜¯ç¼“å­˜å±‚æ”¯æ’‘ä¸ä½æˆ–å®•æ‰åï¼Œ æµé‡ä¼šåƒå¥”é€ƒçš„é‡ç‰›ä¸€æ ·ï¼Œæ‰“å‘åç«¯å­˜å‚¨å±‚ã€‚</p><p>ç”±äºç¼“å­˜å±‚æ‰¿è½½ç€å¤§é‡è¯·æ±‚ï¼Œ æœ‰æ•ˆåœ°ä¿æŠ¤äº†å­˜å‚¨å±‚ï¼Œ ä½†æ˜¯å¦‚æœç¼“å­˜å±‚ç”±äºæŸäº›åŸå› ä¸èƒ½æä¾›æœåŠ¡(æ¯”å¦‚è¶…å¤§å¹¶å‘è¿‡æ¥ï¼Œç¼“å­˜å±‚æ”¯æ’‘ä¸ä½ï¼Œæˆ–è€…ç”±äºç¼“å­˜è®¾è®¡ä¸å¥½ï¼Œç±»ä¼¼å¤§é‡è¯·æ±‚è®¿é—®bigkeyï¼Œå¯¼è‡´ç¼“å­˜èƒ½æ”¯æ’‘çš„å¹¶å‘æ€¥å‰§ä¸‹é™)ï¼Œ äºæ˜¯å¤§é‡è¯·æ±‚éƒ½ä¼šæ‰“åˆ°å­˜å‚¨å±‚ï¼Œ å­˜å‚¨å±‚çš„è°ƒç”¨é‡ä¼šæš´å¢ï¼Œ é€ æˆå­˜å‚¨å±‚ä¹Ÿä¼šçº§è”å®•æœºçš„æƒ…å†µã€‚</p><p>é¢„é˜²å’Œè§£å†³ç¼“å­˜é›ªå´©é—®é¢˜ï¼Œ å¯ä»¥ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¿›è¡Œç€æ‰‹ã€‚</p><p>1ï¼‰ ä¿è¯ç¼“å­˜å±‚æœåŠ¡é«˜å¯ç”¨æ€§ï¼Œæ¯”å¦‚ä½¿ç”¨Redis Sentinelæˆ–Redis Clusterã€‚</p><p>2ï¼‰ ä¾èµ–éš”ç¦»ç»„ä»¶ä¸ºåç«¯é™æµç†”æ–­å¹¶é™çº§ã€‚æ¯”å¦‚ä½¿ç”¨Sentinelæˆ–Hystrixé™æµé™çº§ç»„ä»¶ã€‚</p><p>æ¯”å¦‚æœåŠ¡é™çº§ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®é‡‡å–ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚å½“ä¸šåŠ¡åº”ç”¨è®¿é—®çš„æ˜¯éæ ¸å¿ƒæ•°æ®ï¼ˆä¾‹å¦‚ç”µå•†å•†å“å±æ€§ï¼Œç”¨æˆ·ä¿¡æ¯ç­‰ï¼‰æ—¶ï¼Œæš‚æ—¶åœæ­¢ä»ç¼“å­˜ä¸­æŸ¥è¯¢è¿™äº›æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é¢„å®šä¹‰çš„é»˜è®¤é™çº§ä¿¡æ¯ã€ç©ºå€¼æˆ–æ˜¯é”™è¯¯æç¤ºä¿¡æ¯ï¼›å½“ä¸šåŠ¡åº”ç”¨è®¿é—®çš„æ˜¯æ ¸å¿ƒæ•°æ®ï¼ˆä¾‹å¦‚ç”µå•†å•†å“åº“å­˜ï¼‰æ—¶ï¼Œä»ç„¶å…è®¸æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ç¼ºå¤±ï¼Œä¹Ÿå¯ä»¥ç»§ç»­é€šè¿‡æ•°æ®åº“è¯»å–ã€‚</p><p>3ï¼‰ æå‰æ¼”ç»ƒã€‚ åœ¨é¡¹ç›®ä¸Šçº¿å‰ï¼Œæ¼”ç»ƒç¼“å­˜å±‚å®•æ‰åï¼Œåº”ç”¨ä»¥åŠåç«¯çš„è´Ÿè½½æƒ…å†µä»¥åŠå¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œ åœ¨æ­¤åŸºç¡€ä¸Šåšä¸€äº›é¢„æ¡ˆè®¾å®šã€‚</p><h2 id="çƒ­ç‚¹ç¼“å­˜keyé‡å»ºä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#çƒ­ç‚¹ç¼“å­˜keyé‡å»ºä¼˜åŒ–"><span>çƒ­ç‚¹ç¼“å­˜keyé‡å»ºä¼˜åŒ–</span></a></h2><p>å¼€å‘äººå‘˜ä½¿ç”¨â€œç¼“å­˜+è¿‡æœŸæ—¶é—´â€çš„ç­–ç•¥æ—¢å¯ä»¥åŠ é€Ÿæ•°æ®è¯»å†™ï¼Œ åˆä¿è¯æ•°æ®çš„å®šæœŸæ›´æ–°ï¼Œ è¿™ç§æ¨¡å¼åŸºæœ¬èƒ½å¤Ÿæ»¡è¶³ç»å¤§éƒ¨åˆ†éœ€æ±‚ã€‚ ä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜å¦‚æœåŒæ—¶å‡ºç°ï¼Œ å¯èƒ½å°±ä¼šå¯¹åº”ç”¨é€ æˆè‡´å‘½çš„å±å®³ï¼š</p><ul><li>å½“å‰keyæ˜¯ä¸€ä¸ªçƒ­ç‚¹keyï¼ˆä¾‹å¦‚ä¸€ä¸ªçƒ­é—¨çš„å¨±ä¹æ–°é—»ï¼‰ï¼Œå¹¶å‘é‡éå¸¸å¤§ã€‚</li><li>é‡å»ºç¼“å­˜ä¸èƒ½åœ¨çŸ­æ—¶é—´å®Œæˆï¼Œ å¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚è®¡ç®—ï¼Œä¾‹å¦‚å¤æ‚çš„SQLã€å¤šæ¬¡IOã€å¤šä¸ªä¾èµ–ç­‰ã€‚</li></ul><p>åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œ æœ‰å¤§é‡çº¿ç¨‹æ¥é‡å»ºç¼“å­˜ï¼Œ é€ æˆåç«¯è´Ÿè½½åŠ å¤§ï¼Œ ç”šè‡³å¯èƒ½ä¼šè®©åº”ç”¨å´©æºƒã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¸»è¦å°±æ˜¯è¦é¿å…å¤§é‡çº¿ç¨‹åŒæ—¶é‡å»ºç¼“å­˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨äº’æ–¥é”æ¥è§£å†³ï¼Œæ­¤æ–¹æ³•åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œ å…¶ä»–çº¿ç¨‹ç­‰å¾…é‡å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œ é‡æ–°ä»ç¼“å­˜è·å–æ•°æ®å³å¯ã€‚</p><p>ç¤ºä¾‹ä¼ªä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»Redisä¸­è·å–æ•°æ®</span>
    <span class="token class-name">String</span> value <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœvalueä¸ºç©ºï¼Œ åˆ™å¼€å§‹é‡æ„ç¼“å­˜</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œ ä½¿ç”¨nxï¼Œ å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ex</span>
        <span class="token class-name">String</span> mutexKey <span class="token operator">=</span> <span class="token string">&quot;mutext:key:&quot;</span> <span class="token operator">+</span> key<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>mutexKey<span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ex 180&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token comment">// ä»æ•°æ®æºè·å–æ•°æ®</span>
            value <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å›å†™Redisï¼Œ å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´</span>
            redis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åˆ é™¤key_mutex</span>
            redis<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>mutexKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token comment">// å…¶ä»–çº¿ç¨‹ä¼‘æ¯50æ¯«ç§’åé‡è¯•</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´"><span>ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´</span></a></h2><p>åœ¨å¤§å¹¶å‘ä¸‹ï¼ŒåŒæ—¶æ“ä½œæ•°æ®åº“ä¸ç¼“å­˜ä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜</p><p>1ã€åŒå†™ä¸ä¸€è‡´æƒ…å†µ</p><p>â€‹ <img src="https://img.jssjqd.cn/20221021232846.png" alt=""></p><p>2ã€è¯»å†™å¹¶å‘ä¸ä¸€è‡´</p><p>â€‹ <img src="https://img.jssjqd.cn/20221021232855.png" alt=""></p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>1ã€å¯¹äºå¹¶å‘å‡ ç‡å¾ˆå°çš„æ•°æ®(å¦‚ä¸ªäººç»´åº¦çš„è®¢å•æ•°æ®ã€ç”¨æˆ·æ•°æ®ç­‰)ï¼Œè¿™ç§å‡ ä¹ä¸ç”¨è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œå¾ˆå°‘ä¼šå‘ç”Ÿç¼“å­˜ä¸ä¸€è‡´ï¼Œå¯ä»¥ç»™ç¼“å­˜æ•°æ®åŠ ä¸Šè¿‡æœŸæ—¶é—´ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è§¦å‘è¯»çš„ä¸»åŠ¨æ›´æ–°å³å¯ã€‚</p><p>2ã€å°±ç®—å¹¶å‘å¾ˆé«˜ï¼Œå¦‚æœä¸šåŠ¡ä¸Šèƒ½å®¹å¿çŸ­æ—¶é—´çš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´(å¦‚å•†å“åç§°ï¼Œå•†å“åˆ†ç±»èœå•ç­‰)ï¼Œç¼“å­˜åŠ ä¸Šè¿‡æœŸæ—¶é—´ä¾ç„¶å¯ä»¥è§£å†³å¤§éƒ¨åˆ†ä¸šåŠ¡å¯¹äºç¼“å­˜çš„è¦æ±‚ã€‚</p><p>3ã€å¦‚æœä¸èƒ½å®¹å¿ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡åŠ <strong>åˆ†å¸ƒå¼è¯»å†™é”</strong>ä¿è¯å¹¶å‘è¯»å†™æˆ–å†™å†™çš„æ—¶å€™æŒ‰é¡ºåºæ’å¥½é˜Ÿï¼Œ<strong>è¯»è¯»çš„æ—¶å€™ç›¸å½“äºæ— é”</strong>ã€‚</p><p>4ã€ä¹Ÿå¯ä»¥ç”¨é˜¿é‡Œå¼€æºçš„canalé€šè¿‡ç›‘å¬æ•°æ®åº“çš„binlogæ—¥å¿—åŠæ—¶çš„å»ä¿®æ”¹ç¼“å­˜ï¼Œä½†æ˜¯å¼•å…¥äº†æ–°çš„ä¸­é—´ä»¶ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯å»¶è¿ŸåŒåˆ ï¼Œåœ¨åˆ é™¤ç¼“å­˜åä¼‘çœ ä¸€æ®µæ—¶é—´ï¼Œå†åˆ ä¸€æ¬¡ç¼“å­˜ï¼Œä¸æ¨èã€‚</p><p>â€‹ <img src="https://img.jssjqd.cn/20221021232903.png" alt=""></p><p><strong>æ€»ç»“ï¼š</strong></p><p>ä»¥ä¸Šæˆ‘ä»¬é’ˆå¯¹çš„éƒ½æ˜¯<strong>è¯»å¤šå†™å°‘</strong>çš„æƒ…å†µåŠ å…¥ç¼“å­˜æé«˜æ€§èƒ½ï¼Œå¦‚æœ<strong>å†™å¤šè¯»å¤š</strong>çš„æƒ…å†µåˆä¸èƒ½å®¹å¿ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ï¼Œé‚£å°±æ²¡å¿…è¦åŠ ç¼“å­˜äº†ï¼Œå¯ä»¥ç›´æ¥æ“ä½œæ•°æ®åº“ã€‚å½“ç„¶ï¼Œå¦‚æœæ•°æ®åº“æŠ—ä¸ä½å‹åŠ›ï¼Œè¿˜å¯ä»¥æŠŠç¼“å­˜ä½œä¸ºæ•°æ®è¯»å†™çš„ä¸»å­˜å‚¨ï¼Œå¼‚æ­¥å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®åº“ï¼Œæ•°æ®åº“åªæ˜¯ä½œä¸ºæ•°æ®çš„å¤‡ä»½ã€‚</p><p>æ”¾å…¥ç¼“å­˜çš„æ•°æ®åº”è¯¥æ˜¯å¯¹å®æ—¶æ€§ã€ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜çš„æ•°æ®ã€‚åˆ‡è®°ä¸è¦ä¸ºäº†ç”¨ç¼“å­˜ï¼ŒåŒæ—¶åˆè¦ä¿è¯ç»å¯¹çš„ä¸€è‡´æ€§åšå¤§é‡çš„è¿‡åº¦è®¾è®¡å’Œæ§åˆ¶ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚æ€§ï¼</p><h2 id="å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–"><span>å¼€å‘è§„èŒƒä¸æ€§èƒ½ä¼˜åŒ–</span></a></h2><p><strong>ä¸€ã€é”®å€¼è®¾è®¡</strong></p><p><strong>1. keyåè®¾è®¡</strong></p><ul><li>(1)ã€å»ºè®®ã€‘: å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§</li></ul><p>ä»¥ä¸šåŠ¡å(æˆ–æ•°æ®åº“å)ä¸ºå‰ç¼€(é˜²æ­¢keyå†²çª)ï¼Œç”¨å†’å·åˆ†éš”ï¼Œæ¯”å¦‚ä¸šåŠ¡å:è¡¨å:id</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>trade:order:1              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>(2)ã€å»ºè®®ã€‘ï¼šç®€æ´æ€§</li></ul><p>ä¿è¯è¯­ä¹‰çš„å‰æä¸‹ï¼Œæ§åˆ¶keyçš„é•¿åº¦ï¼Œå½“keyè¾ƒå¤šæ—¶ï¼Œå†…å­˜å ç”¨ä¹Ÿä¸å®¹å¿½è§†ï¼Œä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>user:{uid}:friends:messages:{mid} ç®€åŒ–ä¸º u:{uid}:fr:m:{mid}              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>(3)ã€å¼ºåˆ¶ã€‘ï¼šä¸è¦åŒ…å«ç‰¹æ®Šå­—ç¬¦</li></ul><p>åä¾‹ï¼šåŒ…å«ç©ºæ ¼ã€æ¢è¡Œã€å•åŒå¼•å·ä»¥åŠå…¶ä»–è½¬ä¹‰å­—ç¬¦</p><p><strong>2. valueè®¾è®¡</strong></p><ul><li>(1)ã€å¼ºåˆ¶ã€‘ï¼šæ‹’ç»bigkey(é˜²æ­¢ç½‘å¡æµé‡ã€æ…¢æŸ¥è¯¢)</li></ul><p>åœ¨Redisä¸­ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²æœ€å¤§512MBï¼Œä¸€ä¸ªäºŒçº§æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚hashã€listã€setã€zsetï¼‰å¯ä»¥å­˜å‚¨å¤§çº¦40äº¿ä¸ª(2^32-1)ä¸ªå…ƒç´ ï¼Œä½†å®é™…ä¸­å¦‚æœä¸‹é¢ä¸¤ç§æƒ…å†µï¼Œæˆ‘å°±ä¼šè®¤ä¸ºå®ƒæ˜¯bigkeyã€‚</p><ol><li>å­—ç¬¦ä¸²ç±»å‹ï¼šå®ƒçš„bigä½“ç°åœ¨å•ä¸ªvalueå€¼å¾ˆå¤§ï¼Œä¸€èˆ¬è®¤ä¸ºè¶…è¿‡10KBå°±æ˜¯bigkeyã€‚</li><li>éå­—ç¬¦ä¸²ç±»å‹ï¼šå“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆï¼Œå®ƒä»¬çš„bigä½“ç°åœ¨å…ƒç´ ä¸ªæ•°å¤ªå¤šã€‚</li></ol><p>ä¸€èˆ¬æ¥è¯´ï¼Œstringç±»å‹æ§åˆ¶åœ¨10KBä»¥å†…ï¼Œhashã€listã€setã€zsetå…ƒç´ ä¸ªæ•°ä¸è¦è¶…è¿‡5000ã€‚</p><p>åä¾‹ï¼šä¸€ä¸ªåŒ…å«200ä¸‡ä¸ªå…ƒç´ çš„listã€‚</p><p>éå­—ç¬¦ä¸²çš„bigkeyï¼Œä¸è¦ä½¿ç”¨delåˆ é™¤ï¼Œä½¿ç”¨hscanã€sscanã€zscanæ–¹å¼æ¸è¿›å¼åˆ é™¤ï¼ŒåŒæ—¶è¦æ³¨æ„é˜²æ­¢bigkeyè¿‡æœŸæ—¶é—´è‡ªåŠ¨åˆ é™¤é—®é¢˜(ä¾‹å¦‚ä¸€ä¸ª200ä¸‡çš„zsetè®¾ç½®1å°æ—¶è¿‡æœŸï¼Œä¼šè§¦å‘delæ“ä½œï¼Œé€ æˆé˜»å¡ï¼‰</p><p><strong>bigkeyçš„å±å®³ï¼š</strong></p><p>1.å¯¼è‡´redisé˜»å¡</p><p>2.ç½‘ç»œæ‹¥å¡</p><p>bigkeyä¹Ÿå°±æ„å‘³ç€æ¯æ¬¡è·å–è¦äº§ç”Ÿçš„ç½‘ç»œæµé‡è¾ƒå¤§ï¼Œå‡è®¾ä¸€ä¸ªbigkeyä¸º1MBï¼Œå®¢æˆ·ç«¯æ¯ç§’è®¿é—®é‡ä¸º1000ï¼Œé‚£ä¹ˆæ¯ç§’äº§ç”Ÿ1000MBçš„æµé‡ï¼Œå¯¹äºæ™®é€šçš„åƒå…†ç½‘å¡(æŒ‰ç…§å­—èŠ‚ç®—æ˜¯128MB/s)çš„æœåŠ¡å™¨æ¥è¯´ç®€ç›´æ˜¯ç­é¡¶ä¹‹ç¾ï¼Œè€Œä¸”ä¸€èˆ¬æœåŠ¡å™¨ä¼šé‡‡ç”¨å•æœºå¤šå®ä¾‹çš„æ–¹å¼æ¥éƒ¨ç½²ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªbigkeyå¯èƒ½ä¼šå¯¹å…¶ä»–å®ä¾‹ä¹Ÿé€ æˆå½±å“ï¼Œå…¶åæœä¸å ªè®¾æƒ³ã€‚</p><ol start="3"><li>è¿‡æœŸåˆ é™¤</li></ol><p>æœ‰ä¸ªbigkeyï¼Œå®ƒåˆ†å®ˆå·±ï¼ˆåªæ‰§è¡Œç®€å•çš„å‘½ä»¤ï¼Œä¾‹å¦‚hgetã€lpopã€zscoreç­‰ï¼‰ï¼Œä½†å®ƒè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå½“å®ƒè¿‡æœŸåï¼Œä¼šè¢«åˆ é™¤ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨Redis 4.0çš„è¿‡æœŸå¼‚æ­¥åˆ é™¤(<strong>lazyfree-lazy-expire yes</strong>)ï¼Œå°±ä¼šå­˜åœ¨é˜»å¡Redisçš„å¯èƒ½æ€§ã€‚</p><p><strong>bigkeyçš„äº§ç”Ÿï¼š</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œbigkeyçš„äº§ç”Ÿéƒ½æ˜¯ç”±äºç¨‹åºè®¾è®¡ä¸å½“ï¼Œæˆ–è€…å¯¹äºæ•°æ®è§„æ¨¡é¢„æ–™ä¸æ¸…æ¥šé€ æˆçš„ï¼Œæ¥çœ‹å‡ ä¸ªä¾‹å­ï¼š</p><p>(1) ç¤¾äº¤ç±»ï¼šç²‰ä¸åˆ—è¡¨ï¼Œå¦‚æœæŸäº›æ˜æ˜Ÿæˆ–è€…å¤§vä¸ç²¾å¿ƒè®¾è®¡ä¸‹ï¼Œå¿…æ˜¯bigkeyã€‚</p><p>(2) ç»Ÿè®¡ç±»ï¼šä¾‹å¦‚æŒ‰å¤©å­˜å‚¨æŸé¡¹åŠŸèƒ½æˆ–è€…ç½‘ç«™çš„ç”¨æˆ·é›†åˆï¼Œé™¤éæ²¡å‡ ä¸ªäººç”¨ï¼Œå¦åˆ™å¿…æ˜¯bigkeyã€‚</p><p>(3) ç¼“å­˜ç±»ï¼šå°†æ•°æ®ä»æ•°æ®åº“loadå‡ºæ¥åºåˆ—åŒ–æ”¾åˆ°Redisé‡Œï¼Œè¿™ä¸ªæ–¹å¼éå¸¸å¸¸ç”¨ï¼Œä½†æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œç¬¬ä¸€ï¼Œæ˜¯ä¸æ˜¯æœ‰å¿…è¦æŠŠæ‰€æœ‰å­—æ®µéƒ½ç¼“å­˜ï¼›ç¬¬äºŒï¼Œæœ‰æ²¡æœ‰ç›¸å…³å…³è”çš„æ•°æ®ï¼Œæœ‰çš„åŒå­¦ä¸ºäº†å›¾æ–¹ä¾¿æŠŠç›¸å…³æ•°æ®éƒ½å­˜ä¸€ä¸ªkeyä¸‹ï¼Œäº§ç”Ÿbigkeyã€‚</p><p><strong>å¦‚ä½•ä¼˜åŒ–bigkey</strong></p><ol><li>æ‹†</li></ol><p>big listï¼š list1ã€list2ã€...listN</p><p>big hashï¼šå¯ä»¥è®²æ•°æ®åˆ†æ®µå­˜å‚¨ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤§çš„keyï¼Œå‡è®¾å­˜äº†1ç™¾ä¸‡çš„ç”¨æˆ·æ•°æ®ï¼Œå¯ä»¥æ‹†åˆ†æˆ200ä¸ªkeyï¼Œæ¯ä¸ªkeyä¸‹é¢å­˜æ”¾5000ä¸ªç”¨æˆ·æ•°æ®</p><ol start="2"><li>å¦‚æœbigkeyä¸å¯é¿å…ï¼Œä¹Ÿè¦æ€è€ƒä¸€ä¸‹è¦ä¸è¦æ¯æ¬¡æŠŠæ‰€æœ‰å…ƒç´ éƒ½å–å‡ºæ¥(ä¾‹å¦‚æœ‰æ—¶å€™ä»…ä»…éœ€è¦hmgetï¼Œè€Œä¸æ˜¯hgetall)ï¼Œåˆ é™¤ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå°½é‡ä½¿ç”¨ä¼˜é›…çš„æ–¹å¼æ¥å¤„ç†ã€‚</li></ol><p>ã€æ¨èã€‘ï¼šé€‰æ‹©é€‚åˆçš„æ•°æ®ç±»å‹ã€‚</p><p>ä¾‹å¦‚ï¼šå®ä½“ç±»å‹(è¦åˆç†æ§åˆ¶å’Œä½¿ç”¨æ•°æ®ç»“æ„ï¼Œä½†ä¹Ÿè¦æ³¨æ„èŠ‚çœå†…å­˜å’Œæ€§èƒ½ä¹‹é—´çš„å¹³è¡¡)</p><p>åä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>set user:1:name tom set user:1:age 19 set user:1:favor football          
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­£ä¾‹:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>hmset user:1 name tom age 19 favor football              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3.ã€æ¨èã€‘ï¼šæ§åˆ¶keyçš„ç”Ÿå‘½å‘¨æœŸï¼Œredisä¸æ˜¯åƒåœ¾æ¡¶ã€‚</p><p>å»ºè®®ä½¿ç”¨expireè®¾ç½®è¿‡æœŸæ—¶é—´(æ¡ä»¶å…è®¸å¯ä»¥æ‰“æ•£è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢é›†ä¸­è¿‡æœŸ)ã€‚</p><p><strong>äºŒã€å‘½ä»¤ä½¿ç”¨</strong></p><p>1.ã€æ¨èã€‘ O(N)å‘½ä»¤å…³æ³¨Nçš„æ•°é‡</p><p>ä¾‹å¦‚hgetallã€lrangeã€smembersã€zrangeã€sinterç­‰å¹¶éä¸èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦æ˜ç¡®Nçš„å€¼ã€‚æœ‰éå†çš„éœ€æ±‚å¯ä»¥ä½¿ç”¨hscanã€sscanã€zscanä»£æ›¿ã€‚</p><p>2.ã€æ¨èã€‘ï¼šç¦ç”¨å‘½ä»¤</p><p>ç¦æ­¢çº¿ä¸Šä½¿ç”¨keysã€flushallã€flushdbç­‰ï¼Œé€šè¿‡redisçš„renameæœºåˆ¶ç¦æ‰å‘½ä»¤ï¼Œæˆ–è€…ä½¿ç”¨scançš„æ–¹å¼æ¸è¿›å¼å¤„ç†ã€‚</p><p>3.ã€æ¨èã€‘åˆç†ä½¿ç”¨select</p><p>redisçš„å¤šæ•°æ®åº“è¾ƒå¼±ï¼Œä½¿ç”¨æ•°å­—è¿›è¡ŒåŒºåˆ†ï¼Œå¾ˆå¤šå®¢æˆ·ç«¯æ”¯æŒè¾ƒå·®ï¼ŒåŒæ—¶å¤šä¸šåŠ¡ç”¨å¤šæ•°æ®åº“å®é™…è¿˜æ˜¯å•çº¿ç¨‹å¤„ç†ï¼Œä¼šæœ‰å¹²æ‰°ã€‚</p><p>4.ã€æ¨èã€‘ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡</p><p>åŸç”Ÿå‘½ä»¤ï¼šä¾‹å¦‚mgetã€msetã€‚ éåŸç”Ÿå‘½ä»¤ï¼šå¯ä»¥ä½¿ç”¨pipelineæé«˜æ•ˆç‡ã€‚</p><p>ä½†è¦æ³¨æ„æ§åˆ¶ä¸€æ¬¡æ‰¹é‡æ“ä½œçš„å…ƒç´ ä¸ªæ•°(ä¾‹å¦‚500ä»¥å†…ï¼Œå®é™…ä¹Ÿå’Œå…ƒç´ å­—èŠ‚æ•°æœ‰å…³)ã€‚</p><p>æ³¨æ„ä¸¤è€…ä¸åŒï¼š</p><pre><code>               1.  åŸç”Ÿå‘½ä»¤æ˜¯åŸå­æ“ä½œï¼Œpipelineæ˜¯éåŸå­æ“ä½œã€‚
               2.  pipelineå¯ä»¥æ‰“åŒ…ä¸åŒçš„å‘½ä»¤ï¼ŒåŸç”Ÿå‘½ä»¤åšä¸åˆ°
               3.  pipelineéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶æ”¯æŒã€‚              
</code></pre><p>5.ã€å»ºè®®ã€‘Redisäº‹åŠ¡åŠŸèƒ½è¾ƒå¼±ï¼Œä¸å»ºè®®è¿‡å¤šä½¿ç”¨ï¼Œå¯ä»¥ç”¨luaæ›¿ä»£</p><p><strong>ä¸‰ã€å®¢æˆ·ç«¯ä½¿ç”¨</strong></p><p>1.ã€æ¨èã€‘</p><p>é¿å…å¤šä¸ªåº”ç”¨ä½¿ç”¨ä¸€ä¸ªRediså®ä¾‹</p><p>æ­£ä¾‹ï¼šä¸ç›¸å¹²çš„ä¸šåŠ¡æ‹†åˆ†ï¼Œå…¬å…±æ•°æ®åšæœåŠ¡åŒ–ã€‚</p><p>2.ã€æ¨èã€‘</p><p>ä½¿ç”¨å¸¦æœ‰è¿æ¥æ± çš„æ•°æ®åº“ï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶è¿æ¥ï¼ŒåŒæ—¶æé«˜æ•ˆç‡ï¼Œæ ‡å‡†ä½¿ç”¨æ–¹å¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">JedisPoolConfig</span> jedisPoolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">JedisPool</span> jedisPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPool</span><span class="token punctuation">(</span>jedisPoolConfig<span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.60&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    jedis <span class="token operator">=</span> jedisPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å…·ä½“çš„å‘½ä»¤</span>
    jedis<span class="token punctuation">.</span><span class="token function">executeCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;op key {} error: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ³¨æ„è¿™é‡Œä¸æ˜¯å…³é—­è¿æ¥ï¼Œåœ¨JedisPoolæ¨¡å¼ä¸‹ï¼ŒJedisä¼šè¢«å½’è¿˜ç»™èµ„æºæ± ã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>jedis <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> 
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>        
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿æ¥æ± å‚æ•°å«ä¹‰ï¼š</p><table><thead><tr><th>åºå·</th><th>å‚æ•°å</th><th>å«ä¹‰</th><th>é»˜è®¤å€¼</th><th>ä½¿ç”¨å»ºè®®</th></tr></thead><tbody><tr><td>1</td><td>maxTotal</td><td>èµ„æºæ± ä¸­æœ€å¤§è¿æ¥æ•°</td><td>8</td><td>è®¾ç½®å»ºè®®è§ä¸‹é¢</td></tr><tr><td>2</td><td>maxIdle</td><td>èµ„æºæ± å…è®¸æœ€å¤§ç©ºé—²çš„è¿æ¥æ•°</td><td>8</td><td>è®¾ç½®å»ºè®®è§ä¸‹é¢</td></tr><tr><td>3</td><td>minIdle</td><td>èµ„æºæ± ç¡®ä¿æœ€å°‘ç©ºé—²çš„è¿æ¥æ•°</td><td>0</td><td>è®¾ç½®å»ºè®®è§ä¸‹é¢</td></tr><tr><td>4</td><td>blockWhenExhausted</td><td>å½“èµ„æºæ± ç”¨å°½åï¼Œè°ƒç”¨è€…æ˜¯å¦è¦ç­‰å¾…ã€‚åªæœ‰å½“ä¸ºtrueæ—¶ï¼Œä¸‹é¢çš„maxWaitMillisæ‰ä¼šç”Ÿæ•ˆ</td><td>true</td><td>å»ºè®®ä½¿ç”¨é»˜è®¤å€¼</td></tr><tr><td>5</td><td>maxWaitMillis</td><td>å½“èµ„æºæ± è¿æ¥ç”¨å°½åï¼Œè°ƒç”¨è€…çš„æœ€å¤§ç­‰å¾…æ—¶é—´(å•ä½ä¸ºæ¯«ç§’)</td><td>-1ï¼šè¡¨ç¤ºæ°¸ä¸è¶…æ—¶</td><td>ä¸å»ºè®®ä½¿ç”¨é»˜è®¤å€¼</td></tr><tr><td>6</td><td>testOnBorrow</td><td>å‘èµ„æºæ± å€Ÿç”¨è¿æ¥æ—¶æ˜¯å¦åšè¿æ¥æœ‰æ•ˆæ€§æ£€æµ‹(ping)ï¼Œæ— æ•ˆè¿æ¥ä¼šè¢«ç§»é™¤</td><td>false</td><td>ä¸šåŠ¡é‡å¾ˆå¤§æ—¶å€™å»ºè®®è®¾ç½®ä¸ºfalse(å¤šä¸€æ¬¡pingçš„å¼€é”€)ã€‚</td></tr><tr><td>7</td><td>testOnReturn</td><td>å‘èµ„æºæ± å½’è¿˜è¿æ¥æ—¶æ˜¯å¦åšè¿æ¥æœ‰æ•ˆæ€§æ£€æµ‹(ping)ï¼Œæ— æ•ˆè¿æ¥ä¼šè¢«ç§»é™¤</td><td>false</td><td>ä¸šåŠ¡é‡å¾ˆå¤§æ—¶å€™å»ºè®®è®¾ç½®ä¸ºfalse(å¤šä¸€æ¬¡pingçš„å¼€é”€)ã€‚</td></tr><tr><td>8</td><td>jmxEnabled</td><td>æ˜¯å¦å¼€å¯jmxç›‘æ§ï¼Œå¯ç”¨äºç›‘æ§</td><td>true</td><td>å»ºè®®å¼€å¯ï¼Œä½†åº”ç”¨æœ¬èº«ä¹Ÿè¦å¼€å¯</td></tr></tbody></table><p><strong>ä¼˜åŒ–å»ºè®®ï¼š</strong></p><p>1ï¼‰<strong>maxTotal</strong>ï¼šæœ€å¤§è¿æ¥æ•°ï¼Œæ—©æœŸçš„ç‰ˆæœ¬å«maxActive</p><p>å®é™…ä¸Šè¿™ä¸ªæ˜¯ä¸€ä¸ªå¾ˆéš¾å›ç­”çš„é—®é¢˜ï¼Œè€ƒè™‘çš„å› ç´ æ¯”è¾ƒå¤šï¼š</p><ul><li>ä¸šåŠ¡å¸Œæœ›Rediså¹¶å‘é‡</li><li>å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤æ—¶é—´</li><li>Redisèµ„æºï¼šä¾‹å¦‚ nodes(ä¾‹å¦‚åº”ç”¨ä¸ªæ•°) * maxTotal æ˜¯ä¸èƒ½è¶…è¿‡redisçš„æœ€å¤§è¿æ¥æ•°maxclientsã€‚</li><li>èµ„æºå¼€é”€ï¼šä¾‹å¦‚è™½ç„¶å¸Œæœ›æ§åˆ¶<strong>ç©ºé—²è¿æ¥</strong>(è¿æ¥æ± æ­¤åˆ»å¯é©¬ä¸Šä½¿ç”¨çš„è¿æ¥)ï¼Œä½†æ˜¯ä¸å¸Œæœ›å› ä¸ºè¿æ¥æ± çš„é¢‘ç¹é‡Šæ”¾åˆ›å»ºè¿æ¥é€ æˆä¸å¿…é å¼€é”€ã€‚</li></ul><p><strong>ä»¥ä¸€ä¸ªä¾‹å­è¯´æ˜</strong>ï¼Œå‡è®¾:</p><ul><li>ä¸€æ¬¡å‘½ä»¤æ—¶é—´ï¼ˆborrow|return resource + Jedisæ‰§è¡Œå‘½ä»¤(å«ç½‘ç»œ) ï¼‰çš„å¹³å‡è€—æ—¶çº¦ä¸º1msï¼Œä¸€ä¸ªè¿æ¥çš„QPSå¤§çº¦æ˜¯1000</li><li>ä¸šåŠ¡æœŸæœ›çš„QPSæ˜¯50000</li></ul><p>é‚£ä¹ˆç†è®ºä¸Šéœ€è¦çš„èµ„æºæ± å¤§å°æ˜¯50000 / 1000 = 50ä¸ªã€‚ä½†äº‹å®ä¸Šè¿™æ˜¯ä¸ªç†è®ºå€¼ï¼Œè¿˜è¦è€ƒè™‘åˆ°è¦æ¯”ç†è®ºå€¼é¢„ç•™ä¸€äº›èµ„æºï¼Œé€šå¸¸æ¥è®²maxTotalå¯ä»¥æ¯”ç†è®ºå€¼å¤§ä¸€äº›ã€‚</p><p>ä½†è¿™ä¸ªå€¼ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œä¸€æ–¹é¢è¿æ¥å¤ªå¤šå ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯èµ„æºï¼Œå¦ä¸€æ–¹é¢å¯¹äºRedisè¿™ç§é«˜QPSçš„æœåŠ¡å™¨ï¼Œä¸€ä¸ªå¤§å‘½ä»¤çš„é˜»å¡å³ä½¿è®¾ç½®å†å¤§èµ„æºæ± ä»ç„¶ä¼šæ— æµäºäº‹ã€‚</p><p>2ï¼‰<strong>maxIdleå’ŒminIdle</strong></p><p>maxIdleå®é™…ä¸Šæ‰æ˜¯ä¸šåŠ¡éœ€è¦çš„æœ€å¤§è¿æ¥æ•°ï¼ŒmaxTotalæ˜¯ä¸ºäº†<strong>ç»™å‡ºä½™é‡</strong>ï¼Œæ‰€ä»¥maxIdleä¸è¦è®¾ç½®è¿‡å°ï¼Œå¦åˆ™ä¼šæœ‰new Jedis(æ–°è¿æ¥)å¼€é”€ã€‚</p><p><strong>è¿æ¥æ± çš„æœ€ä½³æ€§èƒ½æ˜¯maxTotal = maxIdle</strong>ï¼Œè¿™æ ·å°±é¿å…è¿æ¥æ± ä¼¸ç¼©å¸¦æ¥çš„æ€§èƒ½å¹²æ‰°ã€‚ä½†æ˜¯å¦‚æœå¹¶å‘é‡ä¸å¤§æˆ–è€…maxTotalè®¾ç½®è¿‡é«˜ï¼Œä¼šå¯¼è‡´ä¸å¿…è¦çš„è¿æ¥èµ„æºæµªè´¹ã€‚ä¸€èˆ¬æ¨èmaxIdleå¯ä»¥è®¾ç½®ä¸ºæŒ‰ä¸Šé¢çš„ä¸šåŠ¡æœŸæœ›QPSè®¡ç®—å‡ºæ¥çš„ç†è®ºè¿æ¥æ•°ï¼ŒmaxTotalå¯ä»¥å†æ”¾å¤§ä¸€å€ã€‚</p><p>minIdleï¼ˆæœ€å°ç©ºé—²è¿æ¥æ•°ï¼‰ï¼Œä¸å…¶è¯´æ˜¯æœ€å°ç©ºé—²è¿æ¥æ•°ï¼Œä¸å¦‚è¯´æ˜¯&quot;<strong>è‡³å°‘éœ€è¦ä¿æŒçš„ç©ºé—²è¿æ¥æ•°</strong>&quot;ï¼Œåœ¨ä½¿ç”¨è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¿æ¥æ•°è¶…è¿‡äº†minIdleï¼Œé‚£ä¹ˆç»§ç»­å»ºç«‹è¿æ¥ï¼Œå¦‚æœè¶…è¿‡äº†maxIdleï¼Œå½“è¶…è¿‡çš„è¿æ¥æ‰§è¡Œå®Œä¸šåŠ¡åä¼šæ…¢æ…¢è¢«ç§»å‡ºè¿æ¥æ± é‡Šæ”¾æ‰ã€‚</p><p>å¦‚æœç³»ç»Ÿå¯åŠ¨å®Œé©¬ä¸Šå°±ä¼šæœ‰å¾ˆå¤šçš„è¯·æ±‚è¿‡æ¥ï¼Œé‚£ä¹ˆå¯ä»¥ç»™redisè¿æ¥æ± åš<strong>é¢„çƒ­</strong>ï¼Œæ¯”å¦‚å¿«é€Ÿçš„åˆ›å»ºä¸€äº›redisè¿æ¥ï¼Œæ‰§è¡Œç®€å•å‘½ä»¤ï¼Œç±»ä¼¼ping()ï¼Œå¿«é€Ÿçš„å°†è¿æ¥æ± é‡Œçš„ç©ºé—²è¿æ¥æå‡åˆ°minIdleçš„æ•°é‡ã€‚</p><p><strong>è¿æ¥æ± é¢„çƒ­</strong></p><p>ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Jedis</span><span class="token punctuation">&gt;</span></span> minIdleJedisList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Jedis</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>jedisPoolConfig<span class="token punctuation">.</span><span class="token function">getMinIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> jedisPoolConfig<span class="token punctuation">.</span><span class="token function">getMinIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        jedis <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        minIdleJedisList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>jedis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ³¨æ„ï¼Œè¿™é‡Œä¸èƒ½é©¬ä¸Šcloseå°†è¿æ¥è¿˜å›è¿æ¥æ± ï¼Œå¦åˆ™æœ€åè¿æ¥æ± é‡Œåªä¼šå»ºç«‹1ä¸ªè¿æ¥ã€‚ã€‚</span>
        <span class="token comment">//jedis.close();</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//ç»Ÿä¸€å°†é¢„çƒ­çš„è¿æ¥è¿˜å›è¿æ¥æ± </span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> jedisPoolConfig<span class="token punctuation">.</span><span class="token function">getMinIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        jedis <span class="token operator">=</span> minIdleJedisList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†è¿æ¥å½’è¿˜å›è¿æ¥æ± </span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ä¹‹ï¼Œè¦æ ¹æ®å®é™…ç³»ç»Ÿçš„QPSå’Œè°ƒç”¨rediså®¢æˆ·ç«¯çš„è§„æ¨¡æ•´ä½“è¯„ä¼°æ¯ä¸ªèŠ‚ç‚¹æ‰€ä½¿ç”¨çš„è¿æ¥æ± å¤§å°ã€‚</p><p>3.ã€å»ºè®®ã€‘</p><p>é«˜å¹¶å‘ä¸‹å»ºè®®å®¢æˆ·ç«¯æ·»åŠ ç†”æ–­åŠŸèƒ½(ä¾‹å¦‚sentinelã€hystrix)</p><p>4.ã€æ¨èã€‘</p><p>è®¾ç½®åˆç†çš„å¯†ç ï¼Œå¦‚æœ‰å¿…è¦å¯ä»¥ä½¿ç”¨SSLåŠ å¯†è®¿é—®</p><p>5.ã€å»ºè®®ã€‘</p><p><strong>Rediså¯¹äºè¿‡æœŸé”®æœ‰ä¸‰ç§æ¸…é™¤ç­–ç•¥ï¼š</strong></p><ol><li>è¢«åŠ¨åˆ é™¤ï¼šå½“è¯»/å†™ä¸€ä¸ªå·²ç»è¿‡æœŸçš„keyæ—¶ï¼Œä¼šè§¦å‘æƒ°æ€§åˆ é™¤ç­–ç•¥ï¼Œç›´æ¥åˆ é™¤æ‰è¿™ä¸ªè¿‡æœŸkey</li><li>ä¸»åŠ¨åˆ é™¤ï¼šç”±äºæƒ°æ€§åˆ é™¤ç­–ç•¥æ— æ³•ä¿è¯å†·æ•°æ®è¢«åŠæ—¶åˆ æ‰ï¼Œæ‰€ä»¥Redisä¼šå®šæœŸ(é»˜è®¤æ¯100ms)ä¸»åŠ¨æ·˜æ±°ä¸€æ‰¹<strong>å·²è¿‡æœŸ</strong>çš„keyï¼Œè¿™é‡Œçš„ä¸€æ‰¹åªæ˜¯éƒ¨åˆ†è¿‡æœŸkeyï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°éƒ¨åˆ†keyå·²ç»è¿‡æœŸä½†è¿˜æ²¡æœ‰è¢«æ¸…ç†æ‰çš„æƒ…å†µï¼Œå¯¼è‡´å†…å­˜å¹¶æ²¡æœ‰è¢«é‡Šæ”¾</li><li>å½“å‰å·²ç”¨å†…å­˜è¶…è¿‡maxmemoryé™å®šæ—¶ï¼Œè§¦å‘<strong>ä¸»åŠ¨æ¸…ç†ç­–ç•¥</strong></li></ol><p><strong>ä¸»åŠ¨æ¸…ç†ç­–ç•¥</strong>åœ¨Redis 4.0 ä¹‹å‰ä¸€å…±å®ç°äº† 6 ç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œåœ¨ 4.0 ä¹‹åï¼Œåˆå¢åŠ äº† 2 ç§ç­–ç•¥ï¼Œæ€»å…±8ç§ï¼š</p><p><strong>a) é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyåšå¤„ç†ï¼š</strong></p><ol><li>volatile-ttlï¼šåœ¨ç­›é€‰æ—¶ï¼Œä¼šé’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼Œæ ¹æ®è¿‡æœŸæ—¶é—´çš„å…ˆåè¿›è¡Œåˆ é™¤ï¼Œè¶Šæ—©è¿‡æœŸçš„è¶Šå…ˆè¢«åˆ é™¤ã€‚</li><li>volatile-randomï¼šå°±åƒå®ƒçš„åç§°ä¸€æ ·ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ä¸­ï¼Œè¿›è¡Œéšæœºåˆ é™¤ã€‚</li><li>volatile-lruï¼šä¼šä½¿ç”¨ LRU ç®—æ³•ç­›é€‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹åˆ é™¤ã€‚</li><li>volatile-lfuï¼šä¼šä½¿ç”¨ LFU ç®—æ³•ç­›é€‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹åˆ é™¤ã€‚</li></ol><p><strong>b) é’ˆå¯¹æ‰€æœ‰çš„keyåšå¤„ç†ï¼š</strong></p><ol><li>allkeys-randomï¼šä»æ‰€æœ‰é”®å€¼å¯¹ä¸­éšæœºé€‰æ‹©å¹¶åˆ é™¤æ•°æ®ã€‚</li><li>allkeys-lruï¼šä½¿ç”¨ LRU ç®—æ³•åœ¨æ‰€æœ‰æ•°æ®ä¸­è¿›è¡Œç­›é€‰åˆ é™¤ã€‚</li><li>allkeys-lfuï¼šä½¿ç”¨ LFU ç®—æ³•åœ¨æ‰€æœ‰æ•°æ®ä¸­è¿›è¡Œç­›é€‰åˆ é™¤ã€‚</li></ol><p><strong>c) ä¸å¤„ç†ï¼š</strong></p><ol><li>noevictionï¼šä¸ä¼šå‰”é™¤ä»»ä½•æ•°æ®ï¼Œæ‹’ç»æ‰€æœ‰å†™å…¥æ“ä½œå¹¶è¿”å›å®¢æˆ·ç«¯é”™è¯¯ä¿¡æ¯&quot;(error) OOM command not allowed when used memory&quot;ï¼Œæ­¤æ—¶Redisåªå“åº”è¯»æ“ä½œã€‚</li></ol><p><strong>LRU ç®—æ³•</strong>ï¼ˆLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰</p><p>æ·˜æ±°å¾ˆä¹…æ²¡è¢«è®¿é—®è¿‡çš„æ•°æ®ï¼Œä»¥<strong>æœ€è¿‘ä¸€æ¬¡è®¿é—®æ—¶é—´</strong>ä½œä¸ºå‚è€ƒã€‚</p><p><strong>LFU ç®—æ³•</strong>ï¼ˆLeast Frequently Usedï¼Œæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼‰</p><p>æ·˜æ±°æœ€è¿‘ä¸€æ®µæ—¶é—´è¢«è®¿é—®æ¬¡æ•°æœ€å°‘çš„æ•°æ®ï¼Œä»¥<strong>æ¬¡æ•°</strong>ä½œä¸ºå‚è€ƒã€‚</p><p>å½“å­˜åœ¨çƒ­ç‚¹æ•°æ®æ—¶ï¼ŒLRUçš„æ•ˆç‡å¾ˆå¥½ï¼Œä½†å¶å‘æ€§çš„ã€å‘¨æœŸæ€§çš„æ‰¹é‡æ“ä½œä¼šå¯¼è‡´LRUå‘½ä¸­ç‡æ€¥å‰§ä¸‹é™ï¼Œç¼“å­˜æ±¡æŸ“æƒ…å†µæ¯”è¾ƒä¸¥é‡ã€‚è¿™æ—¶ä½¿ç”¨LFUå¯èƒ½æ›´å¥½ç‚¹ã€‚</p><p>æ ¹æ®è‡ªèº«ä¸šåŠ¡ç±»å‹ï¼Œé…ç½®å¥½maxmemory-policy(é»˜è®¤æ˜¯noeviction)ï¼Œæ¨èä½¿ç”¨volatile-lruã€‚å¦‚æœä¸è®¾ç½®æœ€å¤§å†…å­˜ï¼Œå½“ Redis å†…å­˜è¶…å‡ºç‰©ç†å†…å­˜é™åˆ¶æ—¶ï¼Œå†…å­˜çš„æ•°æ®ä¼šå¼€å§‹å’Œç£ç›˜äº§ç”Ÿé¢‘ç¹çš„äº¤æ¢ (swap)ï¼Œä¼šè®© Redis çš„æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚</p><p>å½“Redisè¿è¡Œåœ¨ä¸»ä»æ¨¡å¼æ—¶ï¼Œåªæœ‰ä¸»ç»“ç‚¹æ‰ä¼šæ‰§è¡Œè¿‡æœŸåˆ é™¤ç­–ç•¥ï¼Œç„¶åæŠŠåˆ é™¤æ“ä½œâ€del keyâ€åŒæ­¥åˆ°ä»ç»“ç‚¹åˆ é™¤æ•°æ®ã€‚</p><p><strong>å››ã€ç³»ç»Ÿå†…æ ¸å‚æ•°ä¼˜åŒ–</strong></p><p><strong>vm.swapiness</strong></p><p>swapå¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´æ¯”è¾ƒé‡è¦ï¼Œå½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œå¯ä»¥å°†ä¸€éƒ¨åˆ†å†…å­˜é¡µè¿›è¡Œswapåˆ°ç¡¬ç›˜ä¸Šï¼Œä»¥è§£ç‡ƒçœ‰ä¹‹æ€¥ã€‚ä½†ä¸–ç•Œä¸Šæ²¡æœ‰å…è´¹åˆé¤ï¼Œswapç©ºé—´ç”±ç¡¬ç›˜æä¾›ï¼Œå¯¹äºéœ€è¦é«˜å¹¶å‘ã€é«˜ååçš„åº”ç”¨æ¥è¯´ï¼Œç£ç›˜IOé€šå¸¸ä¼šæˆä¸ºç³»ç»Ÿç“¶é¢ˆã€‚åœ¨Linuxä¸­ï¼Œå¹¶ä¸æ˜¯è¦ç­‰åˆ°æ‰€æœ‰ç‰©ç†å†…å­˜éƒ½ä½¿ç”¨å®Œæ‰ä¼šä½¿ç”¨åˆ°swapï¼Œç³»ç»Ÿå‚æ•°swppinessä¼šå†³å®šæ“ä½œç³»ç»Ÿä½¿ç”¨swapçš„å€¾å‘ç¨‹åº¦ã€‚swappinessçš„å–å€¼èŒƒå›´æ˜¯0~100ï¼Œswappinessçš„å€¼è¶Šå¤§ï¼Œè¯´æ˜æ“ä½œç³»ç»Ÿå¯èƒ½ä½¿ç”¨swapçš„æ¦‚ç‡è¶Šé«˜ï¼Œswappinesså€¼è¶Šä½ï¼Œè¡¨ç¤ºæ“ä½œç³»ç»Ÿæ›´åŠ å€¾å‘äºä½¿ç”¨ç‰©ç†å†…å­˜ã€‚swappinessçš„å–å€¼è¶Šå¤§ï¼Œè¯´æ˜æ“ä½œç³»ç»Ÿå¯èƒ½ä½¿ç”¨swapçš„æ¦‚ç‡è¶Šé«˜ï¼Œè¶Šä½åˆ™è¶Šå€¾å‘äºä½¿ç”¨ç‰©ç†å†…å­˜ã€‚</p><p>å¦‚æœlinuxå†…æ ¸ç‰ˆæœ¬&lt;3.5ï¼Œé‚£ä¹ˆswapinessè®¾ç½®ä¸º0ï¼Œè¿™æ ·ç³»ç»Ÿå®æ„¿swapä¹Ÿä¸ä¼šoom killerï¼ˆæ€æ‰è¿›ç¨‹ï¼‰</p><p>å¦‚æœlinuxå†…æ ¸ç‰ˆæœ¬&gt;=3.5ï¼Œé‚£ä¹ˆswapinessè®¾ç½®ä¸º1ï¼Œè¿™æ ·ç³»ç»Ÿå®æ„¿swapä¹Ÿä¸ä¼šoom killer</p><p>ä¸€èˆ¬éœ€è¦ä¿è¯redisä¸ä¼šè¢«killæ‰ï¼š</p><p>â€‹ cat /proc/version #æŸ¥çœ‹linuxå†…æ ¸ç‰ˆæœ¬ echo 1 &gt; /proc/sys/vm/swappiness echo vm.swapiness=1 &gt;&gt; /etc/sysctl.conf</p><p>PSï¼šOOM killer æœºåˆ¶æ˜¯æŒ‡Linuxæ“ä½œç³»ç»Ÿå‘ç°å¯ç”¨å†…å­˜ä¸è¶³æ—¶ï¼Œå¼ºåˆ¶æ€æ­»ä¸€äº›ç”¨æˆ·è¿›ç¨‹ï¼ˆéå†…æ ¸è¿›ç¨‹ï¼‰ï¼Œæ¥ä¿è¯ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜è¿›è¡Œåˆ†é…ã€‚</p><p><strong>vm.overcommit_memory(é»˜è®¤0)</strong></p><p>0ï¼šè¡¨ç¤ºå†…æ ¸å°†æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨ç‰©ç†å†…å­˜(å®é™…ä¸ä¸€å®šç”¨æ»¡)ä¾›åº”ç”¨è¿›ç¨‹ä½¿ç”¨ï¼›å¦‚æœæœ‰è¶³å¤Ÿçš„å¯ç”¨ç‰©ç†å†…å­˜ï¼Œå†…å­˜ç”³è¯·å…è®¸ï¼›å¦åˆ™ï¼Œå†…å­˜ç”³è¯·å¤±è´¥ï¼Œå¹¶æŠŠé”™è¯¯è¿”å›ç»™åº”ç”¨è¿›ç¨‹</p><p>1ï¼šè¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…æ‰€æœ‰çš„ç‰©ç†å†…å­˜ï¼Œè€Œä¸ç®¡å½“å‰çš„å†…å­˜çŠ¶æ€å¦‚ä½•</p><p>å¦‚æœæ˜¯0çš„è¯ï¼Œå¯èƒ½å¯¼è‡´ç±»ä¼¼forkç­‰æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œç”³è¯·ä¸åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´</p><p>Rediså»ºè®®æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸º1ï¼Œå°±æ˜¯ä¸ºäº†è®©forkæ“ä½œèƒ½å¤Ÿåœ¨ä½å†…å­˜ä¸‹ä¹Ÿæ‰§è¡ŒæˆåŠŸã€‚</p><p>â€‹ cat /proc/sys/vm/overcommit_memory echo &quot;vm.overcommit_memory=1&quot; &gt;&gt; /etc/sysctl.conf sysctl vm.overcommit_memory=1</p><p><strong>åˆç†è®¾ç½®æ–‡ä»¶å¥æŸ„æ•°</strong></p><p>æ“ä½œç³»ç»Ÿè¿›ç¨‹è¯•å›¾æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶(æˆ–è€…å«å¥æŸ„)ï¼Œä½†æ˜¯ç°åœ¨è¿›ç¨‹æ‰“å¼€çš„å¥æŸ„æ•°å·²ç»è¾¾åˆ°äº†ä¸Šé™ï¼Œç»§ç»­æ‰“å¼€ä¼šæŠ¥é”™ï¼šâ€œToo many open filesâ€</p><p>ulimit -a #æŸ¥çœ‹ç³»ç»Ÿæ–‡ä»¶å¥æŸ„æ•°ï¼Œçœ‹open filesé‚£é¡¹ ulimit -n 65535 #è®¾ç½®ç³»ç»Ÿæ–‡ä»¶å¥æŸ„æ•°</p><p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šslowlog</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>Redisæ…¢æ—¥å¿—å‘½ä»¤è¯´æ˜:
config get slow <span class="token comment">#æŸ¥è¯¢æœ‰å…³æ…¢æ—¥å¿—çš„é…ç½®ä¿¡æ¯</span>
config <span class="token builtin class-name">set</span> slowlog-log-slower-than <span class="token number">20000</span>  <span class="token comment">#è®¾ç½®æ…¢æ—¥å¿—ä½¿æ—¶é—´é˜ˆå€¼,å•ä½å¾®ç§’ï¼Œæ­¤å¤„ä¸º20æ¯«ç§’ï¼Œå³è¶…è¿‡20æ¯«ç§’çš„æ“ä½œéƒ½ä¼šè®°å½•ä¸‹æ¥ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®1000ï¼Œä¹Ÿå°±æ˜¯1msï¼Œè¿™æ ·ç†è®ºä¸Šrediså¹¶å‘è‡³å°‘è¾¾åˆ°1000ï¼Œå¦‚æœè¦æ±‚å•æœºå¹¶å‘è¾¾åˆ°1ä¸‡ä»¥ä¸Šï¼Œè¿™ä¸ªå€¼å¯ä»¥è®¾ç½®ä¸º100</span>
config <span class="token builtin class-name">set</span> slowlog-max-len <span class="token number">1024</span>  <span class="token comment">#è®¾ç½®æ…¢æ—¥å¿—è®°å½•ä¿å­˜æ•°é‡ï¼Œå¦‚æœä¿å­˜æ•°é‡å·²æ»¡ï¼Œä¼šåˆ é™¤æœ€æ—©çš„è®°å½•ï¼Œæœ€æ–°çš„è®°å½•è¿½åŠ è¿›æ¥ã€‚è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—æ—¶Redisä¼šå¯¹é•¿å‘½ä»¤åšæˆªæ–­æ“ä½œï¼Œå¹¶ä¸ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œå»ºè®®è®¾ç½®ç¨å¤§äº›ï¼Œé˜²æ­¢ä¸¢å¤±æ—¥å¿—</span>
config rewrite <span class="token comment">#å°†æœåŠ¡å™¨å½“å‰æ‰€ä½¿ç”¨çš„é…ç½®ä¿å­˜åˆ°redis.conf</span>
slowlog len <span class="token comment">#è·å–æ…¢æŸ¥è¯¢æ—¥å¿—åˆ—è¡¨çš„å½“å‰é•¿åº¦</span>
slowlog get <span class="token number">5</span> <span class="token comment">#è·å–æœ€æ–°çš„5æ¡æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚æ…¢æŸ¥è¯¢æ—¥å¿—ç”±å››ä¸ªå±æ€§ç»„æˆï¼šæ ‡è¯†IDï¼Œå‘ç”Ÿæ—¶é—´æˆ³ï¼Œå‘½ä»¤è€—æ—¶ï¼Œæ‰§è¡Œå‘½ä»¤å’Œå‚æ•°</span>
slowlog reset <span class="token comment">#é‡ç½®æ…¢æŸ¥è¯¢æ—¥å¿— </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹</p></div><!--[--><!----><!--]--><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/pages/bf6627/" aria-label="Redisæºç ä»¥åŠæ ¸å¿ƒè®¾è®¡åŸç†"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Redisæºç ä»¥åŠæ ¸å¿ƒè®¾è®¡åŸç†</div></a><a class="route-link nav-link next" href="/pages/7b5ba3/" aria-label="Redisç¼“å­˜é«˜å¯ç”¨é›†ç¾¤"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Redisç¼“å­˜é«˜å¯ç”¨é›†ç¾¤<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CcJZcE5q.js" defer></script>
  </body>
</html>
