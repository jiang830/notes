<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.26" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <title>RabbitMQä½¿ç”¨ä¸­çš„å¸¸è§é—®é¢˜</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-CV-aSyL0.css" as="style"><link rel="stylesheet" href="/assets/style-CV-aSyL0.css">
    <link rel="modulepreload" href="/assets/app-CcJZcE5q.js"><link rel="modulepreload" href="/assets/index.html-C6GUmZlK.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-CySwgr6W.js" as="script"><link rel="prefetch" href="/assets/index.html-DIQ6wV2c.js" as="script"><link rel="prefetch" href="/assets/index.html-DA9ZST6q.js" as="script"><link rel="prefetch" href="/assets/index.html-B1qwKQDM.js" as="script"><link rel="prefetch" href="/assets/index.html-QtYXnaPY.js" as="script"><link rel="prefetch" href="/assets/index.html-BoWZ1hiX.js" as="script"><link rel="prefetch" href="/assets/index.html-D1eqxnz4.js" as="script"><link rel="prefetch" href="/assets/index.html-Bkd8jpbq.js" as="script"><link rel="prefetch" href="/assets/index.html-CaPpN9fA.js" as="script"><link rel="prefetch" href="/assets/é˜¿é‡Œäº‘é¢è¯•é¢˜.html-BdFdwHHT.js" as="script"><link rel="prefetch" href="/assets/index.html-Dar6C79p.js" as="script"><link rel="prefetch" href="/assets/index.html-3LHzgUol.js" as="script"><link rel="prefetch" href="/assets/index.html-CNyrWvjP.js" as="script"><link rel="prefetch" href="/assets/index.html-tMJw4xAU.js" as="script"><link rel="prefetch" href="/assets/index.html-BBna-ubM.js" as="script"><link rel="prefetch" href="/assets/index.html-CQDrMRFa.js" as="script"><link rel="prefetch" href="/assets/index.html-BHHkC0SB.js" as="script"><link rel="prefetch" href="/assets/index.html-BT27OHXI.js" as="script"><link rel="prefetch" href="/assets/index.html-Ph_N0RhT.js" as="script"><link rel="prefetch" href="/assets/index.html-C0SZgDj-.js" as="script"><link rel="prefetch" href="/assets/index.html-COW2J1ah.js" as="script"><link rel="prefetch" href="/assets/index.html-CwlZk0kb.js" as="script"><link rel="prefetch" href="/assets/index.html-mOUgrTfQ.js" as="script"><link rel="prefetch" href="/assets/index.html-StCMFG4Y.js" as="script"><link rel="prefetch" href="/assets/index.html-pkZ_qPdt.js" as="script"><link rel="prefetch" href="/assets/index.html-meFoXNUk.js" as="script"><link rel="prefetch" href="/assets/index.html-D6UDt-z1.js" as="script"><link rel="prefetch" href="/assets/index.html-C4CeTDFP.js" as="script"><link rel="prefetch" href="/assets/index.html-DJOa7j38.js" as="script"><link rel="prefetch" href="/assets/index.html-u2YQwqCK.js" as="script"><link rel="prefetch" href="/assets/index.html-BoiC8F1t.js" as="script"><link rel="prefetch" href="/assets/index.html-CSq9YTr5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cyr0Ht9E.js" as="script"><link rel="prefetch" href="/assets/index.html-CpAXHyhZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DLvEiH8j.js" as="script"><link rel="prefetch" href="/assets/index.html-DfVjwGrn.js" as="script"><link rel="prefetch" href="/assets/index.html-BhnlQTe0.js" as="script"><link rel="prefetch" href="/assets/index.html-B3Q99jzV.js" as="script"><link rel="prefetch" href="/assets/index.html-C_jS85gJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DTuYMkqZ.js" as="script"><link rel="prefetch" href="/assets/index.html-ByDsocQC.js" as="script"><link rel="prefetch" href="/assets/index.html-Dx60V46q.js" as="script"><link rel="prefetch" href="/assets/index.html-B2169YvJ.js" as="script"><link rel="prefetch" href="/assets/index.html-u7yWxVkO.js" as="script"><link rel="prefetch" href="/assets/index.html-BAcuX6ex.js" as="script"><link rel="prefetch" href="/assets/index.html-CKFJiaUe.js" as="script"><link rel="prefetch" href="/assets/index.html-BQolQXiO.js" as="script"><link rel="prefetch" href="/assets/index.html-CV5OM5nX.js" as="script"><link rel="prefetch" href="/assets/index.html-edSgNf-M.js" as="script"><link rel="prefetch" href="/assets/index.html-BfO_EaOy.js" as="script"><link rel="prefetch" href="/assets/index.html-nyRG_LTF.js" as="script"><link rel="prefetch" href="/assets/index.html-D-frKFlo.js" as="script"><link rel="prefetch" href="/assets/00.åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-Cpl05HCa.js" as="script"><link rel="prefetch" href="/assets/index.html-Cq20v4BB.js" as="script"><link rel="prefetch" href="/assets/index.html-BVORs3On.js" as="script"><link rel="prefetch" href="/assets/index.html-BP6aZUE6.js" as="script"><link rel="prefetch" href="/assets/index.html-B-3_fbg6.js" as="script"><link rel="prefetch" href="/assets/index.html-CpJC_HeG.js" as="script"><link rel="prefetch" href="/assets/index.html-DjnTf6fe.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-D7z1G1-N.js" as="script"><link rel="prefetch" href="/assets/07.MySQLé”æœºåˆ¶ä¸ä¼˜åŒ–å®è·µä»¥åŠMVCCåº•å±‚åŸç†å‰–æ.html-BKAa643F.js" as="script"><link rel="prefetch" href="/assets/index.html-CxmzedXX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dzfk79WX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dn63XTEd.js" as="script"><link rel="prefetch" href="/assets/index.html-CzdtGl0g.js" as="script"><link rel="prefetch" href="/assets/index.html-9PiiOmcM.js" as="script"><link rel="prefetch" href="/assets/index.html-BmA5G_Wx.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-DuPwqrAu.js" as="script"><link rel="prefetch" href="/assets/index.html-BQ7HKii8.js" as="script"><link rel="prefetch" href="/assets/index.html-Ba0Idv51.js" as="script"><link rel="prefetch" href="/assets/index.html-joJLtsXk.js" as="script"><link rel="prefetch" href="/assets/index.html-L8Hlw6sX.js" as="script"><link rel="prefetch" href="/assets/index.html-C8_gL8dh.js" as="script"><link rel="prefetch" href="/assets/index.html-6Tc1Q6ZE.js" as="script"><link rel="prefetch" href="/assets/index.html-VO0-ALK9.js" as="script"><link rel="prefetch" href="/assets/index.html-BPdXD1cL.js" as="script"><link rel="prefetch" href="/assets/index.html-j-8Qjm4N.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz_Qhpe9.js" as="script"><link rel="prefetch" href="/assets/index.html-CcaTKqjZ.js" as="script"><link rel="prefetch" href="/assets/index.html-o-IA65eG.js" as="script"><link rel="prefetch" href="/assets/index.html-y0YOCSWX.js" as="script"><link rel="prefetch" href="/assets/index.html-BdP5ezWY.js" as="script"><link rel="prefetch" href="/assets/index.html-zkImwKAM.js" as="script"><link rel="prefetch" href="/assets/index.html-B-rM7PKP.js" as="script"><link rel="prefetch" href="/assets/index.html-Bdbd7zWB.js" as="script"><link rel="prefetch" href="/assets/index.html-PQLu_cdG.js" as="script"><link rel="prefetch" href="/assets/index.html-BaByp152.js" as="script"><link rel="prefetch" href="/assets/index.html-DQrw1sGU.js" as="script"><link rel="prefetch" href="/assets/404.html-Xl7f9Pk5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cim6WBqA.js" as="script"><link rel="prefetch" href="/assets/index.html-DBgI0Ctx.js" as="script"><link rel="prefetch" href="/assets/index.html-CjlsAUhS.js" as="script"><link rel="prefetch" href="/assets/index.html-DBEQHe26.js" as="script"><link rel="prefetch" href="/assets/index.html-BrqbaMMm.js" as="script"><link rel="prefetch" href="/assets/index.html-B_JMJTKH.js" as="script"><link rel="prefetch" href="/assets/index.html-8JHj6Ere.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script"><link rel="prefetch" href="/assets/SearchResult-FVi5R2x7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><!----><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="é¦–é¡µ"><span class="font-icon icon circle-question" style=""></span>é¦–é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link active" href="/pages/" aria-label="æ–‡æ¡£"><span class="font-icon icon circle-question" style=""></span>æ–‡æ¡£<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">åˆ†å¸ƒå¼</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">00. Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">02. Elastic Search</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">03. Dubbo</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">04. Zookeeper</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">05.æ¶ˆæ¯é˜Ÿåˆ—</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">00. Rabbit MQ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/9a014b/" aria-label="RabbitMQä¸Šæ‰‹ä»¥åŠé›†ç¾¤æ¶æ„"><!---->RabbitMQä¸Šæ‰‹ä»¥åŠé›†ç¾¤æ¶æ„<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/pages/def779/" aria-label="RabbitMQä½¿ç”¨ä¸­çš„å¸¸è§é—®é¢˜"><!---->RabbitMQä½¿ç”¨ä¸­çš„å¸¸è§é—®é¢˜<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#rabbitmqå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" aria-label="RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ"><!---->RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½" aria-label="å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½ï¼Ÿ"><!---->å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½ï¼Ÿ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#rabbitmqæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ" aria-label="RabbitMQæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ"><!---->RabbitMQæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#å¦‚ä½•ä¿è¯æ¶ˆæ¯å¹‚ç­‰" aria-label="å¦‚ä½•ä¿è¯æ¶ˆæ¯å¹‚ç­‰ï¼Ÿ"><!---->å¦‚ä½•ä¿è¯æ¶ˆæ¯å¹‚ç­‰ï¼Ÿ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåº" aria-label="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Ÿ"><!---->å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Ÿ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#å…³äºrabbitmqçš„æ•°æ®å †ç§¯é—®é¢˜" aria-label="å…³äºRabbitMQçš„æ•°æ®å †ç§¯é—®é¢˜"><!---->å…³äºRabbitMQçš„æ•°æ®å †ç§¯é—®é¢˜<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#rabbitmqçš„å¤‡ä»½ä¸æ¢å¤" aria-label="RabbitMQçš„å¤‡ä»½ä¸æ¢å¤"><!---->RabbitMQçš„å¤‡ä»½ä¸æ¢å¤<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#rabbitmqçš„æ€§èƒ½ç›‘æ§" aria-label="RabbitMQçš„æ€§èƒ½ç›‘æ§"><!---->RabbitMQçš„æ€§èƒ½ç›‘æ§<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#æ­å»ºhaproxy-å®ç°é«˜å¯ç”¨é›†ç¾¤" aria-label="æ­å»ºHAProxyï¼Œå®ç°é«˜å¯ç”¨é›†ç¾¤"><!---->æ­å»ºHAProxyï¼Œå®ç°é«˜å¯ç”¨é›†ç¾¤<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#å®‰è£…haproxy" aria-label="å®‰è£…HAProxy"><!---->å®‰è£…HAProxy<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#é…ç½®haproxy" aria-label="é…ç½®HAProxy"><!---->é…ç½®HAProxy<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/def779/#æ€»ç»“" aria-label="æ€»ç»“"><!---->æ€»ç»“<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/d02edd/" aria-label="RabbitMQæ¶ˆè´¹ç«¯å¼‚å¸¸å¤„ç†"><!---->RabbitMQæ¶ˆè´¹ç«¯å¼‚å¸¸å¤„ç†<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/b891f5/" aria-label="RabbitMQç¼–ç¨‹æ¨¡å‹"><!---->RabbitMQç¼–ç¨‹æ¨¡å‹<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/ae15fa/" aria-label="RabbitMQé«˜çº§ä½¿ç”¨åœºæ™¯"><!---->RabbitMQé«˜çº§ä½¿ç”¨åœºæ™¯<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">01. Kafka</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">02. Rocket MQ</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å®¹å™¨</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å¹¶å‘ç¼–ç¨‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å¾®æœåŠ¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">æ€§èƒ½è°ƒä¼˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">æºç æ¡†æ¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ç®—æ³•</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">è®¡ç®—æœºç½‘ç»œ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">é¢è¯•</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->RabbitMQä½¿ç”¨ä¸­çš„å¸¸è§é—®é¢˜</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">æ±Ÿ</span></span><span property="author" content="æ±Ÿ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-12-04T01:54:39.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 15 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT15M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#rabbitmqå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±">RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½">å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#rabbitmqæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ">RabbitMQæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#å¦‚ä½•ä¿è¯æ¶ˆæ¯å¹‚ç­‰">å¦‚ä½•ä¿è¯æ¶ˆæ¯å¹‚ç­‰ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåº">å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#å…³äºrabbitmqçš„æ•°æ®å †ç§¯é—®é¢˜">å…³äºRabbitMQçš„æ•°æ®å †ç§¯é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#rabbitmqçš„å¤‡ä»½ä¸æ¢å¤">RabbitMQçš„å¤‡ä»½ä¸æ¢å¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#rabbitmqçš„æ€§èƒ½ç›‘æ§">RabbitMQçš„æ€§èƒ½ç›‘æ§</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#æ­å»ºhaproxy-å®ç°é«˜å¯ç”¨é›†ç¾¤">æ­å»ºHAProxyï¼Œå®ç°é«˜å¯ç”¨é›†ç¾¤</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#å®‰è£…haproxy">å®‰è£…HAProxy</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#é…ç½®haproxy">é…ç½®HAProxy</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h2 id="rabbitmqå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" tabindex="-1"><a class="header-anchor" href="#rabbitmqå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"><span>RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</span></a></h2><p>è¿™æ˜¯é¢è¯•æ—¶æœ€å–œæ¬¢é—®çš„é—®é¢˜ï¼Œå…¶å®è¿™æ˜¯ä¸ªæ‰€æœ‰MQçš„ä¸€ä¸ªå…±æ€§çš„é—®é¢˜ï¼Œå¤§è‡´çš„è§£å†³æ€è·¯ä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼Œä½†æ˜¯é’ˆå¯¹ä¸åŒçš„MQäº§å“ä¼šæœ‰ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚è€ŒRabbitMQè®¾è®¡ä¹‹å¤„å°±æ˜¯é’ˆå¯¹ä¼ä¸šå†…éƒ¨ç³»ç»Ÿä¹‹é—´è¿›è¡Œè°ƒç”¨è®¾è®¡çš„ï¼Œæ‰€ä»¥ä»–çš„æ¶ˆæ¯å¯é æ€§æ˜¯æ¯”è¾ƒé«˜çš„ã€‚åƒä¸‡ä¸è¦å†å›ç­”æ‰‹åŠ¨ç¡®è®¤äº†ã€‚</p><h3 id="å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½" tabindex="-1"><a class="header-anchor" href="#å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½"><span>å“ªäº›ç¯èŠ‚ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½ï¼Ÿ</span></a></h3><p>æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªé€šç”¨çš„MQåœºæ™¯</p><p><img src="https://img.jssjqd.cn/202212040155145.png" alt="image"></p><p>å…¶ä¸­ï¼Œ1ï¼Œ2ï¼Œ4ä¸‰ä¸ªåœºæ™¯éƒ½æ˜¯è·¨ç½‘ç»œçš„ï¼Œè€Œè·¨ç½‘ç»œå°±è‚¯å®šä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½ã€‚</p><p>ç„¶åå…³äº3è¿™ä¸ªç¯èŠ‚ï¼Œé€šå¸¸MQå­˜ç›˜æ—¶éƒ½ä¼šå…ˆå†™å…¥æ“ä½œç³»ç»Ÿçš„ç¼“å­˜page cacheä¸­ï¼Œç„¶åå†ç”±æ“ä½œç³»ç»Ÿå¼‚æ­¥çš„å°†æ¶ˆæ¯å†™å…¥ç¡¬ç›˜ã€‚è¿™ä¸ªä¸­é—´æœ‰ä¸ªæ—¶é—´å·®ï¼Œå°±å¯èƒ½ä¼šé€ æˆæ¶ˆæ¯ä¸¢å¤±ã€‚å¦‚æœæœåŠ¡æŒ‚äº†ï¼Œç¼“å­˜ä¸­è¿˜æ²¡æœ‰æ¥å¾—åŠå†™å…¥ç¡¬ç›˜çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚è¿™ä¹Ÿæ˜¯ä»»ä½•ç”¨æˆ·æ€çš„åº”ç”¨ç¨‹åºæ— æ³•é¿å…çš„ã€‚</p><p>å¯¹äºä»»ä½•MQäº§å“ï¼Œéƒ½åº”è¯¥ä»è¿™å››ä¸ªæ–¹é¢æ¥è€ƒè™‘æ•°æ®çš„å®‰å…¨æ€§ã€‚é‚£æˆ‘ä»¬çœ‹çœ‹ç”¨RabbitMQæ—¶è¦å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="rabbitmqæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#rabbitmqæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ"><span>RabbitMQæ¶ˆæ¯é›¶ä¸¢å¤±æ–¹æ¡ˆ</span></a></h3><h4 id="ç”Ÿäº§è€…ä¿è¯æ¶ˆæ¯æ­£ç¡®å‘é€åˆ°rabbitmq" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è€…ä¿è¯æ¶ˆæ¯æ­£ç¡®å‘é€åˆ°rabbitmq"><span>ç”Ÿäº§è€…ä¿è¯æ¶ˆæ¯æ­£ç¡®å‘é€åˆ°RabbitMQ</span></a></h4><p>å¯¹äºå•ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨<strong>ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</strong>ã€‚é€šè¿‡å¤šæ¬¡ç¡®è®¤çš„æ–¹å¼ï¼Œä¿è¯ç”Ÿäº§è€…çš„æ¶ˆæ¯èƒ½å¤Ÿæ­£ç¡®çš„å‘é€åˆ°RabbitMQä¸­ã€‚</p><p>RabbitMQçš„ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶åˆ†ä¸º<strong>åŒæ­¥ç¡®è®¤å’Œå¼‚æ­¥ç¡®è®¤</strong>ã€‚åŒæ­¥ç¡®è®¤ä¸»è¦æ˜¯é€šè¿‡åœ¨ç”Ÿäº§è€…ç«¯ä½¿ç”¨Channel.waitForConfirmsOrDie()æŒ‡å®šä¸€ä¸ªç­‰å¾…ç¡®è®¤çš„å®Œæˆæ—¶é—´ã€‚å¼‚æ­¥ç¡®è®¤æœºåˆ¶åˆ™æ˜¯é€šè¿‡channel.addConfirmListener(ConfirmCallback var1, ConfirmCallback var2)åœ¨ç”Ÿäº§è€…ç«¯æ³¨å…¥ä¸¤ä¸ªå›è°ƒç¡®è®¤å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯åœ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶è°ƒç”¨ï¼Œç¬¬äºŒä¸ªå‡½æ•°åˆ™æ˜¯ç”Ÿäº§è€…æ”¶åˆ°Brokerçš„æ¶ˆæ¯ç¡®è®¤è¯·æ±‚æ—¶è°ƒç”¨ã€‚ä¸¤ä¸ªå‡½æ•°éœ€è¦é€šè¿‡sequenceNumberè‡ªè¡Œå®Œæˆæ¶ˆæ¯çš„å‰åå¯¹åº”ã€‚sequenceNumberçš„ç”Ÿæˆæ–¹å¼éœ€è¦é€šè¿‡channelçš„åºåˆ—è·å–ã€‚int sequenceNumber = channel.getNextPublishSeqNo();</p><p>åœ¨RabbitMQä¸­ï¼Œå¦å¤–è¿˜æœ‰ä¸€ç§<strong>æ‰‹åŠ¨äº‹åŠ¡</strong>çš„æ–¹å¼ï¼Œå¯ä»¥ä¿è¯æ¶ˆæ¯æ­£ç¡®å‘é€ã€‚</p><p>æ‰‹åŠ¨äº‹åŠ¡æœºåˆ¶ä¸»è¦æœ‰å‡ ä¸ªå…³é”®çš„æ–¹æ³•ï¼š channel.txSelect() å¼€å¯äº‹åŠ¡ï¼› channel.txCommit() æäº¤äº‹åŠ¡ï¼› channel.txRollback() å›æ»šäº‹åŠ¡ï¼› ç”¨è¿™å‡ ä¸ªæ–¹æ³•æ¥è¿›è¡Œäº‹åŠ¡ç®¡ç†ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼éœ€è¦æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡é€»è¾‘ï¼Œå¹¶ä¸”æ‰‹åŠ¨äº‹åŠ¡ä¼šå¯¹channeläº§ç”Ÿé˜»å¡ï¼Œé€ æˆååé‡ä¸‹é™</p><h4 id="rabbitmqæ¶ˆæ¯å­˜ç›˜ä¸ä¸¢æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#rabbitmqæ¶ˆæ¯å­˜ç›˜ä¸ä¸¢æ¶ˆæ¯"><span>RabbitMQæ¶ˆæ¯å­˜ç›˜ä¸ä¸¢æ¶ˆæ¯</span></a></h4><p>è¿™ä¸ªåœ¨RabbitMQä¸­æ¯”è¾ƒå¥½å¤„ç†ï¼Œå¯¹äºClassicç»å…¸é˜Ÿåˆ—ï¼Œç›´æ¥å°†é˜Ÿåˆ—å£°æ˜æˆä¸ºæŒä¹…åŒ–é˜Ÿåˆ—å³å¯ã€‚è€Œæ–°å¢çš„Quorumé˜Ÿåˆ—å’ŒStreamé˜Ÿåˆ—ï¼Œéƒ½æ˜¯æ˜æ˜¾çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œèƒ½æ›´å¥½çš„ä¿è¯æœåŠ¡ç«¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚</p><h4 id="rabbitmqä¸»ä»æ¶ˆæ¯åŒæ­¥æ—¶ä¸ä¸¢æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#rabbitmqä¸»ä»æ¶ˆæ¯åŒæ­¥æ—¶ä¸ä¸¢æ¶ˆæ¯"><span>RabbitMQä¸»ä»æ¶ˆæ¯åŒæ­¥æ—¶ä¸ä¸¢æ¶ˆæ¯</span></a></h4><p>è¿™æ¶‰åŠåˆ°RabbitMQçš„é›†ç¾¤æ¶æ„ã€‚é¦–å…ˆä»–çš„æ™®é€šé›†ç¾¤æ¨¡å¼ï¼Œæ¶ˆæ¯æ˜¯åˆ†æ•£å­˜å‚¨çš„ï¼Œä¸ä¼šä¸»åŠ¨è¿›è¡Œæ¶ˆæ¯åŒæ­¥ï¼Œæ˜¯æœ‰å¯èƒ½ä¸¢å¤±æ¶ˆæ¯çš„ã€‚è€Œé•œåƒæ¨¡å¼é›†ç¾¤ï¼Œæ•°æ®ä¼šä¸»åŠ¨åœ¨é›†ç¾¤å„ä¸ªèŠ‚ç‚¹å½“ä¸­åŒæ­¥ï¼Œè¿™æ—¶ä¸¢å¤±æ¶ˆæ¯çš„æ¦‚ç‡ä¸ä¼šå¤ªé«˜ã€‚</p><p>å¦å¤–ï¼Œå¯ç”¨<strong>Federation</strong>è”é‚¦æœºåˆ¶ï¼Œç»™åŒ…å«é‡è¦æ¶ˆæ¯çš„é˜Ÿåˆ—å»ºç«‹ä¸€ä¸ªè¿œç«¯å¤‡ä»½ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><h4 id="rabbitmqæ¶ˆè´¹è€…ä¸ä¸¢å¤±æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#rabbitmqæ¶ˆè´¹è€…ä¸ä¸¢å¤±æ¶ˆæ¯"><span>RabbitMQæ¶ˆè´¹è€…ä¸ä¸¢å¤±æ¶ˆæ¯</span></a></h4><p>RabbitMQåœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶å¯ä»¥æŒ‡å®šæ˜¯è‡ªåŠ¨åº”ç­”ï¼Œè¿˜æ˜¯æ‰‹åŠ¨åº”ç­”ã€‚å¦‚æœæ˜¯è‡ªåŠ¨åº”ç­”æ¨¡å¼ï¼Œæ¶ˆè´¹è€…ä¼šåœ¨å®Œæˆä¸šåŠ¡å¤„ç†åè‡ªåŠ¨è¿›è¡Œåº”ç­”ï¼Œè€Œå¦‚æœæ¶ˆè´¹è€…çš„ä¸šåŠ¡é€»è¾‘æŠ›å‡ºå¼‚å¸¸ï¼ŒRabbitMQä¼šå°†æ¶ˆæ¯è¿›è¡Œé‡è¯•ï¼Œè¿™æ ·æ˜¯ä¸ä¼šä¸¢å¤±æ¶ˆæ¯çš„ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šé€ æˆæ¶ˆæ¯ä¸€ç›´é‡å¤æ¶ˆè´¹ã€‚</p><p>å°†RabbitMQçš„åº”ç­”æ¨¡å¼è®¾å®šä¸ºæ‰‹åŠ¨åº”ç­”å¯ä»¥æé«˜æ¶ˆæ¯æ¶ˆè´¹çš„å¯é æ€§ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span>
                                       <span class="token class-name">BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span>
                    <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> deliveryTag <span class="token operator">=</span> envelope<span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>deliveryTag<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> myconsumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦å¤–è¿™ä¸ªåº”ç­”æ¨¡å¼åœ¨SpringBooté›†æˆæ¡ˆä¾‹ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡å±æ€§spring.rabbitmq.listener.simple.acknowledge-mode è¿›è¡ŒæŒ‡å®šã€‚å¯ä»¥è®¾å®šä¸º AUTO è‡ªåŠ¨åº”ç­”ï¼› MANUAL æ‰‹åŠ¨åº”ç­”ï¼›NONE ä¸åº”ç­”ï¼› å…¶ä¸­è¿™ä¸ªNONEä¸åº”ç­”ï¼Œå°±æ˜¯ä¸å¯åŠ¨åº”ç­”æœºåˆ¶ï¼ŒRabbitMQåªç®¡å¾€æ¶ˆè´¹è€…æ¨é€æ¶ˆæ¯åï¼Œå°±ä¸å†é‡å¤æ¨é€æ¶ˆæ¯äº†ï¼Œç›¸å½“äºRocketMQçš„sendonewayï¼Œ è¿™æ ·æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯æ˜¾ç„¶ä¼šæœ‰ä¸¢æ¶ˆæ¯çš„å¯èƒ½ã€‚</p><p>æœ€åï¼Œä»»ä½•ç”¨æˆ·æ€çš„åº”ç”¨ç¨‹åºéƒ½æ— æ³•ä¿è¯ç»å¯¹çš„æ•°æ®å®‰å…¨ï¼Œæ‰€ä»¥ï¼Œå¤‡ä»½ä¸æ¢å¤çš„æ–¹æ¡ˆä¹Ÿéœ€è¦è€ƒè™‘åˆ°ã€‚</p><h2 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯å¹‚ç­‰" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯å¹‚ç­‰"><span>å¦‚ä½•ä¿è¯æ¶ˆæ¯å¹‚ç­‰ï¼Ÿ</span></a></h2><p><strong>RabbitMQçš„è‡ªåŠ¨é‡è¯•åŠŸèƒ½ï¼š</strong></p><p>å½“æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯å¤„ç†ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œæˆ–è€…ä¸å‘RabbitMQè¿”å›å“åº”ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQä¼šæ— é™æ¬¡æ•°çš„é‡å¤è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹ã€‚</p><p>å¤„ç†å¹‚ç­‰é—®é¢˜ï¼Œ<strong>é¦–å…ˆè¦è®¾å®šRabbitMQçš„é‡è¯•æ¬¡æ•°</strong>ã€‚åœ¨SpringBooté›†æˆRabbitMQæ—¶ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šspring.rabbitmq.listener.simple.retryå¼€å¤´çš„ä¸€ç³»åˆ—å±æ€§ï¼Œæ¥åˆ¶å®šé‡è¯•ç­–ç•¥ã€‚</p><p><strong>ç„¶åï¼Œéœ€è¦åœ¨ä¸šåŠ¡ä¸Šå¤„ç†å¹‚ç­‰é—®é¢˜</strong>ã€‚</p><p>å¤„ç†å¹‚ç­‰é—®é¢˜çš„å…³é”®æ˜¯è¦ç»™æ¯ä¸ªæ¶ˆæ¯ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ã€‚</p><p>åœ¨SpringBootæ¡†æ¶é›†æˆRabbitMQåï¼Œå¯ä»¥ç»™æ¯ä¸ªæ¶ˆæ¯æŒ‡å®šä¸€ä¸ªå…¨å±€å”¯ä¸€çš„MessageIDï¼Œåœ¨æ¶ˆè´¹è€…ç«¯é’ˆå¯¹MessageIDåšå¹‚ç­‰æ€§åˆ¤æ–­ã€‚å…³é”®ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//å‘é€è€…æŒ‡å®šIDå­—æ®µ</span>
<span class="token class-name">Message</span> message2 <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withBody</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMessageId</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  rabbitTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//æ¶ˆè´¹è€…è·å–MessageIDï¼Œè‡ªå·±åšå¹‚ç­‰æ€§åˆ¤æ–­</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;fanout_email_queue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å–æ¶ˆæ¯Id</span>
    <span class="token class-name">String</span> messageId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>è¦æ³¨æ„ä¸‹è¿™é‡Œç”¨çš„messageè¦æ˜¯org.springframework.amqp.core.Message</p></blockquote><p>åœ¨åŸç”ŸAPIå½“ä¸­ï¼Œä¹Ÿæ˜¯æ”¯æŒMessageIdçš„ã€‚å½“ç„¶ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œæœ€å¥½è¿˜æ˜¯èƒ½å¤Ÿæ·»åŠ ä¸€ä¸ªå…·æœ‰ä¸šåŠ¡æ„ä¹‰çš„æ•°æ®ä½œä¸ºå”¯ä¸€é”®ä¼šæ›´å¥½ï¼Œè¿™æ ·èƒ½æ›´å¥½çš„é˜²æ­¢é‡å¤æ¶ˆè´¹é—®é¢˜å¯¹ä¸šåŠ¡çš„å½±å“ã€‚æ¯”å¦‚ï¼Œé’ˆå¯¹è®¢å•æ¶ˆæ¯ï¼Œé‚£å°±ç”¨è®¢å•IDæ¥åšå”¯ä¸€é”®ã€‚åœ¨RabbitMQä¸­ï¼Œæ¶ˆæ¯çš„å¤´éƒ¨å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æºå¸¦æ•°æ®çš„åœ°æ–¹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// ==== å‘é€æ¶ˆæ¯æ—¶ï¼Œæºå¸¦sequenceNumberå’ŒorderNo</span>
<span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span><span class="token function">deliveryMode</span><span class="token punctuation">(</span><span class="token class-name">MessageProperties</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT_TEXT_PLAIN</span><span class="token punctuation">.</span><span class="token function">getDeliveryMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span><span class="token function">priority</span><span class="token punctuation">(</span><span class="token class-name">MessageProperties</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT_TEXT_PLAIN</span><span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//æºå¸¦æ¶ˆæ¯ID</span>
builder<span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>channel<span class="token punctuation">.</span><span class="token function">getNextPublishSeqNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//æºå¸¦è®¢å•å·</span>
headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ==== æ¥æ”¶æ¶ˆæ¯æ—¶ï¼Œæ‹¿åˆ°sequenceNumber</span>
<span class="token class-name">Consumer</span> myconsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span>
     <span class="token class-name">BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span>
     <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">//è·å–æ¶ˆæ¯ID</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;messageId:&quot;</span><span class="token operator">+</span>properties<span class="token punctuation">.</span><span class="token function">getMessageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è·å–è®¢å•ID</span>
     properties<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;key: &quot;</span><span class="token operator">+</span>key <span class="token operator">+</span><span class="token string">&quot;; value: &quot;</span><span class="token operator">+</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// (process the message components here ...)</span>
     <span class="token comment">//æ¶ˆæ¯å¤„ç†å®Œåï¼Œè¿›è¡Œç­”å¤ã€‚ç­”å¤è¿‡çš„æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨å°±ä¸ä¼šå†æ¬¡è½¬å‘ã€‚</span>
     <span class="token comment">//æ²¡æœ‰ç­”å¤è¿‡çš„æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä¼šä¸€ç›´ä¸åœè½¬å‘ã€‚</span>
     channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>deliveryTag<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> myconsumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåº" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåº"><span>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Ÿ</span></a></h2><p>æŸäº›åœºæ™¯ä¸‹ï¼Œéœ€è¦ä¿è¯æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºï¼Œä¾‹å¦‚ä¸€ä¸ªä¸‹å•è¿‡ç¨‹ï¼Œéœ€è¦å…ˆå®Œæˆæ‰£æ¬¾ï¼Œç„¶åæ‰£å‡åº“å­˜ï¼Œç„¶åé€šçŸ¥å¿«é€’å‘è´§ï¼Œè¿™ä¸ªé¡ºåºä¸èƒ½ä¹±ã€‚å¦‚æœæ¯ä¸ªæ­¥éª¤éƒ½é€šè¿‡æ¶ˆæ¯è¿›è¡Œå¼‚æ­¥é€šçŸ¥çš„è¯ï¼Œè¿™ä¸€ç»„æ¶ˆæ¯å°±å¿…é¡»ä¿è¯ä»–ä»¬çš„æ¶ˆè´¹é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚</p><p>åœ¨RabbitMQå½“ä¸­ï¼Œé’ˆå¯¹æ¶ˆæ¯é¡ºåºçš„è®¾è®¡å…¶å®æ˜¯æ¯”è¾ƒå¼±çš„ã€‚å”¯ä¸€æ¯”è¾ƒå¥½çš„ç­–ç•¥å°±æ˜¯ å•é˜Ÿåˆ—+å•æ¶ˆæ¯æ¨é€ã€‚å³ä¸€ç»„æœ‰åºæ¶ˆæ¯ï¼Œåªå‘åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œåˆ©ç”¨é˜Ÿåˆ—çš„FIFOç‰¹æ€§ä¿è¯æ¶ˆæ¯åœ¨é˜Ÿåˆ—å†…é¡ºåºä¸ä¼šä¹±ã€‚ä½†æ˜¯ï¼Œæ˜¾ç„¶ï¼Œè¿™æ˜¯ä»¥æåº¦æ¶ˆè€—æ€§èƒ½ä½œä¸ºä»£ä»·çš„ï¼Œåœ¨å®é™…é€‚åº”è¿‡ç¨‹ä¸­ï¼Œåº”è¯¥å°½é‡é¿å…è¿™ç§åœºæ™¯ã€‚</p><p>ç„¶ååœ¨æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹æ—¶ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ŒåŒæ—¶æŒ‡å®šprefetchå±æ€§ä¸º1ï¼Œå³æ¯æ¬¡RabbitMQéƒ½åªå¾€å®¢æˆ·ç«¯æ¨é€ä¸€ä¸ªæ¶ˆæ¯ã€‚åƒè¿™æ ·ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.rabbitmq.listener.simple.prefetch</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è€Œåœ¨å¤šé˜Ÿåˆ—æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œç›®å‰ä½¿ç”¨RabbitMQçš„è¯ï¼Œè¿˜æ²¡æœ‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨ä½¿ç”¨æ—¶ï¼Œåº”è¯¥å°½é‡é¿å…è¿™ç§æƒ…å†µã€‚</p><h2 id="å…³äºrabbitmqçš„æ•°æ®å †ç§¯é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å…³äºrabbitmqçš„æ•°æ®å †ç§¯é—®é¢˜"><span>å…³äºRabbitMQçš„æ•°æ®å †ç§¯é—®é¢˜</span></a></h2><p>RabbitMQä¸€ç›´ä»¥æ¥éƒ½æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å¯¹äºæ¶ˆæ¯å †ç§¯é—®é¢˜çš„å¤„ç†ä¸å¥½ã€‚å½“RabbitMQä¸­æœ‰å¤§é‡æ¶ˆæ¯å †ç§¯æ—¶ï¼Œæ•´ä½“æ€§èƒ½ä¼šä¸¥é‡ä¸‹é™ã€‚è€Œç›®å‰æ–°æ¨å‡ºçš„Quorumé˜Ÿåˆ—ä»¥åŠStreamé˜Ÿåˆ—ï¼Œç›®çš„å°±åœ¨äºè§£å†³è¿™ä¸ªæ ¸å¿ƒé—®é¢˜ã€‚ä½†æ˜¯è¿™ä¸¤ç§é˜Ÿåˆ—çš„ç¨³å®šæ€§å’Œå‘¨è¾¹ç”Ÿæ€éƒ½è¿˜ä¸å¤Ÿå®Œå–„ï¼Œå› æ­¤ï¼Œåœ¨ä½¿ç”¨RabbitMQæ—¶ï¼Œè¿˜æ˜¯è¦éå¸¸æ³¨æ„æ¶ˆæ¯å †ç§¯çš„é—®é¢˜ã€‚å°½é‡è®©æ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦å’Œç”Ÿäº§é€Ÿåº¦ä¿æŒä¸€è‡´ã€‚</p><p>è€Œå¦‚æœç¡®å®å‡ºç°äº†æ¶ˆæ¯å †ç§¯æ¯”è¾ƒä¸¥é‡çš„åœºæ™¯ï¼Œå°±éœ€è¦ä»æ•°æ®æµè½¬çš„å„ä¸ªç¯èŠ‚ç»¼åˆè€ƒè™‘ï¼Œè®¾è®¡é€‚åˆçš„è§£å†³æ–¹æ¡ˆã€‚</p><p><strong>é¦–å…ˆåœ¨æ¶ˆæ¯ç”Ÿäº§è€…ç«¯ï¼š</strong></p><p>å¯¹äºç”Ÿäº§è€…ç«¯ï¼Œæœ€æ˜æ˜¾çš„æ–¹å¼è‡ªç„¶æ˜¯é™ä½æ¶ˆæ¯ç”Ÿäº§çš„é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œç”Ÿäº§è€…ç«¯äº§ç”Ÿæ¶ˆæ¯çš„é€Ÿåº¦é€šå¸¸æ˜¯è·Ÿä¸šåŠ¡æ¯æ¯ç›¸å…³çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸å¤ªå¥½ç›´æ¥ä¼˜åŒ–ã€‚ä½†æ˜¯å¯ä»¥é€‰æ‹©å°½é‡å¤šé‡‡ç”¨æ‰¹é‡æ¶ˆæ¯çš„æ–¹å¼ï¼Œé™ä½IOé¢‘ç‡ã€‚</p><p><strong>ç„¶ååœ¨RabbitMQæœåŠ¡ç«¯ï¼š</strong></p><p>ä»å‰é¢çš„åˆ†äº«ä¸­ä¹Ÿèƒ½çœ‹å‡ºï¼ŒRabbitMQæœ¬èº«å…¶å®ä¹Ÿåœ¨ç€åŠ›äºæé«˜æœåŠ¡ç«¯çš„æ¶ˆæ¯å †ç§¯èƒ½åŠ›ã€‚å¯¹äºæ¶ˆæ¯å †ç§¯ä¸¥é‡çš„é˜Ÿåˆ—ï¼Œå¯ä»¥é¢„å…ˆæ·»åŠ æ‡’åŠ è½½æœºåˆ¶ï¼Œæˆ–è€…åˆ›å»ºShardingåˆ†ç‰‡é˜Ÿåˆ—ï¼Œè¿™äº›æªæ–½éƒ½æœ‰åŠ©äºä¼˜åŒ–æœåŠ¡ç«¯çš„æ¶ˆæ¯å †ç§¯èƒ½åŠ›ã€‚å¦å¤–ï¼Œå°è¯•ä½¿ç”¨Streamé˜Ÿåˆ—ï¼Œä¹Ÿèƒ½å¾ˆå¥½çš„æé«˜æœåŠ¡ç«¯çš„æ¶ˆæ¯å †ç§¯èƒ½åŠ›ã€‚</p><p><strong>æ¥ä¸‹æ¥åœ¨æ¶ˆæ¯æ¶ˆè´¹è€…ç«¯ï¼š</strong></p><p>è¦æå‡æ¶ˆè´¹é€Ÿåº¦æœ€ç›´æ¥çš„æ–¹å¼ï¼Œå°±æ˜¯å¢åŠ æ¶ˆè´¹è€…æ•°é‡äº†ã€‚å°¤å…¶å½“æ¶ˆè´¹ç«¯çš„æœåŠ¡å‡ºç°é—®é¢˜ï¼Œå·²ç»æœ‰å¤§é‡æ¶ˆæ¯å †ç§¯æ—¶ã€‚è¿™æ—¶ï¼Œå¯ä»¥å°½é‡å¤šçš„ç”³è¯·æœºå™¨ï¼Œéƒ¨ç½²æ¶ˆè´¹ç«¯åº”ç”¨ï¼Œäº‰å–åœ¨æœ€çŸ­çš„æ—¶é—´å†…æ¶ˆè´¹æ‰ç§¯å‹çš„æ¶ˆæ¯ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼éœ€è¦æ³¨æ„å¯¹å…¶ä»–ç»„ä»¶çš„æ€§èƒ½å‹åŠ›ã€‚</p><p>å¯¹äºå•ä¸ªæ¶ˆè´¹è€…ç«¯ï¼Œå¯ä»¥é€šè¿‡é…ç½®æå‡æ¶ˆè´¹è€…ç«¯çš„ååé‡ã€‚ä¾‹å¦‚</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token comment"># å•æ¬¡æ¨é€æ¶ˆæ¯æ•°é‡</span>
<span class="token key attr-name">spring.rabbitmq.listener.simple.prefetch</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token comment"># æ¶ˆè´¹è€…çš„æ¶ˆè´¹çº¿ç¨‹æ•°é‡</span>
<span class="token key attr-name">spring.rabbitmq.listener.simple.concurrency</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çµæ´»é…ç½®è¿™å‡ ä¸ªå‚æ•°ï¼Œèƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šè°ƒæ•´æ¯ä¸ªæ¶ˆè´¹è€…å®ä¾‹çš„ååé‡ï¼Œå‡å°‘æ¶ˆæ¯å †ç§¯æ•°é‡ã€‚</p><p>å½“ç¡®å®é‡åˆ°ç´§æ€¥çŠ¶å†µï¼Œæ¥ä¸åŠè°ƒæ•´æ¶ˆè´¹è€…ç«¯æ—¶ï¼Œå¯ä»¥ç´§æ€¥ä¸Šçº¿ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œä¸“é—¨ç”¨æ¥å°†æ¶ˆæ¯å¿«é€Ÿè½¬å½•ã€‚ä¿å­˜åˆ°æ•°æ®åº“æˆ–è€…Redisï¼Œç„¶åå†æ…¢æ…¢è¿›è¡Œå¤„ç†ã€‚</p><h2 id="rabbitmqçš„å¤‡ä»½ä¸æ¢å¤" tabindex="-1"><a class="header-anchor" href="#rabbitmqçš„å¤‡ä»½ä¸æ¢å¤"><span>RabbitMQçš„å¤‡ä»½ä¸æ¢å¤</span></a></h2><blockquote><p>æ–‡æ¡£åœ°å€ï¼š https://www.rabbitmq.com/backup.html</p></blockquote><p>RabbitMQæœ‰ä¸€ä¸ªdataç›®å½•ä¼šä¿å­˜åˆ†é…åˆ°è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ¶ˆæ¯ã€‚<code>æˆ‘ä»¬çš„å®éªŒç¯å¢ƒä¸­ï¼Œé»˜è®¤æ˜¯åœ¨/var/lib/rabbitmq/mnesiaç›®å½•ä¸‹</code> è¿™ä¸ªç›®å½•é‡Œé¢çš„å¤‡ä»½åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯å…ƒæ•°æ®(å®šä¹‰ç»“æ„çš„æ•°æ®)ï¼Œä¸€ä¸ªæ˜¯æ¶ˆæ¯å­˜å‚¨ç›®å½•ã€‚</p><p><strong>å¯¹äºå…ƒæ•°æ®ï¼Œå¯ä»¥åœ¨Webç®¡ç†é¡µé¢é€šè¿‡jsonæ–‡ä»¶ç›´æ¥å¯¼å‡ºæˆ–å¯¼å…¥ã€‚</strong></p><p><img src="https://img.jssjqd.cn/202212040155282.png" alt="image"></p><p><strong>è€Œå¯¹äºæ¶ˆæ¯ï¼Œå¯ä»¥æ‰‹åŠ¨è¿›è¡Œå¤‡ä»½æ¢å¤</strong></p><p>å…¶å®å¯¹äºæ¶ˆæ¯ï¼Œç”±äºMQçš„ç‰¹æ€§ï¼Œæ˜¯ä¸å»ºè®®è¿›è¡Œå¤‡ä»½æ¢å¤çš„ã€‚è€ŒRabbitMQå¦‚æœè¦è¿›è¡Œæ•°æ®å¤‡ä»½æ¢å¤ï¼Œä¹Ÿéå¸¸ç®€å•ã€‚</p><p>é¦–å…ˆï¼Œè¦ä¿è¯è¦æ¢å¤çš„RabbitMQä¸­å·²ç»æœ‰äº†å…¨éƒ¨çš„å…ƒæ•°æ®ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ä¸Šä¸€æ­¥çš„jsonæ–‡ä»¶æ¥æ¢å¤ã€‚</p><p>ç„¶åï¼Œå¤‡ä»½è¿‡ç¨‹å¿…é¡»è¦å…ˆåœæ­¢åº”ç”¨ã€‚å¦‚æœæ˜¯é’ˆå¯¹é•œåƒé›†ç¾¤ï¼Œè¿˜éœ€è¦æŠŠæ•´ä¸ªé›†ç¾¤å…¨éƒ¨åœæ­¢ã€‚</p><p>æœ€åï¼Œåœ¨RabbitMQçš„æ•°æ®ç›®å½•ä¸­ï¼Œæœ‰æŒ‰virtual hostsç»„ç»‡çš„æ–‡ä»¶å¤¹ã€‚ä½ åªéœ€è¦æŒ‰ç…§è™šæ‹Ÿä¸»æœºï¼Œå°†æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ–°çš„æœåŠ¡ä¸­å³å¯ã€‚æŒä¹…åŒ–æ¶ˆæ¯å’ŒéæŒä¹…åŒ–æ¶ˆæ¯éƒ½ä¼šä¸€èµ·å¤‡ä»½ã€‚ <code>æˆ‘ä»¬å®éªŒç¯å¢ƒçš„é»˜è®¤ç›®å½•æ˜¯/var/lib/rabbitmq/mnesia/rabbit@worker2/msg_stores/vhosts</code></p><h2 id="rabbitmqçš„æ€§èƒ½ç›‘æ§" tabindex="-1"><a class="header-anchor" href="#rabbitmqçš„æ€§èƒ½ç›‘æ§"><span>RabbitMQçš„æ€§èƒ½ç›‘æ§</span></a></h2><p>å…³äºRabbitMQçš„æ€§èƒ½ç›‘æ§ï¼Œåœ¨ç®¡ç†æ§åˆ¶å°ä¸­æä¾›äº†éå¸¸ä¸°å¯Œçš„å±•ç¤ºã€‚ä¾‹å¦‚åœ¨ä¸‹é¢è¿™ä¸ªç®€å•çš„é›†ç¾¤èŠ‚ç‚¹å›¾ä¸­ï¼Œå°±ç›‘æ§äº†éå¸¸å¤šç³»ç»Ÿçš„å…³é”®èµ„æºã€‚</p><p><img src="https://img.jssjqd.cn/202212040155333.png" alt="image"></p><p>è¿˜åŒ…æ‹¬æ¶ˆæ¯çš„ç”Ÿäº§æ¶ˆè´¹é¢‘ç‡ã€å…³é”®ç»„ä»¶ä½¿ç”¨æƒ…å†µç­‰ç­‰éå¸¸å¤šçš„ä¿¡æ¯ï¼Œéƒ½å¯ä»¥ä»è¿™ä¸ªç®¡ç†æ§åˆ¶å°ä¸Šå±•ç°å‡ºæ¥ã€‚ä½†æ˜¯ï¼Œå¯¹äºæ„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–çš„æ€§èƒ½ç›‘æ§ç³»ç»Ÿæ¥è¯´ï¼Œè¿™ä¸ªç®¡ç†é¡µé¢å°±ä¸å¤ªå¤Ÿç”¨äº†ã€‚ä¸ºæ­¤ï¼ŒRabbitMQä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„HTTPæ¥å£ï¼Œé€šè¿‡è¿™äº›æ¥å£å¯ä»¥éå¸¸å…¨é¢çš„ä½¿ç”¨å¹¶ç®¡ç†RabbitMQçš„å„ç§åŠŸèƒ½ã€‚</p><p>è¿™äº›HTTPçš„æ¥å£ä¸éœ€è¦ä¸“é—¨å»æŸ¥æ‰‹å†Œï¼Œåœ¨éƒ¨ç½²çš„ç®¡ç†æ§åˆ¶å°é¡µé¢ä¸‹æ–¹å·²ç»é›†æˆäº†è¯¦ç»†çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰“å¼€HTTP APIçš„é¡µé¢å°±èƒ½çœ‹åˆ°ã€‚</p><p><img src="https://img.jssjqd.cn/202212040155853.png" alt="image"></p><p>æ¯”å¦‚æœ€å¸¸ç”¨çš„ http://[server:port]/api/overview æ¥å£ï¼Œä¼šåˆ—å‡ºéå¸¸å¤šçš„ä¿¡æ¯ï¼ŒåŒ…å«ç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µã€‚é€šè¿‡è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥å¾ˆå¥½çš„å¯¹æ¥Promethusã€Grafanaç­‰å·¥å…·ï¼Œæ„å»ºæ›´çµæ´»çš„ç›‘æ§å‘Šè­¦ä½“ç³»ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¢çš„æ¥å£ç›¸å½“ä¸°å¯Œï¼Œä¸å…‰å¯ä»¥é€šè¿‡GETè¯·æ±‚è·å–å„ç§æ¶ˆæ¯ï¼Œè¿˜å¯ä»¥é€šè¿‡å…¶ä»–ç±»å‹çš„HTTPè¯·æ±‚æ¥ç®¡ç†RabbitMQä¸­çš„å„ç§èµ„æºï¼Œå› æ­¤åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘è¿™äº›æ¥å£çš„å®‰å…¨æ€§ã€‚</p><h2 id="æ­å»ºhaproxy-å®ç°é«˜å¯ç”¨é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#æ­å»ºhaproxy-å®ç°é«˜å¯ç”¨é›†ç¾¤"><span>æ­å»ºHAProxyï¼Œå®ç°é«˜å¯ç”¨é›†ç¾¤</span></a></h2><p>æˆ‘ä»¬ä¹‹å‰æ­å»ºçš„é•œåƒé›†ç¾¤ï¼Œå·²ç»å…·å¤‡äº†é›†ç¾¤çš„åŠŸèƒ½ï¼Œè¯·æ±‚å‘é€åˆ°ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ•°æ®éƒ½æ˜¯åœ¨é›†ç¾¤å†…å…±äº«çš„ã€‚ä½†æ˜¯ï¼Œåœ¨ä¼ä¸šä½¿ç”¨æ—¶ï¼Œé€šå¸¸è¿˜ä¼šé€‰æ‹©åœ¨é›†ç¾¤åŸºç¡€ä¸Šå¢åŠ è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ã€‚å³å¸Œæœ›å°†å®¢æˆ·ç«¯çš„è¯·æ±‚èƒ½å¤Ÿå°½é‡å‡åŒ€çš„åˆ†é…åˆ°é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·å¯ä»¥è®©é›†ç¾¤çš„å‹åŠ›å¾—åˆ°å¹³è¡¡ã€‚</p><p>å®ç°è´Ÿè½½å‡è¡¡çš„æ–¹å¼æœ‰å¾ˆå¤šï¼ŒHAProxyå°±æ˜¯å…¶ä¸­ä¸€ç§å¯é€‰æ–¹æ¡ˆã€‚HAProxyæ˜¯ä¸€ä¸ªå…è´¹ã€å¿«é€Ÿå¹¶ä¸”å¯é çš„è§£å†³æ–¹æ¡ˆï¼Œæœ‰å¾ˆå¤šå¤§å‹äº’è”ç½‘å…¬å¸éƒ½åœ¨ä½¿ç”¨ã€‚é€šè¿‡HAProxyï¼Œåº”ç”¨å¯ä»¥ç›´è¿ä¸€ä¸ªå•ä¸€çš„IPåœ°å€ï¼Œç„¶åHAProxyä¼šå°†è¿™ä¸ªIPåœ°å€çš„TCPè¯·æ±‚è¿›è¡Œè½¬å‘ï¼Œå¹¶åœ¨è½¬å‘è¿‡ç¨‹ä¸­å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><blockquote><p>å¾ˆå¤šæœ‰å®åŠ›çš„å¤§ä¼ä¸šä¼šé‡‡ç”¨F5ç­‰å…¶ä»–çš„ä¸€äº›è´Ÿè½½å‡è¡¡å·¥å…·ã€‚</p></blockquote><h3 id="å®‰è£…haproxy" tabindex="-1"><a class="header-anchor" href="#å®‰è£…haproxy"><span>å®‰è£…HAProxy</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#å®‰è£…</span>
yum <span class="token function">install</span> haproxy

<span class="token comment">#æ£€æµ‹å®‰è£…æ˜¯å¦æˆåŠŸ</span>
haproxy

<span class="token comment">#æŸ¥æ‰¾haproxy.cfgæ–‡ä»¶çš„ä½ç½®</span>
<span class="token function">find</span> / â€name haproxy.cfg

<span class="token comment">#é…ç½®haproxy.cfgæ–‡ä»¶ åé¢ä¼šåˆ—å‡ºå‚è€ƒé…ç½®</span>
<span class="token function">vim</span> /etc/haproxy/haproxy.cfg

<span class="token comment">#å¯åŠ¨haproxy</span>
haproxy â€f /etc/haproxy/haproxy.cfg

<span class="token comment">#æŸ¥çœ‹haproxyè¿›ç¨‹çŠ¶æ€</span>
systemctl status haproxy.service
<span class="token comment">#çŠ¶æ€å¦‚ä¸‹è¯´æ˜ å·²ç»å¯åŠ¨æˆåŠŸ Active: active (running)</span>

<span class="token comment">#è®¿é—®å¦‚ä¸‹åœ°å€å¯¹mqèŠ‚ç‚¹è¿›è¡Œç›‘æ§</span>
http://47.114.175.29:1080/haproxy_stats

<span class="token comment">#ä»£ç ä¸­è®¿é—®mqé›†ç¾¤åœ°å€ï¼Œåˆ™å˜ä¸ºè®¿é—®haproxyåœ°å€:5672</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é…ç½®haproxy" tabindex="-1"><a class="header-anchor" href="#é…ç½®haproxy"><span>é…ç½®HAProxy</span></a></h3><p>ä¿®æ”¹haproxy.cfgæ–‡ä»¶ã€‚ä¸‹é¢æ˜¯å‚è€ƒé…ç½®ã€‚æ³¨æ„å°†èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£æ¢æˆä½ è‡ªå·±çš„ç¯å¢ƒã€‚</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token comment">#â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</span>
<span class="token comment"># Example configuration for a possible web application. See the</span>
<span class="token comment"># full configuration options online.</span>
<span class="token comment">#</span>
<span class="token comment"># http://haproxy.1wt.eu/download/1.4/doc/configuration.txt</span>
<span class="token comment">#</span>
<span class="token comment">#â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</span>

<span class="token comment">#â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</span>
<span class="token comment"># Global settings</span>
<span class="token comment">#â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</span>
global
<span class="token comment"># to have these messages end up in /var/log/haproxy.log you will</span>
<span class="token comment"># need to:</span>
<span class="token comment">#16 # 1) configure syslog to accept network log events. This is done</span>
<span class="token comment"># by adding the &#39;â€r&#39; option to the SYSLOGD_OPTIONS in</span>
<span class="token comment"># /etc/sysconfig/syslog</span>
<span class="token comment">#</span>
<span class="token comment"># 2) configure local2 events to go to the /var/log/haproxy.log</span>
<span class="token comment"># file. A line like the following can be added to</span>
<span class="token comment"># /etc/sysconfig/syslog</span>
<span class="token comment">#</span>
<span class="token comment"># local2.* /var/log/haproxy.log</span>
<span class="token comment">#</span>
<span class="token key attr-name">log</span> <span class="token value attr-value">127.0.0.1 local2</span>

<span class="token key attr-name">chroot</span> <span class="token value attr-value">/var/lib/haproxy</span>
<span class="token key attr-name">pidfile</span> <span class="token value attr-value">/var/run/haproxy.pid</span>
<span class="token key attr-name">maxconn</span> <span class="token value attr-value">4000</span>
<span class="token key attr-name">user</span> <span class="token value attr-value">haproxy</span>
<span class="token key attr-name">group</span> <span class="token value attr-value">haproxy</span>
daemon

<span class="token comment"># turn on stats unix socket</span>
<span class="token key attr-name">stats</span> <span class="token value attr-value">socket /var/lib/haproxy/stats</span>

<span class="token comment">#â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</span>
<span class="token comment"># common defaults that all the &#39;listen&#39; and &#39;backend&#39; sections will</span>
<span class="token comment"># use if not designated in their block</span>
<span class="token comment">#â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</span>
defaults
<span class="token key attr-name">mode</span> <span class="token value attr-value">http</span>
<span class="token key attr-name">log</span> <span class="token value attr-value">global</span>
<span class="token key attr-name">option</span> <span class="token value attr-value">httplog</span>
<span class="token key attr-name">option</span> <span class="token value attr-value">dontlognull</span>
<span class="token key attr-name">option</span> <span class="token value attr-value">httpâ€serverâ€close</span>
<span class="token key attr-name">option</span> <span class="token value attr-value">forwardfor except 127.0.0.0/8</span>
<span class="token key attr-name">option</span> <span class="token value attr-value">redispatch</span>
<span class="token key attr-name">retries</span> <span class="token value attr-value">3</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">httpâ€request 10s</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">queue 1m</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">connect 10s</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">client 1m</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">server 1m</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">httpâ€keepâ€alive 10s</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">check 10s</span>
<span class="token key attr-name">maxconn</span> <span class="token value attr-value">300059</span>

<span class="token comment">#å¯¹MQé›†ç¾¤è¿›è¡Œç›‘å¬</span>
<span class="token key attr-name">listen</span> <span class="token value attr-value">rabbitmq_cluster</span>
<span class="token key attr-name">bind</span> <span class="token value attr-value">0.0.0.0:5672</span>
<span class="token key attr-name">option</span> <span class="token value attr-value">tcplog</span>
<span class="token key attr-name">mode</span> <span class="token value attr-value">tcp</span>
<span class="token key attr-name">option</span> <span class="token value attr-value">clitcpka</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">connect 1s</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">client 10s</span>
<span class="token key attr-name">timeout</span> <span class="token value attr-value">server 10s</span>
<span class="token key attr-name">balance</span> <span class="token value attr-value">roundrobin</span>
<span class="token key attr-name">server</span> <span class="token value attr-value">node1 worker1:5672 check inter 5s rise 2 fall 3</span>
<span class="token key attr-name">server</span> <span class="token value attr-value">node2 worker2:5672 check inter 5s rise 2 fall 3</span>
<span class="token key attr-name">server</span> <span class="token value attr-value">node3 worker3:5672 check inter 5s rise 2 fall 3</span>

<span class="token comment">#å¼€å¯haproxyç›‘æ§æœåŠ¡</span>
<span class="token key attr-name">listen</span> <span class="token value attr-value">http_front</span>
<span class="token key attr-name">bind</span> <span class="token value attr-value">0.0.0.0:1080</span>
<span class="token key attr-name">stats</span> <span class="token value attr-value">refresh 30s</span>
<span class="token key attr-name">stats</span> <span class="token value attr-value">uri /haproxy_stats</span>
<span class="token key attr-name">stats</span> <span class="token value attr-value">auth admin:admin</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><p>åŸºäºMQçš„äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œç»™åºå¤§çš„äº’è”ç½‘åº”ç”¨å¸¦æ¥äº†ä¸ä¸€æ ·çš„æ–¹å‘ã€‚MQçš„å¼‚æ­¥ã€è§£è€¦ã€å‰Šå³°ä¸‰å¤§åŠŸèƒ½ç‰¹ç‚¹åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸‹éƒ½èƒ½å¸¦æ¥æå¤§çš„æ€§èƒ½æå‡ï¼Œåœ¨æ—¥å¸¸å·¥ä½œè¿‡ç¨‹ä¸­ï¼Œåº”è¯¥å°è¯•æ€»ç»“è¿™äº›è®¾è®¡çš„æ€æƒ³ã€‚</p><p>è™½ç„¶MQçš„åŠŸèƒ½ï¼Œè¯´èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯éšç€MQçš„åº”ç”¨é€æ¸æ·±åŒ–ï¼Œæ‰€éœ€è¦è§£å†³çš„é—®é¢˜ä¹Ÿæ›´æ·±å…¥ã€‚å¯¹å„ç§ç»†åŒ–é—®é¢˜çš„æŒ–æ˜ç¨‹åº¦ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†å¼€å‘å›¢é˜Ÿèƒ½ä¸èƒ½çœŸæ­£Holdå¾—ä½MQäº§å“ã€‚é€šå¸¸é¢å‘äº’è”ç½‘çš„åº”ç”¨åœºæ™¯ï¼Œæ›´åŠ æ³¨é‡MQçš„ååé‡ï¼Œéœ€è¦å°†æ¶ˆæ¯å°½å¿«çš„ä¿å­˜ä¸‹æ¥ï¼Œå†ä¾›åç«¯æ…¢æ…¢æ¶ˆè´¹ã€‚è€Œé’ˆå¯¹ä¼ä¸šå†…éƒ¨çš„åº”ç”¨åœºæ™¯ï¼Œæ›´åŠ æ³¨é‡MQçš„æ•°æ®å®‰å…¨æ€§ï¼Œåœ¨å¤æ‚å¤šå˜çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½éœ€è¦æœ‰æ›´åŠ ä¸¥æ ¼çš„å®‰å…¨ä¿éšœã€‚è€Œåœ¨å½“ä»Šäº’è”ç½‘ï¼ŒKafkaæ˜¯ç¬¬ä¸€ä¸ªåœºæ™¯çš„ä¸äºŒä»£è¡¨ï¼Œä½†æ˜¯ä»–ä¼šä¸¢å¤±æ¶ˆæ¯çš„ç‰¹æ€§ï¼Œè®©kafkaçš„ä½¿ç”¨åœºæ™¯æ¯”è¾ƒå±€é™ã€‚RabbitMQä½œä¸ºä¸€ä¸ªè€ç‰Œäº§å“ï¼Œæ˜¯ç¬¬äºŒä¸ªåœºæ™¯æœ€æœ‰åŠ›çš„ä»£è¡¨ã€‚å½“ç„¶ï¼Œéšç€äº’è”ç½‘åº”ç”¨ä¸ç«¯æˆç†Ÿï¼Œä¹Ÿä¸æ–­æœ‰å…¶ä»–æ›´å…¨èƒ½çš„äº§å“å†’å‡ºæ¥ï¼Œæ¯”å¦‚é˜¿é‡Œçš„RocketMQä»¥åŠé›…è™çš„Pulsarã€‚ä½†æ˜¯ä¸ç®¡æœªæ¥MQé¢†åŸŸä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼ŒRabbitMQä¾ç„¶æ˜¯ç›®å‰ä¼ä¸šçº§æœ€ä¸ºç»å…¸ä¹Ÿæœ€ä¸ºé‡è¦çš„ä¸€ä¸ªäº§å“ã€‚ä»–çš„åŠŸèƒ½æœ€ä¸ºå…¨é¢ï¼Œå‘¨è¾¹ç”Ÿæ€ä¹Ÿéå¸¸æˆç†Ÿï¼Œå¹¶ä¸”RabbitMQæœ‰åºå¤§çš„Springç¤¾åŒºæ”¯æŒï¼Œæœ¬èº«ä¹Ÿåœ¨å¸æ”¶å…¶ä»–äº§å“çš„å„ç§ä¼˜ç‚¹ï¼ŒæŒç»­è¿›åŒ–ï¼Œæ‰€ä»¥æœªæ¥RabbitMQçš„é‡è¦æ€§ä¹Ÿä¼šæ›´åŠ å‡¸æ˜¾ã€‚</p></div><!--[--><!----><!--]--><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/pages/9a014b/" aria-label="RabbitMQä¸Šæ‰‹ä»¥åŠé›†ç¾¤æ¶æ„"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->RabbitMQä¸Šæ‰‹ä»¥åŠé›†ç¾¤æ¶æ„</div></a><a class="route-link nav-link next" href="/pages/d02edd/" aria-label="RabbitMQæ¶ˆè´¹ç«¯å¼‚å¸¸å¤„ç†"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">RabbitMQæ¶ˆè´¹ç«¯å¼‚å¸¸å¤„ç†<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CcJZcE5q.js" defer></script>
  </body>
</html>
