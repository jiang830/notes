<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Alibaba 微服务组件 Nacos注册中心 | 学习笔记</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="个人技术博客,技术文档,学习,面试,markdown">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.05e4719f.css" as="style"><link rel="preload" href="/assets/js/app.6519c625.js" as="script"><link rel="preload" href="/assets/js/2.8795ec35.js" as="script"><link rel="preload" href="/assets/js/88.f4f0871d.js" as="script"><link rel="prefetch" href="/assets/js/10.a044793b.js"><link rel="prefetch" href="/assets/js/100.395bca2c.js"><link rel="prefetch" href="/assets/js/101.a3e4de38.js"><link rel="prefetch" href="/assets/js/102.fa4ed05d.js"><link rel="prefetch" href="/assets/js/103.dc6c5d69.js"><link rel="prefetch" href="/assets/js/104.75586808.js"><link rel="prefetch" href="/assets/js/105.511d296d.js"><link rel="prefetch" href="/assets/js/106.afb96620.js"><link rel="prefetch" href="/assets/js/107.1ffa920f.js"><link rel="prefetch" href="/assets/js/108.259eff2f.js"><link rel="prefetch" href="/assets/js/109.72f70ea4.js"><link rel="prefetch" href="/assets/js/11.5e7d0c95.js"><link rel="prefetch" href="/assets/js/110.cf6cc100.js"><link rel="prefetch" href="/assets/js/111.b94b04c5.js"><link rel="prefetch" href="/assets/js/112.dce94b67.js"><link rel="prefetch" href="/assets/js/113.f1e769de.js"><link rel="prefetch" href="/assets/js/114.660b6b09.js"><link rel="prefetch" href="/assets/js/12.e841c0c3.js"><link rel="prefetch" href="/assets/js/13.41a2fb93.js"><link rel="prefetch" href="/assets/js/14.e2a3317c.js"><link rel="prefetch" href="/assets/js/15.a81a6ef1.js"><link rel="prefetch" href="/assets/js/16.7b69e07f.js"><link rel="prefetch" href="/assets/js/17.777b188a.js"><link rel="prefetch" href="/assets/js/18.c81cf408.js"><link rel="prefetch" href="/assets/js/19.a59301e0.js"><link rel="prefetch" href="/assets/js/20.18827160.js"><link rel="prefetch" href="/assets/js/21.8d5d511f.js"><link rel="prefetch" href="/assets/js/22.a8ac93a6.js"><link rel="prefetch" href="/assets/js/23.1bbe4807.js"><link rel="prefetch" href="/assets/js/24.00525e76.js"><link rel="prefetch" href="/assets/js/25.3c90e0a0.js"><link rel="prefetch" href="/assets/js/26.c93f745b.js"><link rel="prefetch" href="/assets/js/27.01181006.js"><link rel="prefetch" href="/assets/js/28.93af4585.js"><link rel="prefetch" href="/assets/js/29.a0806690.js"><link rel="prefetch" href="/assets/js/3.7b0b8907.js"><link rel="prefetch" href="/assets/js/30.3beac9a7.js"><link rel="prefetch" href="/assets/js/31.3ee788ac.js"><link rel="prefetch" href="/assets/js/32.6522140e.js"><link rel="prefetch" href="/assets/js/33.24b1949c.js"><link rel="prefetch" href="/assets/js/34.90e39367.js"><link rel="prefetch" href="/assets/js/35.a67486b8.js"><link rel="prefetch" href="/assets/js/36.d9ffefc3.js"><link rel="prefetch" href="/assets/js/37.e3a99db4.js"><link rel="prefetch" href="/assets/js/38.8e250355.js"><link rel="prefetch" href="/assets/js/39.fc7bdfc1.js"><link rel="prefetch" href="/assets/js/4.9805163b.js"><link rel="prefetch" href="/assets/js/40.454bd56a.js"><link rel="prefetch" href="/assets/js/41.a235b641.js"><link rel="prefetch" href="/assets/js/42.af91ee0f.js"><link rel="prefetch" href="/assets/js/43.ee9374e7.js"><link rel="prefetch" href="/assets/js/44.36c8feb3.js"><link rel="prefetch" href="/assets/js/45.d8301c73.js"><link rel="prefetch" href="/assets/js/46.9a5a32af.js"><link rel="prefetch" href="/assets/js/47.d58b6a64.js"><link rel="prefetch" href="/assets/js/48.f02903e0.js"><link rel="prefetch" href="/assets/js/49.19767842.js"><link rel="prefetch" href="/assets/js/5.c3d6e4f2.js"><link rel="prefetch" href="/assets/js/50.48750e81.js"><link rel="prefetch" href="/assets/js/51.c4254bbf.js"><link rel="prefetch" href="/assets/js/52.b343e884.js"><link rel="prefetch" href="/assets/js/53.98458ade.js"><link rel="prefetch" href="/assets/js/54.fde5639b.js"><link rel="prefetch" href="/assets/js/55.1d6eee4b.js"><link rel="prefetch" href="/assets/js/56.b00d9d45.js"><link rel="prefetch" href="/assets/js/57.eaec60f9.js"><link rel="prefetch" href="/assets/js/58.4b703868.js"><link rel="prefetch" href="/assets/js/59.26a30b6e.js"><link rel="prefetch" href="/assets/js/6.c77dab88.js"><link rel="prefetch" href="/assets/js/60.eb33df05.js"><link rel="prefetch" href="/assets/js/61.d173fa46.js"><link rel="prefetch" href="/assets/js/62.429026f8.js"><link rel="prefetch" href="/assets/js/63.b58a3d49.js"><link rel="prefetch" href="/assets/js/64.99d18334.js"><link rel="prefetch" href="/assets/js/65.cce9fdce.js"><link rel="prefetch" href="/assets/js/66.2fe5a7ce.js"><link rel="prefetch" href="/assets/js/67.fa40b952.js"><link rel="prefetch" href="/assets/js/68.83533afe.js"><link rel="prefetch" href="/assets/js/69.699a59ea.js"><link rel="prefetch" href="/assets/js/7.76f628a5.js"><link rel="prefetch" href="/assets/js/70.576468eb.js"><link rel="prefetch" href="/assets/js/71.d479c994.js"><link rel="prefetch" href="/assets/js/72.b6d86aab.js"><link rel="prefetch" href="/assets/js/73.d835d9fc.js"><link rel="prefetch" href="/assets/js/74.d0c0c961.js"><link rel="prefetch" href="/assets/js/75.c0fb32d8.js"><link rel="prefetch" href="/assets/js/76.b98fe8df.js"><link rel="prefetch" href="/assets/js/77.506c158d.js"><link rel="prefetch" href="/assets/js/78.4bd2d644.js"><link rel="prefetch" href="/assets/js/79.35030393.js"><link rel="prefetch" href="/assets/js/8.d2e1201f.js"><link rel="prefetch" href="/assets/js/80.93dec784.js"><link rel="prefetch" href="/assets/js/81.f5092f98.js"><link rel="prefetch" href="/assets/js/82.ca631d56.js"><link rel="prefetch" href="/assets/js/83.1da51aad.js"><link rel="prefetch" href="/assets/js/84.8a1de17c.js"><link rel="prefetch" href="/assets/js/85.b00ba373.js"><link rel="prefetch" href="/assets/js/86.f0ea7c85.js"><link rel="prefetch" href="/assets/js/87.61a47fcf.js"><link rel="prefetch" href="/assets/js/89.b8a603a6.js"><link rel="prefetch" href="/assets/js/9.2821f128.js"><link rel="prefetch" href="/assets/js/90.fbfb0b00.js"><link rel="prefetch" href="/assets/js/91.a3a69724.js"><link rel="prefetch" href="/assets/js/92.b5de1c97.js"><link rel="prefetch" href="/assets/js/93.251d9171.js"><link rel="prefetch" href="/assets/js/94.f187e4e0.js"><link rel="prefetch" href="/assets/js/95.6fd0a296.js"><link rel="prefetch" href="/assets/js/96.66099a7e.js"><link rel="prefetch" href="/assets/js/97.15b4ddfe.js"><link rel="prefetch" href="/assets/js/98.3169dd1c.js"><link rel="prefetch" href="/assets/js/99.ac7be4e1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.05e4719f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="学习笔记" class="logo"> <span class="site-name can-hide">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://img.jssjqd.cn/202303140455599.jpg"> <div class="blogger-info"><h3>江</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringCloud Alibaba</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f7b862/" class="sidebar-link">微服务架构</a></li><li><a href="/pages/13f0c8/" aria-current="page" class="active sidebar-link">Alibaba 微服务组件 Nacos注册中心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/13f0c8/#注册中心介绍" class="sidebar-link">注册中心介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/13f0c8/#注册中心的作用" class="sidebar-link">注册中心的作用</a></li><li class="sidebar-sub-header level3"><a href="/pages/13f0c8/#注册中心设计思路分析" class="sidebar-link">注册中心设计思路分析</a></li><li class="sidebar-sub-header level3"><a href="/pages/13f0c8/#注册中心对比" class="sidebar-link">注册中心对比</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/13f0c8/#什么是-nacos" class="sidebar-link">什么是 Nacos</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/13f0c8/#nacos-注册中心架构和基本概念" class="sidebar-link">Nacos 注册中心架构和基本概念 !image-20230408031931102</a></li><li class="sidebar-sub-header level3"><a href="/pages/13f0c8/#nacos注册中心核心功能" class="sidebar-link">Nacos注册中心核心功能</a></li><li class="sidebar-sub-header level3"><a href="/pages/13f0c8/#nacos注册中心-nacos-server-环境搭建" class="sidebar-link">Nacos注册中心（Nacos Server）环境搭建</a></li><li class="sidebar-sub-header level3"><a href="/pages/13f0c8/#spring-cloud-alibaba-nacos快速开始" class="sidebar-link">Spring Cloud Alibaba Nacos快速开始</a></li><li class="sidebar-sub-header level3"><a href="/pages/13f0c8/#nacos注册中心常见配置" class="sidebar-link">Nacos注册中心常见配置</a></li></ul></li></ul></li><li><a href="/pages/ed68ae/" class="sidebar-link">负载均衡Ribbon&amp;LoadBalancer实战</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E5%BE%AE%E6%9C%8D%E5%8A%A1" title="分类" data-v-06225672>微服务</a></li><li data-v-06225672><a href="/categories/?category=SpringCloud%20Alibaba" title="分类" data-v-06225672>SpringCloud Alibaba</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>江</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-03-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Alibaba 微服务组件 Nacos注册中心<!----></h1>  <div class="theme-vdoing-content content__default"><p>Nacos版本：v2.1.0</p> <ol><li>微服务怎么学</li></ol> <ul><li><p>第一步：先掌握微服务组件的作用和使用，先系统的把spring cloud&amp;spring cloud alibaba大部分组件学一遍</p> <p>https://www.processon.com/view/link/60519545f346fb348a97c9d5</p></li> <li><p>第二步：深入学习每个组件的设计理念，设计思路，底层原理，扩展应用</p></li> <li><p>第三步：掌握spring，spring boot源码（主线流程）前提下，再去看微服务组件源码</p></li> <li><p>第四步：综合应用实战</p></li></ul> <h2 id="注册中心介绍"><a href="#注册中心介绍" class="header-anchor">#</a> 注册中心介绍</h2> <h3 id="注册中心的作用"><a href="#注册中心的作用" class="header-anchor">#</a> 注册中心的作用</h3> <p>思考：不同的微服务如何维护复杂的调用关系？</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//服务之间通过RestTemplate调用，url写死</span>
<span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8020/order/findOrderByUserId/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">;</span>
<span class="token class-name">R</span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token class-name">R</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          
</code></pre></div><p>实现服务发现的设计思路：</p> <p><img src="https://img.jssjqd.cn/202304080242859.png" alt="image-20230408024229802"></p> <p>服务注册中心的作用就是服务注册与发现</p> <ul><li>服务注册，就是将提供某个服务的模块信息(通常是这个服务的ip和端口)注册到1个公共的组件上去。</li> <li>服务发现，就是新注册的这个服务模块能够及时的被其他调用者发现。不管是服务新增和服务删减都能实现自动发现。</li></ul> <h3 id="注册中心设计思路分析"><a href="#注册中心设计思路分析" class="header-anchor">#</a> 注册中心设计思路分析</h3> <p>https://www.processon.com/view/link/5e71cc85e4b011fcce9d604d</p> <p>​    <img src="https://img.jssjqd.cn/202304080254722.png" alt="Snipaste_2023-04-08_02-53-53"></p> <h3 id="注册中心对比"><a href="#注册中心对比" class="header-anchor">#</a> 注册中心对比</h3> <p><img src="https://img.jssjqd.cn/202304080258850.png" alt="image-20230408025820928"></p> <h2 id="什么是-nacos"><a href="#什么是-nacos" class="header-anchor">#</a> 什么是 Nacos</h2> <p>Nacos 是 Dynamic Naming and Configuration Service 的首字母简称；一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p> <p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。</p> <p>Nacos 的关键特性包括:</p> <ul><li>服务发现和服务健康监测</li> <li>动态配置服务</li> <li>动态 DNS 服务</li> <li>服务及其元数据管理</li></ul> <p>官方文档： https://nacos.io/zh-cn/docs/what-is-nacos.html</p> <p>OpenAPI文档：https://nacos.io/zh-cn/docs/open-api.html</p> <p>nacos版本： v2.1.0</p> <p><strong>Nacos 优势</strong></p> <ul><li><strong>易用</strong>：简单的数据模型，标准的 restfulAPI，易用的控制台，丰富的使用文档。</li> <li><strong>稳定</strong>：99.9% 高可用，脱胎于历经阿里巴巴 10 年生产验证的内部产品，支持具有数百万服务的大规模场景，具备企业级 SLA 的开源产品。</li> <li><strong>实时</strong>：数据变更毫秒级推送生效；1w 级，SLA 承诺 1w 实例上下线 1s，99.9% 推送完成；10w 级，SLA 承诺 1w 实例上下线 3s，99.9% 推送完成；100w 级别，SLA 承诺 1w 实例上下线 9s 99.9% 推送完成。</li> <li>**规模：**十万级服务/配置，百万级连接，具备强大扩展性。</li></ul> <h3 id="nacos-注册中心架构和基本概念"><a href="#nacos-注册中心架构和基本概念" class="header-anchor">#</a> Nacos 注册中心架构和基本概念 <img src="https://img.jssjqd.cn/202304080319169.png" alt="image-20230408031931102"></h3> <p><strong>服务 (Service)</strong></p> <p>服务是指一个或一组软件功能（例如特定信息的检索或一组操作的执行），其目的是不同的客户端可以为不同的目的重用（例如通过跨进程的网络调用）。Nacos 支持主流的服务生态，如 Kubernetes Service、gRPC|Dubbo RPC Service 或者 Spring Cloud RESTful Service。</p> <p><strong>服务注册中心 (Service Registry)</strong></p> <p>服务注册中心，它是服务及其实例和元数据的数据库。服务实例在启动时注册到服务注册表，并在关闭时注销。服务和路由器的客户端查询服务注册表以查找服务的可用实例。服务注册中心可能会调用服务实例的健康检查 API 来验证它是否能够处理请求。</p> <p><strong>服务元数据 (Service Metadata)</strong></p> <p>服务元数据是指包括服务端点(endpoints)、服务标签、服务版本号、服务实例权重、路由规则、安全策略等描述服务的数据。</p> <p><strong>服务提供方 (Service Provider)</strong></p> <p>是指提供可复用和可调用服务的应用方。</p> <p><strong>服务消费方 (Service Consumer)</strong></p> <p>是指会发起对某个服务调用的应用方。</p> <h3 id="nacos注册中心核心功能"><a href="#nacos注册中心核心功能" class="header-anchor">#</a> Nacos注册中心核心功能</h3> <p><strong>服务注册</strong>：Nacos Client会通过发送REST请求的方式向Nacos Server注册自己的服务，提供自身的元数据，比如ip地址、端口等信息。Nacos Server接收到注册请求后，就会把这些元数据信息存储在一个双层的内存Map中。</p> <p><strong>服务心跳</strong>：在服务注册后，Nacos Client会维护一个定时心跳来持续通知Nacos Server，说明服务一直处于可用状态，防止被剔除。默认5s发送一次心跳。</p> <p><strong>服务同步</strong>：Nacos Server集群之间会互相同步服务实例，用来保证服务信息的一致性。</p> <p><strong>服务发现</strong>：服务消费者（Nacos Client）在调用服务提供者的服务时，会发送一个REST请求给Nacos Server，获取上面注册的服务清单，并且缓存在Nacos Client本地，同时会在Nacos Client本地开启一个定时任务定时拉取服务端最新的注册表信息更新到本地缓存</p> <p><strong>服务健康检查</strong>：Nacos Server会开启一个定时任务用来检查注册服务实例的健康情况，对于超过15s没有收到客户端心跳的实例会将它的healthy属性置为false(客户端服务发现时不会发现)，如果某个实例超过30秒没有收到心跳，直接剔除该实例(被剔除的实例如果恢复发送心跳则会重新注册)</p> <h3 id="nacos注册中心-nacos-server-环境搭建"><a href="#nacos注册中心-nacos-server-环境搭建" class="header-anchor">#</a> Nacos注册中心（Nacos Server）环境搭建</h3> <h4 id="单机模式"><a href="#单机模式" class="header-anchor">#</a> 单机模式</h4> <p>官方文档： https://nacos.io/zh-cn/docs/deployment.html</p> <p><strong>下载安装包</strong></p> <p>下载地址：https://github.com/alibaba/nacos/releases/download/2.1.0/nacos-server-2.1.0.tar.gz</p> <p>解压，进入nacos目录，单机模式启动nacos</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#单机模式启动nacos              </span>
</code></pre></div><p>也可以修改默认启动方式</p> <p><img src="https://img.jssjqd.cn/202304080320688.png" alt="image-20230408032030538"></p> <p>访问nacos的管理端：<a href="http://192.168.3.14:8848/nacos" target="_blank" rel="noopener noreferrer">http://192.168.65.103:8848/nacos<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，默认的用户名密码是 nacos/nacos</p> <p><img src="https://img.jssjqd.cn/202304080320380.png" alt="image-20230408032048961"></p> <h4 id="集群模式"><a href="#集群模式" class="header-anchor">#</a> 集群模式</h4> <p>官网文档： https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</p> <p><strong>1）环境准备</strong></p> <ul><li>安装好 JDK，需要 1.8 及其以上版本</li> <li>建议: 2核 CPU / 4G 内存 及其以上</li> <li>建议: 生产环境 3 个节点 及其以上</li></ul> <p>​                # 准备三台centos7服务器 192.168.65.174 192.168.65.192 192.168.65.204</p> <p>注意：在单台服务器上搭建伪集群不能使用连续端口号（比如8848,8849,8850）， 因为使用8848（grpc会占用9848,9849），8849（grpc会占用9849,9850），会导致端口冲突</p> <p>原因：Nacos2.x版本相比1.X新增了gRPC的通信方式，因此需要增加2个端口。新增端口是在配置的主端口(server.port)基础上，进行一定偏移量自动生成。</p> <table><thead><tr><th>端口</th> <th>与主端口的偏移量</th> <th>描述</th></tr></thead> <tbody><tr><td>9848</td> <td>1000</td> <td>客户端gRPC请求服务端端口，用于客户端向服务端发起连接和请求</td></tr> <tr><td>9849</td> <td>1001</td> <td>服务端gRPC请求服务端端口，用于服务间同步等</td></tr></tbody></table> <p><strong>2）以192.168.65.204为例，进入nacos目录</strong></p> <p><strong>2.1）修改conf/application.properties的配置，使用外置数据源</strong></p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment">#使用外置mysql数据源 </span>
<span class="token key attr-name">spring.datasource.platform</span><span class="token punctuation">=</span><span class="token value attr-value">mysql </span>

<span class="token comment">### Count of DB:</span>
<span class="token key attr-name">db.num</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>

<span class="token comment">### Connect URL of DB:</span>
<span class="token key attr-name">db.url.0</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.65.204:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span>
<span class="token key attr-name">db.user.0</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">db.password.0</span><span class="token punctuation">=</span><span class="token value attr-value">root      </span>
</code></pre></div><p><img src="https://img.jssjqd.cn/202304080322297.png" alt="image-20230408032226421"></p> <p><strong>2.2）将conf/cluster.conf.example改为cluster.conf,添加节点配置</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>mv conf<span class="token operator">/</span>cluster<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>example conf<span class="token operator">/</span>cluster<span class="token punctuation">.</span>conf
vim  conf<span class="token operator">/</span>cluster<span class="token punctuation">.</span>conf

# ip<span class="token operator">:</span>port 
<span class="token number">192.168</span><span class="token number">.65</span><span class="token number">.174</span><span class="token operator">:</span><span class="token number">8848</span>
<span class="token number">192.168</span><span class="token number">.65</span><span class="token number">.192</span><span class="token operator">:</span><span class="token number">8848</span>        
</code></pre></div><p>注意：不要使用localhost或127.0.0.1，针对多网卡环境，nacos可以指定网卡或ip</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment">#多网卡选择</span>
<span class="token comment">#ip-address参数可以直接设置nacos的ip</span>
<span class="token comment">#该参数设置后，将会使用这个IP去cluster.conf里进行匹配，请确保这个IP的值在cluster.conf里是存在的</span>
<span class="token key attr-name">nacos.inetutils.ip-address</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.65.206</span>

<span class="token comment">#use-only-site-local-interfaces参数可以让nacos使用局域网ip，这个在nacos部署的机器有多网卡时很有用，可以让nacos选择局域网网卡</span>
<span class="token key attr-name">nacos.inetutils.use-only-site-local-interfaces</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>

<span class="token comment">#ignored-interfaces支持网卡数组，可以让nacos忽略多个网卡</span>
<span class="token key attr-name">nacos.inetutils.ignored-interfaces[0]</span><span class="token punctuation">=</span><span class="token value attr-value">eth0</span>
<span class="token key attr-name">nacos.inetutils.ignored-interfaces[1]</span><span class="token punctuation">=</span><span class="token value attr-value">eth1</span>

<span class="token comment">#preferred-networks参数可以让nacos优先选择匹配的ip，支持正则匹配和前缀匹配</span>
<span class="token key attr-name">nacos.inetutils.preferred-networks[0]</span><span class="token punctuation">=</span><span class="token value attr-value">30.5.124.  </span>
</code></pre></div><p>192.168.65.174，192.168.65.192 按同样的方式配置。</p> <p><strong>3）mysql中创建nacos数据库</strong></p> <p>sql脚本：https://github.com/alibaba/nacos/blob/2.1.0/distribution/conf/nacos-mysql.sql</p> <p><strong>4)  如果内存不够，可以调整jvm参数</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token comment">#修改启动脚本 vim bin\startup.sh              </span>
</code></pre></div><p><img src="https://img.jssjqd.cn/202304080323077.png" alt="image-20230408032327093"></p> <p><strong>5)  分别启动三个节点上的nacos</strong></p> <p>以192.168.65.204为例，进入nacos目录，启动nacos</p> <div class="language-java extra-class"><pre class="language-java"><code>#启动nacos              
</code></pre></div><p><img src="https://img.jssjqd.cn/202304080323358.png" alt="image-20230408032345410"></p> <p><strong>6) 访问nacos管理界面</strong></p> <p>登录http://192.168.65.204:8848/nacos，用户名和密码都是nacos</p> <p><img src="https://img.jssjqd.cn/202304080323940.png" alt="image-20230408032359071"></p> <h3 id="spring-cloud-alibaba-nacos快速开始"><a href="#spring-cloud-alibaba-nacos快速开始" class="header-anchor">#</a> Spring Cloud Alibaba Nacos快速开始</h3> <h4 id="spring-cloud-alibaba版本选型"><a href="#spring-cloud-alibaba版本选型" class="header-anchor">#</a> Spring Cloud Alibaba版本选型</h4> <p>版本说明:<a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <table><thead><tr><th>Spring Cloud Alibaba Version</th> <th>Spring Cloud Version</th> <th>Spring Boot Version</th> <th>Nacos Version</th></tr></thead> <tbody><tr><td>2.2.8.RELEASE</td> <td>Spring Cloud Hoxton.SR12</td> <td>2.3.12.RELEASE</td> <td>2.1.0</td></tr></tbody></table> <p><strong>父pom配置</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.12.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.tuling.mall<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>vip-spring-cloud-alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>vip-spring-cloud-alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Demo project for vip-spring-cloud-alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>Hoxton.SR12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>2.2.8.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud-alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="微服务-nacos-client-整合nacos注册中心-nacos-server"><a href="#微服务-nacos-client-整合nacos注册中心-nacos-server" class="header-anchor">#</a> 微服务(Nacos Client)整合Nacos注册中心(Nacos Server)</h4> <p><strong>配置服务提供者mall-order</strong></p> <p>服务提供者可以通过 Nacos 的服务注册发现功能将其服务注册到 Nacos server 上。</p> <p><strong>1）引入依赖</strong></p> <p>当前项目pom中引入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>nacos-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>注意：只引入spring-cloud-starter-alibaba-nacos-discovery包会出现下面的错误，还需要再引入nacos-common包</p> <p><img src="https://img.jssjqd.cn/202304080325336.png" alt="image-20230408032526883"></p> <p>此bug已经修复了，不需要再引入nacos-common了，只需要引入spring-cloud-starter-alibaba-nacos-discovery</p> <p><strong>2)配置nacos注册中心</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8020</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mall<span class="token punctuation">-</span>order  <span class="token comment">#微服务名称</span>

  <span class="token comment">#配置nacos注册中心地址</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>       
</code></pre></div><p>更多配置：https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-discovery</p> <p>​    <img src="https://img.jssjqd.cn/202304080325724.png" alt="image-20230408032555150"></p> <p><strong>3）启动mall-order，nacos管理端界面查看是否成功注册</strong></p> <p><img src="https://img.jssjqd.cn/202304080326337.png" alt="image-20230408032603399"></p> <p>测试，通过<a href="https://nacos.io/zh-cn/docs/open-api.html" target="_blank" rel="noopener noreferrer">Open API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>查询实例列表</p> <p>http://localhost:8848/nacos/v1/ns/instance/list?serviceName=mall-order</p> <p><img src="https://img.jssjqd.cn/202304080326521.png" alt="image-20230408032612580"></p> <p><strong>配置服务消费者mall-user</strong></p> <p>服务消费者可以通过 Nacos 的服务注册发现功能从 Nacos server 上获取到它要调用的服务。</p> <p><strong>1）引入依赖</strong></p> <p>当前项目pom中引入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>nacos-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>      
</code></pre></div><p><strong>2)配置nacos注册中心</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8040</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mall<span class="token punctuation">-</span>user  <span class="token comment">#微服务名称</span>

  <span class="token comment">#配置nacos注册中心地址</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>                      
</code></pre></div><p><strong>3）启动mall-user，nacos管理端界面查看是否成功注册</strong> <img src="https://img.jssjqd.cn/202304080327014.png" alt="image-20230408032705149"></p> <p><strong>4）使用RestTemplate进行服务调用</strong></p> <p>给 RestTemplate 实例添加 @LoadBalanced 注解，开启 @LoadBalanced 与 Ribbon 的集成</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestConfig</span> <span class="token punctuation">{</span>   
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span>  
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>          
</code></pre></div><p>调用逻辑</p> <div class="language-java extra-class"><pre class="language-java"><code>#使用微服务名发起调用
<span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;http://mall-order/order/findOrderByUserId/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">;</span>      
</code></pre></div><p>测试：http://localhost:8040/user/findOrderByUserId/1，返回数据：</p> <p><img src="https://img.jssjqd.cn/202304080327084.png" alt="image-20230408032751087"></p> <h3 id="nacos注册中心常见配置"><a href="#nacos注册中心常见配置" class="header-anchor">#</a> Nacos注册中心常见配置</h3> <h4 id="服务分级存储模型"><a href="#服务分级存储模型" class="header-anchor">#</a> 服务分级存储模型</h4> <p>注册中心的核心数据是服务的名字和它对应的网络地址，当服务注册了多个实例时，我们需要对不 健康的实例进行过滤或者针对实例的⼀些特征进行流量的分配，那么就需要在实例上存储⼀些例如 健康状态、权重等属性。随着服务规模的扩大，渐渐的又需要在整个服务级别设定⼀些权限规则、 以及对所有实例都生效的⼀些开关，于是在服务级别又会设立⼀些属性。再往后，我们又发现单个 服务的实例又会有划分为多个子集的需求，例如⼀个服务是多机房部署的，那么可能需要对每个机 房的实例做不同的配置，这样又需要在服务和实例之间再设定⼀个数据级别。</p> <p>Nacos 在经过内部多年生 产经验后提炼出的数据模型，则是⼀种服务-集群-实例的三层模型。这样基本可以满足 服务在所有场景下的数据存储和管理。</p> <p><img src="https://img.jssjqd.cn/202304080328976.png" alt="image-20230408032820861"></p> <h4 id="服务逻辑隔离"><a href="#服务逻辑隔离" class="header-anchor">#</a> 服务逻辑隔离</h4> <p>Nacos 数据模型 Key 由三元组唯一确定, Namespace默认是空串，公共命名空间（public），分组默认是 DEFAULT_GROUP。</p> <p>​    <img src="https://img.jssjqd.cn/202304080328056.png" alt="image-20230408032828179"></p> <p><strong>Namespace 隔离设计</strong></p> <p>命名空间(Namespace)用于进行租户（用户）粒度的隔离，Namespace 的常用场景之一是不同环境的隔离，例如开发测试环境和生产环境的资源（如配置、服务）隔离等。	 <img src="https://img.jssjqd.cn/202304080328969.png" alt="image-20230408032835887"></p> <p>修改yml配置</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mall<span class="token punctuation">-</span>user  <span class="token comment">#微服务名称</span>

  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>   <span class="token comment">#配置nacos注册中心地址</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> bc50d386<span class="token punctuation">-</span>8870<span class="token punctuation">-</span>4a26<span class="token punctuation">-</span>8803<span class="token punctuation">-</span>0187486c57be  <span class="token comment"># dev 开发环境       </span>
</code></pre></div><p>启动mall-user，进入nacos控制台可以看到mall-user注册成功，所属namespace是dev</p> <p><img src="https://img.jssjqd.cn/202304080329431.png" alt="image-20230408032900319"></p> <p>测试：http://localhost:8040/user/findOrderByUserId/1，报错</p> <p><img src="https://img.jssjqd.cn/202304080329339.png" alt="image-20230408032908434"></p> <p>原因：mall-order和mall-user使用了不同的namespace，导致服务隔离。</p> <p><strong>group服务分组</strong></p> <p>不同的服务可以归类到同一分组，group也可以起到服务隔离的作用。yml中可以通过spring.cloud.nacos.discovery.group参数配置</p> <h4 id="临时实例和持久化实例"><a href="#临时实例和持久化实例" class="header-anchor">#</a> 临时实例和持久化实例</h4> <p>在定义上区分临时实例和持久化 实例的关键是健康检查的方式。临时实例使用客户端上报模式，而持久化实例使用服务端反向探测模式。临时实例需要能够自动摘除不健康实例，而且无需持久化存储实例。持久化实例使用服务端探测的健康检查方式，因为客户端不会上报心跳， 所以不能自动摘除下线的实例。</p> <p>在大中型的公司里，这两种类型的服务往往都有。⼀些基础的组件例如数据库、缓存等，这些往往不能上报心跳，这种类型的服务在注册时，就需要作为持久化实例注册。而上层的业务服务，例如 微服务或者 Dubbo 服务，服务的 Provider 端支持添加汇报心跳的逻辑，此时就可以使用动态服务的注册方式。</p> <p>Nacos 1.x 中持久化及非 持久化的属性是作为实例的⼀个元数据进行存储和识别。Nacos 2.x 中继续沿用了持久化及非持久化的设定，但是有了⼀些调整。在 Nacos2.0 中将是否持久化的数据抽象至服务级别， 且不再允许⼀个服务同时存在持久化实例和非持久化实例，实例的持久化属性继承自服务的持久化属性。</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># 持久化实例</span>
<span class="token key attr-name">spring.cloud.nacos.discovery.ephemeral</span><span class="token punctuation">:</span> <span class="token value attr-value">false</span>
</code></pre></div><p>​</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/04/08, 16:51:43</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/f7b862/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">微服务架构</div></a> <a href="/pages/ed68ae/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">负载均衡Ribbon&amp;LoadBalancer实战</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/f7b862/" class="prev">微服务架构</a></span> <span class="next"><a href="/pages/ed68ae/">负载均衡Ribbon&amp;LoadBalancer实战</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/ed68ae/"><div>
            负载均衡Ribbon&amp;LoadBalancer实战
            <!----></div></a> <span class="date">04-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/e79a05/"><div>
            SpringBoot自动配置底层源码解析
            <!----></div></a> <span class="date">04-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/5655a2/"><div>
            idea加密连接服务器docker
            <!----></div></a> <span class="date">04-04</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>江</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.6519c625.js" defer></script><script src="/assets/js/2.8795ec35.js" defer></script><script src="/assets/js/88.f4f0871d.js" defer></script>
  </body>
</html>
