<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.26" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <title>ElasticSearch快速入门实战</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-CV-aSyL0.css" as="style"><link rel="stylesheet" href="/assets/style-CV-aSyL0.css">
    <link rel="modulepreload" href="/assets/app-CcJZcE5q.js"><link rel="modulepreload" href="/assets/index.html-C4CeTDFP.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-CySwgr6W.js" as="script"><link rel="prefetch" href="/assets/index.html-DIQ6wV2c.js" as="script"><link rel="prefetch" href="/assets/index.html-DA9ZST6q.js" as="script"><link rel="prefetch" href="/assets/index.html-B1qwKQDM.js" as="script"><link rel="prefetch" href="/assets/index.html-QtYXnaPY.js" as="script"><link rel="prefetch" href="/assets/index.html-BoWZ1hiX.js" as="script"><link rel="prefetch" href="/assets/index.html-D1eqxnz4.js" as="script"><link rel="prefetch" href="/assets/index.html-Bkd8jpbq.js" as="script"><link rel="prefetch" href="/assets/index.html-CaPpN9fA.js" as="script"><link rel="prefetch" href="/assets/阿里云面试题.html-BdFdwHHT.js" as="script"><link rel="prefetch" href="/assets/index.html-Dar6C79p.js" as="script"><link rel="prefetch" href="/assets/index.html-3LHzgUol.js" as="script"><link rel="prefetch" href="/assets/index.html-CNyrWvjP.js" as="script"><link rel="prefetch" href="/assets/index.html-tMJw4xAU.js" as="script"><link rel="prefetch" href="/assets/index.html-BBna-ubM.js" as="script"><link rel="prefetch" href="/assets/index.html-CQDrMRFa.js" as="script"><link rel="prefetch" href="/assets/index.html-BHHkC0SB.js" as="script"><link rel="prefetch" href="/assets/index.html-BT27OHXI.js" as="script"><link rel="prefetch" href="/assets/index.html-Ph_N0RhT.js" as="script"><link rel="prefetch" href="/assets/index.html-C0SZgDj-.js" as="script"><link rel="prefetch" href="/assets/index.html-COW2J1ah.js" as="script"><link rel="prefetch" href="/assets/index.html-CwlZk0kb.js" as="script"><link rel="prefetch" href="/assets/index.html-mOUgrTfQ.js" as="script"><link rel="prefetch" href="/assets/index.html-StCMFG4Y.js" as="script"><link rel="prefetch" href="/assets/index.html-pkZ_qPdt.js" as="script"><link rel="prefetch" href="/assets/index.html-meFoXNUk.js" as="script"><link rel="prefetch" href="/assets/index.html-D6UDt-z1.js" as="script"><link rel="prefetch" href="/assets/index.html-DJOa7j38.js" as="script"><link rel="prefetch" href="/assets/index.html-u2YQwqCK.js" as="script"><link rel="prefetch" href="/assets/index.html-BoiC8F1t.js" as="script"><link rel="prefetch" href="/assets/index.html-CSq9YTr5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cyr0Ht9E.js" as="script"><link rel="prefetch" href="/assets/index.html-CpAXHyhZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DLvEiH8j.js" as="script"><link rel="prefetch" href="/assets/index.html-DfVjwGrn.js" as="script"><link rel="prefetch" href="/assets/index.html-BhnlQTe0.js" as="script"><link rel="prefetch" href="/assets/index.html-B3Q99jzV.js" as="script"><link rel="prefetch" href="/assets/index.html-C_jS85gJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DTuYMkqZ.js" as="script"><link rel="prefetch" href="/assets/index.html-ByDsocQC.js" as="script"><link rel="prefetch" href="/assets/index.html-Dx60V46q.js" as="script"><link rel="prefetch" href="/assets/index.html-B2169YvJ.js" as="script"><link rel="prefetch" href="/assets/index.html-u7yWxVkO.js" as="script"><link rel="prefetch" href="/assets/index.html-BAcuX6ex.js" as="script"><link rel="prefetch" href="/assets/index.html-CKFJiaUe.js" as="script"><link rel="prefetch" href="/assets/index.html-BQolQXiO.js" as="script"><link rel="prefetch" href="/assets/index.html-CV5OM5nX.js" as="script"><link rel="prefetch" href="/assets/index.html-edSgNf-M.js" as="script"><link rel="prefetch" href="/assets/index.html-BfO_EaOy.js" as="script"><link rel="prefetch" href="/assets/index.html-nyRG_LTF.js" as="script"><link rel="prefetch" href="/assets/index.html-D-frKFlo.js" as="script"><link rel="prefetch" href="/assets/00.分布式事务组件Seata.html-Cpl05HCa.js" as="script"><link rel="prefetch" href="/assets/index.html-Cq20v4BB.js" as="script"><link rel="prefetch" href="/assets/index.html-BVORs3On.js" as="script"><link rel="prefetch" href="/assets/index.html-BP6aZUE6.js" as="script"><link rel="prefetch" href="/assets/index.html-B-3_fbg6.js" as="script"><link rel="prefetch" href="/assets/index.html-CpJC_HeG.js" as="script"><link rel="prefetch" href="/assets/index.html-DjnTf6fe.js" as="script"><link rel="prefetch" href="/assets/06.MySQL事务原理与优化最佳实践.html-D7z1G1-N.js" as="script"><link rel="prefetch" href="/assets/07.MySQL锁机制与优化实践以及MVCC底层原理剖析.html-BKAa643F.js" as="script"><link rel="prefetch" href="/assets/index.html-CxmzedXX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dzfk79WX.js" as="script"><link rel="prefetch" href="/assets/index.html-Dn63XTEd.js" as="script"><link rel="prefetch" href="/assets/index.html-CzdtGl0g.js" as="script"><link rel="prefetch" href="/assets/index.html-9PiiOmcM.js" as="script"><link rel="prefetch" href="/assets/index.html-BmA5G_Wx.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBC源码与内核解析.html-DuPwqrAu.js" as="script"><link rel="prefetch" href="/assets/index.html-BQ7HKii8.js" as="script"><link rel="prefetch" href="/assets/index.html-Ba0Idv51.js" as="script"><link rel="prefetch" href="/assets/index.html-joJLtsXk.js" as="script"><link rel="prefetch" href="/assets/index.html-L8Hlw6sX.js" as="script"><link rel="prefetch" href="/assets/index.html-C8_gL8dh.js" as="script"><link rel="prefetch" href="/assets/index.html-6Tc1Q6ZE.js" as="script"><link rel="prefetch" href="/assets/index.html-VO0-ALK9.js" as="script"><link rel="prefetch" href="/assets/index.html-BPdXD1cL.js" as="script"><link rel="prefetch" href="/assets/index.html-j-8Qjm4N.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz_Qhpe9.js" as="script"><link rel="prefetch" href="/assets/index.html-CcaTKqjZ.js" as="script"><link rel="prefetch" href="/assets/index.html-o-IA65eG.js" as="script"><link rel="prefetch" href="/assets/index.html-y0YOCSWX.js" as="script"><link rel="prefetch" href="/assets/index.html-BdP5ezWY.js" as="script"><link rel="prefetch" href="/assets/index.html-C6GUmZlK.js" as="script"><link rel="prefetch" href="/assets/index.html-zkImwKAM.js" as="script"><link rel="prefetch" href="/assets/index.html-B-rM7PKP.js" as="script"><link rel="prefetch" href="/assets/index.html-Bdbd7zWB.js" as="script"><link rel="prefetch" href="/assets/index.html-PQLu_cdG.js" as="script"><link rel="prefetch" href="/assets/index.html-BaByp152.js" as="script"><link rel="prefetch" href="/assets/index.html-DQrw1sGU.js" as="script"><link rel="prefetch" href="/assets/404.html-Xl7f9Pk5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cim6WBqA.js" as="script"><link rel="prefetch" href="/assets/index.html-DBgI0Ctx.js" as="script"><link rel="prefetch" href="/assets/index.html-CjlsAUhS.js" as="script"><link rel="prefetch" href="/assets/index.html-DBEQHe26.js" as="script"><link rel="prefetch" href="/assets/index.html-BrqbaMMm.js" as="script"><link rel="prefetch" href="/assets/index.html-B_JMJTKH.js" as="script"><link rel="prefetch" href="/assets/index.html-8JHj6Ere.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script"><link rel="prefetch" href="/assets/SearchResult-FVi5R2x7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><!----><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="首页"><span class="font-icon icon circle-question" style=""></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link active" href="/pages/" aria-label="文档"><span class="font-icon icon circle-question" style=""></span>文档<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">分布式</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">00. Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">02. Elastic Search</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/5a94a3/" aria-label="ElasticSearch 高级查询语法Query DSL实战"><!---->ElasticSearch 高级查询语法Query DSL实战<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/a0495c/" aria-label="ElasticSearch基础查询语句"><!---->ElasticSearch基础查询语句<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/pages/8c5c4e/" aria-label="ElasticSearch快速入门实战"><!---->ElasticSearch快速入门实战<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#全文检索" aria-label="全文检索"><!---->全文检索<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#什么是全文检索" aria-label="什么是全文检索"><!---->什么是全文检索<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#倒排索引" aria-label="倒排索引"><!---->倒排索引<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elasticsearch简介" aria-label="ElasticSearch简介"><!---->ElasticSearch简介<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elasticsearch是什么" aria-label="ElasticSearch是什么"><!---->ElasticSearch是什么<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elastic-stack介绍" aria-label="Elastic Stack介绍"><!---->Elastic Stack介绍<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elasticsearch应用场景" aria-label="ElasticSearch应用场景"><!---->ElasticSearch应用场景<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elasticsearch快速开始" aria-label="ElasticSearch快速开始"><!---->ElasticSearch快速开始<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elasticsearch安装运行" aria-label="ElasticSearch安装运行"><!---->ElasticSearch安装运行<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elasticsearch基本概念" aria-label="ElasticSearch基本概念"><!---->ElasticSearch基本概念<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elasticsearch索引操作" aria-label="ElasticSearch索引操作"><!---->ElasticSearch索引操作<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elasticsearch文档操作" aria-label="ElasticSearch文档操作"><!---->ElasticSearch文档操作<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/pages/8c5c4e/#elasticsearch文档批量操作" aria-label="ElasticSearch文档批量操作"><!---->ElasticSearch文档批量操作<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/f9f747/" aria-label="ElasticSearch搜索技术深入与聚合查询实战"><!---->ElasticSearch搜索技术深入与聚合查询实战<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/pages/1c44cf/" aria-label="ElasticSearch集群架构实战及其原理"><!---->ElasticSearch集群架构实战及其原理<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">03. Dubbo</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">04. Zookeeper</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">05.消息队列</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">容器</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">并发编程</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">微服务</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">性能调优</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">源码框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">算法</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">计算机网络</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">面试</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->ElasticSearch快速入门实战</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">江</span></span><span property="author" content="江"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-12-11T15:58:17.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 24 分钟</span><meta property="timeRequired" content="PT24M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#全文检索">全文检索</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#什么是全文检索">什么是全文检索</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#倒排索引">倒排索引</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#elasticsearch简介">ElasticSearch简介</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#elasticsearch是什么">ElasticSearch是什么</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#elastic-stack介绍">Elastic Stack介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#elasticsearch应用场景">ElasticSearch应用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#elasticsearch快速开始">ElasticSearch快速开始</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#elasticsearch安装运行">ElasticSearch安装运行</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#elasticsearch基本概念">ElasticSearch基本概念</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#elasticsearch索引操作">ElasticSearch索引操作</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#elasticsearch文档操作">ElasticSearch文档操作</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#elasticsearch文档批量操作">ElasticSearch文档批量操作</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><p>ES版本： v7.17.3</p><h2 id="全文检索" tabindex="-1"><a class="header-anchor" href="#全文检索"><span>全文检索</span></a></h2><p><strong>数据分类：</strong></p><ul><li>结构化数据： 固定格式，有限长度 比如mysql存的数据</li><li>非结构化数据：不定长，无固定格式 比如邮件，word文档，日志</li><li>半结构化数据： 前两者结合 比如xml，html</li></ul><p><strong>搜索分类：</strong></p><ul><li><p>结构化数据搜索： 使用关系型数据库</p></li><li><p>非结构化数据搜索</p></li><li><ul><li>顺序扫描</li><li>全文检索</li></ul></li></ul><p>设想一个关于搜索的场景，假设我们要搜索一首诗句内容中带“前”字的古诗</p><table><thead><tr><th>name</th><th>content</th><th>author</th></tr></thead><tbody><tr><td>静夜思</td><td>床前明月光,疑是地上霜。举头望明月，低头思故乡。</td><td>李白</td></tr><tr><td>望庐山瀑布</td><td>日照香炉生紫烟，遥看瀑布挂前川。飞流直下三千尺,疑是银河落九天。</td><td>李白</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><p>思考：用传统关系型数据库和ES 实现会有什么差别？</p><p>如果用像 MySQL 这样的 RDBMS 来存储古诗的话，我们应该会去使用这样的 SQL 去查询</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">select</span> name <span class="token keyword">from</span> poems <span class="token keyword">where</span> content <span class="token operator">like</span> <span class="token string">&quot;%前%&quot;</span>              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这种我们称为顺序扫描法，需要遍历所有的记录进行匹配。不但效率低，而且不符合我们搜索时的期望，比如我们在搜索“ABCD&quot;这样的关键词时，通常还希望看到&quot;A&quot;,&quot;AB&quot;,&quot;CD&quot;,“ABC”的搜索结果。</p><h3 id="什么是全文检索" tabindex="-1"><a class="header-anchor" href="#什么是全文检索"><span>什么是全文检索</span></a></h3><p>全文检索是指：</p><ul><li>通过一个程序扫描文本中的每一个单词，针对单词建立索引，并保存该单词在文本中的位置、以及出现的次数</li><li>用户查询时，通过之前建立好的索引来查询，将索引中单词对应的文本位置、出现的次数返回给用户，因为有了具体文本的位置，所以就可以将具体内容读取出来了</li></ul><p><img src="https://img.jssjqd.cn/202212111606093.png" alt="image-20221211160621032"></p><p>搜索原理简单概括的话可以分为这么几步：</p><ul><li>内容爬取，停顿词过滤比如一些无用的像&quot;的&quot;，“了”之类的语气词/连接词</li><li>内容分词，提取关键词</li><li>根据关键词建立倒排索引</li><li>用户输入关键词进行搜索</li></ul><h3 id="倒排索引" tabindex="-1"><a class="header-anchor" href="#倒排索引"><span>倒排索引</span></a></h3><p>索引就类似于目录，平时我们使用的都是索引，都是通过主键定位到某条数据，那么倒排索引呢，刚好相反，数据对应到主键。</p><p><img src="https://img.jssjqd.cn/202212111610103.png" alt="image-20221211161013902"></p><p>这里以一个博客文章的内容为例:</p><p><strong>正排索引（正向索引）</strong></p><table><thead><tr><th>文章ID</th><th>文章标题</th><th>文章内容</th></tr></thead><tbody><tr><td>1</td><td>浅析JAVA设计模式</td><td>JAVA设计模式是每一个JAVA程序员都应该掌握的进阶知识</td></tr><tr><td>2</td><td>JAVA多线程设计模式</td><td>JAVA多线程与设计模式结合</td></tr></tbody></table><p><strong>倒排索引（反向索引）</strong></p><p>假如，我们有一个站内搜索的功能，通过某个关键词来搜索相关的文章，那么这个关键词可能出现在标题中，也可能出现在文章内容中，那我们将会在创建或修改文章的时候，建立一个关键词与文章的对应关系表，这种，我们可以称之为倒排索引。</p><table><thead><tr><th>关键词</th><th>文章ID</th></tr></thead><tbody><tr><td>JAVA</td><td>1,2</td></tr><tr><td>设计模式</td><td>1,2</td></tr><tr><td>多线程</td><td>2</td></tr></tbody></table><p>简单理解，正向索引是通过key找value，反向索引则是通过value找key。ES底层在检索时底层使用的就是倒排索引。</p><h2 id="elasticsearch简介" tabindex="-1"><a class="header-anchor" href="#elasticsearch简介"><span>ElasticSearch简介</span></a></h2><h3 id="elasticsearch是什么" tabindex="-1"><a class="header-anchor" href="#elasticsearch是什么"><span>ElasticSearch是什么</span></a></h3><p>ElasticSearch（简称ES）是一个分布式、RESTful 风格的搜索和数据分析引擎，是用Java开发并且是当前最流行的开源的企业级搜索引擎，能够达到近实时搜索，稳定，可靠，快速，安装使用方便。</p><p>客户端支持Java、.NET（C#）、PHP、Python、Ruby等多种语言。</p><p><strong>官方网站:</strong> https://www.elastic.co/</p><p>**下载地址：**https://www.elastic.co/cn/downloads/past-releases#elasticsearch</p><p>搜索引擎排名：</p><p><img src="https://img.jssjqd.cn/202212130317569.png" alt="image-20221213031750797"></p><p>参考网站：https://db-engines.com/en/ranking/search+engine</p><p><strong>起源——Lucene</strong></p><ul><li><p>基于Java语言开发的搜索引擎库类</p></li><li><p>创建于1999年，2005年成为Apache 顶级开源项目</p></li><li><p>Lucene具有高性能、易扩展的优点</p></li><li><p>Lucene的局限性︰</p></li><li><ul><li>只能基于Java语言开发</li><li>类库的接口学习曲线陡峭</li><li>原生并不支持水平扩展</li></ul></li></ul><p><strong>Elasticsearch的诞生</strong></p><p>Elasticsearch是构建在Apache Lucene之上的开源分布式搜索引擎。</p><ul><li><p>2004年 Shay Banon 基于Lucene开发了Compass</p></li><li><p>2010年 Shay Banon重写了Compass，取名Elasticsearch</p></li><li><ul><li>支持分布式，可水平扩展</li><li>降低全文检索的学习曲线，可以被任何编程语言调用</li></ul></li></ul><p>​ <img src="https://note.youdao.com/yws/public/resource/d5d5718ae542f274ba0fda4284a53231/xmlnote/A8F24FAED7834EFAAFFD94EFCF5A07A8/46329" alt="0"></p><p>Elasticsearch 与 Lucene 核心库竞争的优势在于：</p><ul><li>完美封装了 Lucene 核心库，设计了友好的 Restful-API，开发者无需过多关注底层机制，直接开箱即用。</li><li>分片与副本机制，直接解决了集群下性能与高可用问题。</li></ul><p>ES Server进程 3节点 raft (奇数节点)</p><p>数据分片 -》lucene实例 分片和副本数 1个ES节点可以有多个lucene实例。也可以指定一个索引的多个分片</p><p><img src="https://img.jssjqd.cn/202212111616311.png" alt="image-20221211161559774"></p><p><strong>ElasticSearch版本特性</strong></p><p>5.x新特性</p><ul><li><p>Lucene 6.x， 性能提升，默认打分机制从TF-IDF改为BM 25</p></li><li><p>支持Ingest节点/ Painless Scripting / Completion suggested支持/原生的Java REST客户端</p></li><li><p>Type标记成deprecated， 支持了Keyword的类型</p></li><li><p>性能优化</p><p>内部引擎移除了避免同一文档并发更新的竞争锁，带来15% - 20%的性能提升</p><p>Instant aggregation,支持分片，上聚合的缓存</p><p>新增了Profile API</p></li></ul><p>6.x新特性</p><ul><li><p>Lucene 7.x</p></li><li><p>新功能</p></li><li><ul><li>跨集群复制(CCR)</li><li>索引生命周期管理</li><li>SQL的支持</li></ul></li><li><p>更友好的的升级及数据迁移</p></li><li><ul><li>在主要版本之间的迁移更为简化，体验升级</li><li>全新的基于操作的数据复制框架，可加快恢复数据</li></ul></li><li><p>性能优化</p></li><li><ul><li>有效存储稀疏字段的新方法，降低了存储成本</li><li>在索引时进行排序，可加快排序的查询性能</li></ul></li></ul><p>7.x新特性</p><ul><li><p>Lucene 8.0</p></li><li><p>重大改进-正式废除单个索引下多Type的支持</p></li><li><p>7.1开始，Security 功能免费使用</p></li><li><p>ECK - Elasticseach Operator on Kubernetes</p></li><li><p>新功能</p></li><li><ul><li>New Cluster coordination</li><li>Feature——Complete High Level REST Client</li><li>Script Score Query</li></ul></li><li><p>性能优化</p></li><li><ul><li>默认的Primary Shard数从5改为1,避免Over Sharding</li><li>性能优化， 更快的Top K</li></ul></li></ul><p>8.x新特性</p><ul><li>Rest API相比较7.x而言做了比较大的改动（比如彻底删除_type）</li><li>默认开启安全配置</li><li>存储空间优化：对倒排文件使用新的编码集，对于keyword、match_only_text、text类型字段有效，有3.5%的空间优化提升，对于新建索引和segment自动生效。</li><li>优化geo_point，geo_shape类型的索引（写入）效率：15%的提升。</li><li>技术预览版KNN API发布，（K邻近算法），跟推荐系统、自然语言排名相关。</li><li>https://www.elastic.co/guide/en/elastic-stack/current/elasticsearch-breaking-changes.html</li></ul><p><strong>ElasticSearch vs Solr</strong></p><p>Solr 是第一个基于 Lucene 核心库功能完备的搜索引擎产品，诞生远早于 Elasticsearch。</p><p>当单纯的对已有数据进行搜索时，Solr更快。当实时建立索引时, Solr会产生io阻塞，查询性能较差, Elasticsearch具有明显的优势。</p><p><img src="https://img.jssjqd.cn/202212111617130.png" alt="image-20221211161742842"></p><p>​ <img src="https://note.youdao.com/yws/public/resource/d5d5718ae542f274ba0fda4284a53231/xmlnote/A1C3A7F3FBA943E89AADB69DA767EE4D/46439" alt="0"></p><p>大型互联网公司，实际生产环境测试，将搜索引擎从Solr转到 Elasticsearch以后的平均查询速度有了50倍的提升。</p><p><img src="https://img.jssjqd.cn/202212111617826.png" alt="image-20221211161751943"></p><p><strong>总结：</strong></p><ul><li>Solr 利用 Zookeeper 进行分布式管理，而Elasticsearch 自身带有分布式协调管理功能。</li><li>Solr 支持更多格式的数据，比如JSON、XML、CSV，而 Elasticsearch 仅支持json文件格式。</li><li>Solr 在传统的搜索应用中表现好于 Elasticsearch，但在处理实时搜索应用时效率明显低于 Elasticsearch。</li><li>Solr 是传统搜索应用的有力解决方案，但 Elasticsearch更适用于新兴的实时搜索应用。</li></ul><h3 id="elastic-stack介绍" tabindex="-1"><a class="header-anchor" href="#elastic-stack介绍"><span>Elastic Stack介绍</span></a></h3><p>在Elastic Stack之前我们听说过ELK，ELK分别是Elasticsearch，Logstash，Kibana这三款软件在一起的简称，在发展的过程中又有新的成员Beats的加入，就形成了Elastic Stack。</p><p><img src="https://img.jssjqd.cn/202212111618501.png" alt="image-20221211161811486"></p><p>Elastic Stack生态圈</p><p>在Elastic Stack生态圈中Elasticsearch作为数据存储和搜索，是生态圈的基石，Kibana在上层提供用户一个可视化及操作的界面，Logstash和Beat可以对数据进行收集。在上图的右侧X-Pack部分则是Elastic公司提供的商业项目。</p><p>指标分析/日志分析：</p><p><img src="https://img.jssjqd.cn/202212111618794.png" alt="image-20221211161825292"></p><h3 id="elasticsearch应用场景" tabindex="-1"><a class="header-anchor" href="#elasticsearch应用场景"><span>ElasticSearch应用场景</span></a></h3><ul><li>站内搜索</li><li>日志管理与分析</li><li>大数据分析</li><li>应用性能监控</li><li>机器学习</li></ul><p>国内现在有大量的公司都在使用 Elasticsearch，包括携程、滴滴、今日头条、饿了么、360安全、小米、vivo等诸多知名公司。除了搜索之外，结合Kibana、Logstash、Beats，Elastic Stack还被广泛运用在大数据近实时分析领域，包括日志分析、指标监控、信息安全等多个领域。它可以帮助你探索海量结构化、非结构化数据，按需创建可视化报表，对监控数据设置报警阈值，甚至通过使用机器学习技术，自动识别异常状况。</p><p><strong>通用数据处理流程：</strong></p><p><img src="https://img.jssjqd.cn/202212111625903.png" alt="image-20221211162513743"></p><h2 id="elasticsearch快速开始" tabindex="-1"><a class="header-anchor" href="#elasticsearch快速开始"><span>ElasticSearch快速开始</span></a></h2><h3 id="elasticsearch安装运行" tabindex="-1"><a class="header-anchor" href="#elasticsearch安装运行"><span>ElasticSearch安装运行</span></a></h3><p><strong>docker compose安装</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.1&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">:</span>7.17.7
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> elasticsearch
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /source/elasticsearch/data<span class="token punctuation">:</span>/usr/share/elasticsearch/data
      <span class="token punctuation">-</span> /source/elasticsearch/plugins<span class="token punctuation">:</span>/usr/share/elasticsearch/plugins
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> discovery.type=single<span class="token punctuation">-</span>node
      <span class="token punctuation">-</span> ES_JAVA_OPTS=<span class="token punctuation">-</span>Xms512m <span class="token punctuation">-</span>Xmx2048m
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 9200<span class="token punctuation">:</span><span class="token number">9200</span>
      <span class="token punctuation">-</span> 9300<span class="token punctuation">:</span><span class="token number">9300</span>
  <span class="token key atrule">kibana</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> kibana<span class="token punctuation">:</span>7.17.7
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kibana
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> alwaysq
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> elasticsearch <span class="token comment">#kibana在elasticsearch启动之后再启动</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">ELASTICSEARCH_HOSTS</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//elasticsearch<span class="token punctuation">:</span><span class="token number">9200</span> <span class="token comment">#设置访问elasticsearch的地址</span>
      <span class="token key atrule">I18N_LOCALE</span><span class="token punctuation">:</span> zh<span class="token punctuation">-</span>CN
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 5601<span class="token punctuation">:</span><span class="token number">5601</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>IK分词器安装</strong></p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 进入容器内部
docker exec -it elasticsearch /bin/bash

# 在线下载并安装
./bin/elasticsearch-plugin  install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.17.7/elasticsearch-analysis-ik-7.17.7.zip

#退出
exit
#重启容器
docker restart elasticsearch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>环境准备</strong></p><ul><li><p>运行Elasticsearch，需安装并配置JDK</p></li><li><ul><li>设置$JAVA_HOME</li></ul></li><li><p>各个版本对Java的依赖 https://www.elastic.co/support/matrix#matrix_jvm</p></li><li><ul><li>Elasticsearch 5需要Java 8以上的版本</li><li>Elasticsearch 从6.5开始支持Java 11</li><li>7.0开始，内置了Java环境</li></ul></li><li><p>ES比较耗内存，建议虚拟机4G或以上内存，jvm1g以上的内存分配</p></li></ul><p>可以参考es的环境文件elasticsearch-env.bat</p><p><img src="https://img.jssjqd.cn/202212111625079.png" alt="image-20221211162551957"></p><p>ES的jdk环境生效的优先级配置ES_JAVA_HOME&gt;JAVA_HOME&gt;ES_HOME</p><p><strong>下载并解压ElasticSearch</strong></p><p>下载地址： https://www.elastic.co/cn/downloads/past-releases#elasticsearch</p><p>选择版本：7.17.3</p><p><img src="https://img.jssjqd.cn//202304271404436.png" alt="image-20230427140407494"></p><p><strong>ElasticSearch文件目录结构</strong></p><table><thead><tr><th>目录</th><th>描述</th></tr></thead><tbody><tr><td>bin</td><td>脚本文件，包括启动elasticsearch，安装插件，运行统计数据等</td></tr><tr><td>config</td><td>配置文件目录，如elasticsearch配置、角色配置、jvm配置等。</td></tr><tr><td>jdk</td><td>java运行环境</td></tr><tr><td>data</td><td>默认的数据存放目录，包含节点、分片、索引、文档的所有数据，生产环境需要修改。</td></tr><tr><td>lib</td><td>elasticsearch依赖的Java类库</td></tr><tr><td>logs</td><td>默认的日志文件存储路径，生产环境需要修改。</td></tr><tr><td>modules</td><td>包含所有的Elasticsearch模块，如Cluster、Discovery、Indices等。</td></tr><tr><td>plugins</td><td>已安装插件目录</td></tr></tbody></table><p><strong>主配置文件elasticsearch.yml</strong></p><ul><li>cluster.name</li></ul><p>当前节点所属集群名称，多个节点如果要组成同一个集群，那么集群名称一定要配置成相同。默认值elasticsearch，生产环境建议根据ES集群的使用目的修改成合适的名字。</p><ul><li>node.name</li></ul><p>当前节点名称，默认值当前节点部署所在机器的主机名，所以如果一台机器上要起多个ES节点的话，需要通过配置该属性明确指定不同的节点名称。</p><ul><li>path.data</li></ul><p>配置数据存储目录，比如索引数据等，默认值 $ES_HOME/data，生产环境下强烈建议部署到另外的安全目录，防止ES升级导致数据被误删除。</p><ul><li>path.logs</li></ul><p>配置日志存储目录，比如运行日志和集群健康信息等，默认值 $ES_HOME/logs，生产环境下强烈建议部署到另外的安全目录，防止ES升级导致数据被误删除。</p><ul><li>bootstrap.memory_lock</li></ul><p>配置ES启动时是否进行内存锁定检查，默认值true。</p><p>ES对于内存的需求比较大，一般生产环境建议配置大内存，如果内存不足，容易导致内存交换到磁盘，严重影响ES的性能。所以默认启动时进行相应大小内存的锁定，如果无法锁定则会启动失败。</p><p>非生产环境可能机器内存本身就很小，能够供给ES使用的就更小，如果该参数配置为true的话很可能导致无法锁定内存以致ES无法成功启动，此时可以修改为false。</p><ul><li>network.host</li></ul><p>配置能够访问当前节点的主机，默认值为当前节点所在机器的本机回环地址127.0.0.1 和[::1]，这就导致默认情况下只能通过当前节点所在主机访问当前节点。可以配置为 0.0.0.0 ，表示所有主机均可访问。</p><ul><li>http.port</li></ul><p>配置当前ES节点对外提供服务的http端口，默认值 9200</p><ul><li>discovery.seed_hosts</li></ul><p>配置参与集群节点发现过程的主机列表，说白一点就是集群中所有节点所在的主机列表，可以是具体的IP地址，也可以是可解析的域名。</p><ul><li>cluster.initial_master_nodes</li></ul><p>配置ES集群初始化时参与master选举的节点名称列表，必须与node.name配置的一致。ES集群首次构建完成后，应该将集群中所有节点的配置文件中的cluster.initial_master_nodes配置项移除，重启集群或者将新节点加入某个已存在的集群时切记不要设置该配置项。</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token comment">#ES开启远程访问  </span>
<span class="token key attr-name">network.host</span><span class="token punctuation">:</span> <span class="token value attr-value">0.0.0.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>修改JVM配置</strong></p><p>修改config/jvm.options配置文件，调整jvm堆内存大小</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token key attr-name">vim</span> <span class="token value attr-value">jvm.options</span>
-Xms4g
-Xmx4g
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置的建议</p><ul><li>Xms和Xms设置成—样</li><li>Xmx不要超过机器内存的50%</li><li>不要超过30GB - https://www.elastic.co/cn/blog/a-heap-of-trouble</li></ul><p><strong>启动ElasticSearch服务</strong></p><p><strong>Windows</strong></p><p><strong>直接运行elasticsearch.bat</strong></p><p><strong>Linux（centos7）</strong></p><p>ES不允许使用root账号启动服务，如果你当前账号是root，则需要创建一个专有账户</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#非root用户</span>
bin/elasticsearch 

<span class="token comment"># -d 后台启动</span>
bin/elasticsearch <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.jssjqd.cn/202212111657473.png" alt="image-20221211165722461"></p><p>注意：es默认不能用root用户启动，生产环境建议为elasticsearch创建用户。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#为elaticsearch创建用户并赋予相应权限</span>
adduser es
<span class="token function">passwd</span> es
<span class="token function">chown</span> <span class="token parameter variable">-R</span> es:es elasticsearch-17.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行http://localhost:9200/</p><p><img src="https://img.jssjqd.cn/202212111741264.png" alt="image-20221211174106920"></p><p>如果ES服务启动异常，会有提示：</p><p><img src="https://img.jssjqd.cn/202212111741591.png" alt="image-20221211174118481"></p><p><strong>启动ES服务常见错误解决方案</strong></p><p>[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</p><p>ES因为需要大量的创建索引文件，需要大量的打开系统的文件，所以我们需要解除linux系统当中打开文件最大数目的限制，不然ES启动就会抛错</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#切换到root用户</span>
<span class="token function">vim</span> /etc/security/limits.conf

末尾添加如下配置：
  *	    soft 	nofile 	<span class="token number">65536</span>
  *     hard 	nofile 	<span class="token number">65536</span>
  *     soft 	nproc 	<span class="token number">4096</span>
  *	    hard 	nproc 	<span class="token number">4096</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>[2]: max number of threads [1024] for user [es] is too low, increase to at least [4096]</p><p>无法创建本地线程问题,用户最大可创建线程数太小</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/security/limits.d/20-nproc.conf

改为如下配置：
* soft nproc <span class="token number">4096</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>[3]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</p><p>最大虚拟内存太小,调大系统的虚拟内存</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/sysctl.conf
追加以下内容：
<span class="token assign-left variable">vm.max_map_count</span><span class="token operator">=</span><span class="token number">262144</span>
保存退出之后执行如下命令：
<span class="token function">sysctl</span> <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>[4]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured</p><p>缺少默认配置，至少需要配置discovery.seed_hosts/discovery.seed_providers/cluster.initial_master_nodes中的一个参数.</p><ul><li>discovery.seed_hosts: 集群主机列表</li><li>discovery.seed_providers: 基于配置文件配置集群主机列表</li><li>cluster.initial_master_nodes: 启动时初始化的参与选主的node，生产环境必填</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">vim</span> config/elasticsearch.yml
<span class="token comment">#添加配置</span>
discovery.seed_hosts: <span class="token punctuation">[</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">]</span>
cluster.initial_master_nodes: <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">]</span>

<span class="token comment">#或者  单节点（集群单节点）</span>
discovery.type: single-node
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>客户端Kibana安装</strong></p><p>Kibana是一个开源分析和可视化平台，旨在与Elasticsearch协同工作。</p><p><strong>1）下载并解压缩Kibana</strong></p><p>下载地址：https://www.elastic.co/cn/downloads/past-releases#kibana</p><p>选择版本：7.17.3</p><p><img src="https://img.jssjqd.cn/202212111814314.png" alt="image-20221211181406069"></p><p><strong>2）修改Kibana.yml</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">vim</span> config/kibana.yml

server.port: <span class="token number">5601</span>
server.host: <span class="token string">&quot;localhost&quot;</span>  <span class="token comment">#服务器ip</span>
elasticsearch.hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://localhost:9200&quot;</span><span class="token punctuation">]</span>  <span class="token comment">#elasticsearch的访问地址</span>
i18n.locale: <span class="token string">&quot;zh-CN&quot;</span>   <span class="token comment">#Kibana汉化</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3）运行Kibana</strong></p><p>注意：kibana也需要非root用户启动</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>bin/kibana
<span class="token comment">#后台启动</span>
<span class="token function">nohup</span>  bin/kibana <span class="token operator">&amp;</span>

<span class="token comment">#查询kibana进程</span>
<span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">5601</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>访问Kibana:</strong> <a href="http://localhost:5601/" target="_blank" rel="noopener noreferrer"><strong>http://localhost:5601/</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://img.jssjqd.cn/202212111814155.png" alt="image-20221211181455946"></p><p><strong>cat API</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/_cat/allocation         <span class="token comment">#查看单节点的shard分配整体情况</span>
/_cat/shards          <span class="token comment">#查看各shard的详细情况</span>
/_cat/shards/<span class="token punctuation">{</span>index<span class="token punctuation">}</span>     <span class="token comment">#查看指定分片的详细情况</span>
/_cat/master          <span class="token comment">#查看master节点信息</span>
/_cat/nodes           <span class="token comment">#查看所有节点信息</span>
/_cat/indices         <span class="token comment">#查看集群中所有index的详细信息</span>
/_cat/indices/<span class="token punctuation">{</span>index<span class="token punctuation">}</span>      <span class="token comment">#查看集群中指定index的详细信息</span>
/_cat/segments        <span class="token comment">#查看各index的segment详细信息,包括segment名, 所属shard, 内存(磁盘)占用大小, 是否刷盘</span>
/_cat/segments/<span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token comment">#查看指定index的segment详细信息</span>
/_cat/count           <span class="token comment">#查看当前集群的doc数量</span>
/_cat/count/<span class="token punctuation">{</span>index<span class="token punctuation">}</span>   <span class="token comment">#查看指定索引的doc数量</span>
/_cat/recovery        <span class="token comment">#查看集群内每个shard的recovery过程.调整replica。</span>
/_cat/recovery/<span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token comment">#查看指定索引shard的recovery过程</span>
/_cat/health          <span class="token comment">#查看集群当前状态：红、黄、绿</span>
/_cat/pending_tasks   <span class="token comment">#查看当前集群的pending task</span>
/_cat/aliases         <span class="token comment">#查看集群中所有alias信息,路由配置等</span>
/_cat/aliases/<span class="token punctuation">{</span>alias<span class="token punctuation">}</span> <span class="token comment">#查看指定索引的alias信息</span>
/_cat/thread_pool     <span class="token comment">#查看集群各节点内部不同类型的threadpool的统计信息,</span>
/_cat/plugins         <span class="token comment">#查看集群各个节点上的plugin信息</span>
/_cat/fielddata       <span class="token comment">#查看当前集群各个节点的fielddata内存使用情况</span>
/_cat/fielddata/<span class="token punctuation">{</span>fields<span class="token punctuation">}</span>     <span class="token comment">#查看指定field的内存使用情况,里面传field属性对应的值</span>
/_cat/nodeattrs              <span class="token comment">#查看单节点的自定义属性</span>
/_cat/repositories           <span class="token comment">#输出集群中注册快照存储库</span>
/_cat/templates              <span class="token comment">#输出当前正在存在的模板信息     </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Elasticsearch安装分词插件</strong></p><p>Elasticsearch提供插件机制对系统进行扩展</p><p>以安装analysis-icu这个分词插件为例</p><p><strong>在线安装</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#查看已安装插件</span>
bin/elasticsearch-plugin list
<span class="token comment">#安装插件</span>
bin/elasticsearch-plugin <span class="token function">install</span> analysis-icu
<span class="token comment">#删除插件</span>
bin/elasticsearch-plugin remove analysis-icu   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：安装和删除完插件后，需要重启ES服务才能生效。</p><p>测试分词效果</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>POST _analyze
<span class="token punctuation">{</span>
    <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;icu_analyzer&quot;</span>,
    <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;中华人民共和国&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ <img src="https://img.jssjqd.cn/202212111815196.png" alt="image-20221211181551941"></p><p><strong>离线安装</strong></p><p>本地下载相应的插件，解压，然后手动上传到elasticsearch的plugins目录，然后重启ES实例就可以了。</p><p>比如ik中文分词插件：https://github.com/medcl/elasticsearch-analysis-ik</p><p>测试分词效果</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#ES的默认分词设置是standard，会单字拆分</span>
POST _analyze
<span class="token punctuation">{</span>
    <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;standard&quot;</span>,
    <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;中华人民共和国&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">#ik_smart:会做最粗粒度的拆</span>
POST _analyze
<span class="token punctuation">{</span>
    <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_smart&quot;</span>,
    <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;中华人民共和国&quot;</span>
 <span class="token punctuation">}</span>

<span class="token comment">#ik_max_word:会将文本做最细粒度的拆分</span>
POST _analyze
<span class="token punctuation">{</span>
    <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ik_max_word&quot;</span>,
    <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;中华人民共和国&quot;</span>
<span class="token punctuation">}</span>         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建索引时可以指定IK分词器作为默认分词器</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>PUT /es_db
<span class="token punctuation">{</span>
    <span class="token string">&quot;settings&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;analysis.analyzer.default.type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_max_word&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ <img src="https://img.jssjqd.cn/202212111816941.png" alt="image-20221211181631808"></p><h3 id="elasticsearch基本概念" tabindex="-1"><a class="header-anchor" href="#elasticsearch基本概念"><span>ElasticSearch基本概念</span></a></h3><p><strong>关系型数据库 VS ElasticSearch</strong></p><ul><li><p>在7.0之前，一个 Index可以设置多个Types</p></li><li><p>目前Type已经被Deprecated，7.0开始，一个索引只能创建一个Type - “_doc”</p></li><li><p>传统关系型数据库和Elasticsearch的区别:</p></li><li><ul><li>Elasticsearch- Schemaless /相关性/高性能全文检索</li><li>RDMS —事务性/ Join</li></ul></li></ul><p><img src="https://img.jssjqd.cn/202212111816812.png" alt="image-20221211181637831"></p><p><strong>索引（Index）</strong></p><p>一个索引就是一个拥有几分相似特征的文档的集合。比如说，可以有一个客户数据的索引，另一个产品目录的索引，还有一个订单数据的索引。</p><p>一个索引由一个名字来标识（必须全部是小写字母的），并且当我们要对对应于这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。</p><p><img src="https://img.jssjqd.cn/202212111816510.png" alt="image-20221211181647104"></p><p><strong>文档（Document）</strong></p><ul><li><p>Elasticsearch是面向文档的，文档是所有可搜索数据的最小单位。</p></li><li><ul><li>日志文件中的日志项</li><li>一本电影的具体信息/一张唱片的详细信息</li><li>MP3播放器里的一首歌/一篇PDF文档中的具体内容</li></ul></li><li><p>文档会被序列化成JSON格式，保存在Elasticsearch中</p></li><li><ul><li>JSON对象由字段组成</li><li>每个字段都有对应的字段类型(字符串/数值/布尔/日期/二进制/范围类型)</li></ul></li><li><p>每个文档都有一个Unique ID</p></li><li><ul><li>可以自己指定ID或者通过Elasticsearch自动生成</li></ul></li><li><p>一篇文档包含了一系列字段，类似数据库表中的一条记录</p></li><li><p>JSON文档，格式灵活，不需要预先定义格式</p></li><li><ul><li>字段的类型可以指定或者通过Elasticsearch自动推算</li><li>支持数组/支持嵌套</li></ul></li></ul><p><strong>文档元数据</strong></p><p><img src="https://img.jssjqd.cn/202212111817336.png" alt="image-20221211181657762"></p><p>元数据，用于标注文档的相关信息：</p><ul><li>_index：文档所属的索引名</li><li>_type：文档所属的类型名</li><li>_id：文档唯—ld</li><li>_source: 文档的原始Json数据</li><li>_version: 文档的版本号，修改删除操作_version都会自增1</li><li>_seq_no: 和_version一样，一旦数据发生更改，数据也一直是累计的。Shard级别严格递增，保证后写入的Doc的_seq_no大于先写入的Doc的_seq_no。</li><li>_primary_term: _primary_term主要是用来恢复数据时处理当多个文档的_seq_no一样时的冲突，避免Primary Shard上的写入被覆盖。每当Primary Shard发生重新分配时，比如重启，Primary选举等，_primary_term会递增1。</li></ul><h3 id="elasticsearch索引操作" tabindex="-1"><a class="header-anchor" href="#elasticsearch索引操作"><span>ElasticSearch索引操作</span></a></h3><p>https://www.elastic.co/guide/en/elasticsearch/reference/7.17/index.html</p><p><strong>创建索引</strong></p><p>索引命名必须小写，不能以下划线开头</p><p>格式: PUT /索引名称</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#创建索引</span>
PUT /es_db

<span class="token comment">#创建索引时可以设置分片数和副本数</span>
PUT /es_db
<span class="token punctuation">{</span>
    <span class="token string">&quot;settings&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;number_of_shards&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">3</span>,
        <span class="token string">&quot;number_of_replicas&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#修改索引配置</span>
PUT /es_db/_settings
<span class="token punctuation">{</span>
    <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;number_of_replicas&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.jssjqd.cn/202212111817630.png" alt="image-20221211181736268"></p><p><strong>查询索引</strong></p><p>格式: GET /索引名称</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#查询索引</span>
GET /es_db

<span class="token comment">#es_db是否存在</span>
HEAD /es_db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.jssjqd.cn/202212111818045.png" alt="image-20221211181801190"></p><p>​</p><p><strong>删除索引</strong></p><p>格式: DELETE /索引名称</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>DELETE /es_db		 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="elasticsearch文档操作" tabindex="-1"><a class="header-anchor" href="#elasticsearch文档操作"><span>ElasticSearch文档操作</span></a></h3><p>示例数据</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>PUT /es_db
<span class="token punctuation">{</span>
    <span class="token string">&quot;settings&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;analysis.analyzer.default.type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_max_word&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

PUT /es_db/_doc/1
<span class="token punctuation">{</span>
<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;张三&quot;</span>,
<span class="token string">&quot;sex&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">25</span>,
<span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;广州天河公园&quot;</span>,
<span class="token string">&quot;remark&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;java developer&quot;</span>
<span class="token punctuation">}</span>
PUT /es_db/_doc/2
<span class="token punctuation">{</span>
<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;李四&quot;</span>,
<span class="token string">&quot;sex&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">28</span>,
<span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;广州荔湾大厦&quot;</span>,
<span class="token string">&quot;remark&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;java assistant&quot;</span>
<span class="token punctuation">}</span>

PUT /es_db/_doc/3
<span class="token punctuation">{</span>
<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;王五&quot;</span>,
<span class="token string">&quot;sex&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">26</span>,
<span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;广州白云山公园&quot;</span>,
<span class="token string">&quot;remark&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;php developer&quot;</span>
<span class="token punctuation">}</span>

PUT /es_db/_doc/4
<span class="token punctuation">{</span>
<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;赵六&quot;</span>,
<span class="token string">&quot;sex&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">22</span>,
<span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;长沙橘子洲&quot;</span>,
<span class="token string">&quot;remark&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;python assistant&quot;</span>
<span class="token punctuation">}</span>

PUT /es_db/_doc/5
<span class="token punctuation">{</span>
<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;张龙&quot;</span>,
<span class="token string">&quot;sex&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">19</span>,
<span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;长沙麓谷企业广场&quot;</span>,
<span class="token string">&quot;remark&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;java architect assistant&quot;</span>
<span class="token punctuation">}</span>	
	
PUT /es_db/_doc/6
<span class="token punctuation">{</span>
<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;赵虎&quot;</span>,
<span class="token string">&quot;sex&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">32</span>,
<span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;长沙麓谷兴工国际产业园&quot;</span>,
<span class="token string">&quot;remark&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;java architect&quot;</span>
<span class="token punctuation">}</span>	  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>添加（索引）文档</strong></p><ul><li>格式: [PUT | POST] /索引名称/[_doc | _create ]/id</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 创建文档,指定id</span>
<span class="token comment"># 如果id不存在，创建新的文档，否则先删除现有文档，再创建新的文档，版本会增加</span>
PUT /es_db/_doc/1
<span class="token punctuation">{</span>
<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;张三&quot;</span>,
<span class="token string">&quot;sex&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">25</span>,
<span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;广州天河公园&quot;</span>,
<span class="token string">&quot;remark&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;java developer&quot;</span>
<span class="token punctuation">}</span>	

<span class="token comment">#创建文档，ES生成id</span>
POST /es_db/_doc
<span class="token punctuation">{</span>
<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;张三&quot;</span>,
<span class="token string">&quot;sex&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">25</span>,
<span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;广州天河公园&quot;</span>,
<span class="token string">&quot;remark&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;java developer&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.jssjqd.cn/202212111818908.png" alt="image-20221211181856853"></p><p>注意:POST和PUT都能起到创建/更新的作用，PUT需要对一个具体的资源进行操作也就是要确定id才能进行更新/创建，而POST是可以针对整个资源集合进行操作的，如果不写id就由ES生成一个唯一id进行创建新文档，如果填了id那就针对这个id的文档进行创建/更新</p><p><img src="https://img.jssjqd.cn/202212111820356.png" alt="image-20221211182005357"></p><p>Create -如果ID已经存在，会失败</p><p><img src="https://img.jssjqd.cn/202212111820917.png" alt="image-20221211182013730"></p><p><strong>修改文档</strong></p><ul><li>全量更新，整个json都会替换，格式: [PUT | POST] /索引名称/_doc/id</li></ul><p>如果文档存在，现有文档会被删除，新的文档会被索引</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 全量更新，替换整个json</span>
PUT /es_db/_doc/1/
<span class="token punctuation">{</span>
<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;张三&quot;</span>,
<span class="token string">&quot;sex&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">25</span>
<span class="token punctuation">}</span>

<span class="token comment">#查询文档</span>
GET /es_db/_doc/1 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.jssjqd.cn/202212111820502.png" alt="image-20221211182038548"></p><ul><li>使用_update部分更新，格式: POST /索引名称/_update/id</li></ul><p>update不会删除原来的文档，而是实现真正的数据更新</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 部分更新：在原有文档上更新</span>
<span class="token comment"># Update -文档必须已经存在，更新只会对相应字段做增量修改</span>
POST /es_db/_update/1
<span class="token punctuation">{</span>
  <span class="token string">&quot;doc&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">28</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#查询文档</span>
GET /es_db/_doc/1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ <img src="https://img.jssjqd.cn/202212112006926.png" alt="image-20221211200632538"></p><ul><li>使用 _update_by_query 更新文档</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>POST /es_db/_update_by_query
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;script&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ctx._source.age = 30&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.jssjqd.cn/202212112007946.png" alt="image-20221211200730849"></p><p><strong>并发场景下修改文档</strong></p><p>_seq_no和_primary_term是对_version的优化，7.X版本的ES默认使用这种方式控制版本，所以当在高并发环境下使用乐观锁机制修改文档时，要带上当前文档的_seq_no和_primary_term进行更新：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>POST /es_db/_doc/2?if_seq_no<span class="token operator">=</span><span class="token number">21</span><span class="token operator">&amp;</span><span class="token assign-left variable">if_primary_term</span><span class="token operator">=</span><span class="token number">6</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;李四xxx&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果版本号不对，会抛出版本冲突异常，如下图：</p><p><img src="https://img.jssjqd.cn/202212112030830.png" alt="image-20221211203031269"></p><p><strong>查询文档</strong></p><ul><li>根据id查询文档，格式: GET /索引名称/_doc/id</li></ul><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>GET /es_db/_doc/1              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>条件查询 _search，格式： /索引名称/_doc/_search</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 查询前10条文档</span>
GET /es_db/_doc/_search   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ES Search API提供了两种条件查询搜索方式：</p><ul><li>REST风格的请求URI，直接将参数带过去</li><li>封装到request body中，这种方式可以定义更加易读的JSON格式</li></ul><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>#通过URI搜索，使用“q”指定查询字符串，“query string syntax” KV键值对

#条件查询, 如要查询age等于28岁的 _search?q=*:***
GET /es_db/_doc/_search?q=age:28

#范围查询, 如要查询age在25至26岁之间的 _search?q=***[** TO **]  注意: TO 必须为大写
GET /es_db/_doc/_search?q=age[25 TO 26]

#查询年龄小于等于28岁的 :&lt;=
GET /es_db/_doc/_search?q=age:&lt;=28
#查询年龄大于28前的 :&gt;
GET /es_db/_doc/_search?q=age:&gt;28

#分页查询 from=*&amp;size=*
GET /es_db/_doc/_search?q=age[25 TO 26]&amp;from=0&amp;size=1

#对查询结果只输出某些字段 _source=字段,字段
GET /es_db/_doc/_search?_source=name,age

#对查询结果排序 sort=字段:desc/asc
GET /es_db/_doc/_search?sort=age:desc 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过请求体的搜索方式会在后面课程详细讲解（DSL）</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>GET /es_db/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;广州白云&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>删除文档</strong></p><p>格式: DELETE /索引名称/_doc/id</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>DELETE /es_db/_doc/1              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="elasticsearch文档批量操作" tabindex="-1"><a class="header-anchor" href="#elasticsearch文档批量操作"><span>ElasticSearch文档批量操作</span></a></h3><p>批量操作可以减少网络连接所产生的开销，提升性能</p><ul><li>支持在一次API调用中，对不同的索引进行操作</li><li>可以在URI中指定Index，也可以在请求的Payload中进行</li><li>操作中单条操作失败，并不会影响其他操作</li><li>返回结果包括了每一条操作执行的结果</li></ul><p><strong>批量写入</strong></p><p>批量对文档进行写操作是通过_bulk的API来实现的</p><ul><li><p>请求方式：POST</p></li><li><p>请求地址：_bulk</p></li><li><p>请求参数：通过_bulk操作文档，一般至少有两行参数(或偶数行参数)</p></li><li><ul><li>第一行参数为指定操作的类型及操作的对象(index,type和id)</li><li>第二行参数才是操作的数据</li></ul></li></ul><p>参数类似于：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">{</span><span class="token string">&quot;actionName&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;indexName&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;typeName&quot;</span>,<span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;field1&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;value1&quot;</span>, <span class="token string">&quot;field2&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;value2&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>actionName：表示操作类型，主要有create,index,delete和update</li></ul><p><strong>批量创建文档create</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>POST _bulk
<span class="token punctuation">{</span><span class="token string">&quot;create&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:3<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:3,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;fox老师&quot;</span>,<span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;fox老师666&quot;</span>,<span class="token string">&quot;tags&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;面向对象&quot;</span><span class="token punctuation">]</span>,<span class="token string">&quot;create_time&quot;</span>:1554015482530<span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;create&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:4<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:4,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;mark老师&quot;</span>,<span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;mark老师NB&quot;</span>,<span class="token string">&quot;tags&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;面向对象&quot;</span><span class="token punctuation">]</span>,<span class="token string">&quot;create_time&quot;</span>:1554015482530<span class="token punctuation">}</span>      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>普通创建或全量替换index</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>POST _bulk
<span class="token punctuation">{</span><span class="token string">&quot;index&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:3<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:3,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;图灵徐庶老师&quot;</span>,<span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;图灵学院徐庶老师666&quot;</span>,<span class="token string">&quot;tags&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;面向对象&quot;</span><span class="token punctuation">]</span>,<span class="token string">&quot;create_time&quot;</span>:1554015482530<span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;index&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:4<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:4,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;图灵诸葛老师&quot;</span>,<span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;图灵学院诸葛老师NB&quot;</span>,<span class="token string">&quot;tags&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;面向对象&quot;</span><span class="token punctuation">]</span>,<span class="token string">&quot;create_time&quot;</span>:1554015482530<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>如果原文档不存在，则是创建</li><li>如果原文档存在，则是替换(全量修改原文档)</li></ul><p><strong>批量删除delete</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>POST _bulk
<span class="token punctuation">{</span><span class="token string">&quot;delete&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:3<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;delete&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:4<span class="token punctuation">}</span><span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>批量修改update</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>POST _bulk
<span class="token punctuation">{</span><span class="token string">&quot;update&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:3<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;doc&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ES大法必修内功&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;update&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:4<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;doc&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;create_time&quot;</span>:1554018421008<span class="token punctuation">}</span><span class="token punctuation">}</span>     
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>组合应用</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>POST _bulk
<span class="token punctuation">{</span><span class="token string">&quot;create&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:3<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:3,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;fox老师&quot;</span>,<span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;fox老师666&quot;</span>,<span class="token string">&quot;tags&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;面向对象&quot;</span><span class="token punctuation">]</span>,<span class="token string">&quot;create_time&quot;</span>:1554015482530<span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;delete&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:3<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;update&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;article&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>, <span class="token string">&quot;_id&quot;</span>:4<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;doc&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;create_time&quot;</span>:1554018421008<span class="token punctuation">}</span><span class="token punctuation">}</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>批量读取</strong></p><p>es的批量查询可以使用mget和msearch两种。其中mget是需要我们知道它的id，可以指定不同的index，也可以指定返回值source。msearch可以通过字段查询来进行一个批量的查找。</p><p><strong>_mget</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#可以通过ID批量获取不同index和type的数据</span>
GET _mget
<span class="token punctuation">{</span>
<span class="token string">&quot;docs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;es_db&quot;</span>,
<span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>,
<span class="token punctuation">{</span>
<span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;article&quot;</span>,
<span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">4</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">#可以通过ID批量获取es_db的数据</span>
GET /es_db/_mget
<span class="token punctuation">{</span>
<span class="token string">&quot;docs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>,
<span class="token punctuation">{</span>
<span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">4</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">#简化后</span>
GET /es_db/_mget 
<span class="token punctuation">{</span>
 <span class="token string">&quot;ids&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span>,<span class="token string">&quot;2&quot;</span><span class="token punctuation">]</span>  
 <span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.jssjqd.cn/202212112053019.png" alt="image-20221211205347896"></p><p><strong>_msearch</strong></p><p>在_msearch中，请求格式和bulk类似。查询一条数据需要两个对象，第一个设置index和type，第二个设置查询语句。查询语句和search相同。如果只是查询一个index，我们可以在url中带上index，这样，如果查该index可以直接用空对象表示。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>GET /es_db/_msearch
<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;match_all&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token string">&quot;from&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;article&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;match_all&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.jssjqd.cn/202212112054657.png" alt="image-20221211205411694"></p></div><!--[--><!----><!--]--><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/pages/a0495c/" aria-label="ElasticSearch基础查询语句"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->ElasticSearch基础查询语句</div></a><a class="route-link nav-link next" href="/pages/f9f747/" aria-label="ElasticSearch搜索技术深入与聚合查询实战"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">ElasticSearch搜索技术深入与聚合查询实战<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CcJZcE5q.js" defer></script>
  </body>
</html>
