<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/pages/e79a05/"><meta property="og:site_name" content="å­¦ä¹ ç¬”è®°"><meta property="og:title" content="SpringBootè‡ªåŠ¨é…ç½®åº•å±‚æºç è§£æ"><meta property="og:description" content="å†…å®¹ @EnableAutoConfigurationæºç è§£æ å„ç§æ¡ä»¶æ³¨è§£æºç è§£æ SpringBootæ•´åˆTomcatåº•å±‚æºç è§£æ SpringBootä¹‹AOPè‡ªåŠ¨é…ç½®æºç è§£æ Starteræœºåˆ¶åº•å±‚åŸç†è§£æ SpringBoot2.6.6æºç åœ°å€ï¼šhttps://gitee.com/archguide/spring-boot-2.6.6"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-08-03T16:58:58.000Z"><meta property="article:author" content="æ±Ÿ"><meta property="article:published_time" content="2023-04-08T00:48:43.000Z"><meta property="article:modified_time" content="2023-08-03T16:58:58.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"SpringBootè‡ªåŠ¨é…ç½®åº•å±‚æºç è§£æ","image":[""],"datePublished":"2023-04-08T00:48:43.000Z","dateModified":"2023-08-03T16:58:58.000Z","author":[{"@type":"Person","name":"æ±Ÿ"}]}</script><title>SpringBootè‡ªåŠ¨é…ç½®åº•å±‚æºç è§£æ | å­¦ä¹ ç¬”è®°</title><meta name="description" content="å†…å®¹ @EnableAutoConfigurationæºç è§£æ å„ç§æ¡ä»¶æ³¨è§£æºç è§£æ SpringBootæ•´åˆTomcatåº•å±‚æºç è§£æ SpringBootä¹‹AOPè‡ªåŠ¨é…ç½®æºç è§£æ Starteræœºåˆ¶åº•å±‚åŸç†è§£æ SpringBoot2.6.6æºç åœ°å€ï¼šhttps://gitee.com/archguide/spring-boot-2.6.6">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-850a8bcc.css" as="style"><link rel="stylesheet" href="/assets/style-850a8bcc.css">
    <link rel="modulepreload" href="/assets/app-6d45e392.js"><link rel="modulepreload" href="/assets/index.html-a06ee49a.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/index.html-50f991ab.js"><link rel="prefetch" href="/assets/index.html-bba30501.js" as="script"><link rel="prefetch" href="/assets/index.html-6e9240b9.js" as="script"><link rel="prefetch" href="/assets/index.html-475cb0e6.js" as="script"><link rel="prefetch" href="/assets/index.html-df2a795e.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-6373254a.js" as="script"><link rel="prefetch" href="/assets/index.html-f49d6e12.js" as="script"><link rel="prefetch" href="/assets/index.html-061b9a53.js" as="script"><link rel="prefetch" href="/assets/index.html-9a702514.js" as="script"><link rel="prefetch" href="/assets/index.html-3c8399ed.js" as="script"><link rel="prefetch" href="/assets/index.html-8bac4fe2.js" as="script"><link rel="prefetch" href="/assets/index.html-a0b7d616.js" as="script"><link rel="prefetch" href="/assets/index.html-84ef939d.js" as="script"><link rel="prefetch" href="/assets/index.html-87ed9aa0.js" as="script"><link rel="prefetch" href="/assets/index.html-bde3909f.js" as="script"><link rel="prefetch" href="/assets/index.html-ef85629f.js" as="script"><link rel="prefetch" href="/assets/index.html-2bc4d19e.js" as="script"><link rel="prefetch" href="/assets/index.html-a0023da4.js" as="script"><link rel="prefetch" href="/assets/index.html-758b8de4.js" as="script"><link rel="prefetch" href="/assets/index.html-b3092d02.js" as="script"><link rel="prefetch" href="/assets/index.html-65bf5569.js" as="script"><link rel="prefetch" href="/assets/index.html-110bf219.js" as="script"><link rel="prefetch" href="/assets/index.html-4dbee09d.js" as="script"><link rel="prefetch" href="/assets/index.html-cc9d808d.js" as="script"><link rel="prefetch" href="/assets/index.html-b39fa39e.js" as="script"><link rel="prefetch" href="/assets/index.html-9997c7c4.js" as="script"><link rel="prefetch" href="/assets/index.html-bb210c51.js" as="script"><link rel="prefetch" href="/assets/index.html-2b609943.js" as="script"><link rel="prefetch" href="/assets/index.html-a385b3e2.js" as="script"><link rel="prefetch" href="/assets/index.html-d27602b9.js" as="script"><link rel="prefetch" href="/assets/index.html-824c3f2b.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-db1bbf23.js" as="script"><link rel="prefetch" href="/assets/index.html-e1b95bee.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-04738cc4.js" as="script"><link rel="prefetch" href="/assets/index.html-2b42c9a6.js" as="script"><link rel="prefetch" href="/assets/50.å¾®æœåŠ¡ç½‘å…³æ•´åˆOAuth2.0æˆæƒä¸­å¿ƒ.html-db62c592.js" as="script"><link rel="prefetch" href="/assets/index.html-4121d5d7.js" as="script"><link rel="prefetch" href="/assets/index.html-57c7f32a.js" as="script"><link rel="prefetch" href="/assets/index.html-c8cc8279.js" as="script"><link rel="prefetch" href="/assets/index.html-cdad1aaf.js" as="script"><link rel="prefetch" href="/assets/index.html-0a2b44f0.js" as="script"><link rel="prefetch" href="/assets/index.html-f48dce59.js" as="script"><link rel="prefetch" href="/assets/index.html-4afd42c7.js" as="script"><link rel="prefetch" href="/assets/index.html-c2c6322c.js" as="script"><link rel="prefetch" href="/assets/index.html-d40fb462.js" as="script"><link rel="prefetch" href="/assets/index.html-4796b4d0.js" as="script"><link rel="prefetch" href="/assets/index.html-ff53f267.js" as="script"><link rel="prefetch" href="/assets/index.html-4d48b6e7.js" as="script"><link rel="prefetch" href="/assets/index.html-22237176.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-2f991798.js" as="script"><link rel="prefetch" href="/assets/index.html-f80752d4.js" as="script"><link rel="prefetch" href="/assets/index.html-f68ff14e.js" as="script"><link rel="prefetch" href="/assets/index.html-399eb32a.js" as="script"><link rel="prefetch" href="/assets/index.html-a6aff505.js" as="script"><link rel="prefetch" href="/assets/index.html-acd4067d.js" as="script"><link rel="prefetch" href="/assets/index.html-67341afa.js" as="script"><link rel="prefetch" href="/assets/index.html-5e21be11.js" as="script"><link rel="prefetch" href="/assets/index.html-0d4b784f.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-71c0f603.js" as="script"><link rel="prefetch" href="/assets/index.html-73a2dd1b.js" as="script"><link rel="prefetch" href="/assets/index.html-672da43e.js" as="script"><link rel="prefetch" href="/assets/index.html-f0edeb3c.js" as="script"><link rel="prefetch" href="/assets/index.html-ab54a6f3.js" as="script"><link rel="prefetch" href="/assets/index.html-d4be5d59.js" as="script"><link rel="prefetch" href="/assets/index.html-80b92347.js" as="script"><link rel="prefetch" href="/assets/index.html-0da9e1c6.js" as="script"><link rel="prefetch" href="/assets/index.html-5fbc8245.js" as="script"><link rel="prefetch" href="/assets/index.html-d9a6d1be.js" as="script"><link rel="prefetch" href="/assets/index.html-884cd1cf.js" as="script"><link rel="prefetch" href="/assets/index.html-3cc02b39.js" as="script"><link rel="prefetch" href="/assets/index.html-9d9f6e80.js" as="script"><link rel="prefetch" href="/assets/index.html-c4985c46.js" as="script"><link rel="prefetch" href="/assets/index.html-0ad213fd.js" as="script"><link rel="prefetch" href="/assets/index.html-65437f8f.js" as="script"><link rel="prefetch" href="/assets/index.html-26d20cf1.js" as="script"><link rel="prefetch" href="/assets/index.html-f7b308d3.js" as="script"><link rel="prefetch" href="/assets/index.html-8ef93226.js" as="script"><link rel="prefetch" href="/assets/index.html-180336df.js" as="script"><link rel="prefetch" href="/assets/index.html-9bfca606.js" as="script"><link rel="prefetch" href="/assets/index.html-db2aad34.js" as="script"><link rel="prefetch" href="/assets/index.html-48009edc.js" as="script"><link rel="prefetch" href="/assets/index.html-02980b5f.js" as="script"><link rel="prefetch" href="/assets/index.html-b94e89dc.js" as="script"><link rel="prefetch" href="/assets/index.html-fc9d4c27.js" as="script"><link rel="prefetch" href="/assets/index.html-a2c03602.js" as="script"><link rel="prefetch" href="/assets/index.html-ddd0848e.js" as="script"><link rel="prefetch" href="/assets/index.html-0c150beb.js" as="script"><link rel="prefetch" href="/assets/index.html-2fc65ea1.js" as="script"><link rel="prefetch" href="/assets/index.html-e2aafaa6.js" as="script"><link rel="prefetch" href="/assets/index.html-91e14f17.js" as="script"><link rel="prefetch" href="/assets/index.html-bf422f4d.js" as="script"><link rel="prefetch" href="/assets/index.html-b5d81e05.js" as="script"><link rel="prefetch" href="/assets/index.html-4cbb1b2b.js" as="script"><link rel="prefetch" href="/assets/index.html-d39437a2.js" as="script"><link rel="prefetch" href="/assets/index.html-2789544e.js" as="script"><link rel="prefetch" href="/assets/index.html-2f2d3b09.js" as="script"><link rel="prefetch" href="/assets/index.html-6a2d4ab8.js" as="script"><link rel="prefetch" href="/assets/index.html-ff2f82d1.js" as="script"><link rel="prefetch" href="/assets/index.html-9905b46e.js" as="script"><link rel="prefetch" href="/assets/index.html-6117fdaf.js" as="script"><link rel="prefetch" href="/assets/index.html-d5a2010d.js" as="script"><link rel="prefetch" href="/assets/index.html-0f6a6f5a.js" as="script"><link rel="prefetch" href="/assets/index.html-14e38234.js" as="script"><link rel="prefetch" href="/assets/index.html-cf4aeb41.js" as="script"><link rel="prefetch" href="/assets/index.html-43045d2a.js" as="script"><link rel="prefetch" href="/assets/index.html-ca943502.js" as="script"><link rel="prefetch" href="/assets/index.html-69aa5bb5.js" as="script"><link rel="prefetch" href="/assets/index.html-606cc55b.js" as="script"><link rel="prefetch" href="/assets/index.html-338af8a1.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-d4af4d18.js" as="script"><link rel="prefetch" href="/assets/index.html-259fa2ec.js" as="script"><link rel="prefetch" href="/assets/index.html-6c113e89.js" as="script"><link rel="prefetch" href="/assets/index.html-d6d41c6d.js" as="script"><link rel="prefetch" href="/assets/index.html-23244f48.js" as="script"><link rel="prefetch" href="/assets/index.html-463942ed.js" as="script"><link rel="prefetch" href="/assets/index.html-336a7153.js" as="script"><link rel="prefetch" href="/assets/index.html-cf2d7eef.js" as="script"><link rel="prefetch" href="/assets/index.html-f68d4ad9.js" as="script"><link rel="prefetch" href="/assets/index.html-973d40e6.js" as="script"><link rel="prefetch" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-6a62419d.js" as="script"><link rel="prefetch" href="/assets/404.html-f4f9fdbe.js" as="script"><link rel="prefetch" href="/assets/index.html-ccedd87a.js" as="script"><link rel="prefetch" href="/assets/index.html-6b635626.js" as="script"><link rel="prefetch" href="/assets/index.html-f3c1ea90.js" as="script"><link rel="prefetch" href="/assets/index.html-39a19522.js" as="script"><link rel="prefetch" href="/assets/index.html-4e6ecfce.js" as="script"><link rel="prefetch" href="/assets/index.html-c37db087.js" as="script"><link rel="prefetch" href="/assets/index.html-7f2f880b.js" as="script"><link rel="prefetch" href="/assets/index.html-f8546af5.js" as="script"><link rel="prefetch" href="/assets/index.html-36e6cb8c.js" as="script"><link rel="prefetch" href="/assets/index.html-27371869.js" as="script"><link rel="prefetch" href="/assets/index.html-4c15c6fc.js" as="script"><link rel="prefetch" href="/assets/index.html-116aca17.js" as="script"><link rel="prefetch" href="/assets/index.html-2a643c60.js" as="script"><link rel="prefetch" href="/assets/index.html-21236a9b.js" as="script"><link rel="prefetch" href="/assets/index.html-b238d9f4.js" as="script"><link rel="prefetch" href="/assets/index.html-46e55ee3.js" as="script"><link rel="prefetch" href="/assets/index.html-6d53c5d1.js" as="script"><link rel="prefetch" href="/assets/index.html-778d883e.js" as="script"><link rel="prefetch" href="/assets/index.html-d798a209.js" as="script"><link rel="prefetch" href="/assets/index.html-ab8b6fb7.js" as="script"><link rel="prefetch" href="/assets/index.html-200c9b62.js" as="script"><link rel="prefetch" href="/assets/index.html-9fa57983.js" as="script"><link rel="prefetch" href="/assets/index.html-30ef2e2b.js" as="script"><link rel="prefetch" href="/assets/index.html-2a6dfb95.js" as="script"><link rel="prefetch" href="/assets/index.html-3fd779a7.js" as="script"><link rel="prefetch" href="/assets/index.html-0118c6d9.js" as="script"><link rel="prefetch" href="/assets/index.html-942ff972.js" as="script"><link rel="prefetch" href="/assets/index.html-41b511cf.js" as="script"><link rel="prefetch" href="/assets/index.html-2be3f4a2.js" as="script"><link rel="prefetch" href="/assets/index.html-4b04c8af.js" as="script"><link rel="prefetch" href="/assets/index.html-940c35a3.js" as="script"><link rel="prefetch" href="/assets/index.html-f3f33451.js" as="script"><link rel="prefetch" href="/assets/index.html-1a8f23e9.js" as="script"><link rel="prefetch" href="/assets/index.html-c93e5cd2.js" as="script"><link rel="prefetch" href="/assets/index.html-6508b456.js" as="script"><link rel="prefetch" href="/assets/index.html-ed0506a1.js" as="script"><link rel="prefetch" href="/assets/index.html-31f68f17.js" as="script"><link rel="prefetch" href="/assets/index.html-d92890df.js" as="script"><link rel="prefetch" href="/assets/index.html-b2b41008.js" as="script"><link rel="prefetch" href="/assets/index.html-ac4c44c1.js" as="script"><link rel="prefetch" href="/assets/index.html-0ef231d8.js" as="script"><link rel="prefetch" href="/assets/index.html-bab80dce.js" as="script"><link rel="prefetch" href="/assets/index.html-d9a5fb97.js" as="script"><link rel="prefetch" href="/assets/index.html-8d390098.js" as="script"><link rel="prefetch" href="/assets/index.html-17f4d67e.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-761328ea.js" as="script"><link rel="prefetch" href="/assets/index.html-e524b9d3.js" as="script"><link rel="prefetch" href="/assets/index.html-6c6e9139.js" as="script"><link rel="prefetch" href="/assets/index.html-60c3031e.js" as="script"><link rel="prefetch" href="/assets/index.html-c2e013fa.js" as="script"><link rel="prefetch" href="/assets/index.html-1c11e766.js" as="script"><link rel="prefetch" href="/assets/index.html-d7321efe.js" as="script"><link rel="prefetch" href="/assets/index.html-5977f8c1.js" as="script"><link rel="prefetch" href="/assets/index.html-1b4da397.js" as="script"><link rel="prefetch" href="/assets/index.html-8e89cd00.js" as="script"><link rel="prefetch" href="/assets/index.html-02d6c807.js" as="script"><link rel="prefetch" href="/assets/index.html-46fae025.js" as="script"><link rel="prefetch" href="/assets/index.html-69cd3c06.js" as="script"><link rel="prefetch" href="/assets/index.html-db3fe939.js" as="script"><link rel="prefetch" href="/assets/index.html-3d984116.js" as="script"><link rel="prefetch" href="/assets/index.html-997bb951.js" as="script"><link rel="prefetch" href="/assets/index.html-68bb7856.js" as="script"><link rel="prefetch" href="/assets/index.html-a700f4f8.js" as="script"><link rel="prefetch" href="/assets/index.html-d18b242d.js" as="script"><link rel="prefetch" href="/assets/index.html-b4f348dd.js" as="script"><link rel="prefetch" href="/assets/index.html-be6c2183.js" as="script"><link rel="prefetch" href="/assets/index.html-a2cee25a.js" as="script"><link rel="prefetch" href="/assets/index.html-730e32b9.js" as="script"><link rel="prefetch" href="/assets/index.html-2997bb3d.js" as="script"><link rel="prefetch" href="/assets/index.html-df970cde.js" as="script"><link rel="prefetch" href="/assets/index.html-f3eadbbe.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-fc3255db.js" as="script"><link rel="prefetch" href="/assets/index.html-bf12af7e.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-73b02be7.js" as="script"><link rel="prefetch" href="/assets/index.html-ef6931ff.js" as="script"><link rel="prefetch" href="/assets/50.å¾®æœåŠ¡ç½‘å…³æ•´åˆOAuth2.0æˆæƒä¸­å¿ƒ.html-24d3145c.js" as="script"><link rel="prefetch" href="/assets/index.html-f60086f0.js" as="script"><link rel="prefetch" href="/assets/index.html-9100e44f.js" as="script"><link rel="prefetch" href="/assets/index.html-0381a938.js" as="script"><link rel="prefetch" href="/assets/index.html-097d63c8.js" as="script"><link rel="prefetch" href="/assets/index.html-22bef521.js" as="script"><link rel="prefetch" href="/assets/index.html-83304cce.js" as="script"><link rel="prefetch" href="/assets/index.html-aec4357f.js" as="script"><link rel="prefetch" href="/assets/index.html-b42efc62.js" as="script"><link rel="prefetch" href="/assets/index.html-73832354.js" as="script"><link rel="prefetch" href="/assets/index.html-48221998.js" as="script"><link rel="prefetch" href="/assets/index.html-37ceb737.js" as="script"><link rel="prefetch" href="/assets/index.html-07c606ad.js" as="script"><link rel="prefetch" href="/assets/index.html-b4e14ecb.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-d97565a5.js" as="script"><link rel="prefetch" href="/assets/index.html-c43a50df.js" as="script"><link rel="prefetch" href="/assets/index.html-8cb8123b.js" as="script"><link rel="prefetch" href="/assets/index.html-f21cdad8.js" as="script"><link rel="prefetch" href="/assets/index.html-8d774be6.js" as="script"><link rel="prefetch" href="/assets/index.html-0ce5820c.js" as="script"><link rel="prefetch" href="/assets/index.html-80240652.js" as="script"><link rel="prefetch" href="/assets/index.html-306ced06.js" as="script"><link rel="prefetch" href="/assets/index.html-94c88d8a.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-ffc9db2f.js" as="script"><link rel="prefetch" href="/assets/index.html-1b1893c3.js" as="script"><link rel="prefetch" href="/assets/index.html-62f81ce5.js" as="script"><link rel="prefetch" href="/assets/index.html-fb202bc3.js" as="script"><link rel="prefetch" href="/assets/index.html-b149f2ea.js" as="script"><link rel="prefetch" href="/assets/index.html-10e7347f.js" as="script"><link rel="prefetch" href="/assets/index.html-fda95f20.js" as="script"><link rel="prefetch" href="/assets/index.html-67b8181d.js" as="script"><link rel="prefetch" href="/assets/index.html-b82ac6d5.js" as="script"><link rel="prefetch" href="/assets/index.html-18cf8f7d.js" as="script"><link rel="prefetch" href="/assets/index.html-e42215a4.js" as="script"><link rel="prefetch" href="/assets/index.html-4bceed98.js" as="script"><link rel="prefetch" href="/assets/index.html-d20a83b0.js" as="script"><link rel="prefetch" href="/assets/index.html-8a5223dd.js" as="script"><link rel="prefetch" href="/assets/index.html-5e0093bb.js" as="script"><link rel="prefetch" href="/assets/index.html-f320d1f5.js" as="script"><link rel="prefetch" href="/assets/index.html-cad64787.js" as="script"><link rel="prefetch" href="/assets/index.html-a8c6716d.js" as="script"><link rel="prefetch" href="/assets/index.html-48c59174.js" as="script"><link rel="prefetch" href="/assets/index.html-7bb25030.js" as="script"><link rel="prefetch" href="/assets/index.html-893823d4.js" as="script"><link rel="prefetch" href="/assets/index.html-d41fc55d.js" as="script"><link rel="prefetch" href="/assets/index.html-7fa8c257.js" as="script"><link rel="prefetch" href="/assets/index.html-ce518419.js" as="script"><link rel="prefetch" href="/assets/index.html-de7cfa2f.js" as="script"><link rel="prefetch" href="/assets/index.html-a5ecc648.js" as="script"><link rel="prefetch" href="/assets/index.html-e04e7eb7.js" as="script"><link rel="prefetch" href="/assets/index.html-50c40125.js" as="script"><link rel="prefetch" href="/assets/index.html-f7ae0721.js" as="script"><link rel="prefetch" href="/assets/index.html-a7a669ae.js" as="script"><link rel="prefetch" href="/assets/index.html-b9393f2c.js" as="script"><link rel="prefetch" href="/assets/index.html-921f67f8.js" as="script"><link rel="prefetch" href="/assets/index.html-62b0250c.js" as="script"><link rel="prefetch" href="/assets/index.html-37a1d0fb.js" as="script"><link rel="prefetch" href="/assets/index.html-d5fb0f14.js" as="script"><link rel="prefetch" href="/assets/index.html-58871ffb.js" as="script"><link rel="prefetch" href="/assets/index.html-20f24699.js" as="script"><link rel="prefetch" href="/assets/index.html-ddecb9bd.js" as="script"><link rel="prefetch" href="/assets/index.html-7d43b4c2.js" as="script"><link rel="prefetch" href="/assets/index.html-6e42f3f3.js" as="script"><link rel="prefetch" href="/assets/index.html-c064a334.js" as="script"><link rel="prefetch" href="/assets/index.html-ef359b17.js" as="script"><link rel="prefetch" href="/assets/index.html-e924e41b.js" as="script"><link rel="prefetch" href="/assets/index.html-3d7283b0.js" as="script"><link rel="prefetch" href="/assets/index.html-d47203ec.js" as="script"><link rel="prefetch" href="/assets/index.html-f3c65495.js" as="script"><link rel="prefetch" href="/assets/index.html-368a0dce.js" as="script"><link rel="prefetch" href="/assets/index.html-34d16bb7.js" as="script"><link rel="prefetch" href="/assets/index.html-f9bef08a.js" as="script"><link rel="prefetch" href="/assets/index.html-0fa630ac.js" as="script"><link rel="prefetch" href="/assets/index.html-7f7cdea0.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-f4ac9e4a.js" as="script"><link rel="prefetch" href="/assets/index.html-9e607adc.js" as="script"><link rel="prefetch" href="/assets/index.html-9af77916.js" as="script"><link rel="prefetch" href="/assets/index.html-a24689f2.js" as="script"><link rel="prefetch" href="/assets/index.html-66970517.js" as="script"><link rel="prefetch" href="/assets/index.html-621947c5.js" as="script"><link rel="prefetch" href="/assets/index.html-cdf078ab.js" as="script"><link rel="prefetch" href="/assets/index.html-edcd7965.js" as="script"><link rel="prefetch" href="/assets/index.html-52dc5986.js" as="script"><link rel="prefetch" href="/assets/index.html-d53b3ef9.js" as="script"><link rel="prefetch" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-6772ff48.js" as="script"><link rel="prefetch" href="/assets/404.html-461ff74c.js" as="script"><link rel="prefetch" href="/assets/index.html-b2824715.js" as="script"><link rel="prefetch" href="/assets/index.html-bf630227.js" as="script"><link rel="prefetch" href="/assets/index.html-2ccc13d8.js" as="script"><link rel="prefetch" href="/assets/index.html-025d7978.js" as="script"><link rel="prefetch" href="/assets/index.html-e7281517.js" as="script"><link rel="prefetch" href="/assets/index.html-dd038321.js" as="script"><link rel="prefetch" href="/assets/index.html-7ff3e11e.js" as="script"><link rel="prefetch" href="/assets/index.html-1e0f8ca5.js" as="script"><link rel="prefetch" href="/assets/index.html-91a90aa5.js" as="script"><link rel="prefetch" href="/assets/index.html-b41716bc.js" as="script"><link rel="prefetch" href="/assets/index.html-7fbe4bcc.js" as="script"><link rel="prefetch" href="/assets/index.html-70c76245.js" as="script"><link rel="prefetch" href="/assets/index.html-d91f6c12.js" as="script"><link rel="prefetch" href="/assets/index.html-2e16b465.js" as="script"><link rel="prefetch" href="/assets/index.html-a78a20f3.js" as="script"><link rel="prefetch" href="/assets/index.html-ff2c131a.js" as="script"><link rel="prefetch" href="/assets/index.html-144aa0d9.js" as="script"><link rel="prefetch" href="/assets/index.html-c0eb79ef.js" as="script"><link rel="prefetch" href="/assets/index.html-8d28343e.js" as="script"><link rel="prefetch" href="/assets/index.html-21c61708.js" as="script"><link rel="prefetch" href="/assets/index.html-0f05122a.js" as="script"><link rel="prefetch" href="/assets/index.html-f0710051.js" as="script"><link rel="prefetch" href="/assets/index.html-b5df8347.js" as="script"><link rel="prefetch" href="/assets/index.html-c1db7764.js" as="script"><link rel="prefetch" href="/assets/index.html-9f78e9be.js" as="script"><link rel="prefetch" href="/assets/index.html-5aa72145.js" as="script"><link rel="prefetch" href="/assets/index.html-c12ff88a.js" as="script"><link rel="prefetch" href="/assets/index.html-4439ca13.js" as="script"><link rel="prefetch" href="/assets/index.html-394c9698.js" as="script"><link rel="prefetch" href="/assets/index.html-72f3752a.js" as="script"><link rel="prefetch" href="/assets/index.html-f13b6a87.js" as="script"><link rel="prefetch" href="/assets/index.html-6434280b.js" as="script"><link rel="prefetch" href="/assets/index.html-0572e6e3.js" as="script"><link rel="prefetch" href="/assets/index.html-b8720651.js" as="script"><link rel="prefetch" href="/assets/index.html-80d2c9b0.js" as="script"><link rel="prefetch" href="/assets/index.html-a1cdc00b.js" as="script"><link rel="prefetch" href="/assets/index.html-922369ed.js" as="script"><link rel="prefetch" href="/assets/index.html-e278ab2b.js" as="script"><link rel="prefetch" href="/assets/index.html-c8a31c38.js" as="script"><link rel="prefetch" href="/assets/index.html-545bd13b.js" as="script"><link rel="prefetch" href="/assets/index.html-9d55779e.js" as="script"><link rel="prefetch" href="/assets/giscus-765fdce2.js" as="script"><link rel="prefetch" href="/assets/auto-bce451fc.js" as="script"><link rel="prefetch" href="/assets/index-a49a0f47.js" as="script"><link rel="prefetch" href="/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-8ccca130.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-0f5688fe.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-5794cde2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="å­¦ä¹ ç¬”è®°"><!----><span class="site-name hide-in-pad">å­¦ä¹ ç¬”è®°</span></a><!--]--><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->SpringBootè‡ªåŠ¨é…ç½®åº•å±‚æºç è§£æ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">æ±Ÿ</span></span><span property="author" content="æ±Ÿ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-08T00:48:43.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 30 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT30M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category1 clickable" role="navigation">å¾®æœåŠ¡</span><span class="page-category-item category4 clickable" role="navigation">SpringBootåŸç†</span><!--]--><meta property="articleSection" content="å¾®æœåŠ¡,SpringBootåŸç†"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#è‡ªåŠ¨é…ç½®åˆ°åº•é…äº†ä»€ä¹ˆ" class="router-link-active router-link-exact-active toc-link level2">è‡ªåŠ¨é…ç½®åˆ°åº•é…äº†ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#è‡ªåŠ¨é…ç½®ç±»" class="router-link-active router-link-exact-active toc-link level2">è‡ªåŠ¨é…ç½®ç±»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#æ¡ä»¶æ³¨è§£" class="router-link-active router-link-exact-active toc-link level2">æ¡ä»¶æ³¨è§£</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#starteræœºåˆ¶" class="router-link-active router-link-exact-active toc-link level2">Starteræœºåˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#conditionalonmissingbean" class="router-link-active router-link-exact-active toc-link level2">@ConditionalOnMissingBean</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#è‡ªåŠ¨é…ç½®å¼€å¯åŸç†" class="router-link-active router-link-exact-active toc-link level2">è‡ªåŠ¨é…ç½®å¼€å¯åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#spring-bootæ•´åˆtomcatåº•å±‚åŸç†" class="router-link-active router-link-exact-active toc-link level2">Spring Bootæ•´åˆTomcatåº•å±‚åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£" class="router-link-active router-link-exact-active toc-link level2">è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#conditionalonclassçš„åº•å±‚å·¥ä½œåŸç†" class="router-link-active router-link-exact-active toc-link level2">@ConditionalOnClassçš„åº•å±‚å·¥ä½œåŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/e79a05/#conditionalonbeançš„åº•å±‚å·¥ä½œåŸç†" class="router-link-active router-link-exact-active toc-link level2">@ConditionalOnBeançš„åº•å±‚å·¥ä½œåŸç†</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p><strong>å†…å®¹</strong></p><ol><li>@EnableAutoConfigurationæºç è§£æ</li><li>å„ç§æ¡ä»¶æ³¨è§£æºç è§£æ</li><li>SpringBootæ•´åˆTomcatåº•å±‚æºç è§£æ</li><li>SpringBootä¹‹AOPè‡ªåŠ¨é…ç½®æºç è§£æ</li><li>Starteræœºåˆ¶åº•å±‚åŸç†è§£æ</li></ol><p>SpringBoot2.6.6æºç åœ°å€ï¼š<a href="https://gitee.com/archguide/spring-boot-2.6.6" target="_blank" rel="noopener noreferrer">https://gitee.com/archguide/spring-boot-2.6.6<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>SpringBoot2.6.6æºç ç¼–è¯‘é—®é¢˜æ±‡æ€»ï¼š<a href="https://www.yuque.com/docs/share/c6770db5-6baa-4394-9636-b2a02edd04de?#" target="_blank" rel="noopener noreferrer">https://www.yuque.com/docs/share/c6770db5-6baa-4394-9636-b2a02edd04de?#<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="è‡ªåŠ¨é…ç½®åˆ°åº•é…äº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨é…ç½®åˆ°åº•é…äº†ä»€ä¹ˆ" aria-hidden="true">#</a> è‡ªåŠ¨é…ç½®åˆ°åº•é…äº†ä»€ä¹ˆï¼Ÿ</h2><p>å¯¹äºä¸€ä¸ªSpringé¡¹ç›®ï¼Œä¸»è¦å°±æ˜¯æœ‰ä¸¤ç§é…ç½®ï¼š</p><ol><li>ä¸€ç§æ˜¯ç±»ä¼¼ç«¯å£å·ã€æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åå¯†ç ç­‰</li><li>ä¸€ç§æ˜¯å„ç§Beanï¼Œæ¯”å¦‚æ•´åˆMybatiséœ€è¦é…ç½®çš„<strong>MapperFactoryBean</strong>ï¼Œæ¯”å¦‚æ•´åˆäº‹åŠ¡éœ€è¦é…ç½®<strong>DataSourceTransactionManager</strong></li></ol><p>SpringBootä¸­çš„è‡ªåŠ¨é…ç½®ï¼Œæ›´å¤šçš„æ˜¯é…ç½®å„ç§Beanï¼Œå› ä¸ºå¯¹äºç¬¬ä¸€ç§é…ç½®ï¼ŒSpringBootä¹Ÿæ— æ³•å»é…ç½®ï¼Œæ¯”å¦‚æ•°æ®åº“åœ°å€ã€å¯†ç ä¹‹ç±»çš„ï¼ŒSpringBootè‚¯å®šæ˜¯æ— æ³•çŸ¥é“çš„ï¼Œä½†æ˜¯å¯¹äºç«¯å£å·è¿™äº›é…ç½®ï¼ŒSpringBootä¹Ÿæ˜¯ä¼šæä¾›ä¸€ç§é»˜è®¤å€¼çš„ï¼Œä¹Ÿç›¸å½“äºä¸€ç§è‡ªåŠ¨é…ç½®ã€‚</p><p>é‚£SpringBootæ˜¯å¦‚ä½•è‡ªåŠ¨çš„å¸®åŠ©æˆ‘ä»¬æ¥é…ç½®è¿™äº›Beançš„å‘¢ï¼Ÿå¹¶ä¸”å¦‚æœæŸäº›Beanç¨‹åºå‘˜è‡ªå·±ä¹Ÿé…ç½®äº†ï¼Œé‚£SpringBootæ˜¯å¦‚ä½•è¿›è¡Œé€‰æ‹©çš„å‘¢ï¼Ÿ</p><h2 id="è‡ªåŠ¨é…ç½®ç±»" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨é…ç½®ç±»" aria-hidden="true">#</a> è‡ªåŠ¨é…ç½®ç±»</h2><p>SpringBootè¦è‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½®Beanï¼Œé‚£è¦æ”¯æŒçš„å°±å¤šäº†ï¼š</p><ol><li>æ¯”å¦‚Springæ•´åˆå„ç§Servletå®¹å™¨ï¼ˆTomcatã€Jettyï¼‰çš„Bean</li><li>æ¯”å¦‚Springæ•´åˆå„ç§æ¶ˆæ¯é˜Ÿåˆ—çš„Bean</li></ol><p>æ‰€ä»¥SpringBootä¸­è‚¯å®šä¸èƒ½æŠŠæ‰€æœ‰çš„Beanéƒ½å®šä¹‰åœ¨ä¸€ä¸ªé…ç½®ç±»ä¸­ï¼Œéœ€è¦åˆ†é—¨åˆ«ç±»ï¼Œè¿™æ ·å°±é’ˆå¯¹ä¸åŒçš„åœºæ™¯å®šä¹‰äº†ä¸åŒçš„è‡ªåŠ¨é…ç½®ç±»ï¼Œæ¯”å¦‚ï¼š</p><ol><li>ServletWebServerFactoryAutoConfigurationï¼šé…ç½®äº†Servlet Webåœºæ™¯ä¸­æ‰€éœ€è¦çš„ä¸€äº›Bean</li><li>TransactionAutoConfigurationï¼šé…ç½®äº†äº‹åŠ¡åœºæ™¯ä¸­æ‰€éœ€è¦çš„ä¸€äº›Bean</li><li>AopAutoConfigurationï¼šé…ç½®äº†AOPåœºæ™¯ä¸­æ‰€éœ€è¦çš„ä¸€äº›Bean</li><li>RabbitAutoConfigurationï¼šé…ç½®äº†Rabbitmqåœºæ™¯ä¸­æ‰€éœ€è¦çš„ä¸€äº›Bean</li></ol><p>ä½¿ç”¨è¿™ç§ç»“æ„åï¼ŒSpringBootå°±èƒ½è®©ç¨‹åºå‘˜æ›´ä¸ºæ–¹ä¾¿çš„æ¥æ§åˆ¶<strong>æŸä¸ªBeanæˆ–æŸäº›Beanè¦ä¸è¦ç”Ÿæ•ˆ</strong>ï¼Œå¦‚æœæŸä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸ç”Ÿæ•ˆï¼Œé‚£è¯¥é…ç½®ç±»ä¸­æ‰€å®šä¹‰çš„Beanåˆ™éƒ½ä¸ä¼šç”Ÿæ•ˆã€‚</p><p>é‚£SpringBootä¸­æ˜¯å¦‚ä½•æ§åˆ¶æŸä¸ªè‡ªåŠ¨é…ç½®ç±»æˆ–æŸä¸ªBeanç”Ÿä¸ç”Ÿæ•ˆå‘¢ï¼Ÿ</p><h2 id="æ¡ä»¶æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#æ¡ä»¶æ³¨è§£" aria-hidden="true">#</a> æ¡ä»¶æ³¨è§£</h2><p>SpringBootä¸­çš„æ¡ä»¶æ³¨è§£æœ‰ï¼š</p><ol><li>ConditionalOnBeanï¼šæ˜¯å¦å­˜åœ¨æŸä¸ªæŸç±»æˆ–æŸä¸ªåå­—çš„Bean</li><li>ConditionalOnMissingBeanï¼šæ˜¯å¦ç¼ºå¤±æŸä¸ªæŸç±»æˆ–æŸä¸ªåå­—çš„Bean</li><li>ConditionalOnSingleCandidateï¼šæ˜¯å¦ç¬¦åˆæŒ‡å®šç±»å‹çš„Beanåªæœ‰ä¸€ä¸ª</li><li>ConditionalOnClassï¼šæ˜¯å¦å­˜åœ¨æŸä¸ªç±»</li><li>ConditionalOnMissingClassï¼šæ˜¯å¦ç¼ºå¤±æŸä¸ªç±»</li><li>ConditionalOnExpressionï¼šæŒ‡å®šçš„è¡¨è¾¾å¼è¿”å›çš„æ˜¯trueè¿˜æ˜¯false</li><li>ConditionalOnJavaï¼šåˆ¤æ–­Javaç‰ˆæœ¬</li><li>ConditionalOnJndiï¼šJNDIæŒ‡å®šçš„èµ„æºæ˜¯å¦å­˜åœ¨</li><li>ConditionalOnWebApplicationï¼šå½“å‰åº”ç”¨æ˜¯ä¸€ä¸ªWebåº”ç”¨</li><li>ConditionalOnNotWebApplicationï¼šå½“å‰åº”ç”¨ä¸æ˜¯ä¸€ä¸ªWebåº”ç”¨</li><li>ConditionalOnPropertyï¼šEnvironmentä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå±æ€§</li><li>ConditionalOnResourceï¼šæŒ‡å®šçš„èµ„æºæ˜¯å¦å­˜åœ¨</li><li>ConditionalOnWarDeploymentï¼šå½“å‰é¡¹ç›®æ˜¯ä¸æ˜¯ä»¥WaråŒ…éƒ¨ç½²çš„æ–¹å¼è¿è¡Œ</li><li>ConditionalOnCloudPlatformï¼šæ˜¯ä¸æ˜¯åœ¨æŸä¸ªäº‘å¹³å°ä¸Š</li></ol><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨@Conditionalæ¥è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£ã€‚</p><p>æ¡ä»¶æ³¨è§£æ˜¯å¯ä»¥å†™åœ¨ç±»ä¸Šå’Œæ–¹æ³•ä¸Šçš„ï¼Œå¦‚æœæŸä¸ªæ¡ä»¶æ³¨è§£å†™åœ¨äº†è‡ªåŠ¨é…ç½®ç±»ä¸Šï¼Œé‚£è¯¥è‡ªåŠ¨é…ç½®ç±»ä¼šä¸ä¼šç”Ÿæ•ˆå°±è¦çœ‹å½“å‰æ¡ä»¶èƒ½ä¸èƒ½ç¬¦åˆï¼Œæˆ–è€…æ¡ä»¶æ³¨è§£å†™åœ¨æŸä¸ª@Beanä¿®é¥°çš„æ–¹æ³•ä¸Šï¼Œé‚£è¿™ä¸ªBeanç”Ÿä¸ç”Ÿæ•ˆå°±çœ‹å½“å‰æ¡ä»¶ç¬¦ä¸ç¬¦åˆã€‚</p><p>å…·ä½“åŸç†æ˜¯ï¼š</p><ol><li>Springåœ¨è§£ææŸä¸ªè‡ªåŠ¨é…ç½®ç±»æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥è¯¥è‡ªåŠ¨é…ç½®ç±»ä¸Šæ˜¯å¦æœ‰æ¡ä»¶æ³¨è§£ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­è¯¥æ¡ä»¶æ³¨è§£æ‰€æŒ‡å®šçš„æ¡ä»¶å½“å‰èƒ½ä¸èƒ½æ»¡è¶³ï¼Œå¦‚æœæ»¡è¶³äº†åˆ™ç»§ç»­è§£æè¯¥é…ç½®ç±»ï¼Œå¦‚æœä¸æ»¡è¶³åˆ™ä¸è¿›è¡Œè§£æäº†ï¼Œä¹Ÿå°±æ˜¯é…ç½®ç±»æ‰€å®šä¹‰çš„Beanéƒ½å¾—ä¸åˆ°è§£æï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæ²¡æœ‰è¿™äº›Beanäº†ã€‚</li><li>åŒç†ï¼ŒSpringåœ¨è§£ææŸä¸ª@Beançš„æ–¹æ³•æ—¶ï¼Œä¹Ÿä¼šå…ˆåˆ¤æ–­æ–¹æ³•ä¸Šæ˜¯å¦æœ‰æ¡ä»¶æ³¨è§£ï¼Œç„¶åè¿›è¡Œè§£æï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¯¥Beanä¸ä¼šç”Ÿæ•ˆ</li></ol><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒSpringBootçš„è‡ªåŠ¨é…ç½®ï¼Œå®é™…ä¸Šå°±æ˜¯SpringBootçš„æºç ä¸­é¢„å…ˆå†™å¥½äº†ä¸€äº›é…ç½®ç±»ï¼Œé¢„å…ˆå®šä¹‰å¥½äº†ä¸€äº›Beanï¼Œæˆ‘ä»¬åœ¨ç”¨SpringBootæ—¶ï¼Œè¿™äº›é…ç½®ç±»å°±å·²ç»åœ¨æˆ‘ä»¬é¡¹ç›®çš„ä¾èµ–ä¸­äº†ï¼Œè€Œè¿™äº›è‡ªåŠ¨é…ç½®ç±»æˆ–è‡ªåŠ¨é…ç½®Beanåˆ°åº•ç”Ÿä¸ç”Ÿæ•ˆï¼Œå°±çœ‹å…·ä½“æ‰€æŒ‡å®šçš„æ¡ä»¶äº†ã€‚</p><h2 id="starteræœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#starteræœºåˆ¶" aria-hidden="true">#</a> Starteræœºåˆ¶</h2><p>é‚£SpringBootä¸­çš„Starterå’Œè‡ªåŠ¨é…ç½®åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p><p>å…¶å®é¦–å…ˆè¦æ˜ç™½ä¸€ä¸ªStarterï¼Œå°±æ˜¯ä¸€ä¸ªMavenä¾èµ–ï¼Œå½“æˆ‘ä»¬åœ¨é¡¹ç›®çš„pom.xmlæ–‡ä»¶ä¸­æ·»åŠ æŸä¸ªStarterä¾èµ–æ—¶ï¼Œå…¶å®å°±æ˜¯ç®€å•çš„æ·»åŠ äº†å¾ˆå¤šå…¶ä»–çš„ä¾èµ–ï¼Œæ¯”å¦‚ï¼š</p><ol><li>spring-boot-starter-webï¼šå¼•å…¥äº†spring-boot-starterã€spring-boot-starter-jsonã€spring-boot-starter-tomcatç­‰å’ŒWebå¼€å‘ç›¸å…³çš„ä¾èµ–åŒ…</li><li>spring-boot-starter-tomcatï¼šå¼•å…¥äº†tomcat-embed-coreã€tomcat-embed-elã€tomcat-embed-websocketç­‰å’ŒTomcatç›¸å…³çš„ä¾èµ–åŒ…</li><li>...</li></ol><p>å¦‚æœç¡¬è¦æŠŠStarteræœºåˆ¶å’Œè‡ªåŠ¨é…ç½®è”ç³»èµ·æ¥ï¼Œé‚£å°±æ˜¯é€šè¿‡@ConditionalOnClassè¿™ä¸ªæ¡ä»¶æ³¨è§£ï¼Œå› ä¸ºè¿™ä¸ªæ¡ä»¶æ³¨è§£çš„ä½œç”¨å°±æ˜¯ç”¨æ¥åˆ¤æ–­å½“å‰åº”ç”¨çš„ä¾èµ–ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªç±»æˆ–æŸäº›ç±»ï¼Œæ¯”å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Tomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">UpgradeProtocol</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ServletWebServerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedTomcat</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">TomcatServletWebServerFactory</span> <span class="token function">tomcatServletWebServerFactory</span><span class="token punctuation">(</span>
        <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatConnectorCustomizer</span><span class="token punctuation">&gt;</span></span> connectorCustomizers<span class="token punctuation">,</span>
        <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatContextCustomizer</span><span class="token punctuation">&gt;</span></span> contextCustomizers<span class="token punctuation">,</span>
        <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatProtocolHandlerCustomizer</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> protocolHandlerCustomizers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TomcatServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// orderedStream()è°ƒç”¨æ—¶ä¼šå»Springå®¹å™¨ä¸­æ‰¾åˆ°TomcatConnectorCustomizerç±»å‹çš„Beanï¼Œé»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œç¨‹åºå‘˜å¯ä»¥è‡ªå·±å®šä¹‰</span>
        factory<span class="token punctuation">.</span><span class="token function">getTomcatConnectorCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>connectorCustomizers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">getTomcatContextCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>contextCustomizers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">getTomcatProtocolHandlerCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>protocolHandlerCustomizers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä»£ç ä¸­å°±ç”¨åˆ°äº†@ConditionalOnClassï¼Œç”¨æ¥åˆ¤æ–­é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨Servlet.classã€Tomcat.classã€UpgradeProtocol.classè¿™ä¸‰ä¸ªç±»ï¼Œå¦‚æœå­˜åœ¨å°±æ»¡è¶³å½“å‰æ¡ä»¶ï¼Œå¦‚æœé¡¹ç›®ä¸­å¼•å…¥äº†spring-boot-starter-tomcatï¼Œé‚£å°±æœ‰è¿™ä¸‰ä¸ªç±»ï¼Œå¦‚æœæ²¡æœ‰spring-boot-starter-tomcaté‚£å°±å¯èƒ½æ²¡æœ‰è¿™ä¸‰ä¸ªç±»ï¼ˆé™¤éä½ è‡ªå·±å•ç‹¬å¼•å…¥äº†Tomcatç›¸å…³çš„ä¾èµ–ï¼‰ã€‚</p><p>æ‰€ä»¥è¿™å°±åšåˆ°äº†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­è¦ç”¨Tomcatï¼Œé‚£å°±ä¾èµ–spring-boot-starter-webå°±å¤Ÿäº†ï¼Œå› ä¸ºå®ƒé»˜è®¤ä¾èµ–äº†spring-boot-starter-tomcatï¼Œä»è€Œä¾èµ–äº†Tomcatï¼Œä»è€ŒTomcatç›¸å…³çš„Beanèƒ½ç”Ÿæ•ˆã€‚</p><p>è€Œå¦‚æœä¸æƒ³ç”¨Tomcatï¼Œé‚£å°±å¾—è¿™ä¹ˆå†™ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jetty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾—æŠŠspring-boot-starter-tomcatç»™æ’é™¤æ‰ï¼Œå†æ·»åŠ ä¸Šspring-boot-starter-jettyçš„ä¾èµ–ï¼Œè¿™æ ·Tomcatçš„Beanå°±ä¸ä¼šç”Ÿæ•ˆï¼ŒJettyçš„Beanå°±èƒ½ç”Ÿæ•ˆï¼Œä»è€Œé¡¹ç›®ä¸­ç”¨çš„å°±æ˜¯Jettyã€‚</p><h2 id="conditionalonmissingbean" tabindex="-1"><a class="header-anchor" href="#conditionalonmissingbean" aria-hidden="true">#</a> @ConditionalOnMissingBean</h2><p>@ConditionalOnMissingBeançš„ä½œç”¨æ˜¯ç”¨æ¥åˆ¤æ–­æŸä¸ªBeanæ˜¯å¦ç¼ºå¤±ï¼Œå¦‚æœ<strong>ä¸å­˜åœ¨</strong>æŸä¸ªBeanï¼Œé‚£å°±<strong>ç¬¦åˆè¯¥æ¡ä»¶</strong>ï¼Œç†è§£èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ç»†ç»†æƒ³ä¸€ä¸‹å°±ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯é¡ºåºé—®é¢˜ï¼Œè¿˜æ˜¯æ‹¿ä¸Šé¢çš„ä»£ç ä¸¾ä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@Configuration(proxyBeanMethods = false)
@ConditionalOnClass({ Servlet.class, Tomcat.class, UpgradeProtocol.class })
@ConditionalOnMissingBean(value = ServletWebServerFactory.class, search = SearchStrategy.CURRENT)
static class EmbeddedTomcat {
    
    @Bean
    TomcatServletWebServerFactory tomcatServletWebServerFactory(
        ObjectProvider&lt;TomcatConnectorCustomizer&gt; connectorCustomizers,
        ObjectProvider&lt;TomcatContextCustomizer&gt; contextCustomizers,
        ObjectProvider&lt;TomcatProtocolHandlerCustomizer&lt;?&gt;&gt; protocolHandlerCustomizers) {
        TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();
        
        // orderedStream()è°ƒç”¨æ—¶ä¼šå»Springå®¹å™¨ä¸­æ‰¾åˆ°TomcatConnectorCustomizerç±»å‹çš„Beanï¼Œé»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œç¨‹åºå‘˜å¯ä»¥è‡ªå·±å®šä¹‰
        factory.getTomcatConnectorCustomizers()
            .addAll(connectorCustomizers.orderedStream().collect(Collectors.toList()));
        factory.getTomcatContextCustomizers()
            .addAll(contextCustomizers.orderedStream().collect(Collectors.toList()));
        factory.getTomcatProtocolHandlerCustomizers()
            .addAll(protocolHandlerCustomizers.orderedStream().collect(Collectors.toList()));
        return factory;
    }
    
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä»£ç ä¸­å°±ç”¨åˆ°äº†@ConditionalOnMissingBeanï¼Œæ„æ€æ˜¯å¦‚æœå½“å‰ä¸å­˜åœ¨ServletWebServerFactoryç±»å‹çš„Beanï¼Œé‚£å°±ç¬¦åˆæ¡ä»¶ï¼Œç»“åˆæ•´ä½“ä»£ç ï¼Œæ„æ€å°±æ˜¯ï¼Œï¼š</p><ol><li>å¦‚æœç”¨æˆ·è‡ªå·±<strong>æ²¡æœ‰å®šä¹‰</strong>ServletWebServerFactoryç±»å‹çš„Beanï¼Œé‚£ä»£ç ä¸­æ‰€å®šä¹‰çš„Beanå°±ä¼š<strong>ç”Ÿæ•ˆ</strong>ï¼Œ</li><li>å¦‚æœç”¨æˆ·è‡ªå·±å®šä¹‰äº†ServletWebServerFactoryç±»å‹çš„Beanï¼Œé‚£ä»£ç ä¸­å®šä¹‰çš„Beanå°±ä¸ç”Ÿæ•ˆ</li></ol><p>æ‰€ä»¥è¿™ä¸ªæ³¨è§£æ˜¯éå¸¸é‡è¦çš„ï¼ŒSpringBootåˆ©ç”¨è¿™ä¸ªæ³¨è§£æ¥å†³å®šåˆ°åº•ç”¨ç”¨æˆ·è‡ªå·±çš„Beanï¼Œè¿˜æ˜¯ç”¨SpringBootè‡ªåŠ¨é…ç½®çš„ã€‚</p><p>å…³é”®é—®é¢˜åœ¨äºï¼Œä¸ç®¡æ˜¯è‡ªåŠ¨é…ç½®ç±»ä¸­å®šä¹‰çš„Beanï¼Œè¿˜æ˜¯ç”¨æˆ·å®šä¹‰çš„Beanï¼Œéƒ½æ˜¯éœ€è¦è§£æçš„ï¼Œè€Œä¸”æ˜¯æœ‰ä¸€ä¸ªé¡ºåºçš„ã€‚</p><p>å¦‚æœæ˜¯ï¼š</p><ol><li>å…ˆè§£æçš„SpringBootè‡ªåŠ¨é…ç½®ç±»ï¼Œæ¯”å¦‚ä¸Šé¢çš„EmbeddedTomcatç±»</li><li>å†è§£æç¨‹åºå‘˜å®šä¹‰çš„Bean</li></ol><p>é‚£@ConditionalOnMissingBeançš„åˆ¤æ–­ç»“æœæ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºæ˜¯å…ˆè§£æçš„EmbeddedTomcatï¼Œåœ¨è§£æçš„æ—¶å€™æ˜¯æ²¡æœ‰å‘ç°ç¨‹åºå‘˜æ‰€å®šä¹‰çš„Beançš„ï¼Œå°±ä¼šè®¤ä¸ºç¬¦åˆ@ConditionalOnMissingBeançš„æ¡ä»¶ï¼Œè€Œå®é™…ä¸Šç¨‹åºå‘˜æ˜¯å®šä¹‰äº†çš„ï¼Œåªæ˜¯è¿˜æ²¡æœ‰è§£æåˆ°ï¼Œæ‰€ä»¥è¿™å°±éœ€è¦SpringBootæŠŠè¿™ä¸ªé¡ºåºæ§åˆ¶å¥½ï¼Œæ§åˆ¶ä¸ºï¼š</p><ol><li>å…ˆè§£æç”¨æˆ·çš„å®šä¹‰çš„Beanï¼Œä¹Ÿå°±æ˜¯è§£æç”¨æˆ·å®šä¹‰çš„é…ç½®ç±»ï¼ˆåŒ…å«äº†æ‰«æå’Œ@Beançš„è§£æï¼‰</li><li>å†è§£æSpringBootä¸­çš„è‡ªåŠ¨é…ç½®ç±»</li></ol><p>ä¸ç®¡æ˜¯ç”¨æˆ·å®šä¹‰çš„é…ç½®ç±»è¿˜æ˜¯è‡ªåŠ¨é…ç½®ç±»ï¼Œéƒ½æ˜¯é…ç½®ç±»ï¼ˆç®€å•ç†è§£å°±æ˜¯åŠ äº†@Configurationæ³¨è§£ï¼‰ã€‚SpringBootå¯åŠ¨æ—¶ï¼Œæœ€æ ¸å¿ƒçš„ä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªSpringå®¹å™¨ï¼Œè€Œåˆ›å»ºSpringå®¹å™¨çš„è¿‡ç¨‹ä¸­ä¼šæ³¨è§£åšå‡ ä»¶äº‹æƒ…ï¼š</p><ol><li>æŠŠSpringApplication.run(MyApplication.class)ä¼ å…¥è¿›æ¥çš„MyApplicationç±»åšä¸ºé…ç½®ç±»è¿›è¡Œè§£æ</li><li>ç”±äºMyApplicationç±»ä¸Šå®šä¹‰äº†@SpringBootApplicationï¼Œç›¸å½“äºå®šä¹‰äº†@SpringBootConfigurationã€@EnableAutoConfigurationã€@ComponentScanæ³¨è§£</li><li>æ‰€ä»¥SpringBootä¼šè¿›ä¸€æ­¥è§£æè¿™äº›æ³¨è§£</li></ol><ul><li><ol><li>@EnableAutoConfigurationï¼šé€šè¿‡@importæ³¨è§£å¯¼å…¥AutoConfigurationImportSelectorè¿™ä¸ªé…ç½®ç±»ï¼Œå› ä¸ºå®ƒå®ç°äº†DeferredImportSelectoræ¥å£ï¼Œæ‰€ä»¥Springä¼šåœ¨æŠŠå…¶ä»–é…ç½®ç±»éƒ½è§£æå®Œä¹‹åæ‰è§£æAutoConfigurationImportSelectorï¼ˆSpring Frameworkä¸­çš„çŸ¥è¯†ï¼‰</li><li>@ComponentScanï¼šæ‰«æï¼Œæ‰«ææ—¶ä¼šæ‰«æåˆ°ç”¨æˆ·æ‰€å®šä¹‰çš„é…ç½®ç±»ï¼Œå¹¶è§£æç”¨æˆ·çš„é…ç½®ç±»ï¼Œæ³¨æ„ï¼šæ‰«ææ˜¯æ‰«æä¸åˆ°SpringBootçš„è‡ªåŠ¨é…ç½®çš„ç±»ï¼Œå› ä¸ºæ‰«æçš„åŒ…è·¯å¾„ä¸åŒ¹é…ï¼ŒSpringBootçš„åŒ…éƒ½æ˜¯org.springframework.boot.xxxxï¼Œç”¨æˆ·éƒ½æ˜¯è‡ªå·±çš„åŒ…è·¯å¾„ã€‚</li></ol></li></ul><p>é€šè¿‡ä¸Šè¿°è¿‡ç¨‹æˆ‘ä»¬å‘ç°ï¼ŒSpringä¼šåœ¨æœ€åæ‰æ¥è§£æAutoConfigurationImportSelectorè¿™ä¸ªé…ç½®ç±»ï¼Œè€Œè¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯ç”¨æ¥è§£æSpringBootçš„è‡ªåŠ¨é…ç½®ç±»ï¼Œé‚£æ—¢ç„¶æ— æ³•æ‰«æåˆ°SpringBootä¸­çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œé‚£æ€ä¹ˆçŸ¥é“SpringBootä¸­æœ‰å“ªäº›è‡ªåŠ¨é…ç½®ç±»å‘¢ï¼Œè¿™å°±éœ€è¦spring.factoriesæ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringBootä¼šæä¾›ä¸€ä¸ªspring.factoriesæ–‡ä»¶ï¼Œå¹¶æŠŠæ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»çš„åå­—è®°å½•åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œåˆ°æ—¶å€™å¯åŠ¨è¿‡ç¨‹ä¸­è§£æè¿™ä¸ªæ–‡ä»¶å°±çŸ¥é“æœ‰å“ªäº›è‡ªåŠ¨é…ç½®ç±»äº†ï¼Œå¹¶ä¸”è¿™ä»¶äº‹ä¹Ÿæ˜¯å‘ç”Ÿåœ¨è§£æå®Œç”¨æˆ·çš„é…ç½®ç±»ä¹‹åçš„ã€‚</p><h2 id="è‡ªåŠ¨é…ç½®å¼€å¯åŸç†" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨é…ç½®å¼€å¯åŸç†" aria-hidden="true">#</a> è‡ªåŠ¨é…ç½®å¼€å¯åŸç†</h2><p>æˆ‘ä»¬åœ¨ä½¿ç”¨SpringBootæ—¶ï¼Œé€šå¸¸ä½¿ç”¨çš„æ˜¯@SpringBootApplicationè¿™ä¸ªæ³¨è§£ï¼Œæ¯”å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œè¿™ä¸ªæ³¨è§£çš„å®šä¹‰ä¸ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥å‘ç°è¿™ä¸ªæ³¨è§£ä¸Šæœ‰å¦å¤–ä¸‰ä¸ªæ³¨è§£ï¼š</p><ol><li>@SpringBootConfiguration</li><li>@EnableAutoConfiguration</li><li>@ComponentScan</li></ol><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸º@SpringBootApplicationæ˜¯ä¸€ä¸ªä¸‰åˆä¸€æ³¨è§£ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™ä¹ˆç”¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬è¿™ä¹ˆç”¨å°±èƒ½è‡ªå·±æ§åˆ¶è¦ä¸è¦ç”¨@EnableAutoConfigurationè¿™ä¸ªæ³¨è§£ï¼Œå¦‚æœç”¨å°±è¡¨ç¤ºå¼€å¯è‡ªåŠ¨é…ç½®ï¼Œå¦‚æœä¸ç”¨å°±è¡¨ç¤ºä¸å¼€å¯è‡ªåŠ¨é…ç½®ï¼Œé‚£å¼€å¯å’Œä¸å¼€å¯è‡ªåŠ¨é…ç½®åˆ°åº•è¯¥æ€ä¹ˆç†è§£å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å‰é¢åˆ†æè¿‡ï¼ŒSpringBootçš„è‡ªåŠ¨é…ç½®å°±æ˜¯SpringBootå¸®åŠ©ç¨‹åºå‘˜é…ç½®ä¸€äº›Beanï¼Œä»è€Œè®©ç¨‹åºå‘˜åœ¨ç”¨SpringBootæ—¶å¯ä»¥å°‘å»é…ç½®å¾ˆå¤šBeanï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å¼€å¯äº†è‡ªåŠ¨é…ç½®ï¼Œé‚£æœ€ç»ˆSpringå®¹å™¨ä¸­å°±æœ‰SpringBootå¸®æˆ‘ä»¬é…ç½®çš„Beanï¼Œå¦‚æœæ²¡æœ‰å¼€å¯è‡ªåŠ¨é…ç½®ï¼Œé‚£Springå®¹å™¨ä¸­å°±æ²¡æœ‰è¿™äº›Beanï¼Œå°±éœ€è¦ç¨‹åºå‘˜å»é…ç½®ã€‚</p><p>é‚£æˆ‘ä»¬æ¥çœ‹çœ‹@EnableAutoConfigurationè¿™ä¸ªæ³¨è§£æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿå…ˆçœ‹æºç å®šä¹‰ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@AutoConfigurationPackage</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­éå¸¸æ ¸å¿ƒçš„å°±æ˜¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è€ŒAutoConfigurationImportSelectorå®ç°äº†DeferredImportSelectorè¿™ä¸ªæ¥å£ï¼ŒSpringå®¹å™¨åœ¨å¯åŠ¨æ—¶ï¼Œä¼šåœ¨è§£æå®Œå…¶ä»–æ‰€æœ‰ç¨‹åºå‘˜å®šä¹‰çš„é…ç½®ç±»ä¹‹åï¼Œæ¥è°ƒç”¨AutoConfigurationImportSelectorä¸­çš„selectImportsæ–¹æ³•ï¼Œç„¶åæŠŠè¯¥æ–¹æ³•è¿”å›çš„ç±»åå¯¹åº”çš„ç±»ä½œä¸ºé…ç½®ç±»è¿›è¡Œè§£æã€‚</p><p>è¯¥æ–¹æ³•ä¼šåˆ©ç”¨SpringFactoriesLoaderæ‰¾åˆ°æ‰€æœ‰çš„META-INF/spring.factoriesæ–‡ä»¶ä¸­keyä¸ºEnableAutoConfiguration.classçš„valueå€¼ï¼Œä¹Ÿå°±æ˜¯ä¼—å¤šè‡ªåŠ¨é…ç½®ç±»çš„ç±»åã€‚</p><p>æ‹¿åˆ°è¿™äº›ç±»ååä¼šè¿›è¡Œå»é‡ï¼Œå»é‡çš„ä»£ç ä¸ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å»é‡å®Œä¹‹åï¼Œå°±ä¼šçœ‹æ˜¯å¦å­˜åœ¨æŸäº›è‡ªåŠ¨é…ç½®ç±»éœ€è¦æ’é™¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡@EnableAutoConfigurationæ³¨è§£çš„excludeå±æ€§ï¼Œæˆ–è€…spring.autoconfigure.excludeé…ç½®æ¥æŒ‡å®šä¸€äº›è‡ªåŠ¨é…ç½®ç±»çš„åå­—ï¼Œç„¶åæŠŠå®ƒä»¬ä»è‡ªåŠ¨é…ç½®ç±»é›†åˆä¸­æ’é™¤æ‰ã€‚</p><p>ç„¶åä¼šç»§ç»­åˆ©ç”¨ConfigurationClassFilterå¯¹è‡ªåŠ¨é…ç½®ç±»è¿›è¡Œè¿›ä¸€æ­¥ç­›é€‰ï¼ŒConfigurationClassFilterä¼šåˆ©ç”¨AutoConfigurationMetadataè¿›è¡Œç­›é€‰ï¼Œè€ŒAutoConfigurationMetadataå¯¹è±¡å¯¹åº”çš„æ˜¯&quot;META-INF/spring-autoconfigure-metadata.properties&quot;æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œè¿™æ˜¯ä¸€ç§åŠ å¿«SpringBootå¯åŠ¨é€Ÿåº¦çš„æœºåˆ¶ï¼Œé»˜è®¤æ˜¯å¼€å¯äº†çš„ï¼ˆä¸è¿‡è¦é€šè¿‡mavenæˆ–gradleçš„æ–¹å¼å¼•å…¥springbootçš„ä¾èµ–æ¥ä½¿ç”¨æ‰èƒ½çœ‹åˆ°æ•ˆæœï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯åœ¨SpringBootæºç å·¥ç¨‹ç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆå‡ºæ¥çš„ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºè¿™ä¸ªæ–‡ä»¶ï¼Œä»¥åŠè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„è¿™ä¸ªæ–‡ä»¶å†…å®¹æ ·ä¾‹ï¼š</p><figure><img src="https://img.jssjqd.cn/202304080118430.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://img.jssjqd.cn/202304080118356.png" alt="image-20230408011812100" tabindex="0" loading="lazy"><figcaption>image-20230408011812100</figcaption></figure><p>å†…å®¹æ ¼å¼ä¸ºï¼š<strong>è‡ªåŠ¨é…ç½®ç±»å.æ¡ä»¶æ³¨è§£=æ¡ä»¶</strong></p><p>æœ‰äº†è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼ŒSpringBootä¼šåœ¨é€šè¿‡spring.facotriesæ–‡ä»¶æ‰¾åˆ°æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»åï¼Œä¼šæŠŠè¿™ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹è¯»å‡ºæ¥ï¼Œç„¶ååˆ©ç”¨AutoConfigurationImportFilterå¯¹æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»è¿›è¡Œæ¡ä»¶åŒ¹é…ï¼Œè¿™é‡Œçš„æ¡ä»¶åˆ¤æ–­ï¼Œåªä¼šåˆ¤æ–­æ‰€éœ€è¦çš„ç±»æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœéœ€è¦çš„ç±»ï¼Œæˆ–è€…éœ€è¦çš„Beanå¯¹åº”çš„ç±»ï¼Œéƒ½ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè‚¯å®šä¸ç¬¦åˆæ¡ä»¶äº†ï¼Œå¯¹äºåƒ@ConditionalOnMissingBeanè¿™æ ·çš„æ¡ä»¶ï¼Œåœ¨è¿™ä¸€æ­¥æ˜¯ä¸ä¼šå»åˆ¤æ–­çš„ï¼Œæœ€åæ¡ä»¶åŒ¹é…æˆåŠŸçš„è‡ªåŠ¨é…ç½®ç±»å°±ä¼šè®°å½•ä¸‹æ¥ï¼Œå¹¶æœ€ç»ˆè¿”å›ç»™Springå®¹å™¨ï¼Œç»§ç»­è¿›è¡Œå…¶ä»–æ¡ä»¶çš„åŒ¹é…ã€‚</p><p>æ‰€ä»¥é€šè¿‡è¿™ä¸ªæœºåˆ¶ï¼Œä½¿å¾—Springå¹¶ä¸éœ€è¦è§£ææ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œä»è€Œæé«˜äº†æ•ˆç‡ã€‚</p><p>å½“ç„¶åœ¨è¿™ä¸ªè¿‡æ»¤çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ—¥å¿—çº§åˆ«ç­‰äºtraceçº§åˆ«ï¼Œé‚£ä¹ˆä¼šæŠŠæ‰€æœ‰æ¡ä»¶ä¸åŒ¹é…çš„è‡ªåŠ¨é…ç½®ç±»è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œå¦‚æœæ—¥å¿—æ¡†æ¶é…ç½®äº†æ‰“å°åˆ°æ§åˆ¶å°ï¼Œé‚£å°±ä¼šæ‰“å°åˆ°æ§åˆ¶å°ï¼Œæ¯”å¦‚ï¼š</p><figure><img src="https://img.jssjqd.cn/202304080118501.png" alt="image-20230408011834622" tabindex="0" loading="lazy"><figcaption>image-20230408011834622</figcaption></figure><p>åœ¨SpringBootä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´åŠ å¼ºå¤§çš„ç»Ÿè®¡è‡ªåŠ¨é…ç½®ç±»åŒ¹é…ç»“æœçš„åŠŸèƒ½ï¼Œå°±æ˜¯å¯ä»¥é…ç½®debug=trueï¼Œåªè¦å¼€å¯äº†è¿™ä¸ªé…ç½®ï¼Œé‚£ä¹ˆSpringåœ¨è§£ææ¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»æ—¶ï¼Œå°±ä¼šå°†æ˜¯å¦åŒ¹é…çš„ç»“æœè¿›è¡Œè®°å½•ï¼Œæ¯”å¦‚å¼€å¯äº†debug=trueï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°ï¼š</p><figure><img src="https://img.jssjqd.cn/202304080118961.png" alt="image-20230408011843020" tabindex="0" loading="lazy"><figcaption>image-20230408011843020</figcaption></figure><figure><img src="https://img.jssjqd.cn/202304080118198.png" alt="image-20230408011849165" tabindex="0" loading="lazy"><figcaption>image-20230408011849165</figcaption></figure><figure><img src="https://img.jssjqd.cn/202304080118269.png" alt="image-20230408011856345" tabindex="0" loading="lazy"><figcaption>image-20230408011856345</figcaption></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªåŒ¹é…ç»“æœåˆ†åˆ«è®°å½•äº†ï¼š</p><ol><li>å“ªäº›è‡ªåŠ¨é…ç½®ç±»çš„æ¡ä»¶æ˜¯åŒ¹é…çš„</li><li>å“ªäº›è‡ªåŠ¨é…ç½®ç±»çš„æ¡ä»¶æ˜¯ä¸åŒ¹é…çš„ï¼Œå¹¶ä¸”å…·ä½“åŸå› ä¹Ÿä¼šæ‰“å°å‡ºæ¥ï¼Œæ¯”å¦‚æ˜¯å“ªä¸ªç±»ä¸å­˜åœ¨</li><li>å“ªäº›è‡ªåŠ¨é…ç½®ç±»æ˜¯æ— æ¡ä»¶çš„</li></ol><p>è¿™ä¸ªåŠŸèƒ½çš„å®ç°ï¼Œæ˜¯Springè§£æå…·ä½“çš„è‡ªåŠ¨é…ç½®ç±»ä¸Šçš„å„ç§æ¡ä»¶æ³¨è§£çš„æ—¶å€™ç»Ÿè®¡çš„ï¼Œæ¯è§£æä¸€ä¸ªæ¡ä»¶æ³¨è§£ï¼Œå°±ä¼šæŠŠç»“æœè®°å½•åœ¨ConditionEvaluationReportå¯¹è±¡ä¸­ï¼Œå½“Springå®¹å™¨å¯åŠ¨å®Œæˆåï¼Œä¼šå‘å¸ƒä¸€ä¸ªContextRefreshedEventäº‹ä»¶ï¼Œè€ŒSpringBootæä¾›äº†ä¸€ä¸ªConditionEvaluationReportLoggingListenerä¼šå¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œæ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶åå°±ä¼šæŠŠç»Ÿè®¡ç»“æœè¿›è¡Œæ‰“å°ã€‚</p><p>è‡ªåŠ¨é…ç½®ç±»è§£æçš„å¤§ä½“æµç¨‹ä¸ºï¼š</p><ol><li>è¯»å–spring.factoriesä¸­çš„æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»</li><li>çœ‹æ˜¯å¦é…ç½®äº†éœ€è¦æ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œè¿›è¡Œæ’é™¤</li><li>ç„¶ååˆ©ç”¨spring-autoconfigure-metadata.propertiesæ–‡ä»¶æ¥è¿‡æ»¤æ‰ä¸€äº›è‡ªåŠ¨é…ç½®ç±»ï¼ˆæ¡ä»¶ä¸­æŒ‡å®šçš„ç±»ä¸å­˜åœ¨çš„è‡ªåŠ¨é…ç½®ç±»ï¼‰</li><li>è§£æè¿‡æ»¤åè‡ªåŠ¨é…ç½®ç±»ï¼Œåˆ¤æ–­è‡ªåŠ¨é…ç½®ç±»æ‰€æœ‰çš„æ¡ä»¶æ³¨è§£ï¼Œæ¡ä»¶å…¨éƒ¨ç¬¦åˆæ‰ä¼šçœŸæ­£å»è§£æè‡ªåŠ¨é…ç½®ç±»ä¸Šçš„å…¶ä»–å†…å®¹ï¼Œæ¯”å¦‚@Beanï¼ˆä¹Ÿä¼šè¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼‰</li></ol><h2 id="spring-bootæ•´åˆtomcatåº•å±‚åŸç†" tabindex="-1"><a class="header-anchor" href="#spring-bootæ•´åˆtomcatåº•å±‚åŸç†" aria-hidden="true">#</a> Spring Bootæ•´åˆTomcatåº•å±‚åŸç†</h2><p>é€šè¿‡å‰é¢æˆ‘ä»¬ä¼šSpringBootçš„è‡ªåŠ¨é…ç½®æœºåˆ¶ã€Starteræœºåˆ¶ã€å¯åŠ¨è¿‡ç¨‹çš„åº•å±‚åˆ†æï¼Œæˆ‘ä»¬æ‹¿ä¸€ä¸ªå®é™…çš„ä¸šåŠ¡æ¡ˆä¾‹æ¥ä¸²è®²ä¸€ä¸‹ï¼Œé‚£å°±æ˜¯SpringBootå’ŒTomcatçš„æ•´åˆã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåªè¦æˆ‘ä»¬çš„é¡¹ç›®æ·»åŠ çš„starterä¸ºï¼šspring-boot-starter-webï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯åŠ¨é¡¹ç›®æ—¶ï¼ŒSpringBootå°±ä¼šè‡ªåŠ¨å¯åŠ¨ä¸€ä¸ªTomcatã€‚</p><p>é‚£ä¹ˆè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨spring-boot-starter-webè¿™ä¸ªstarterä¸­ï¼Œå…¶å®ç®€ä»‹çš„å¼•å…¥äº†spring-boot-starter-tomcatè¿™ä¸ªstarterï¼Œè¿™ä¸ªspring-boot-starter-tomcatåˆå¼•å…¥äº†tomcat-embed-coreä¾èµ–ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬é¡¹ç›®ä¸­ä¾èµ–äº†spring-boot-starter-webå°±ç›¸å½“äºä¾èµ–äº†Tomcatã€‚</p><p>ç„¶ååœ¨SpringBootä¼—å¤šçš„è‡ªåŠ¨é…ç½®ç±»ä¸­ï¼Œæœ‰ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»å«åšServletWebServerFactoryAutoConfigurationï¼Œå®šä¹‰ä¸ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">SERVLET</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">ServerProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration<span class="token punctuation">.</span>BeanPostProcessorsRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedTomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedJetty</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedUndertow</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆçœ‹è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»æ‰€éœ€è¦çš„æ¡ä»¶ï¼š</p><ol><li>@ConditionalOnClass(ServletRequest.class)ï¼šè¡¨ç¤ºé¡¹ç›®ä¾èµ–ä¸­è¦æœ‰ServletRequestç±»ï¼ˆserver apiï¼‰</li><li>@ConditionalOnWebApplication(type = Type.SERVLET)ï¼šè¡¨ç¤ºé¡¹ç›®åº”ç”¨ç±»å‹å¾—æ˜¯SpringMVCï¼ˆè®²å¯åŠ¨è¿‡ç¨‹çš„æ—¶å€™å°±çŸ¥é“å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªSpringBootåº”ç”¨çš„ç±»å‹äº†ï¼‰</li></ol><p>åœ¨ä¸Šé¢æåˆ°çš„spring-boot-starter-webä¸­ï¼Œå…¶å®è¿˜é—´æ¥çš„å¼•å…¥äº†spring-webã€spring-webmvcç­‰ä¾èµ–ï¼Œè¿™å°±ä½¿å¾—ç¬¬äºŒä¸ªæ¡ä»¶æ»¡è¶³ï¼Œè€Œå¯¹äºç¬¬ä¸€ä¸ªæ¡ä»¶çš„ServletRequestç±»ï¼Œè™½ç„¶å®ƒæ˜¯Servletè§„èŒƒä¸­çš„ç±»ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬æ‰€ä¾èµ–çš„tomcat-embed-coreè¿™ä¸ªjaråŒ…ä¸­æ˜¯å­˜åœ¨è¿™ä¸ªç±»çš„ï¼Œè¿™æ˜¯å› ä¸ºTomcatåœ¨è‡ªå·±çš„æºç ä¸­æŠŠServletè§„èŒƒä¸­çš„ä¸€äº›ä»£ç ä¹ŸåŒ…å«è¿›å»äº†ï¼Œæ¯”å¦‚ï¼š</p><figure><img src="https://img.jssjqd.cn/202304080119223.png" alt="image-20230408011935126" tabindex="0" loading="lazy"><figcaption>image-20230408011935126</figcaption></figure><p>è¿™å°±ä½¿å¾—ServletWebServerFactoryAutoConfigurationè¿™ä¸ªè‡ªåŠ¨é…ç½®çš„ä¸¤ä¸ªæ¡ä»¶éƒ½ç¬¦åˆï¼Œé‚£ä¹ˆSpringå°±èƒ½å»è§£æå®ƒï¼Œä¸€è§£æå®ƒå°±å‘ç°è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»Importè¿›æ¥äº†ä¸‰ä¸ªç±»ï¼š</p><ol><li>ServletWebServerFactoryConfiguration.EmbeddedTomcat.class</li><li>ServletWebServerFactoryConfiguration.EmbeddedJetty.class</li><li>ServletWebServerFactoryConfiguration.EmbeddedUndertow.class</li></ol><p>å¾ˆæ˜æ˜¾ï¼ŒImportè¿›æ¥çš„è¿™ä¸‰ä¸ªç±»åº”è¯¥æ˜¯å·®ä¸å¤šï¼Œæˆ‘ä»¬çœ‹EmbeddedTomcatè¿™ä¸ªç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Tomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">UpgradeProtocol</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ServletWebServerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedTomcat</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">TomcatServletWebServerFactory</span> <span class="token function">tomcatServletWebServerFactory</span><span class="token punctuation">(</span>
        <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatConnectorCustomizer</span><span class="token punctuation">&gt;</span></span> connectorCustomizers<span class="token punctuation">,</span>
        <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatContextCustomizer</span><span class="token punctuation">&gt;</span></span> contextCustomizers<span class="token punctuation">,</span>
        <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatProtocolHandlerCustomizer</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> protocolHandlerCustomizers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TomcatServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// orderedStream()è°ƒç”¨æ—¶ä¼šå»Springå®¹å™¨ä¸­æ‰¾åˆ°TomcatConnectorCustomizerç±»å‹çš„Beanï¼Œé»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œç¨‹åºå‘˜å¯ä»¥è‡ªå·±å®šä¹‰</span>
        factory<span class="token punctuation">.</span><span class="token function">getTomcatConnectorCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>connectorCustomizers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">getTomcatContextCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>contextCustomizers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">getTomcatProtocolHandlerCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>protocolHandlerCustomizers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥å‘ç°è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œæ‰€ä»¥Springä¹Ÿä¼šæ¥è§£æå®ƒï¼Œä¸è¿‡å®ƒä¹Ÿæœ‰ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li>@ConditionalOnClass({ Servlet.class, Tomcat.class, UpgradeProtocol.class })ï¼šé¡¹ç›®ä¾èµ–ä¸­è¦æœ‰Servlet.classã€Tomcat.classã€UpgradeProtocol.classè¿™ä¸‰ä¸ªç±»ï¼Œè¿™ä¸ªæ¡ä»¶æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œé¡¹ç›®ä¾èµ–ä¸­æœ‰Tomcatçš„ç±»ï¼Œé‚£è¿™ä¸ªæ¡ä»¶å°±ç¬¦åˆã€‚</li><li>@ConditionalOnMissingBean(value = ServletWebServerFactory.class, search = SearchStrategy.CURRENT)ï¼Œé¡¹ç›®ä¸­æ²¡æœ‰ServletWebServerFactoryç±»å‹çš„Beanï¼Œå› ä¸ºè¿™ä¸ªé…ç½®ç±»çš„å†…éƒ¨å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªTomcatServletWebServerFactoryç±»å‹çš„Beanï¼ŒTomcatServletWebServerFactoryå®ç°äº†ServletWebServerFactoryæ¥å£ï¼Œæ‰€ä»¥è¿™ä¸ªæ¡ä»¶æ³¨è§£çš„æ„æ€å°±æ˜¯ï¼Œå¦‚æœç¨‹åºå‘˜è‡ªå·±æ²¡æœ‰å®šä¹‰ServletWebServerFactoryç±»å‹çš„Beanï¼Œé‚£ä¹ˆå°±ç¬¦åˆæ¡ä»¶ï¼Œä¸ç„¶ï¼Œå¦‚æœç¨‹åºå‘˜è‡ªå·±å®šä¹‰äº†ServletWebServerFactoryç±»å‹çš„Beanï¼Œé‚£ä¹ˆæ¡ä»¶å°±ä¸ç¬¦åˆï¼Œä¹Ÿå°±å¯¼è‡´SpringBootç»™æˆ‘ä»¬å®šä¹‰çš„TomcatServletWebServerFactoryè¿™ä¸ªBeanå°±ä¸ä¼šç”Ÿæ•ˆï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„å°±æ˜¯ç¨‹åºå‘˜è‡ªå·±å®šä¹‰çš„ã€‚</li></ol><p>æ‰€ä»¥ï¼Œé€šå¸¸åªè¦æˆ‘ä»¬é¡¹ç›®ä¾èµ–ä¸­æœ‰Tomcatä¾èµ–ï¼Œé‚£å°±ç¬¦åˆæ¡ä»¶ï¼Œé‚£æœ€ç»ˆSpringå®¹å™¨ä¸­å°±ä¼šæœ‰TomcatServletWebServerFactoryè¿™ä¸ªBeanã€‚</p><p>å¯¹äºå¦å¤–çš„EmbeddedJettyå’ŒEmbeddedUndertowï¼Œä¹Ÿå·®ä¸å¤šï¼Œéƒ½æ˜¯åˆ¤æ–­é¡¹ç›®ä¾èµ–ä¸­æ˜¯å¦æœ‰Jettyå’ŒUndertowçš„ä¾èµ–ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆå¯¹åº”åœ¨Springå®¹å™¨ä¸­å°±ä¼šå­˜åœ¨JettyServletWebServerFactoryç±»å‹çš„Beanã€æˆ–è€…å­˜åœ¨UndertowServletWebServerFactoryç±»å‹çš„Beanã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><ol><li>æœ‰Tomcatä¾èµ–ï¼Œå°±æœ‰TomcatServletWebServerFactoryè¿™ä¸ªBean</li><li>æœ‰Jettyä¾èµ–ï¼Œå°±æœ‰JettyServletWebServerFactoryè¿™ä¸ªBean</li><li>æœ‰Undertowä¾èµ–ï¼Œå°±æœ‰UndertowServletWebServerFactoryè¿™ä¸ªBean</li></ol><p>é‚£ä¹ˆSpringBootç»™æˆ‘ä»¬é…ç½®çš„è¿™å‡ ä¸ªBeanåˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å‰é¢è¯´åˆ°ï¼ŒTomcatServletWebServerFactoryå®ç°äº†ServletWebServerFactoryè¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£çš„å®šä¹‰ä¸ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ServletWebServerFactory</span> <span class="token punctuation">{</span>
    <span class="token class-name">WebServer</span> <span class="token function">getWebServer</span><span class="token punctuation">(</span><span class="token class-name">ServletContextInitializer</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> initializers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WebServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">WebServerException</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">WebServerException</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å‘ç°ServletWebServerFactoryå…¶å®å°±æ˜¯ç”¨æ¥è·å¾—WebServerå¯¹è±¡çš„ï¼Œè€ŒWebServeræ‹¥æœ‰å¯åŠ¨ã€åœæ­¢ã€è·å–ç«¯å£ç­‰æ–¹æ³•ï¼Œé‚£ä¹ˆå¾ˆè‡ªç„¶ï¼Œæˆ‘ä»¬å°±å‘ç°WebServerå…¶å®æŒ‡çš„å°±æ˜¯Tomcatã€Jettyã€Undertowï¼Œè€ŒTomcatServletWebServerFactoryå°±æ˜¯ç”¨æ¥ç”ŸæˆTomcatæ‰€å¯¹åº”çš„WebServerå¯¹è±¡ï¼Œå…·ä½“ä¸€ç‚¹å°±æ˜¯TomcatWebServerå¯¹è±¡ï¼Œå¹¶ä¸”åœ¨ç”ŸæˆTomcatWebServerå¯¹è±¡æ—¶ä¼šæŠŠTomcatç»™å¯åŠ¨èµ·æ¥ï¼Œåœ¨æºç ä¸­ï¼Œè°ƒç”¨TomcatServletWebServerFactoryå¯¹è±¡çš„getWebServer()æ–¹æ³•æ—¶å°±ä¼šå¯åŠ¨Tomcatã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹TomcatServletWebServerFactoryè¿™ä¸ªBeançš„å®šä¹‰ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">TomcatServletWebServerFactory</span> <span class="token function">tomcatServletWebServerFactory</span><span class="token punctuation">(</span>
    <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatConnectorCustomizer</span><span class="token punctuation">&gt;</span></span> connectorCustomizers<span class="token punctuation">,</span>
    <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatContextCustomizer</span><span class="token punctuation">&gt;</span></span> contextCustomizers<span class="token punctuation">,</span>
    <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatProtocolHandlerCustomizer</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> protocolHandlerCustomizers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">TomcatServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// orderedStream()è°ƒç”¨æ—¶ä¼šå»Springå®¹å™¨ä¸­æ‰¾åˆ°TomcatConnectorCustomizerç±»å‹çš„Beanï¼Œé»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œç¨‹åºå‘˜å¯ä»¥è‡ªå·±å®šä¹‰</span>
    factory<span class="token punctuation">.</span><span class="token function">getTomcatConnectorCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>connectorCustomizers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">getTomcatContextCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>contextCustomizers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">getTomcatProtocolHandlerCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>protocolHandlerCustomizers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¦æ„é€ è¿™ä¸ªBeanï¼ŒSpringä¼šä»Springå®¹å™¨ä¸­è·å–åˆ°TomcatConnectorCustomizerã€TomcatContextCustomizerã€TomcatProtocolHandlerCustomizerè¿™ä¸‰ä¸ªç±»å‹çš„Beanï¼Œç„¶åæŠŠå®ƒä»¬æ·»åŠ åˆ°TomcatServletWebServerFactoryå¯¹è±¡ä¸­å»ï¼Œå¾ˆæ˜æ˜¾è¿™ä¸‰ç§Beanæ˜¯ç”¨æ¥é…ç½®Tomcatçš„ï¼Œæ¯”å¦‚ï¼š</p><ol><li>TomcatConnectorCustomizerï¼šæ˜¯ç”¨æ¥é…ç½®Tomcatä¸­çš„Connectorç»„ä»¶çš„</li><li>TomcatContextCustomizerï¼šæ˜¯ç”¨æ¥é…ç½®Tomcatä¸­çš„Contextç»„ä»¶çš„</li><li>TomcatProtocolHandlerCustomizerï¼šæ˜¯ç”¨æ¥é…ç½®Tomcatä¸­çš„ProtocolHandlerç»„ä»¶çš„</li></ol><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰TomcatConnectorCustomizerç±»å‹çš„Beanï¼Œæ¥å¯¹Tomcatè¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TomcatConnectorCustomizer</span> <span class="token function">tomcatConnectorCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TomcatConnectorCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">Connector</span> connector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                connector<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·Tomcatå°±ä¼šç»‘å®š8888è¿™ä¸ªç«¯å£ã€‚</p><p>æœ‰äº†TomcatServletWebServerFactoryè¿™ä¸ªBeanä¹‹åï¼Œåœ¨SpringBootçš„å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šæ‰§è¡ŒServletWebServerApplicationContextçš„onRefresh()æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨createWebServer()æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä¸­æœ€ä¸ºé‡è¦çš„ä¸¤è¡Œä»£ç ä¸ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token function">getWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>webServer <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getWebServer</span><span class="token punctuation">(</span><span class="token function">getSelfInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾ˆæ˜æ˜¾ï¼ŒgetWebServerFactory()è´Ÿè´£è·å–å…·ä½“çš„ServletWebServerFactoryå¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯TomcatServletWebServerFactoryå¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯JettyServletWebServerFactoryå¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯UndertowServletWebServerFactoryå¯¹è±¡ï¼Œæ³¨æ„åªèƒ½è·å–åˆ°ä¸€ä¸ªï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡çš„getWebServeræ–¹æ³•ï¼Œå¯åŠ¨å¯¹åº”çš„Tomcatã€æˆ–è€…Jettyã€æˆ–è€…Undertowã€‚</p><p>getWebServerFactoryæ–¹æ³•ä¸­çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œè·å–Springå®¹å™¨ä¸­çš„ServletWebServerFactoryç±»å‹çš„Beanå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰è·å–åˆ°åˆ™æŠ›å¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªä¹ŸæŠ›å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯åœ¨Springå®¹å™¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªServletWebServerFactoryç±»å‹çš„Beanå¯¹è±¡ã€‚</p><p>æ‹¿åˆ°TomcatServletWebServerFactoryå¯¹è±¡åï¼Œå°±è°ƒç”¨å®ƒçš„getWebServeræ–¹æ³•ï¼Œè€Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°±ä¼šç”Ÿæˆä¸€ä¸ªTomcatå¯¹è±¡ï¼Œå¹¶ä¸”åˆ©ç”¨å‰é¢çš„TomcatConnectorCustomizerç­‰ç­‰ä¼šTomcatå¯¹è±¡è¿›è¡Œé…ç½®ï¼Œæœ€åå¯åŠ¨Tomcatã€‚</p><p>è¿™æ ·åœ¨å¯åŠ¨åº”ç”¨æ—¶å°±å®Œæˆäº†Tomcatçš„å¯åŠ¨ï¼Œåˆ°æ­¤æˆ‘ä»¬é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ä¹Ÿçœ‹åˆ°äº†å…·ä½“çš„Starteræœºåˆ¶ã€è‡ªåŠ¨é…ç½®çš„å…·ä½“ä½¿ç”¨ã€‚</p><p>ä¸è¿‡é¢å¤–æœ‰ä¸€ç‚¹è¦æä¸€ä¸‹ï¼Œæˆ‘ä»¬å‰é¢æåˆ°äº†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨TomcatConnectorCustomizerå¯¹Tomcaä¸­çš„Connectorç»„ä»¶è¿›è¡Œé…ç½®ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringBootæ˜¯ä¸æ˜¯å°±æ˜¯æä¾›äº†ä¸€ä¸ªTomcatConnectorCustomizerçš„Beanï¼Œç„¶åç»™Connectoré…ç½®äº†8080ç«¯å£ï¼Œæˆ–è€…ä»Environmentå¯¹è±¡ä¸­è·å–server.porté…ç½®ï¼Œå¹¶è®¾ç½®åˆ°Connectorä¸­å»å‘¢ï¼Ÿ</p><p>å¹¶ä¸æ˜¯ï¼Œå› ä¸ºå¦‚æœSpringBootè¿™ä¹ˆå®ç°ï¼Œé‚£ä¹ˆé»˜è®¤å°±å¾—æä¾›ä¸‰ä¸ªConnectorCustomizerçš„Beanï¼Œä¸€ä¸ªTomcatConnectorCustomizerã€ä¸€ä¸ªJettyConnectorCustomizerã€ä¸€ä¸ªUndertowConnectorCustomizerï¼Œè¿™æ˜¯æ¯”è¾ƒä¸æ°å½“çš„ï¼Œæˆ‘ä»¬çŸ¥é“é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ç®¡æˆ‘ä»¬æ˜¯ç”¨Tomcatï¼Œè¿˜æ˜¯Jettyï¼Œè¿˜æ˜¯Undertowï¼Œå®ƒä»¬å¯åŠ¨æ—¶ç»‘å®šçš„éƒ½æ˜¯8080ç«¯å£ï¼Œä¹Ÿå°±æ˜¯è¯´SpringBootå¹¶ä¸ä¼šæ ¹æ®ä¸åŒçš„WebServerè®¾ç½®ä¸åŒçš„ç«¯å£ï¼Œä¹Ÿå°±æ˜¯è¯´SpringBootåªä¼šç»™WebServerè®¾ç½®ç«¯å£ï¼Œè€Œä¸ä¼šåŒºåˆ†WebServerçš„ä¸åŒå®ç°ã€‚</p><p>æ‰€ä»¥åœ¨è‡ªåŠ¨é…ç½®ç±»ServletWebServerFactoryAutoConfigurationä¸­ï¼Œä¼šå®šä¹‰ä¸€ä¸ªServletWebServerFactoryCustomizerç±»å‹çš„Beanï¼Œå®šä¹‰ä¸ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletWebServerFactoryCustomizer</span>
    <span class="token function">servletWebServerFactoryCustomizer</span><span class="token punctuation">(</span><span class="token class-name">ServerProperties</span> serverProperties<span class="token punctuation">,</span>
                                      <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebListenerRegistrar</span><span class="token punctuation">&gt;</span></span> webListenerRegistrars<span class="token punctuation">,</span>
                                      <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CookieSameSiteSupplier</span><span class="token punctuation">&gt;</span></span> cookieSameSiteSuppliers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServletWebServerFactoryCustomizer</span><span class="token punctuation">(</span>serverProperties<span class="token punctuation">,</span>
                webListenerRegistrars<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                cookieSameSiteSuppliers<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªBeanä¼šæ¥æ”¶ä¸€ä¸ªServerPropertiesçš„Beanï¼ŒServerPropertiesçš„Beanå¯¹åº”çš„å°±æ˜¯propertiesæ–‡ä»¶ä¸­å‰ç¼€ä¸ºserverçš„é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ServerPropertieså¯¹è±¡çš„getPortæ–¹æ³•è·å–åˆ°æˆ‘ä»¬æ‰€é…ç½®çš„server.portçš„å€¼ã€‚</p><p>è€ŒServletWebServerFactoryCustomizeræ˜¯é’ˆå¯¹ä¸€ä¸ªServletWebServerFactoryçš„è‡ªå®šä¹‰å™¨ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥é…ç½®TomcatServletWebServerFactoryè¿™ä¸ªBeançš„ï¼Œåˆ°æ—¶å€™ServletWebServerFactoryCustomizerå°±ä¼šåˆ©ç”¨ServerPropertieså¯¹è±¡æ¥å¯¹TomcatServletWebServerFactoryå¯¹è±¡è¿›è¡Œè®¾ç½®ã€‚</p><p>åœ¨ServletWebServerFactoryAutoConfigurationè¿™ä¸ªè‡ªåŠ¨é…ç½®ä¸Šï¼Œé™¤å¼€Importäº†EmbeddedTomcatã€EmbeddedJettyã€EmbeddedUndertowè¿™ä¸‰ä¸ªé…ç½®ç±»ï¼Œè¿˜Importäº†ä¸€ä¸ªServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.classï¼Œè¿™ä¸ªBeanPostProcessorsRegistrarä¼šå‘Springå®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªWebServerFactoryCustomizerBeanPostProcessorç±»å‹çš„Beanã€‚</p><p>WebServerFactoryCustomizerBeanPostProcessoræ˜¯ä¸€ä¸ªBeanPosrtProcessorï¼Œå®ƒä¸“é—¨ç”¨æ¥å¤„ç†ç±»å‹ä¸ºWebServerFactoryçš„Beanå¯¹è±¡ï¼Œè€Œæˆ‘ä»¬çš„TomcatServletWebServerFactoryã€JettyServletWebServerFactoryã€UndertowServletWebServerFactoryä¹Ÿéƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä¸ç®¡å½“å‰é¡¹ç›®ä¾èµ–çš„æƒ…å†µï¼Œåªè¦åœ¨Springåœ¨åˆ›å»ºæ¯”å¦‚TomcatServletWebServerFactoryè¿™ä¸ªBeanæ—¶ï¼ŒWebServerFactoryCustomizerBeanPostProcessorå°±ä¼šå¯¹å®ƒè¿›è¡Œå¤„ç†ï¼Œå¤„ç†çš„é€»è¾‘ä¸ºï¼š</p><ol><li>ä»Springå®¹å™¨ä¸­æ‹¿åˆ°WebServerFactoryCustomizerç±»å‹çš„Beanï¼Œä¹Ÿå°±æ˜¯å‰é¢è¯´çš„ServletWebServerFactoryCustomizerå¯¹è±¡</li><li>ç„¶åè°ƒç”¨ServletWebServerFactoryCustomizerå¯¹è±¡çš„customizeæ–¹æ³•ï¼ŒæŠŠTomcatServletWebServerFactoryå¯¹è±¡ä¼ å…¥è¿›å»</li><li>customizeæ–¹æ³•ä¸­å°±ä¼šä»ServerPropertieså¯¹è±¡è·å–å„ç§é…ç½®ï¼Œç„¶åè®¾ç½®ç»™TomcatServletWebServerFactoryå¯¹è±¡</li></ol><p>æ¯”å¦‚ï¼š</p><figure><img src="https://img.jssjqd.cn/202304080126723.png" alt="image-20230408012650676" tabindex="0" loading="lazy"><figcaption>image-20230408012650676</figcaption></figure><p>è¿™æ ·å½“TomcatServletWebServerFactoryè¿™ä¸ªBeanå¯¹è±¡åˆ›å»ºå®Œæˆåï¼Œå®ƒé‡Œé¢çš„å¾ˆå¤šå±æ€§ï¼Œæ¯”å¦‚portï¼Œå°±å·²ç»æ˜¯ç¨‹åºå‘˜æ‰€é…ç½®çš„å€¼äº†ï¼Œåç»­æ‰§è¡ŒgetWebServeræ–¹æ³•æ—¶ï¼Œå°±ç›´æ¥è·å–è‡ªå·±çš„å±æ€§ï¼Œæ¯”å¦‚portå±æ€§ï¼Œè®¾ç½®ç»™Tomcatï¼Œç„¶åå†åˆ©ç”¨TomcatConnectorCustomizerç­‰ä¼šä¸‹è¿›è¡Œå¤„ç†ï¼Œæœ€åå¯åŠ¨Tomcatã€‚</p><p>åˆ°æ­¤ï¼ŒSpringBootæ•´åˆTomcatçš„æ ¸å¿ƒåŸç†å°±åˆ†æå®Œäº†ï¼Œä¸»è¦æ¶‰åŠçš„ä¸œè¥¿æœ‰ï¼š</p><ol><li>spring-boot-starter-webï¼šä¼šè‡ªåŠ¨å¼•å…¥Tomcatã€SpringMVCçš„ä¾èµ–</li><li>ServletWebServerFactoryAutoConfigurationï¼šè‡ªåŠ¨é…ç½®ç±»</li><li>ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrarï¼šç”¨æ¥æ³¨å†ŒWebServerFactoryCustomizerBeanPostProcessor</li><li>ServletWebServerFactoryConfiguration.EmbeddedTomcatï¼šé…ç½®TomcatServletWebServerFactory</li><li>ServletWebServerFactoryConfiguration.EmbeddedJettyï¼šé…ç½®JettyServletWebServerFactory</li><li>ServletWebServerFactoryConfiguration.EmbeddedUndertowï¼šé…ç½®UndertowServletWebServerFactory</li><li>ServletWebServerFactoryCustomizerï¼šç”¨æ¥é…ç½®ServletWebServerFactory</li><li>WebServerFactoryCustomizerBeanPostProcessorï¼šæ˜¯ä¸€ä¸ªBeanPostProcessorï¼Œåˆ©ç”¨ServletWebServerFactoryCustomizeræ¥é…ç½®ServletWebServerFactory</li><li>ServletWebServerApplicationContextä¸­çš„onRefresh()æ–¹æ³•ï¼šè´Ÿè´£å¯åŠ¨Tomcat</li></ol><p>SpringBootä¸­çš„åº•å±‚åŸç†å®ç°ä¸­ï¼Œæ¡ä»¶æ³¨è§£æ—¶éå¸¸é‡è¦çš„ï¼Œå› ä¸ºæ¡ä»¶æ³¨è§£ç›´æ¥å†³å®šäº†ä¸€ä¸ªBeanåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹æ‰ä¼šç”Ÿæ•ˆï¼Œå‰é¢å·²ç»æ•´ç†è¿‡äº†SpringBootä¸­æœ‰å“ªäº›æ¡ä»¶æ³¨è§£ï¼Œè¿™é‡Œå°±ä¸å†é‡å¤ï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥çœ‹çœ‹éå¸¸æ ¸å¿ƒçš„ä¸¤ä¸ªæ¡ä»¶æ³¨è§£@ConditionalOnClasså’Œ@ConditionalOnBeançš„åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h2 id="è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£" aria-hidden="true">#</a> è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£</h2><p>SpringBootä¸­ä¼—å¤šçš„æ¡ä»¶æ³¨è§£ï¼Œéƒ½æ˜¯åŸºäºSpringä¸­çš„@Conditionalæ¥å®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥ç”¨ä¸€ä¸‹@Conditionalæ³¨è§£ã€‚</p><p>å…ˆæ¥çœ‹ä¸‹@Conditionalæ³¨è§£çš„å®šä¹‰ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Conditional</span> <span class="token punctuation">{</span>
    
    <span class="token doc-comment comment">/**
    * All <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Condition</span></span><span class="token punctuation">}</span> classes that must <span class="token punctuation">{</span><span class="token keyword">@linkplain</span> <span class="token reference"><span class="token class-name">Condition</span><span class="token punctuation">#</span><span class="token field">matches</span></span> match<span class="token punctuation">}</span>
    * in order for the component to be registered.
    */</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Condition</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ®å®šä¹‰æˆ‘ä»¬åœ¨ç”¨@Conditionalæ³¨è§£æ—¶ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªConditionçš„å®ç°ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥æä¾›ä¸€ä¸ªå®ç°ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuCondition</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨matchesæ–¹æ³•ä¸­æ¥å®šä¹‰æ¡ä»¶é€»è¾‘ï¼š</p><ol><li>ConditionContextï¼šè¡¨ç¤ºæ¡ä»¶ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥é€šè¿‡ConditionContextè·å–åˆ°å½“å‰çš„ç±»åŠ è½½å™¨ã€BeanFactoryã€Environmentç¯å¢ƒå˜é‡å¯¹è±¡</li><li>AnnotatedTypeMetadataï¼šè¡¨ç¤ºå½“å‰æ­£åœ¨è¿›è¡Œæ¡ä»¶åˆ¤æ–­çš„Beanæ‰€å¯¹åº”çš„ç±»ä¿¡æ¯ï¼Œæˆ–æ–¹æ³•ä¿¡æ¯ï¼ˆæ¯”å¦‚@Beanå®šä¹‰çš„ä¸€ä¸ªBeanï¼‰ï¼Œå¯ä»¥é€šè¿‡AnnotatedTypeMetadataè·å–åˆ°å½“å‰ç±»æˆ–æ–¹æ³•ç›¸å…³çš„ä¿¡æ¯ï¼Œä»è€Œå°±å¯ä»¥æ‹¿åˆ°æ¡ä»¶æ³¨è§£çš„ä¿¡æ¯ï¼Œå½“ç„¶å¦‚æœä¸€ä¸ªBeanä¸Šä½¿ç”¨äº†å¤šä¸ªæ¡ä»¶æ³¨è§£ï¼Œé‚£ä¹ˆåœ¨è§£æè¿‡ç¨‹ä¸­éƒ½å¯ä»¥è·å–åˆ°ï¼ŒåŒæ—¶ä¹Ÿèƒ½è·å–Beanä¸Šå®šä¹‰çš„å…¶ä»–æ³¨è§£ä¿¡æ¯</li></ol><p>äº†è§£è¿™äº›ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹@ConditionalOnClassæ˜¯å¦‚ä½•å·¥ä½œçš„</p><h2 id="conditionalonclassçš„åº•å±‚å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#conditionalonclassçš„åº•å±‚å·¥ä½œåŸç†" aria-hidden="true">#</a> @ConditionalOnClassçš„åº•å±‚å·¥ä½œåŸç†</h2><p>å…ˆæ¥çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;com.zhouyu.Jetty&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingClass</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;com.zhouyu.Tomcat&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuConfiguration</span> <span class="token punctuation">{</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åœ¨ZhouyuConfigurationè¿™ä¸ªç±»ä¸Šä½¿ç”¨äº†ä¸¤ä¸ªæ¡ä»¶æ³¨è§£ï¼š</p><ol><li>@ConditionalOnClass(name = &quot;com.zhouyu.Jetty&quot;)ï¼šæ¡ä»¶æ˜¯é¡¹ç›®ä¾èµ–ä¸­<strong>å­˜åœ¨</strong>&quot;com.zhouyu.Jetty&quot;è¿™ä¸ªç±»ï¼Œåˆ™è¡¨ç¤ºç¬¦åˆæ¡ä»¶</li><li>@ConditionalOnMissingClass(value = &quot;com.zhouyu.Tomcat&quot;)ï¼šæ¡ä»¶æ˜¯é¡¹ç›®ä¾èµ–ä¸­<strong>ä¸å­˜åœ¨</strong>&quot;com.zhouyu.Tomcat&quot;è¿™ä¸ªç±»ï¼Œåˆ™è¡¨ç¤ºç¬¦åˆæ¡ä»¶</li></ol><p>è¿™ä¸¤ä¸ªæ³¨è§£å¯¹åº”çš„éƒ½æ˜¯**@Conditional(OnClassCondition.class)**ï¼Œé‚£åœ¨OnClassConditionç±»ä¸­æ˜¯å¦‚ä½•å¯¹è¿™ä¸¤ä¸ªæ³¨è§£è¿›è¡ŒåŒºåˆ†çš„å‘¢ï¼Ÿ</p><p>Springåœ¨è§£æåˆ°ZhouyuConfigurationè¿™ä¸ªé…ç½®æ—¶ï¼Œå‘ç°è¯¥ç±»ä¸Šç”¨åˆ°äº†æ¡ä»¶æ³¨è§£å°±ä¼šè¿›è¡Œæ¡ä»¶è§£æï¼Œç›¸å…³æºç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Condition</span> condition <span class="token operator">:</span> conditions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ConfigurationPhase</span> requiredPhase <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>condition <span class="token keyword">instanceof</span> <span class="token class-name">ConfigurationCondition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        requiredPhase <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ConfigurationCondition</span><span class="token punctuation">)</span> condition<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConfigurationPhase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// é‡ç‚¹åœ¨è¿™</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>requiredPhase <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> requiredPhase <span class="token operator">==</span> phase<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>condition<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>conditionsä¸­ä¿å­˜äº†ä¸¤ä¸ªOnClassConditionå¯¹è±¡ï¼Œè¿™æ®µä»£ç ä¼šä¾æ¬¡è°ƒç”¨OnClassConditionå¯¹è±¡çš„matchesæ–¹æ³•è¿›è¡Œæ¡ä»¶åŒ¹é…ï¼Œä¸€æ—¦æŸä¸€ä¸ªæ¡ä»¶ä¸åŒ¹é…å°±ä¸ä¼šè¿›è¡Œä¸‹ä¸€ä¸ªæ¡ä»¶çš„åˆ¤æ–­äº†ï¼Œè¿™é‡Œreturnçš„æ˜¯trueï¼Œä½†æ˜¯è¿™æ®µä»£ç æ‰€åœ¨çš„æ–¹æ³•å«åšshouldSkipï¼Œæ‰€ä»¥trueè¡¨ç¤ºå¿½ç•¥ã€‚</p><p>æˆ‘ä»¬ç»§ç»­çœ‹OnClassConditionçš„matches()æ–¹æ³•çš„å®ç°ã€‚</p><p>OnClassConditionç±»ç»§æ‰¿äº†FilteringSpringBootConditionï¼ŒFilteringSpringBootConditionç±»åˆç»§æ‰¿äº†SpringBootConditionï¼Œè€ŒSpringBootConditionå®ç°äº†Conditionæ¥å£ï¼Œmatches()æ–¹æ³•ä¹Ÿæ˜¯åœ¨SpringBootConditionè¿™ä¸ªç±»ä¸­å®ç°çš„ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å–å½“å‰è§£æçš„ç±»åæˆ–æ–¹æ³•å</span>
    <span class="token class-name">String</span> classOrMethodName <span class="token operator">=</span> <span class="token function">getClassOrMethodName</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿›è¡Œå…·ä½“çš„æ¡ä»¶åŒ¹é…ï¼ŒConditionOutcomeè¡¨ç¤ºåŒ¹é…ç»“æœ</span>
        <span class="token class-name">ConditionOutcome</span> outcome <span class="token operator">=</span> <span class="token function">getMatchOutcome</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// æ—¥å¿—è®°å½•åŒ¹é…ç»“æœ</span>
        <span class="token function">logOutcome</span><span class="token punctuation">(</span>classOrMethodName<span class="token punctuation">,</span> outcome<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">recordEvaluation</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> classOrMethodName<span class="token punctuation">,</span> outcome<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// è¿”å›trueæˆ–false</span>
        <span class="token keyword">return</span> outcome<span class="token punctuation">.</span><span class="token function">isMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoClassDefFoundError</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥å…·ä½“çš„æ¡ä»¶åŒ¹é…é€»è¾‘åœ¨getMatchOutcomeæ–¹æ³•ä¸­ï¼Œè€ŒSpringBootConditionç±»ä¸­çš„getMatchOutcomeæ–¹æ³•æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°é€»è¾‘å°±åœ¨å­ç±»OnClassConditionä¸­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ConditionOutcome</span> <span class="token function">getMatchOutcome</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ConditionMessage</span> matchMessage <span class="token operator">=</span> <span class="token class-name">ConditionMessage</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// æ‹¿åˆ°ConditionalOnClassæ³¨è§£ä¸­çš„valueå€¼ï¼Œä¹Ÿå°±æ˜¯è¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨çš„ç±»å</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> onClasses <span class="token operator">=</span> <span class="token function">getCandidates</span><span class="token punctuation">(</span>metadata<span class="token punctuation">,</span> <span class="token class-name">ConditionalOnClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>onClasses <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ¤æ–­onClassesä¸­ä¸å­˜åœ¨çš„ç±»</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> missing <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>onClasses<span class="token punctuation">,</span> <span class="token class-name">ClassNameFilter</span><span class="token punctuation">.</span><span class="token constant">MISSING</span><span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœæœ‰ç¼ºå¤±çš„ç±»ï¼Œé‚£å°±è¡¨ç¤ºä¸åŒ¹é…</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>missing<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">.</span><span class="token function">noMatch</span><span class="token punctuation">(</span><span class="token class-name">ConditionMessage</span><span class="token punctuation">.</span><span class="token function">forCondition</span><span class="token punctuation">(</span><span class="token class-name">ConditionalOnClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                                            <span class="token punctuation">.</span><span class="token function">didNotFind</span><span class="token punctuation">(</span><span class="token string">&quot;required class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;required classes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token class-name">Style</span><span class="token punctuation">.</span><span class="token constant">QUOTE</span><span class="token punctuation">,</span> missing<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å¦åˆ™å°±è¡¨ç¤ºåŒ¹é…</span>
        matchMessage <span class="token operator">=</span> matchMessage<span class="token punctuation">.</span><span class="token function">andCondition</span><span class="token punctuation">(</span><span class="token class-name">ConditionalOnClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">found</span><span class="token punctuation">(</span><span class="token string">&quot;required class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;required classes&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token class-name">Style</span><span class="token punctuation">.</span><span class="token constant">QUOTE</span><span class="token punctuation">,</span> <span class="token function">filter</span><span class="token punctuation">(</span>onClasses<span class="token punctuation">,</span> <span class="token class-name">ClassNameFilter</span><span class="token punctuation">.</span><span class="token constant">PRESENT</span><span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å’Œä¸Šé¢ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯åˆ¤æ–­onMissingClassesæ˜¯ä¸æ˜¯å…¨éƒ¨ç¼ºå¤±ï¼Œå¦‚æœæ˜¯åˆ™è¡¨ç¤ºåŒ¹é…</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> onMissingClasses <span class="token operator">=</span> <span class="token function">getCandidates</span><span class="token punctuation">(</span>metadata<span class="token punctuation">,</span> <span class="token class-name">ConditionalOnMissingClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>onMissingClasses <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> present <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>onMissingClasses<span class="token punctuation">,</span> <span class="token class-name">ClassNameFilter</span><span class="token punctuation">.</span><span class="token constant">PRESENT</span><span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>present<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">.</span><span class="token function">noMatch</span><span class="token punctuation">(</span><span class="token class-name">ConditionMessage</span><span class="token punctuation">.</span><span class="token function">forCondition</span><span class="token punctuation">(</span><span class="token class-name">ConditionalOnMissingClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                                            <span class="token punctuation">.</span><span class="token function">found</span><span class="token punctuation">(</span><span class="token string">&quot;unwanted class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;unwanted classes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token class-name">Style</span><span class="token punctuation">.</span><span class="token constant">QUOTE</span><span class="token punctuation">,</span> present<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        matchMessage <span class="token operator">=</span> matchMessage<span class="token punctuation">.</span><span class="token function">andCondition</span><span class="token punctuation">(</span><span class="token class-name">ConditionalOnMissingClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">didNotFind</span><span class="token punctuation">(</span><span class="token string">&quot;unwanted class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;unwanted classes&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token class-name">Style</span><span class="token punctuation">.</span><span class="token constant">QUOTE</span><span class="token punctuation">,</span> <span class="token function">filter</span><span class="token punctuation">(</span>onMissingClasses<span class="token punctuation">,</span> <span class="token class-name">ClassNameFilter</span><span class="token punctuation">.</span><span class="token constant">MISSING</span><span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">ConditionOutcome</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>matchMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨getMatchOutcomeæ–¹æ³•ä¸­çš„é€»è¾‘ä¸ºï¼š</p><ol><li>å¦‚æœç±»æˆ–æ–¹æ³•ä¸Šæœ‰@ConditionalOnClassæ³¨è§£ï¼Œåˆ™è·å–@ConditionalOnClassæ³¨è§£ä¸­çš„valueå±æ€§ï¼Œä¹Ÿå°±æ˜¯è¦åˆ¤æ–­æ˜¯å¦<strong>å­˜åœ¨çš„ç±»å</strong></li><li>åˆ©ç”¨ClassNameFilter.MISSINGæ¥åˆ¤æ–­è¿™äº›ç±»æ˜¯å¦ç¼ºå¤±ï¼ŒæŠŠç¼ºå¤±çš„ç±»çš„ç±»åå­˜å…¥missingé›†åˆ</li><li>å¦‚æœmissingä¸ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºæœ‰ç±»ç¼ºå¤±ï¼Œåˆ™è¡¨ç¤ºä¸åŒ¹é…ï¼Œå¹¶åˆ©ç”¨ConditionMessageè®°å½•å“ªäº›ç±»æ˜¯ç¼ºå¤±çš„ï¼Œç›´æ¥returnï¼Œè¡¨ç¤ºæ¡ä»¶ä¸åŒ¹é…</li><li>å¦åˆ™ï¼Œåˆ™è¡¨ç¤ºæ¡ä»¶åŒ¹é…ï¼Œç»§ç»­æ‰§è¡Œä»£ç </li><li>å¦‚æœç±»æˆ–æ–¹æ³•ä¸Šæœ‰ConditionalOnMissingClassæ³¨è§£ï¼Œåˆ™è·å–ConditionalOnMissingClassæ³¨è§£ä¸­çš„valueå±æ€§ï¼Œä¹Ÿå°±æ˜¯è¦åˆ¤æ–­æ˜¯å¦<strong>ç¼ºå¤±çš„ç±»å</strong></li><li>åˆ©ç”¨ClassNameFilter.PRESENTæ¥åˆ¤æ–­è¿™äº›ç±»æ˜¯å¦å­˜åœ¨ï¼ŒæŠŠå­˜åœ¨çš„ç±»çš„ç±»åå­˜å…¥presenté›†åˆ</li><li>å¦‚æœpresentä¸ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºæœ‰ç±»å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºä¸åŒ¹é…ï¼Œå¹¶åˆ©ç”¨ConditionMessageè®°å½•å“ªäº›ç±»æ˜¯å­˜åœ¨çš„ï¼Œç›´æ¥returnï¼Œè¡¨ç¤ºæ¡ä»¶ä¸åŒ¹é…</li><li>å¦åˆ™ï¼Œåˆ™è¡¨ç¤ºæ¡ä»¶åŒ¹é…ï¼Œç»§ç»­æ‰§è¡Œä»£ç </li><li>returnï¼Œè¡¨ç¤ºæ¡ä»¶åŒ¹é…</li></ol><p>å› ä¸ºConditionalOnClassæ³¨è§£å’ŒConditionalOnMissingClassæ³¨è§£çš„é€»è¾‘æ˜¯æ¯”è¾ƒç±»ä¼¼çš„ï¼Œæ‰€ä»¥åœ¨æºç ä¸­éƒ½æ˜¯åœ¨OnClassConditionè¿™ä¸ªç±»ä¸­å®ç°çš„ï¼Œå‡å¦‚ä¸€ä¸ªç±»ä¸Šå³æœ‰@ConditionalOnClassï¼Œä¹Ÿæœ‰@ConditionalOnMissingClassï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">Tomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingClass</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;com.zhouyu.Tomcat&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuConfiguration</span> <span class="token punctuation">{</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>å¦‚æœ@ConditionalOnClassæ¡ä»¶åŒ¹é…ã€@ConditionalOnMissingClassæ¡ä»¶ä¹ŸåŒ¹é…ï¼Œé‚£ä¹ˆgetMatchOutcomeæ–¹æ³•ä¼šæ‰§è¡Œä¸¤æ¬¡</li><li>å¦‚æœ@ConditionalOnClassæ¡ä»¶ä¸åŒ¹é…ï¼Œé‚£ä¹ˆgetMatchOutcomeæ–¹æ³•ä¼šæ‰§è¡Œä¸€æ¬¡</li><li>å¦‚æœ@ConditionalOnClassæ¡ä»¶åŒ¹é…ã€@ConditionalOnMissingClassæ¡ä»¶ä¸åŒ¹é…ï¼Œé‚£ä¹ˆgetMatchOutcomeæ–¹æ³•ä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºåœ¨getMatchOutcomeæ–¹æ³•å¤„ç†äº†è¿™ç§æƒ…å†µ</li></ol><p>ä¸Šé¢æåˆ°çš„ClassNameFilter.MISSINGå’ŒClassNameFilter.PRESENTä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>protected enum ClassNameFilter {

        PRESENT {

            @Override
            public boolean matches(String className, ClassLoader classLoader) {
                return isPresent(className, classLoader);
            }

        },

        MISSING {

            @Override
            public boolean matches(String className, ClassLoader classLoader) {
                return !isPresent(className, classLoader);
            }

        };

        abstract boolean matches(String className, ClassLoader classLoader);

        static boolean isPresent(String className, ClassLoader classLoader) {
            if (classLoader == null) {
                classLoader = ClassUtils.getDefaultClassLoader();
            }
            try {
                resolve(className, classLoader);
                return true;
            }
            catch (Throwable ex) {
                return false;
            }
        }

    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>protected static Class&lt;?&gt; resolve(String className, ClassLoader classLoader) throws ClassNotFoundException {
    if (classLoader != null) {
        return Class.forName(className, false, classLoader);
    }
    return Class.forName(className);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸»è¦å°±æ˜¯ç”¨ç±»åŠ è½½å™¨ï¼Œæ¥åˆ¤æ–­ç±»æ˜¯å¦å­˜åœ¨ã€‚</p><h2 id="conditionalonbeançš„åº•å±‚å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#conditionalonbeançš„åº•å±‚å·¥ä½œåŸç†" aria-hidden="true">#</a> @ConditionalOnBeançš„åº•å±‚å·¥ä½œåŸç†</h2><p>@ConditionalOnBeanå’Œ@ConditionalOnClassçš„åº•å±‚å®ç°åº”è¯¥æ˜¯å·®ä¸å¤šçš„ï¼Œä¸€ä¸ªæ˜¯åˆ¤æ–­Beanå­˜ä¸å­˜åœ¨ï¼Œä¸€ä¸ªæ˜¯åˆ¤æ–­ç±»å­˜ä¸å­˜åœ¨ï¼Œäº‹å®ä¸Šä¹Ÿç¡®å®å·®ä¸å¤šã€‚</p><p>é¦–å…ˆ@ConditionalOnBeanå’Œ@ConditionalOnMissingBeanå¯¹åº”çš„éƒ½æ˜¯OnBeanConditionç±»ï¼ŒOnBeanConditionç±»ä¹Ÿæ˜¯ç»§æ‰¿äº†SpringBootConditionï¼Œæ‰€ä»¥SpringBootConditionç±»ä¸­çš„getMatchOutcomeæ–¹æ³•æ‰æ˜¯åŒ¹é…é€»è¾‘ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@Override
public ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) {
    ConditionMessage matchMessage = ConditionMessage.empty();
    MergedAnnotations annotations = metadata.getAnnotations();
    
    // å¦‚æœå­˜åœ¨ConditionalOnBeanæ³¨è§£
    if (annotations.isPresent(ConditionalOnBean.class)) {
        Spec&lt;ConditionalOnBean&gt; spec = new Spec&lt;&gt;(context, metadata, annotations, ConditionalOnBean.class);
        MatchResult matchResult = getMatchingBeans(context, spec);
        
        // å¦‚æœæŸä¸ªBeanä¸å­˜åœ¨
        if (!matchResult.isAllMatched()) {
            String reason = createOnBeanNoMatchReason(matchResult);
            return ConditionOutcome.noMatch(spec.message().because(reason));
        }
        
        // æ‰€æœ‰Beanéƒ½å­˜åœ¨
        matchMessage = spec.message(matchMessage).found(&quot;bean&quot;, &quot;beans&quot;).items(Style.QUOTE,
                                                                               matchResult.getNamesOfAllMatches());
    }
    
    // å¦‚æœå­˜åœ¨ConditionalOnSingleCandidateæ³¨è§£
    if (metadata.isAnnotated(ConditionalOnSingleCandidate.class.getName())) {
        Spec&lt;ConditionalOnSingleCandidate&gt; spec = new SingleCandidateSpec(context, metadata, annotations);
        MatchResult matchResult = getMatchingBeans(context, spec);
        
        // Beanä¸å­˜åœ¨
        if (!matchResult.isAllMatched()) {
            return ConditionOutcome.noMatch(spec.message().didNotFind(&quot;any beans&quot;).atAll());
        }
        
        // Beanå­˜åœ¨
        Set&lt;String&gt; allBeans = matchResult.getNamesOfAllMatches();
        
        // å¦‚æœåªæœ‰ä¸€ä¸ª
        if (allBeans.size() == 1) {
            matchMessage = spec.message(matchMessage).found(&quot;a single bean&quot;).items(Style.QUOTE, allBeans);
        }
        else {
            // å¦‚æœæœ‰å¤šä¸ª
            List&lt;String&gt; primaryBeans = getPrimaryBeans(context.getBeanFactory(), allBeans,
                                                        spec.getStrategy() == SearchStrategy.ALL);
            
            // æ²¡æœ‰ä¸»Beanï¼Œé‚£å°±ä¸åŒ¹é…
            if (primaryBeans.isEmpty()) {
                return ConditionOutcome.noMatch(
                    spec.message().didNotFind(&quot;a primary bean from beans&quot;).items(Style.QUOTE, allBeans));
            }
            // æœ‰å¤šä¸ªä¸»Beanï¼Œé‚£å°±ä¸åŒ¹é…
            if (primaryBeans.size() &gt; 1) {
                return ConditionOutcome
                    .noMatch(spec.message().found(&quot;multiple primary beans&quot;).items(Style.QUOTE, primaryBeans));
            }
            
            // åªæœ‰ä¸€ä¸ªä¸»Bean
            matchMessage = spec.message(matchMessage)
                .found(&quot;a single primary bean &#39;&quot; + primaryBeans.get(0) + &quot;&#39; from beans&quot;)
                .items(Style.QUOTE, allBeans);
        }
    }
    
    // å­˜åœ¨ConditionalOnMissingBeanæ³¨è§£
    if (metadata.isAnnotated(ConditionalOnMissingBean.class.getName())) {
        Spec&lt;ConditionalOnMissingBean&gt; spec = new Spec&lt;&gt;(context, metadata, annotations,
                                                         ConditionalOnMissingBean.class);
        MatchResult matchResult = getMatchingBeans(context, spec);
        
        //æœ‰ä»»æ„ä¸€ä¸ªBeanå­˜åœ¨ï¼Œé‚£å°±æ¡ä»¶ä¸åŒ¹é…
        if (matchResult.isAnyMatched()) {
            String reason = createOnMissingBeanNoMatchReason(matchResult);
            return ConditionOutcome.noMatch(spec.message().because(reason));
        }
        
        // éƒ½ä¸å­˜åœ¨åœ¨ï¼Œåˆ™åŒ¹é…
        matchMessage = spec.message(matchMessage).didNotFind(&quot;any beans&quot;).atAll();
    }
    return ConditionOutcome.match(matchMessage);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€»è¾‘æµç¨‹ä¸ºï¼š</p><ol><li>å½“å‰åœ¨è§£æçš„ç±»æˆ–æ–¹æ³•ä¸Šï¼Œæ˜¯å¦æœ‰@ConditionalOnBeanæ³¨è§£ï¼Œå¦‚æœæœ‰åˆ™ç”Ÿæˆå¯¹åº”çš„Specå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­åŒ…å«äº†ç”¨æˆ·æŒ‡å®šçš„ï¼Œè¦åˆ¤æ–­çš„æ˜¯å¦å­˜åœ¨çš„Beançš„ç±»å‹</li><li>è°ƒç”¨getMatchingBeansæ–¹æ³•è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼ŒMatchResultä¸ºæ¡ä»¶åˆ¤æ–­ç»“æœ</li><li>åªè¦åˆ¤æ–­å‡ºæ¥æŸä¸€ä¸ªBeanä¸å­˜åœ¨ï¼Œåˆ™returnï¼Œè¡¨ç¤ºæ¡ä»¶ä¸åŒ¹é…</li><li>åªè¦æ‰€æœ‰Beanéƒ½å­˜åœ¨ï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢ä»£ç </li><li>å½“å‰åœ¨è§£æçš„ç±»æˆ–æ–¹æ³•ä¸Šï¼Œæ˜¯å¦æœ‰@ConditionalOnSingleCandidateæ³¨è§£ï¼Œå¦‚æœæœ‰åˆ™ç”Ÿæˆå¯¹åº”çš„SingleCandidateSpecå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­åŒ…å«äº†ç”¨æˆ·æŒ‡å®šçš„ï¼Œè¦åˆ¤æ–­çš„æ˜¯å¦å­˜åœ¨çš„Beançš„ç±»å‹ï¼ˆåªèƒ½æŒ‡å®šä¸€ä¸ªç±»å‹ï¼‰ï¼Œå¹¶ä¸”è¯¥ç±»å‹çš„Beanåªèƒ½æœ‰ä¸€ä¸ª</li><li>è°ƒç”¨getMatchingBeansæ–¹æ³•è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼ŒMatchResultä¸ºæ¡ä»¶åˆ¤æ–­ç»“æœ</li><li>æŒ‡å®šç±»å‹çš„Beanå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™returnï¼Œè¡¨ç¤ºæ¡ä»¶ä¸åŒ¹é…</li><li>å¦‚æœæŒ‡å®šç±»å‹çš„Beanå­˜åœ¨ï¼Œä½†æ˜¯å­˜åœ¨å¤šä¸ªï¼Œé‚£å°±çœ‹æ˜¯å¦å­˜åœ¨ä¸»Beanï¼ˆåŠ äº†@primaryæ³¨è§£çš„Beanï¼‰ï¼Œå¹¶ä¸”åªèƒ½æœ‰ä¸€ä¸ªä¸»Beanï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™returnï¼Œè¡¨ç¤ºæ¡ä»¶ä¸åŒ¹é…</li><li>å¦‚æœåªæœ‰ä¸€ä¸ªä¸»Beanï¼Œåˆ™è¡¨ç¤ºæ¡ä»¶åŒ¹é…ï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢ä»£ç </li><li>å½“å‰åœ¨è§£æçš„ç±»æˆ–æ–¹æ³•ä¸Šï¼Œæ˜¯å¦æœ‰@ConditionalOnMissingBeanæ³¨è§£ï¼Œå¦‚æœæœ‰åˆ™ç”Ÿæˆå¯¹åº”çš„Specå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­åŒ…å«äº†ç”¨æˆ·æŒ‡å®šçš„ï¼Œè¦åˆ¤æ–­çš„æ˜¯å¦ç¼ºå¤±çš„Beançš„ç±»å‹</li><li>è°ƒç”¨getMatchingBeansæ–¹æ³•è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼ŒMatchResultä¸ºæ¡ä»¶åˆ¤æ–­ç»“æœ</li><li>åªè¦æœ‰ä»»æ„ä¸€ä¸ªBeanå­˜åœ¨ï¼Œåˆ™returnï¼Œè¡¨ç¤ºæ¡ä»¶ä¸åŒ¹é…</li><li>éƒ½å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºæ¡ä»¶åŒ¹é…</li><li>ç»“æŸ</li></ol><p>getMatchingBeansæ–¹æ³•ä¸­ä¼šåˆ©ç”¨BeanFactoryå»è·å–æŒ‡å®šç±»å‹çš„Beanï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šç±»å‹çš„Beanï¼Œåˆ™ä¼šå°†è¯¥ç±»å‹è®°å½•åœ¨MatchResultå¯¹è±¡çš„unmatchedTypesé›†åˆä¸­ï¼Œå¦‚æœæœ‰è¯¥ç±»å‹çš„Beanï¼Œåˆ™ä¼šæŠŠè¯¥Beançš„beanNameè®°å½•åœ¨MatchResultå¯¹è±¡çš„matchedNamesé›†åˆä¸­ï¼Œæ‰€ä»¥MatchResultå¯¹è±¡ä¸­è®°å½•äº†ï¼Œå“ªäº›ç±»æ²¡æœ‰å¯¹åº”çš„Beanï¼Œå“ªäº›ç±»æœ‰å¯¹åº”çš„Beanã€‚</p><p>@ConditionalOnClasså’Œ@ConditionalOnBeanï¼Œè¿™ä¸¤ä¸ªæ¡ä»¶æ³¨è§£çš„å·¥ä½œåŸç†å°±åˆ†æåˆ°è¿™ï¼Œæ€»ç»“ä»¥ä¸‹æµç¨‹å°±æ˜¯ï¼š</p><ol><li>Springåœ¨è§£ææŸä¸ªé…ç½®ç±»ï¼Œæˆ–æŸä¸ªBeanå®šä¹‰æ—¶</li><li>å¦‚æœå‘ç°å®ƒä»¬ä¸Šé¢ç”¨åˆ°äº†æ¡ä»¶æ³¨è§£ï¼Œå°±ä¼šå–å‡ºæ‰€æœ‰çš„æ¡ä»¶çš„æ¡ä»¶æ³¨è§£ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„æ¡ä»¶å¯¹è±¡ï¼Œæ¯”å¦‚OnBeanConditionå¯¹è±¡ã€OnClassConditionå¯¹è±¡</li><li>ä»è€Œä¾æ¬¡è°ƒç”¨æ¡ä»¶å¯¹è±¡çš„matchesæ–¹æ³•ï¼Œè¿›è¡Œæ¡ä»¶åŒ¹é…ï¼Œçœ‹æ˜¯å¦ç¬¦åˆæ¡ä»¶</li><li>è€Œæ¡ä»¶åŒ¹é…é€»è¾‘ä¸­ï¼Œä¼šæ‹¿åˆ°@ConditionalOnClasså’Œ@ConditionalOnBeanç­‰æ¡ä»¶æ³¨è§£çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¦åˆ¤æ–­å“ªäº›ç±»å­˜åœ¨ã€å“ªäº›Beanå­˜åœ¨</li><li>ç„¶ååˆ©ç”¨ClassLaoderã€BeanFactoryæ¥è¿›è¡Œåˆ¤æ–­</li><li>æœ€ååªæœ‰æ‰€æœ‰æ¡ä»¶æ³¨è§£çš„æ¡ä»¶éƒ½åŒ¹é…ï¼Œé‚£ä¹ˆå½“å‰é…ç½®ç±»æˆ–Beanå®šä¹‰æ‰ç®—ç¬¦åˆæ¡ä»¶</li></ol><p>æºç æœ‰ç‚¹éš¾ï¼Œè€ç‚¹æ€§å­ï¼Œå¤šçœ‹å¤šè°ƒè¯•æºç ã€‚</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><!----><div class="copyright">Copyright Â© 2023 æ±Ÿ</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-6d45e392.js" defer></script>
  </body>
</html>
